"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/collections";
exports.ids = ["pages/api/collections"];
exports.modules = {

/***/ "(api-node)/./lib/auth-utils.js":
/*!***************************!*\
  !*** ./lib/auth-utils.js ***!
  \***************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateToken: () => (/* binding */ generateToken),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword)\n/* harmony export */ });\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcryptjs */ \"bcryptjs\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_1__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([bcryptjs__WEBPACK_IMPORTED_MODULE_0__]);\nbcryptjs__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n/**\n * Hash a password using bcrypt\n * @param {string} password - Plain text password to hash\n * @returns {Promise<string>} - Hashed password\n */ const hashPassword = async (password)=>{\n    const salt = await bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].genSalt(12);\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hash(password, salt);\n};\n/**\n * Verify a password against a hash\n * @param {string} password - Plain text password to check\n * @param {string} hash - Hashed password to compare against\n * @returns {Promise<boolean>} - True if password matches hash\n */ const verifyPassword = async (password, hash)=>{\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].compare(password, hash);\n};\n/**\n * Generate a random token (e.g., for email confirmation, password reset)\n * @param {number} length - Length of the token\n * @returns {string} - Random token\n */ const generateToken = (length = 32)=>{\n    return crypto__WEBPACK_IMPORTED_MODULE_1___default().randomBytes(length).toString('hex');\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9hdXRoLXV0aWxzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUE4QjtBQUNGO0FBRTVCOzs7O0NBSUMsR0FDTSxNQUFNRSxlQUFlLE9BQU9DO0lBQ2pDLE1BQU1DLE9BQU8sTUFBTUosd0RBQWMsQ0FBQztJQUNsQyxPQUFPQSxxREFBVyxDQUFDRyxVQUFVQztBQUMvQixFQUFFO0FBRUY7Ozs7O0NBS0MsR0FDTSxNQUFNRyxpQkFBaUIsT0FBT0osVUFBVUc7SUFDN0MsT0FBT04sd0RBQWMsQ0FBQ0csVUFBVUc7QUFDbEMsRUFBRTtBQUVGOzs7O0NBSUMsR0FDTSxNQUFNRyxnQkFBZ0IsQ0FBQ0MsU0FBUyxFQUFFO0lBQ3ZDLE9BQU9ULHlEQUFrQixDQUFDUyxRQUFRRSxRQUFRLENBQUM7QUFDN0MsRUFBRSIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxiYXVkaVxcT25lRHJpdmVcXERlc2t0b3BcXFByb21wdFByb1xcUHJvbXB0UHJvXFxsaWJcXGF1dGgtdXRpbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5cbi8qKlxuICogSGFzaCBhIHBhc3N3b3JkIHVzaW5nIGJjcnlwdFxuICogQHBhcmFtIHtzdHJpbmd9IHBhc3N3b3JkIC0gUGxhaW4gdGV4dCBwYXNzd29yZCB0byBoYXNoXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSAtIEhhc2hlZCBwYXNzd29yZFxuICovXG5leHBvcnQgY29uc3QgaGFzaFBhc3N3b3JkID0gYXN5bmMgKHBhc3N3b3JkKSA9PiB7XG4gIGNvbnN0IHNhbHQgPSBhd2FpdCBiY3J5cHQuZ2VuU2FsdCgxMik7XG4gIHJldHVybiBiY3J5cHQuaGFzaChwYXNzd29yZCwgc2FsdCk7XG59O1xuXG4vKipcbiAqIFZlcmlmeSBhIHBhc3N3b3JkIGFnYWluc3QgYSBoYXNoXG4gKiBAcGFyYW0ge3N0cmluZ30gcGFzc3dvcmQgLSBQbGFpbiB0ZXh0IHBhc3N3b3JkIHRvIGNoZWNrXG4gKiBAcGFyYW0ge3N0cmluZ30gaGFzaCAtIEhhc2hlZCBwYXNzd29yZCB0byBjb21wYXJlIGFnYWluc3RcbiAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSAtIFRydWUgaWYgcGFzc3dvcmQgbWF0Y2hlcyBoYXNoXG4gKi9cbmV4cG9ydCBjb25zdCB2ZXJpZnlQYXNzd29yZCA9IGFzeW5jIChwYXNzd29yZCwgaGFzaCkgPT4ge1xuICByZXR1cm4gYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIGhhc2gpO1xufTtcblxuLyoqXG4gKiBHZW5lcmF0ZSBhIHJhbmRvbSB0b2tlbiAoZS5nLiwgZm9yIGVtYWlsIGNvbmZpcm1hdGlvbiwgcGFzc3dvcmQgcmVzZXQpXG4gKiBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIC0gTGVuZ3RoIG9mIHRoZSB0b2tlblxuICogQHJldHVybnMge3N0cmluZ30gLSBSYW5kb20gdG9rZW5cbiAqL1xuZXhwb3J0IGNvbnN0IGdlbmVyYXRlVG9rZW4gPSAobGVuZ3RoID0gMzIpID0+IHtcbiAgcmV0dXJuIGNyeXB0by5yYW5kb21CeXRlcyhsZW5ndGgpLnRvU3RyaW5nKCdoZXgnKTtcbn07Il0sIm5hbWVzIjpbImJjcnlwdCIsImNyeXB0byIsImhhc2hQYXNzd29yZCIsInBhc3N3b3JkIiwic2FsdCIsImdlblNhbHQiLCJoYXNoIiwidmVyaWZ5UGFzc3dvcmQiLCJjb21wYXJlIiwiZ2VuZXJhdGVUb2tlbiIsImxlbmd0aCIsInJhbmRvbUJ5dGVzIiwidG9TdHJpbmciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/auth-utils.js\n");

/***/ }),

/***/ "(api-node)/./lib/auth.js":
/*!*********************!*\
  !*** ./lib/auth.js ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAuthSession: () => (/* binding */ getAuthSession),\n/* harmony export */   withAuth: () => (/* binding */ withAuth),\n/* harmony export */   withAuthForMethods: () => (/* binding */ withAuthForMethods)\n/* harmony export */ });\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/jwt */ \"next-auth/jwt\");\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__);\n\n/**\n * Check if the request is authenticated\n * @param {Object} req - The request object\n * @returns {Promise<Object|null>} - The user session or null if not authenticated\n */ async function getAuthSession(req) {\n    return await (0,next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__.getToken)({\n        req,\n        secret: process.env.NEXTAUTH_SECRET\n    });\n}\n/**\n * Higher-order function that creates an API handler that requires authentication\n * @param {Function} handler - The API handler to protect\n * @returns {Function} - The protected API handler\n */ function withAuth(handler) {\n    return async (req, res)=>{\n        const session = await getAuthSession(req);\n        if (!session) {\n            return res.status(401).json({\n                error: \"Unauthorized\"\n            });\n        }\n        // Add the session to the request object\n        req.session = session;\n        // Also add a user property for compatibility\n        req.user = {\n            id: session.sub || session.id,\n            name: session.name,\n            email: session.email\n        };\n        // Call the original handler\n        return handler(req, res);\n    };\n}\n/**\n * Higher-order function that optionally requires authentication for certain methods\n * @param {Function} handler - The API handler \n * @param {Array} protectedMethods - HTTP methods that require authentication (e.g., ['POST', 'PUT', 'DELETE'])\n * @returns {Function} - The conditionally protected API handler\n */ function withAuthForMethods(handler, protectedMethods = [\n    'POST',\n    'PUT',\n    'DELETE'\n]) {\n    return async (req, res)=>{\n        // Check if the current method requires authentication\n        if (protectedMethods.includes(req.method)) {\n            const session = await getAuthSession(req);\n            if (!session) {\n                return res.status(401).json({\n                    error: \"Unauthorized\"\n                });\n            }\n            // Add the session to the request object\n            req.session = session;\n            // Also add a user property for compatibility\n            req.user = {\n                id: session.sub || session.id,\n                name: session.name,\n                email: session.email\n            };\n        }\n        // Call the original handler\n        return handler(req, res);\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9hdXRoLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQXlDO0FBRXpDOzs7O0NBSUMsR0FDTSxlQUFlQyxlQUFlQyxHQUFHO0lBQ3RDLE9BQU8sTUFBTUYsdURBQVFBLENBQUM7UUFBRUU7UUFBS0MsUUFBUUMsUUFBUUMsR0FBRyxDQUFDQyxlQUFlO0lBQUM7QUFDbkU7QUFFQTs7OztDQUlDLEdBQ00sU0FBU0MsU0FBU0MsT0FBTztJQUM5QixPQUFPLE9BQU9OLEtBQUtPO1FBQ2pCLE1BQU1DLFVBQVUsTUFBTVQsZUFBZUM7UUFFckMsSUFBSSxDQUFDUSxTQUFTO1lBQ1osT0FBT0QsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFlO1FBQ3REO1FBRUEsd0NBQXdDO1FBQ3hDWCxJQUFJUSxPQUFPLEdBQUdBO1FBRWQsNkNBQTZDO1FBQzdDUixJQUFJWSxJQUFJLEdBQUc7WUFDVEMsSUFBSUwsUUFBUU0sR0FBRyxJQUFJTixRQUFRSyxFQUFFO1lBQzdCRSxNQUFNUCxRQUFRTyxJQUFJO1lBQ2xCQyxPQUFPUixRQUFRUSxLQUFLO1FBQ3RCO1FBRUEsNEJBQTRCO1FBQzVCLE9BQU9WLFFBQVFOLEtBQUtPO0lBQ3RCO0FBQ0Y7QUFFQTs7Ozs7Q0FLQyxHQUNNLFNBQVNVLG1CQUFtQlgsT0FBTyxFQUFFWSxtQkFBbUI7SUFBQztJQUFRO0lBQU87Q0FBUztJQUN0RixPQUFPLE9BQU9sQixLQUFLTztRQUNqQixzREFBc0Q7UUFDdEQsSUFBSVcsaUJBQWlCQyxRQUFRLENBQUNuQixJQUFJb0IsTUFBTSxHQUFHO1lBQ3pDLE1BQU1aLFVBQVUsTUFBTVQsZUFBZUM7WUFFckMsSUFBSSxDQUFDUSxTQUFTO2dCQUNaLE9BQU9ELElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQUVDLE9BQU87Z0JBQWU7WUFDdEQ7WUFFQSx3Q0FBd0M7WUFDeENYLElBQUlRLE9BQU8sR0FBR0E7WUFFZCw2Q0FBNkM7WUFDN0NSLElBQUlZLElBQUksR0FBRztnQkFDVEMsSUFBSUwsUUFBUU0sR0FBRyxJQUFJTixRQUFRSyxFQUFFO2dCQUM3QkUsTUFBTVAsUUFBUU8sSUFBSTtnQkFDbEJDLE9BQU9SLFFBQVFRLEtBQUs7WUFDdEI7UUFDRjtRQUVBLDRCQUE0QjtRQUM1QixPQUFPVixRQUFRTixLQUFLTztJQUN0QjtBQUNGIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXGJhdWRpXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvbXB0UHJvXFxQcm9tcHRQcm9cXGxpYlxcYXV0aC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRUb2tlbiB9IGZyb20gXCJuZXh0LWF1dGgvand0XCI7XG5cbi8qKlxuICogQ2hlY2sgaWYgdGhlIHJlcXVlc3QgaXMgYXV0aGVudGljYXRlZFxuICogQHBhcmFtIHtPYmplY3R9IHJlcSAtIFRoZSByZXF1ZXN0IG9iamVjdFxuICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0fG51bGw+fSAtIFRoZSB1c2VyIHNlc3Npb24gb3IgbnVsbCBpZiBub3QgYXV0aGVudGljYXRlZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXV0aFNlc3Npb24ocmVxKSB7XG4gIHJldHVybiBhd2FpdCBnZXRUb2tlbih7IHJlcSwgc2VjcmV0OiBwcm9jZXNzLmVudi5ORVhUQVVUSF9TRUNSRVQgfSk7XG59XG5cbi8qKlxuICogSGlnaGVyLW9yZGVyIGZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhbiBBUEkgaGFuZGxlciB0aGF0IHJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIC0gVGhlIEFQSSBoYW5kbGVyIHRvIHByb3RlY3RcbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gLSBUaGUgcHJvdGVjdGVkIEFQSSBoYW5kbGVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoQXV0aChoYW5kbGVyKSB7XG4gIHJldHVybiBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0QXV0aFNlc3Npb24ocmVxKTtcbiAgICBcbiAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBBZGQgdGhlIHNlc3Npb24gdG8gdGhlIHJlcXVlc3Qgb2JqZWN0XG4gICAgcmVxLnNlc3Npb24gPSBzZXNzaW9uO1xuICAgIFxuICAgIC8vIEFsc28gYWRkIGEgdXNlciBwcm9wZXJ0eSBmb3IgY29tcGF0aWJpbGl0eVxuICAgIHJlcS51c2VyID0ge1xuICAgICAgaWQ6IHNlc3Npb24uc3ViIHx8IHNlc3Npb24uaWQsXG4gICAgICBuYW1lOiBzZXNzaW9uLm5hbWUsXG4gICAgICBlbWFpbDogc2Vzc2lvbi5lbWFpbFxuICAgIH07XG4gICAgXG4gICAgLy8gQ2FsbCB0aGUgb3JpZ2luYWwgaGFuZGxlclxuICAgIHJldHVybiBoYW5kbGVyKHJlcSwgcmVzKTtcbiAgfTtcbn1cblxuLyoqXG4gKiBIaWdoZXItb3JkZXIgZnVuY3Rpb24gdGhhdCBvcHRpb25hbGx5IHJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uIGZvciBjZXJ0YWluIG1ldGhvZHNcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgLSBUaGUgQVBJIGhhbmRsZXIgXG4gKiBAcGFyYW0ge0FycmF5fSBwcm90ZWN0ZWRNZXRob2RzIC0gSFRUUCBtZXRob2RzIHRoYXQgcmVxdWlyZSBhdXRoZW50aWNhdGlvbiAoZS5nLiwgWydQT1NUJywgJ1BVVCcsICdERUxFVEUnXSlcbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gLSBUaGUgY29uZGl0aW9uYWxseSBwcm90ZWN0ZWQgQVBJIGhhbmRsZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhBdXRoRm9yTWV0aG9kcyhoYW5kbGVyLCBwcm90ZWN0ZWRNZXRob2RzID0gWydQT1NUJywgJ1BVVCcsICdERUxFVEUnXSkge1xuICByZXR1cm4gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgLy8gQ2hlY2sgaWYgdGhlIGN1cnJlbnQgbWV0aG9kIHJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uXG4gICAgaWYgKHByb3RlY3RlZE1ldGhvZHMuaW5jbHVkZXMocmVxLm1ldGhvZCkpIHtcbiAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRBdXRoU2Vzc2lvbihyZXEpO1xuICAgICAgXG4gICAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEFkZCB0aGUgc2Vzc2lvbiB0byB0aGUgcmVxdWVzdCBvYmplY3RcbiAgICAgIHJlcS5zZXNzaW9uID0gc2Vzc2lvbjtcbiAgICAgIFxuICAgICAgLy8gQWxzbyBhZGQgYSB1c2VyIHByb3BlcnR5IGZvciBjb21wYXRpYmlsaXR5XG4gICAgICByZXEudXNlciA9IHtcbiAgICAgICAgaWQ6IHNlc3Npb24uc3ViIHx8IHNlc3Npb24uaWQsXG4gICAgICAgIG5hbWU6IHNlc3Npb24ubmFtZSxcbiAgICAgICAgZW1haWw6IHNlc3Npb24uZW1haWxcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIC8vIENhbGwgdGhlIG9yaWdpbmFsIGhhbmRsZXJcbiAgICByZXR1cm4gaGFuZGxlcihyZXEsIHJlcyk7XG4gIH07XG59Il0sIm5hbWVzIjpbImdldFRva2VuIiwiZ2V0QXV0aFNlc3Npb24iLCJyZXEiLCJzZWNyZXQiLCJwcm9jZXNzIiwiZW52IiwiTkVYVEFVVEhfU0VDUkVUIiwid2l0aEF1dGgiLCJoYW5kbGVyIiwicmVzIiwic2Vzc2lvbiIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInVzZXIiLCJpZCIsInN1YiIsIm5hbWUiLCJlbWFpbCIsIndpdGhBdXRoRm9yTWV0aG9kcyIsInByb3RlY3RlZE1ldGhvZHMiLCJpbmNsdWRlcyIsIm1ldGhvZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/auth.js\n");

/***/ }),

/***/ "(api-node)/./lib/db.js":
/*!*******************!*\
  !*** ./lib/db.js ***!
  \*******************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addPromptToCollection: () => (/* binding */ addPromptToCollection),\n/* harmony export */   addTeamMember: () => (/* binding */ addTeamMember),\n/* harmony export */   createCollection: () => (/* binding */ createCollection),\n/* harmony export */   createComment: () => (/* binding */ createComment),\n/* harmony export */   createPrompt: () => (/* binding */ createPrompt),\n/* harmony export */   createTeam: () => (/* binding */ createTeam),\n/* harmony export */   createUser: () => (/* binding */ createUser),\n/* harmony export */   deleteCollection: () => (/* binding */ deleteCollection),\n/* harmony export */   deleteComment: () => (/* binding */ deleteComment),\n/* harmony export */   deletePrompt: () => (/* binding */ deletePrompt),\n/* harmony export */   deleteTeam: () => (/* binding */ deleteTeam),\n/* harmony export */   deleteUser: () => (/* binding */ deleteUser),\n/* harmony export */   getAllCollections: () => (/* binding */ getAllCollections),\n/* harmony export */   getAllPrompts: () => (/* binding */ getAllPrompts),\n/* harmony export */   getAllUsers: () => (/* binding */ getAllUsers),\n/* harmony export */   getCollectionById: () => (/* binding */ getCollectionById),\n/* harmony export */   getCommentsByPromptId: () => (/* binding */ getCommentsByPromptId),\n/* harmony export */   getPromptById: () => (/* binding */ getPromptById),\n/* harmony export */   getTeamById: () => (/* binding */ getTeamById),\n/* harmony export */   getTeamsByUserId: () => (/* binding */ getTeamsByUserId),\n/* harmony export */   getUserByEmail: () => (/* binding */ getUserByEmail),\n/* harmony export */   getUserById: () => (/* binding */ getUserById),\n/* harmony export */   removePromptFromCollection: () => (/* binding */ removePromptFromCollection),\n/* harmony export */   removeTeamMember: () => (/* binding */ removeTeamMember),\n/* harmony export */   updateCollection: () => (/* binding */ updateCollection),\n/* harmony export */   updateComment: () => (/* binding */ updateComment),\n/* harmony export */   updatePrompt: () => (/* binding */ updatePrompt),\n/* harmony export */   updateTeam: () => (/* binding */ updateTeam),\n/* harmony export */   updateUser: () => (/* binding */ updateUser)\n/* harmony export */ });\n/* harmony import */ var _mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./mongodb */ \"(api-node)/./lib/mongodb.js\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _auth_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./auth-utils */ \"(api-node)/./lib/auth-utils.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_auth_utils__WEBPACK_IMPORTED_MODULE_2__]);\n_auth_utils__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n // Assuming auth-utils handles password hashing\n/**\n * Helper function to get the database and collections.\n */ async function getCollections() {\n    const { db } = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.connectToDatabase)();\n    return {\n        users: db.collection('users'),\n        prompts: db.collection('prompts'),\n        collections: db.collection('collections'),\n        teams: db.collection('teams'),\n        comments: db.collection('comments')\n    };\n}\n/**\n * Helper function to convert string ID to ObjectId.\n * Returns null if the ID is invalid.\n */ function toObjectId(id) {\n    if (!id || !mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId.isValid(id)) {\n        return null;\n    }\n    try {\n        return new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(id);\n    } catch (error) {\n        // Handle potential errors during ObjectId creation if needed\n        console.error(\"Error creating ObjectId:\", error);\n        return null;\n    }\n}\n// --- Prompt Functions ---\nconst getAllPrompts = async (filter = {}, options = {})=>{\n    try {\n        const { prompts } = await getCollections();\n        const cursor = prompts.find(filter);\n        // Add sorting if specified in options\n        if (options.sort) {\n            cursor.sort(options.sort);\n        } else {\n            cursor.sort({\n                createdAt: -1\n            }); // Default sort: newest first\n        }\n        // Add limit if specified\n        if (options.limit) {\n            cursor.limit(options.limit);\n        }\n        // Add skip for pagination if specified\n        if (options.skip) {\n            cursor.skip(options.skip);\n        }\n        const allPrompts = await cursor.toArray();\n        return allPrompts;\n    } catch (error) {\n        console.error(\"Error fetching all prompts:\", error);\n        throw new Error(\"Database error while fetching prompts.\");\n    }\n};\nconst getPromptById = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { prompts } = await getCollections();\n        const prompt = await prompts.findOne({\n            _id: objectId\n        });\n        return prompt;\n    } catch (error) {\n        console.error(\"Error fetching prompt by ID:\", error);\n        throw new Error(\"Database error while fetching prompt.\");\n    }\n};\nconst createPrompt = async (promptData)=>{\n    try {\n        const { prompts } = await getCollections();\n        const now = new Date();\n        const newPrompt = {\n            title: promptData.title,\n            content: promptData.content,\n            description: promptData.description || '',\n            tags: promptData.tags || [],\n            aiPlatform: promptData.aiPlatform || 'ChatGPT',\n            rating: promptData.rating || 0,\n            usageCount: promptData.usageCount || 0,\n            successRate: promptData.successRate || 0,\n            visibility: promptData.visibility || 'private',\n            userId: promptData.userId,\n            createdBy: promptData.createdBy,\n            teamId: promptData.teamId ? toObjectId(promptData.teamId) : null,\n            createdAt: now,\n            updatedAt: now\n        };\n        const result = await prompts.insertOne(newPrompt);\n        return {\n            ...newPrompt,\n            _id: result.insertedId\n        };\n    } catch (error) {\n        console.error(\"Error creating prompt:\", error);\n        throw new Error(\"Database error while creating prompt.\");\n    }\n};\nconst updatePrompt = async (id, promptData)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { prompts } = await getCollections();\n        const updateDoc = {\n            $set: {}\n        };\n        // Add fields to update only if they are provided\n        for (const key of [\n            'title',\n            'content',\n            'description',\n            'tags',\n            'aiPlatform',\n            'rating',\n            'usageCount',\n            'successRate',\n            'visibility',\n            'createdBy'\n        ]){\n            if (promptData[key] !== undefined) {\n                updateDoc.$set[key] = promptData[key];\n            }\n        }\n        // Handle teamId separately - allow setting to null or a valid ObjectId\n        if (promptData.teamId !== undefined) {\n            updateDoc.$set.teamId = promptData.teamId ? toObjectId(promptData.teamId) : null;\n        }\n        // Don't update userId or createdAt\n        updateDoc.$set.updatedAt = new Date();\n        if (Object.keys(updateDoc.$set).length === 1) {\n            // Maybe skip update if only timestamp changes?\n            return prompts.findOne({\n                _id: objectId\n            }); // Return current doc\n        }\n        const result = await prompts.updateOne({\n            _id: objectId\n        }, updateDoc);\n        if (result.matchedCount === 0) {\n            return null; // Prompt not found\n        }\n        const updatedPrompt = await prompts.findOne({\n            _id: objectId\n        });\n        return updatedPrompt;\n    } catch (error) {\n        console.error(\"Error updating prompt:\", error);\n        throw new Error(\"Database error while updating prompt.\");\n    }\n};\nconst deletePrompt = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return false;\n    try {\n        const { prompts } = await getCollections();\n        // TODO: Consider deleting associated comments or handling dependencies\n        const result = await prompts.deleteOne({\n            _id: objectId\n        });\n        return result.deletedCount > 0;\n    } catch (error) {\n        console.error(\"Error deleting prompt:\", error);\n        throw new Error(\"Database error while deleting prompt.\");\n    }\n};\n// TODO: Implement searchPrompts using MongoDB's text search or complex filtering\n// export const searchPrompts = async (query, options = {}) => { ... };\n// --- Collection Functions ---\nconst getAllCollections = async (filter = {}, options = {})=>{\n    try {\n        const { collections } = await getCollections();\n        const cursor = collections.find(filter);\n        if (options.sort) cursor.sort(options.sort);\n        if (options.limit) cursor.limit(options.limit);\n        if (options.skip) cursor.skip(options.skip);\n        const allCollections = await cursor.toArray();\n        return allCollections;\n    } catch (error) {\n        console.error(\"Error fetching all collections:\", error);\n        throw new Error(\"Database error while fetching collections.\");\n    }\n};\nconst getCollectionById = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { collections } = await getCollections();\n        // Optionally use aggregation to populate prompts if needed immediately\n        const collection = await collections.findOne({\n            _id: objectId\n        });\n        return collection;\n    } catch (error) {\n        console.error(\"Error fetching collection by ID:\", error);\n        throw new Error(\"Database error while fetching collection.\");\n    }\n};\nconst createCollection = async (collectionData)=>{\n    try {\n        const { collections } = await getCollections();\n        const now = new Date();\n        const newCollection = {\n            name: collectionData.name,\n            description: collectionData.description || '',\n            userId: collectionData.userId,\n            prompts: [],\n            createdAt: now,\n            updatedAt: now\n        };\n        const result = await collections.insertOne(newCollection);\n        return {\n            ...newCollection,\n            _id: result.insertedId\n        };\n    } catch (error) {\n        console.error(\"Error creating collection:\", error);\n        throw new Error(\"Database error while creating collection.\");\n    }\n};\nconst updateCollection = async (id, collectionData)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { collections } = await getCollections();\n        const updateDoc = {\n            $set: {}\n        };\n        if (collectionData.name !== undefined) updateDoc.$set.name = collectionData.name;\n        if (collectionData.description !== undefined) updateDoc.$set.description = collectionData.description;\n        // Note: Managing the 'prompts' array (add/remove) typically done via separate functions\n        updateDoc.$set.updatedAt = new Date();\n        if (Object.keys(updateDoc.$set).length > 1) {\n            const result = await collections.updateOne({\n                _id: objectId\n            }, updateDoc);\n            if (result.matchedCount === 0) return null;\n        }\n        const updatedCollection = await collections.findOne({\n            _id: objectId\n        });\n        return updatedCollection;\n    } catch (error) {\n        console.error(\"Error updating collection:\", error);\n        throw new Error(\"Database error while updating collection.\");\n    }\n};\nconst deleteCollection = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return false;\n    try {\n        const { collections } = await getCollections();\n        const result = await collections.deleteOne({\n            _id: objectId\n        });\n        return result.deletedCount > 0;\n    } catch (error) {\n        console.error(\"Error deleting collection:\", error);\n        throw new Error(\"Database error while deleting collection.\");\n    }\n};\nconst addPromptToCollection = async (collectionId, promptId)=>{\n    const collObjectId = toObjectId(collectionId);\n    const promptObjectId = toObjectId(promptId);\n    if (!collObjectId || !promptObjectId) return null;\n    try {\n        const { collections } = await getCollections();\n        // Use $addToSet to add the prompt's ObjectId to the array if not already present\n        const result = await collections.updateOne({\n            _id: collObjectId\n        }, {\n            $addToSet: {\n                prompts: promptObjectId\n            },\n            $set: {\n                updatedAt: new Date()\n            }\n        });\n        if (result.matchedCount === 0) return null; // Collection not found\n        const updatedCollection = await collections.findOne({\n            _id: collObjectId\n        });\n        return updatedCollection;\n    } catch (error) {\n        console.error(\"Error adding prompt to collection:\", error);\n        throw new Error(\"Database error while adding prompt to collection.\");\n    }\n};\nconst removePromptFromCollection = async (collectionId, promptId)=>{\n    const collObjectId = toObjectId(collectionId);\n    const promptObjectId = toObjectId(promptId);\n    if (!collObjectId || !promptObjectId) return null;\n    try {\n        const { collections } = await getCollections();\n        // Use $pull to remove the prompt's ObjectId from the array\n        const result = await collections.updateOne({\n            _id: collObjectId\n        }, {\n            $pull: {\n                prompts: promptObjectId\n            },\n            $set: {\n                updatedAt: new Date()\n            }\n        });\n        if (result.matchedCount === 0) return null; // Collection not found\n        const updatedCollection = await collections.findOne({\n            _id: collObjectId\n        });\n        return updatedCollection;\n    } catch (error) {\n        console.error(\"Error removing prompt from collection:\", error);\n        throw new Error(\"Database error while removing prompt from collection.\");\n    }\n};\n// --- User Functions ---\n// Note: These are basic implementations. Authentication libraries often handle user management.\nconst getAllUsers = async (filter = {}, options = {})=>{\n    try {\n        const { users } = await getCollections();\n        // Exclude password field by default\n        const cursor = users.find(filter, {\n            projection: {\n                password: 0\n            }\n        });\n        if (options.sort) cursor.sort(options.sort);\n        if (options.limit) cursor.limit(options.limit);\n        if (options.skip) cursor.skip(options.skip);\n        const allUsers = await cursor.toArray();\n        return allUsers;\n    } catch (error) {\n        console.error(\"Error fetching all users:\", error);\n        throw new Error(\"Database error while fetching users.\");\n    }\n};\nconst getUserById = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { users } = await getCollections();\n        const user = await users.findOne({\n            _id: objectId\n        }, {\n            projection: {\n                password: 0\n            }\n        });\n        return user;\n    } catch (error) {\n        console.error(\"Error fetching user by ID:\", error);\n        throw new Error(\"Database error while fetching user.\");\n    }\n};\nconst getUserByEmail = async (email)=>{\n    if (!email) return null;\n    try {\n        const { users } = await getCollections();\n        // Find user by email, but DO include password for authentication checks\n        const user = await users.findOne({\n            email: email.toLowerCase()\n        });\n        return user;\n    } catch (error) {\n        console.error(\"Error fetching user by email:\", error);\n        throw new Error(\"Database error while fetching user.\");\n    }\n};\nconst createUser = async (userData)=>{\n    if (!userData.email || !userData.password) {\n        throw new Error(\"Email and password are required to create a user.\");\n    }\n    try {\n        const { users } = await getCollections();\n        const now = new Date();\n        // Check if user already exists\n        const existingUser = await users.findOne({\n            email: userData.email.toLowerCase()\n        });\n        if (existingUser) {\n            throw new Error(\"User with this email already exists.\");\n        }\n        // Hash password before storing\n        const hashedPassword = await (0,_auth_utils__WEBPACK_IMPORTED_MODULE_2__.hashPassword)(userData.password);\n        const newUser = {\n            name: userData.name || '',\n            email: userData.email.toLowerCase(),\n            password: hashedPassword,\n            image: userData.image || null,\n            // Add roles or other fields as needed\n            createdAt: now,\n            updatedAt: now\n        };\n        const result = await users.insertOne(newUser);\n        // Return user data without the password hash\n        const { password, ...userWithoutPassword } = newUser;\n        return {\n            ...userWithoutPassword,\n            _id: result.insertedId\n        };\n    } catch (error) {\n        console.error(\"Error creating user:\", error);\n        // Rethrow specific errors or a generic one\n        if (error.message === \"User with this email already exists.\") {\n            throw error;\n        }\n        throw new Error(\"Database error while creating user.\");\n    }\n};\nconst updateUser = async (id, userData)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { users } = await getCollections();\n        const updateDoc = {\n            $set: {}\n        };\n        if (userData.name !== undefined) updateDoc.$set.name = userData.name;\n        if (userData.image !== undefined) updateDoc.$set.image = userData.image;\n        // Add other updatable fields (e.g., roles)\n        // Handle email change carefully\n        if (userData.email && typeof userData.email === 'string') {\n            const newEmail = userData.email.toLowerCase();\n            const existingUser = await users.findOne({\n                email: newEmail\n            });\n            // Allow update only if email doesn't exist OR belongs to the current user\n            if (existingUser && !existingUser._id.equals(objectId)) {\n                throw new Error(\"Email address is already in use.\");\n            }\n            updateDoc.$set.email = newEmail;\n        }\n        // Do not allow password update through this general function\n        // Create a specific changePassword function if needed\n        updateDoc.$set.updatedAt = new Date();\n        if (Object.keys(updateDoc.$set).length > 1) {\n            const result = await users.updateOne({\n                _id: objectId\n            }, updateDoc);\n            if (result.matchedCount === 0) return null;\n        }\n        const updatedUser = await users.findOne({\n            _id: objectId\n        }, {\n            projection: {\n                password: 0\n            }\n        });\n        return updatedUser;\n    } catch (error) {\n        console.error(\"Error updating user:\", error);\n        if (error.message === \"Email address is already in use.\") {\n            throw error;\n        }\n        throw new Error(\"Database error while updating user.\");\n    }\n};\nconst deleteUser = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return false;\n    try {\n        const { users } = await getCollections();\n        // TODO: Handle related data cleanup (e.g., reassign prompts?)\n        const result = await users.deleteOne({\n            _id: objectId\n        });\n        return result.deletedCount > 0;\n    } catch (error) {\n        console.error(\"Error deleting user:\", error);\n        throw new Error(\"Database error while deleting user.\");\n    }\n};\n// --- Team Functions (already refactored) ---\nconst getTeamById = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null; // Invalid ID format\n    try {\n        const { teams } = await getCollections();\n        // Fetch team and potentially populate member details if needed later\n        const team = await teams.findOne({\n            _id: objectId\n        });\n        // Optionally convert member userIds back to string if needed for frontend\n        // if (team && team.members) {\n        //   team.members = team.members.map(member => ({ ...member, userId: member.userId.toString() }));\n        // }\n        // Convert main _id to string\n        // if (team) team._id = team._id.toString();\n        return team; // Returns the team document or null if not found\n    } catch (error) {\n        console.error(\"Error fetching team by ID:\", error);\n        throw new Error(\"Database error while fetching team.\");\n    }\n};\nconst getTeamsByUserId = async (userId)=>{\n    // Ensure userId is treated as a string for matching unless it's clearly an ObjectId\n    const userIdString = userId.toString();\n    const userObjectId = toObjectId(userId); // Attempt conversion\n    try {\n        const { teams } = await getCollections();\n        // Find teams where the user is the owner (userId field)\n        // OR the user is in the members array (assuming member.userId is stored as string)\n        const query = {\n            'members.userId': userIdString\n        };\n        // If the original userId was *also* the ownerId field, add that check\n        // This depends on how owner `userId` is stored (string vs ObjectId)\n        // Let's assume owner `userId` might match the string ID from session\n        const ownerQuery = {\n            userId: userIdString\n        };\n        // Combine queries\n        const finalQuery = {\n            $or: [\n                query,\n                ownerQuery\n            ]\n        };\n        // If the userId *was* a valid ObjectId, also check for ObjectId matches \n        // (in case some IDs are stored as ObjectIds)\n        if (userObjectId) {\n            finalQuery.$or.push({\n                'members.userId': userObjectId\n            });\n            finalQuery.$or.push({\n                userId: userObjectId\n            });\n        }\n        const userTeams = await teams.find(finalQuery).toArray();\n        return userTeams;\n    } catch (error) {\n        console.error(\"Error fetching teams by user ID:\", error);\n        throw new Error(\"Database error while fetching user's teams.\");\n    }\n};\nconst createTeam = async (teamData)=>{\n    try {\n        const { teams, users } = await getCollections();\n        const now = new Date();\n        const ownerUserId = teamData.userId; // Assume this is the string ID from session\n        // Fetch owner's name\n        let ownerName = 'Owner'; // Default\n        const ownerUser = await users.findOne({\n            _id: toObjectId(ownerUserId)\n        }, {\n            projection: {\n                name: 1\n            }\n        });\n        if (ownerUser && ownerUser.name) {\n            ownerName = ownerUser.name;\n        }\n        const newTeam = {\n            name: teamData.name,\n            description: teamData.description || '',\n            userId: ownerUserId,\n            members: [],\n            createdAt: now,\n            updatedAt: now\n        };\n        // Add creator as the owner\n        newTeam.members.push({\n            userId: ownerUserId,\n            role: 'owner',\n            joinedAt: now,\n            name: ownerName // Add owner's name\n        });\n        const result = await teams.insertOne(newTeam);\n        return {\n            ...newTeam,\n            _id: result.insertedId\n        };\n    } catch (error) {\n        console.error(\"Error creating team:\", error);\n        throw new Error(\"Database error while creating team.\");\n    }\n};\nconst updateTeam = async (id, teamData)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { teams } = await getCollections();\n        const updateDoc = {\n            $set: {}\n        };\n        if (teamData.name !== undefined) updateDoc.$set.name = teamData.name;\n        if (teamData.description !== undefined) updateDoc.$set.description = teamData.description;\n        updateDoc.$set.updatedAt = new Date();\n        if (Object.keys(updateDoc.$set).length > 1) {\n            const result = await teams.updateOne({\n                _id: objectId\n            }, updateDoc);\n            if (result.matchedCount === 0) return null;\n        }\n        const updatedTeam = await teams.findOne({\n            _id: objectId\n        });\n        return updatedTeam;\n    } catch (error) {\n        console.error(\"Error updating team:\", error);\n        throw new Error(\"Database error while updating team.\");\n    }\n};\nconst deleteTeam = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return false;\n    try {\n        const { teams } = await getCollections();\n        // TODO: Handle related data cleanup (e.g., prompts belonging to team?)\n        const result = await teams.deleteOne({\n            _id: objectId\n        });\n        return result.deletedCount > 0;\n    } catch (error) {\n        console.error(\"Error deleting team:\", error);\n        throw new Error(\"Database error while deleting team.\");\n    }\n};\nconst addTeamMember = async (teamId, memberData)=>{\n    const teamObjectId = toObjectId(teamId);\n    if (!teamObjectId) return null;\n    if (!memberData || !memberData.userId) throw new Error(\"Member user ID is required.\");\n    const memberUserId = memberData.userId; // Assume string ID from request\n    try {\n        const { teams, users } = await getCollections();\n        const now = new Date();\n        // Fetch member's name\n        let memberName = 'Member'; // Default\n        const memberUser = await users.findOne({\n            _id: toObjectId(memberUserId)\n        }, {\n            projection: {\n                name: 1\n            }\n        });\n        if (memberUser && memberUser.name) {\n            memberName = memberUser.name;\n        }\n        const memberRecord = {\n            userId: memberUserId,\n            role: memberData.role || 'member',\n            joinedAt: now,\n            name: memberName // Add member's name\n        };\n        // Check if user is already a member (using the string ID)\n        const team = await teams.findOne({\n            _id: teamObjectId,\n            'members.userId': memberUserId\n        });\n        if (team) {\n            console.log(\"User is already a member of this team.\");\n            return team; // Already a member\n        }\n        // Use $addToSet (or $push if duplicates are impossible/undesired)\n        const result = await teams.updateOne({\n            _id: teamObjectId\n        }, {\n            $push: {\n                members: memberRecord\n            },\n            $set: {\n                updatedAt: now\n            }\n        });\n        if (result.matchedCount === 0) return null;\n        const updatedTeam = await teams.findOne({\n            _id: teamObjectId\n        });\n        return updatedTeam;\n    } catch (error) {\n        console.error(\"Error adding team member:\", error);\n        throw new Error(\"Database error while adding team member.\");\n    }\n};\nconst removeTeamMember = async (teamId, userIdToRemove)=>{\n    const teamObjectId = toObjectId(teamId);\n    if (!teamObjectId) return null;\n    if (!userIdToRemove) throw new Error(\"User ID to remove is required.\");\n    const memberUserIdString = userIdToRemove.toString();\n    try {\n        const { teams } = await getCollections();\n        const now = new Date();\n        // Find the team first to check if the user being removed is the owner\n        const team = await teams.findOne({\n            _id: teamObjectId\n        });\n        if (!team) return null; // Team not found\n        const memberToRemove = team.members.find((m)=>m.userId === memberUserIdString);\n        if (!memberToRemove) {\n            // console.log(\"Member not found in team.\");\n            return team; // Member not found, return current team state\n        }\n        // Prevent removing the owner\n        if (memberToRemove.role === 'owner') {\n            throw new Error(\"Cannot remove the team owner.\");\n        }\n        // Use $pull to remove the member by userId (string match)\n        const result = await teams.updateOne({\n            _id: teamObjectId\n        }, {\n            $pull: {\n                members: {\n                    userId: memberUserIdString\n                }\n            },\n            $set: {\n                updatedAt: now\n            }\n        });\n        if (result.modifiedCount === 0) {\n            // Should not happen if member was found, but handle gracefully\n            console.log(\"Pull operation did not modify the document.\");\n        }\n        const updatedTeam = await teams.findOne({\n            _id: teamObjectId\n        });\n        return updatedTeam;\n    } catch (error) {\n        console.error(\"Error removing team member:\", error);\n        if (error.message === \"Cannot remove the team owner.\") {\n            throw error;\n        }\n        throw new Error(\"Database error while removing team member.\");\n    }\n};\n// TODO: Implement updateTeamMember role if needed\n// --- Comment Functions ---\nconst getCommentsByPromptId = async (promptId)=>{\n    const promptObjectId = toObjectId(promptId);\n    if (!promptObjectId) return [];\n    try {\n        const { comments } = await getCollections();\n        // Fetch comments and sort by creation date (newest first)\n        const promptComments = await comments.find({\n            promptId: promptObjectId\n        }).sort({\n            createdAt: -1\n        }).toArray();\n        return promptComments;\n    } catch (error) {\n        console.error(\"Error fetching comments by prompt ID:\", error);\n        throw new Error(\"Database error while fetching comments.\");\n    }\n};\nconst createComment = async (commentData)=>{\n    if (!commentData.promptId || !commentData.userId || !commentData.content) {\n        throw new Error(\"Prompt ID, User ID, and content are required for comments.\");\n    }\n    const promptObjectId = toObjectId(commentData.promptId);\n    // Assuming userId is passed as string from session\n    const userIdString = commentData.userId.toString();\n    if (!promptObjectId) {\n        throw new Error(\"Invalid Prompt ID format for comment.\");\n    }\n    try {\n        const { comments, users } = await getCollections();\n        const now = new Date();\n        // Fetch commenter's name\n        let createdByName = 'User'; // Default\n        const commenterUser = await users.findOne({\n            _id: toObjectId(userIdString)\n        }, {\n            projection: {\n                name: 1\n            }\n        });\n        if (commenterUser && commenterUser.name) {\n            createdByName = commenterUser.name;\n        }\n        const newComment = {\n            promptId: promptObjectId,\n            userId: userIdString,\n            content: commentData.content,\n            createdBy: createdByName,\n            createdAt: now,\n            updatedAt: now\n        };\n        const result = await comments.insertOne(newComment);\n        return {\n            ...newComment,\n            _id: result.insertedId\n        };\n    } catch (error) {\n        console.error(\"Error creating comment:\", error);\n        throw new Error(\"Database error while creating comment.\");\n    }\n};\nconst updateComment = async (id, commentData)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    if (!commentData.content) {\n        throw new Error(\"Comment content is required for update.\");\n    }\n    try {\n        const { comments } = await getCollections();\n        const updateDoc = {\n            $set: {\n                content: commentData.content,\n                updatedAt: new Date()\n            }\n        };\n        const result = await comments.updateOne({\n            _id: objectId\n        }, updateDoc);\n        if (result.matchedCount === 0) return null;\n        const updatedComment = await comments.findOne({\n            _id: objectId\n        });\n        return updatedComment;\n    } catch (error) {\n        console.error(\"Error updating comment:\", error);\n        throw new Error(\"Database error while updating comment.\");\n    }\n};\nconst deleteComment = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return false;\n    try {\n        const { comments } = await getCollections();\n        const result = await comments.deleteOne({\n            _id: objectId\n        });\n        return result.deletedCount > 0;\n    } catch (error) {\n        console.error(\"Error deleting comment:\", error);\n        throw new Error(\"Database error while deleting comment.\");\n    }\n}; // Remove the old in-memory data and initialization logic\n /*\nlet prompts = [];\nlet collections = [];\nlet users = [];\nlet teams = [];\nlet comments = [];\nlet promptIdCounter = 1;\nlet collectionIdCounter = 1;\nlet userIdCounter = 1;\nlet teamIdCounter = 1;\nlet commentIdCounter = 1;\n\n// All old functions like:\nexport const getAllPrompts = () => { ... };\n// ... etc.\n\n// Initialize with some sample data - in real app, this would be loaded from database\nexport const initializeDb = async () => { ... };\n\n// Call initialize when imported\n(async () => { ... })();\n*/ \n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9kYi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBOEM7QUFDWDtBQUNTLENBQUMsK0NBQStDO0FBRTVGOztDQUVDLEdBQ0QsZUFBZUc7SUFDYixNQUFNLEVBQUVDLEVBQUUsRUFBRSxHQUFHLE1BQU1KLDJEQUFpQkE7SUFDdEMsT0FBTztRQUNMSyxPQUFPRCxHQUFHRSxVQUFVLENBQUM7UUFDckJDLFNBQVNILEdBQUdFLFVBQVUsQ0FBQztRQUN2QkUsYUFBYUosR0FBR0UsVUFBVSxDQUFDO1FBQzNCRyxPQUFPTCxHQUFHRSxVQUFVLENBQUM7UUFDckJJLFVBQVVOLEdBQUdFLFVBQVUsQ0FBQztJQUMxQjtBQUNGO0FBRUE7OztDQUdDLEdBQ0QsU0FBU0ssV0FBV0MsRUFBRTtJQUNwQixJQUFJLENBQUNBLE1BQU0sQ0FBQ1gsNkNBQVFBLENBQUNZLE9BQU8sQ0FBQ0QsS0FBSztRQUNoQyxPQUFPO0lBQ1Q7SUFDQSxJQUFJO1FBQ0YsT0FBTyxJQUFJWCw2Q0FBUUEsQ0FBQ1c7SUFDdEIsRUFBRSxPQUFPRSxPQUFPO1FBQ2QsNkRBQTZEO1FBQzdEQyxRQUFRRCxLQUFLLENBQUMsNEJBQTRCQTtRQUMxQyxPQUFPO0lBQ1Q7QUFDRjtBQUVBLDJCQUEyQjtBQUVwQixNQUFNRSxnQkFBZ0IsT0FBT0MsU0FBUyxDQUFDLENBQUMsRUFBRUMsVUFBVSxDQUFDLENBQUM7SUFDM0QsSUFBSTtRQUNGLE1BQU0sRUFBRVgsT0FBTyxFQUFFLEdBQUcsTUFBTUo7UUFDMUIsTUFBTWdCLFNBQVNaLFFBQVFhLElBQUksQ0FBQ0g7UUFFNUIsc0NBQXNDO1FBQ3RDLElBQUlDLFFBQVFHLElBQUksRUFBRTtZQUNoQkYsT0FBT0UsSUFBSSxDQUFDSCxRQUFRRyxJQUFJO1FBQzFCLE9BQU87WUFDSEYsT0FBT0UsSUFBSSxDQUFDO2dCQUFFQyxXQUFXLENBQUM7WUFBRSxJQUFJLDZCQUE2QjtRQUNqRTtRQUVBLHlCQUF5QjtRQUN6QixJQUFJSixRQUFRSyxLQUFLLEVBQUU7WUFDakJKLE9BQU9JLEtBQUssQ0FBQ0wsUUFBUUssS0FBSztRQUM1QjtRQUVBLHVDQUF1QztRQUN2QyxJQUFJTCxRQUFRTSxJQUFJLEVBQUU7WUFDZEwsT0FBT0ssSUFBSSxDQUFDTixRQUFRTSxJQUFJO1FBQzVCO1FBRUEsTUFBTUMsYUFBYSxNQUFNTixPQUFPTyxPQUFPO1FBQ3ZDLE9BQU9EO0lBQ1QsRUFBRSxPQUFPWCxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQywrQkFBK0JBO1FBQzdDLE1BQU0sSUFBSWEsTUFBTTtJQUNsQjtBQUNGLEVBQUU7QUFFSyxNQUFNQyxnQkFBZ0IsT0FBT2hCO0lBQ2xDLE1BQU1pQixXQUFXbEIsV0FBV0M7SUFDNUIsSUFBSSxDQUFDaUIsVUFBVSxPQUFPO0lBQ3RCLElBQUk7UUFDRixNQUFNLEVBQUV0QixPQUFPLEVBQUUsR0FBRyxNQUFNSjtRQUMxQixNQUFNMkIsU0FBUyxNQUFNdkIsUUFBUXdCLE9BQU8sQ0FBQztZQUFFQyxLQUFLSDtRQUFTO1FBQ3JELE9BQU9DO0lBQ1QsRUFBRSxPQUFPaEIsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsZ0NBQWdDQTtRQUM5QyxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBRUssTUFBTU0sZUFBZSxPQUFPQztJQUNqQyxJQUFJO1FBQ0YsTUFBTSxFQUFFM0IsT0FBTyxFQUFFLEdBQUcsTUFBTUo7UUFDMUIsTUFBTWdDLE1BQU0sSUFBSUM7UUFDaEIsTUFBTUMsWUFBWTtZQUNoQkMsT0FBT0osV0FBV0ksS0FBSztZQUN2QkMsU0FBU0wsV0FBV0ssT0FBTztZQUMzQkMsYUFBYU4sV0FBV00sV0FBVyxJQUFJO1lBQ3ZDQyxNQUFNUCxXQUFXTyxJQUFJLElBQUksRUFBRTtZQUMzQkMsWUFBWVIsV0FBV1EsVUFBVSxJQUFJO1lBQ3JDQyxRQUFRVCxXQUFXUyxNQUFNLElBQUk7WUFDN0JDLFlBQVlWLFdBQVdVLFVBQVUsSUFBSTtZQUNyQ0MsYUFBYVgsV0FBV1csV0FBVyxJQUFJO1lBQ3ZDQyxZQUFZWixXQUFXWSxVQUFVLElBQUk7WUFDckNDLFFBQVFiLFdBQVdhLE1BQU07WUFDekJDLFdBQVdkLFdBQVdjLFNBQVM7WUFDL0JDLFFBQVFmLFdBQVdlLE1BQU0sR0FBR3RDLFdBQVd1QixXQUFXZSxNQUFNLElBQUk7WUFDNUQzQixXQUFXYTtZQUNYZSxXQUFXZjtRQUNiO1FBQ0EsTUFBTWdCLFNBQVMsTUFBTTVDLFFBQVE2QyxTQUFTLENBQUNmO1FBQ3ZDLE9BQU87WUFBRSxHQUFHQSxTQUFTO1lBQUVMLEtBQUttQixPQUFPRSxVQUFVO1FBQUM7SUFDaEQsRUFBRSxPQUFPdkMsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsMEJBQTBCQTtRQUN4QyxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBRUssTUFBTTJCLGVBQWUsT0FBTzFDLElBQUlzQjtJQUNyQyxNQUFNTCxXQUFXbEIsV0FBV0M7SUFDNUIsSUFBSSxDQUFDaUIsVUFBVSxPQUFPO0lBRXRCLElBQUk7UUFDRixNQUFNLEVBQUV0QixPQUFPLEVBQUUsR0FBRyxNQUFNSjtRQUMxQixNQUFNb0QsWUFBWTtZQUFFQyxNQUFNLENBQUM7UUFBRTtRQUU3QixpREFBaUQ7UUFDakQsS0FBSyxNQUFNQyxPQUFPO1lBQUM7WUFBUztZQUFXO1lBQWU7WUFBUTtZQUFjO1lBQVU7WUFBYztZQUFlO1lBQWM7U0FBWSxDQUFFO1lBQzdJLElBQUl2QixVQUFVLENBQUN1QixJQUFJLEtBQUtDLFdBQVc7Z0JBQ2pDSCxVQUFVQyxJQUFJLENBQUNDLElBQUksR0FBR3ZCLFVBQVUsQ0FBQ3VCLElBQUk7WUFDdkM7UUFDRjtRQUNBLHVFQUF1RTtRQUN2RSxJQUFJdkIsV0FBV2UsTUFBTSxLQUFLUyxXQUFXO1lBQ2pDSCxVQUFVQyxJQUFJLENBQUNQLE1BQU0sR0FBR2YsV0FBV2UsTUFBTSxHQUFHdEMsV0FBV3VCLFdBQVdlLE1BQU0sSUFBSTtRQUNoRjtRQUVBLG1DQUFtQztRQUNuQ00sVUFBVUMsSUFBSSxDQUFDTixTQUFTLEdBQUcsSUFBSWQ7UUFFL0IsSUFBSXVCLE9BQU9DLElBQUksQ0FBQ0wsVUFBVUMsSUFBSSxFQUFFSyxNQUFNLEtBQUssR0FBRztZQUMxQywrQ0FBK0M7WUFDL0MsT0FBT3RELFFBQVF3QixPQUFPLENBQUM7Z0JBQUVDLEtBQUtIO1lBQVMsSUFBSSxxQkFBcUI7UUFDcEU7UUFFQSxNQUFNc0IsU0FBUyxNQUFNNUMsUUFBUXVELFNBQVMsQ0FBQztZQUFFOUIsS0FBS0g7UUFBUyxHQUFHMEI7UUFFMUQsSUFBSUosT0FBT1ksWUFBWSxLQUFLLEdBQUc7WUFDN0IsT0FBTyxNQUFNLG1CQUFtQjtRQUNsQztRQUVBLE1BQU1DLGdCQUFnQixNQUFNekQsUUFBUXdCLE9BQU8sQ0FBQztZQUFFQyxLQUFLSDtRQUFTO1FBQzVELE9BQU9tQztJQUNULEVBQUUsT0FBT2xELE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDBCQUEwQkE7UUFDeEMsTUFBTSxJQUFJYSxNQUFNO0lBQ2xCO0FBQ0YsRUFBRTtBQUVLLE1BQU1zQyxlQUFlLE9BQU9yRDtJQUNqQyxNQUFNaUIsV0FBV2xCLFdBQVdDO0lBQzVCLElBQUksQ0FBQ2lCLFVBQVUsT0FBTztJQUV0QixJQUFJO1FBQ0YsTUFBTSxFQUFFdEIsT0FBTyxFQUFFLEdBQUcsTUFBTUo7UUFDMUIsdUVBQXVFO1FBQ3ZFLE1BQU1nRCxTQUFTLE1BQU01QyxRQUFRMkQsU0FBUyxDQUFDO1lBQUVsQyxLQUFLSDtRQUFTO1FBQ3ZELE9BQU9zQixPQUFPZ0IsWUFBWSxHQUFHO0lBQy9CLEVBQUUsT0FBT3JELE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDBCQUEwQkE7UUFDeEMsTUFBTSxJQUFJYSxNQUFNO0lBQ2xCO0FBQ0YsRUFBRTtBQUVGLGlGQUFpRjtBQUNqRix1RUFBdUU7QUFFdkUsK0JBQStCO0FBRXhCLE1BQU15QyxvQkFBb0IsT0FBT25ELFNBQVMsQ0FBQyxDQUFDLEVBQUVDLFVBQVUsQ0FBQyxDQUFDO0lBQy9ELElBQUk7UUFDRixNQUFNLEVBQUVWLFdBQVcsRUFBRSxHQUFHLE1BQU1MO1FBQzlCLE1BQU1nQixTQUFTWCxZQUFZWSxJQUFJLENBQUNIO1FBQ2hDLElBQUlDLFFBQVFHLElBQUksRUFBRUYsT0FBT0UsSUFBSSxDQUFDSCxRQUFRRyxJQUFJO1FBQzFDLElBQUlILFFBQVFLLEtBQUssRUFBRUosT0FBT0ksS0FBSyxDQUFDTCxRQUFRSyxLQUFLO1FBQzdDLElBQUlMLFFBQVFNLElBQUksRUFBRUwsT0FBT0ssSUFBSSxDQUFDTixRQUFRTSxJQUFJO1FBQzFDLE1BQU02QyxpQkFBaUIsTUFBTWxELE9BQU9PLE9BQU87UUFDM0MsT0FBTzJDO0lBQ1QsRUFBRSxPQUFPdkQsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsbUNBQW1DQTtRQUNqRCxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBRUssTUFBTTJDLG9CQUFvQixPQUFPMUQ7SUFDdEMsTUFBTWlCLFdBQVdsQixXQUFXQztJQUM1QixJQUFJLENBQUNpQixVQUFVLE9BQU87SUFDdEIsSUFBSTtRQUNGLE1BQU0sRUFBRXJCLFdBQVcsRUFBRSxHQUFHLE1BQU1MO1FBQzlCLHVFQUF1RTtRQUN2RSxNQUFNRyxhQUFhLE1BQU1FLFlBQVl1QixPQUFPLENBQUM7WUFBRUMsS0FBS0g7UUFBUztRQUM3RCxPQUFPdkI7SUFDVCxFQUFFLE9BQU9RLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLG9DQUFvQ0E7UUFDbEQsTUFBTSxJQUFJYSxNQUFNO0lBQ2xCO0FBQ0YsRUFBRTtBQUVLLE1BQU00QyxtQkFBbUIsT0FBT0M7SUFDckMsSUFBSTtRQUNGLE1BQU0sRUFBRWhFLFdBQVcsRUFBRSxHQUFHLE1BQU1MO1FBQzlCLE1BQU1nQyxNQUFNLElBQUlDO1FBQ2hCLE1BQU1xQyxnQkFBZ0I7WUFDcEJDLE1BQU1GLGVBQWVFLElBQUk7WUFDekJsQyxhQUFhZ0MsZUFBZWhDLFdBQVcsSUFBSTtZQUMzQ08sUUFBUXlCLGVBQWV6QixNQUFNO1lBQzdCeEMsU0FBUyxFQUFFO1lBQ1hlLFdBQVdhO1lBQ1hlLFdBQVdmO1FBQ2I7UUFDQSxNQUFNZ0IsU0FBUyxNQUFNM0MsWUFBWTRDLFNBQVMsQ0FBQ3FCO1FBQzNDLE9BQU87WUFBRSxHQUFHQSxhQUFhO1lBQUV6QyxLQUFLbUIsT0FBT0UsVUFBVTtRQUFDO0lBQ3BELEVBQUUsT0FBT3ZDLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDhCQUE4QkE7UUFDNUMsTUFBTSxJQUFJYSxNQUFNO0lBQ2xCO0FBQ0YsRUFBRTtBQUVLLE1BQU1nRCxtQkFBbUIsT0FBTy9ELElBQUk0RDtJQUN6QyxNQUFNM0MsV0FBV2xCLFdBQVdDO0lBQzVCLElBQUksQ0FBQ2lCLFVBQVUsT0FBTztJQUV0QixJQUFJO1FBQ0YsTUFBTSxFQUFFckIsV0FBVyxFQUFFLEdBQUcsTUFBTUw7UUFDOUIsTUFBTW9ELFlBQVk7WUFBRUMsTUFBTSxDQUFDO1FBQUU7UUFDN0IsSUFBSWdCLGVBQWVFLElBQUksS0FBS2hCLFdBQVdILFVBQVVDLElBQUksQ0FBQ2tCLElBQUksR0FBR0YsZUFBZUUsSUFBSTtRQUNoRixJQUFJRixlQUFlaEMsV0FBVyxLQUFLa0IsV0FBV0gsVUFBVUMsSUFBSSxDQUFDaEIsV0FBVyxHQUFHZ0MsZUFBZWhDLFdBQVc7UUFDckcsd0ZBQXdGO1FBQ3hGZSxVQUFVQyxJQUFJLENBQUNOLFNBQVMsR0FBRyxJQUFJZDtRQUUvQixJQUFJdUIsT0FBT0MsSUFBSSxDQUFDTCxVQUFVQyxJQUFJLEVBQUVLLE1BQU0sR0FBRyxHQUFHO1lBQzFDLE1BQU1WLFNBQVMsTUFBTTNDLFlBQVlzRCxTQUFTLENBQUM7Z0JBQUU5QixLQUFLSDtZQUFTLEdBQUcwQjtZQUM5RCxJQUFJSixPQUFPWSxZQUFZLEtBQUssR0FBRyxPQUFPO1FBQ3hDO1FBRUEsTUFBTWEsb0JBQW9CLE1BQU1wRSxZQUFZdUIsT0FBTyxDQUFDO1lBQUVDLEtBQUtIO1FBQVM7UUFDcEUsT0FBTytDO0lBQ1QsRUFBRSxPQUFPOUQsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsOEJBQThCQTtRQUM1QyxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBRUssTUFBTWtELG1CQUFtQixPQUFPakU7SUFDckMsTUFBTWlCLFdBQVdsQixXQUFXQztJQUM1QixJQUFJLENBQUNpQixVQUFVLE9BQU87SUFDdEIsSUFBSTtRQUNGLE1BQU0sRUFBRXJCLFdBQVcsRUFBRSxHQUFHLE1BQU1MO1FBQzlCLE1BQU1nRCxTQUFTLE1BQU0zQyxZQUFZMEQsU0FBUyxDQUFDO1lBQUVsQyxLQUFLSDtRQUFTO1FBQzNELE9BQU9zQixPQUFPZ0IsWUFBWSxHQUFHO0lBQy9CLEVBQUUsT0FBT3JELE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDhCQUE4QkE7UUFDNUMsTUFBTSxJQUFJYSxNQUFNO0lBQ2xCO0FBQ0YsRUFBRTtBQUVLLE1BQU1tRCx3QkFBd0IsT0FBT0MsY0FBY0M7SUFDeEQsTUFBTUMsZUFBZXRFLFdBQVdvRTtJQUNoQyxNQUFNRyxpQkFBaUJ2RSxXQUFXcUU7SUFDbEMsSUFBSSxDQUFDQyxnQkFBZ0IsQ0FBQ0MsZ0JBQWdCLE9BQU87SUFFN0MsSUFBSTtRQUNGLE1BQU0sRUFBRTFFLFdBQVcsRUFBRSxHQUFHLE1BQU1MO1FBQzlCLGlGQUFpRjtRQUNqRixNQUFNZ0QsU0FBUyxNQUFNM0MsWUFBWXNELFNBQVMsQ0FDeEM7WUFBRTlCLEtBQUtpRDtRQUFhLEdBQ3BCO1lBQ0VFLFdBQVc7Z0JBQUU1RSxTQUFTMkU7WUFBZTtZQUNyQzFCLE1BQU07Z0JBQUVOLFdBQVcsSUFBSWQ7WUFBTztRQUNoQztRQUVGLElBQUllLE9BQU9ZLFlBQVksS0FBSyxHQUFHLE9BQU8sTUFBTSx1QkFBdUI7UUFFbkUsTUFBTWEsb0JBQW9CLE1BQU1wRSxZQUFZdUIsT0FBTyxDQUFDO1lBQUVDLEtBQUtpRDtRQUFhO1FBQ3hFLE9BQU9MO0lBQ1QsRUFBRSxPQUFPOUQsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsc0NBQXNDQTtRQUNwRCxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBRUssTUFBTXlELDZCQUE2QixPQUFPTCxjQUFjQztJQUM3RCxNQUFNQyxlQUFldEUsV0FBV29FO0lBQ2hDLE1BQU1HLGlCQUFpQnZFLFdBQVdxRTtJQUNsQyxJQUFJLENBQUNDLGdCQUFnQixDQUFDQyxnQkFBZ0IsT0FBTztJQUU3QyxJQUFJO1FBQ0YsTUFBTSxFQUFFMUUsV0FBVyxFQUFFLEdBQUcsTUFBTUw7UUFDOUIsMkRBQTJEO1FBQzNELE1BQU1nRCxTQUFTLE1BQU0zQyxZQUFZc0QsU0FBUyxDQUN4QztZQUFFOUIsS0FBS2lEO1FBQWEsR0FDcEI7WUFDRUksT0FBTztnQkFBRTlFLFNBQVMyRTtZQUFlO1lBQ2pDMUIsTUFBTTtnQkFBRU4sV0FBVyxJQUFJZDtZQUFPO1FBQ2hDO1FBRUYsSUFBSWUsT0FBT1ksWUFBWSxLQUFLLEdBQUcsT0FBTyxNQUFNLHVCQUF1QjtRQUVuRSxNQUFNYSxvQkFBb0IsTUFBTXBFLFlBQVl1QixPQUFPLENBQUM7WUFBRUMsS0FBS2lEO1FBQWE7UUFDeEUsT0FBT0w7SUFDVCxFQUFFLE9BQU85RCxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQywwQ0FBMENBO1FBQ3hELE1BQU0sSUFBSWEsTUFBTTtJQUNsQjtBQUNGLEVBQUU7QUFFRix5QkFBeUI7QUFDekIsZ0dBQWdHO0FBRXpGLE1BQU0yRCxjQUFjLE9BQU9yRSxTQUFTLENBQUMsQ0FBQyxFQUFFQyxVQUFVLENBQUMsQ0FBQztJQUN6RCxJQUFJO1FBQ0YsTUFBTSxFQUFFYixLQUFLLEVBQUUsR0FBRyxNQUFNRjtRQUN4QixvQ0FBb0M7UUFDcEMsTUFBTWdCLFNBQVNkLE1BQU1lLElBQUksQ0FBQ0gsUUFBUTtZQUFFc0UsWUFBWTtnQkFBRUMsVUFBVTtZQUFFO1FBQUU7UUFDaEUsSUFBSXRFLFFBQVFHLElBQUksRUFBRUYsT0FBT0UsSUFBSSxDQUFDSCxRQUFRRyxJQUFJO1FBQzFDLElBQUlILFFBQVFLLEtBQUssRUFBRUosT0FBT0ksS0FBSyxDQUFDTCxRQUFRSyxLQUFLO1FBQzdDLElBQUlMLFFBQVFNLElBQUksRUFBRUwsT0FBT0ssSUFBSSxDQUFDTixRQUFRTSxJQUFJO1FBQzFDLE1BQU1pRSxXQUFXLE1BQU10RSxPQUFPTyxPQUFPO1FBQ3JDLE9BQU8rRDtJQUNULEVBQUUsT0FBTzNFLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDZCQUE2QkE7UUFDM0MsTUFBTSxJQUFJYSxNQUFNO0lBQ2xCO0FBQ0YsRUFBRTtBQUVLLE1BQU0rRCxjQUFjLE9BQU85RTtJQUNoQyxNQUFNaUIsV0FBV2xCLFdBQVdDO0lBQzVCLElBQUksQ0FBQ2lCLFVBQVUsT0FBTztJQUN0QixJQUFJO1FBQ0YsTUFBTSxFQUFFeEIsS0FBSyxFQUFFLEdBQUcsTUFBTUY7UUFDeEIsTUFBTXdGLE9BQU8sTUFBTXRGLE1BQU0wQixPQUFPLENBQUM7WUFBRUMsS0FBS0g7UUFBUyxHQUFHO1lBQUUwRCxZQUFZO2dCQUFFQyxVQUFVO1lBQUU7UUFBRTtRQUNsRixPQUFPRztJQUNULEVBQUUsT0FBTzdFLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDhCQUE4QkE7UUFDNUMsTUFBTSxJQUFJYSxNQUFNO0lBQ2xCO0FBQ0YsRUFBRTtBQUVLLE1BQU1pRSxpQkFBaUIsT0FBT0M7SUFDbkMsSUFBSSxDQUFDQSxPQUFPLE9BQU87SUFDbkIsSUFBSTtRQUNGLE1BQU0sRUFBRXhGLEtBQUssRUFBRSxHQUFHLE1BQU1GO1FBQ3hCLHdFQUF3RTtRQUN4RSxNQUFNd0YsT0FBTyxNQUFNdEYsTUFBTTBCLE9BQU8sQ0FBQztZQUFFOEQsT0FBT0EsTUFBTUMsV0FBVztRQUFHO1FBQzlELE9BQU9IO0lBQ1QsRUFBRSxPQUFPN0UsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsaUNBQWlDQTtRQUMvQyxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBRUssTUFBTW9FLGFBQWEsT0FBT0M7SUFDL0IsSUFBSSxDQUFDQSxTQUFTSCxLQUFLLElBQUksQ0FBQ0csU0FBU1IsUUFBUSxFQUFFO1FBQ3pDLE1BQU0sSUFBSTdELE1BQU07SUFDbEI7SUFFQSxJQUFJO1FBQ0YsTUFBTSxFQUFFdEIsS0FBSyxFQUFFLEdBQUcsTUFBTUY7UUFDeEIsTUFBTWdDLE1BQU0sSUFBSUM7UUFFaEIsK0JBQStCO1FBQy9CLE1BQU02RCxlQUFlLE1BQU01RixNQUFNMEIsT0FBTyxDQUFDO1lBQUU4RCxPQUFPRyxTQUFTSCxLQUFLLENBQUNDLFdBQVc7UUFBRztRQUMvRSxJQUFJRyxjQUFjO1lBQ2hCLE1BQU0sSUFBSXRFLE1BQU07UUFDbEI7UUFFQSwrQkFBK0I7UUFDL0IsTUFBTXVFLGlCQUFpQixNQUFNaEcseURBQVlBLENBQUM4RixTQUFTUixRQUFRO1FBRTNELE1BQU1XLFVBQVU7WUFDZHpCLE1BQU1zQixTQUFTdEIsSUFBSSxJQUFJO1lBQ3ZCbUIsT0FBT0csU0FBU0gsS0FBSyxDQUFDQyxXQUFXO1lBQ2pDTixVQUFVVTtZQUNWRSxPQUFPSixTQUFTSSxLQUFLLElBQUk7WUFDekIsc0NBQXNDO1lBQ3RDOUUsV0FBV2E7WUFDWGUsV0FBV2Y7UUFDYjtRQUNBLE1BQU1nQixTQUFTLE1BQU05QyxNQUFNK0MsU0FBUyxDQUFDK0M7UUFDckMsNkNBQTZDO1FBQzdDLE1BQU0sRUFBRVgsUUFBUSxFQUFFLEdBQUdhLHFCQUFxQixHQUFHRjtRQUM3QyxPQUFPO1lBQUUsR0FBR0UsbUJBQW1CO1lBQUVyRSxLQUFLbUIsT0FBT0UsVUFBVTtRQUFDO0lBRTFELEVBQUUsT0FBT3ZDLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLHdCQUF3QkE7UUFDdEMsMkNBQTJDO1FBQzNDLElBQUlBLE1BQU13RixPQUFPLEtBQUssd0NBQXdDO1lBQzFELE1BQU14RjtRQUNWO1FBQ0EsTUFBTSxJQUFJYSxNQUFNO0lBQ2xCO0FBQ0YsRUFBRTtBQUVLLE1BQU00RSxhQUFhLE9BQU8zRixJQUFJb0Y7SUFDbkMsTUFBTW5FLFdBQVdsQixXQUFXQztJQUM1QixJQUFJLENBQUNpQixVQUFVLE9BQU87SUFFdEIsSUFBSTtRQUNGLE1BQU0sRUFBRXhCLEtBQUssRUFBRSxHQUFHLE1BQU1GO1FBQ3hCLE1BQU1vRCxZQUFZO1lBQUVDLE1BQU0sQ0FBQztRQUFFO1FBRTdCLElBQUl3QyxTQUFTdEIsSUFBSSxLQUFLaEIsV0FBV0gsVUFBVUMsSUFBSSxDQUFDa0IsSUFBSSxHQUFHc0IsU0FBU3RCLElBQUk7UUFDcEUsSUFBSXNCLFNBQVNJLEtBQUssS0FBSzFDLFdBQVdILFVBQVVDLElBQUksQ0FBQzRDLEtBQUssR0FBR0osU0FBU0ksS0FBSztRQUN2RSwyQ0FBMkM7UUFFM0MsZ0NBQWdDO1FBQ2hDLElBQUlKLFNBQVNILEtBQUssSUFBSSxPQUFPRyxTQUFTSCxLQUFLLEtBQUssVUFBVTtZQUN4RCxNQUFNVyxXQUFXUixTQUFTSCxLQUFLLENBQUNDLFdBQVc7WUFDM0MsTUFBTUcsZUFBZSxNQUFNNUYsTUFBTTBCLE9BQU8sQ0FBQztnQkFBRThELE9BQU9XO1lBQVM7WUFDM0QsMEVBQTBFO1lBQzFFLElBQUlQLGdCQUFnQixDQUFDQSxhQUFhakUsR0FBRyxDQUFDeUUsTUFBTSxDQUFDNUUsV0FBVztnQkFDckQsTUFBTSxJQUFJRixNQUFNO1lBQ25CO1lBQ0E0QixVQUFVQyxJQUFJLENBQUNxQyxLQUFLLEdBQUdXO1FBQ3pCO1FBRUEsNkRBQTZEO1FBQzdELHNEQUFzRDtRQUV0RGpELFVBQVVDLElBQUksQ0FBQ04sU0FBUyxHQUFHLElBQUlkO1FBRS9CLElBQUl1QixPQUFPQyxJQUFJLENBQUNMLFVBQVVDLElBQUksRUFBRUssTUFBTSxHQUFHLEdBQUc7WUFDMUMsTUFBTVYsU0FBUyxNQUFNOUMsTUFBTXlELFNBQVMsQ0FBQztnQkFBRTlCLEtBQUtIO1lBQVMsR0FBRzBCO1lBQ3hELElBQUlKLE9BQU9ZLFlBQVksS0FBSyxHQUFHLE9BQU87UUFDeEM7UUFFQSxNQUFNMkMsY0FBYyxNQUFNckcsTUFBTTBCLE9BQU8sQ0FBQztZQUFFQyxLQUFLSDtRQUFTLEdBQUc7WUFBRTBELFlBQVk7Z0JBQUVDLFVBQVU7WUFBRTtRQUFFO1FBQ3pGLE9BQU9rQjtJQUVULEVBQUUsT0FBTzVGLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLHdCQUF3QkE7UUFDckMsSUFBSUEsTUFBTXdGLE9BQU8sS0FBSyxvQ0FBb0M7WUFDdkQsTUFBTXhGO1FBQ1Y7UUFDQSxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBRUssTUFBTWdGLGFBQWEsT0FBTy9GO0lBQy9CLE1BQU1pQixXQUFXbEIsV0FBV0M7SUFDNUIsSUFBSSxDQUFDaUIsVUFBVSxPQUFPO0lBQ3RCLElBQUk7UUFDRixNQUFNLEVBQUV4QixLQUFLLEVBQUUsR0FBRyxNQUFNRjtRQUN4Qiw4REFBOEQ7UUFDOUQsTUFBTWdELFNBQVMsTUFBTTlDLE1BQU02RCxTQUFTLENBQUM7WUFBRWxDLEtBQUtIO1FBQVM7UUFDckQsT0FBT3NCLE9BQU9nQixZQUFZLEdBQUc7SUFDL0IsRUFBRSxPQUFPckQsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsd0JBQXdCQTtRQUN0QyxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBR0YsOENBQThDO0FBRXZDLE1BQU1pRixjQUFjLE9BQU9oRztJQUNoQyxNQUFNaUIsV0FBV2xCLFdBQVdDO0lBQzVCLElBQUksQ0FBQ2lCLFVBQVUsT0FBTyxNQUFNLG9CQUFvQjtJQUVoRCxJQUFJO1FBQ0YsTUFBTSxFQUFFcEIsS0FBSyxFQUFFLEdBQUcsTUFBTU47UUFDeEIscUVBQXFFO1FBQ3JFLE1BQU0wRyxPQUFPLE1BQU1wRyxNQUFNc0IsT0FBTyxDQUFDO1lBQUVDLEtBQUtIO1FBQVM7UUFFakQsMEVBQTBFO1FBQzFFLDhCQUE4QjtRQUM5QixrR0FBa0c7UUFDbEcsSUFBSTtRQUNKLDZCQUE2QjtRQUM3Qiw0Q0FBNEM7UUFFNUMsT0FBT2dGLE1BQU0saURBQWlEO0lBQ2hFLEVBQUUsT0FBTy9GLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDhCQUE4QkE7UUFDNUMsTUFBTSxJQUFJYSxNQUFNO0lBQ2xCO0FBQ0YsRUFBRTtBQUVLLE1BQU1tRixtQkFBbUIsT0FBTy9EO0lBQ3JDLG9GQUFvRjtJQUNwRixNQUFNZ0UsZUFBZWhFLE9BQU9pRSxRQUFRO0lBQ3BDLE1BQU1DLGVBQWV0RyxXQUFXb0MsU0FBUyxxQkFBcUI7SUFFOUQsSUFBSTtRQUNGLE1BQU0sRUFBRXRDLEtBQUssRUFBRSxHQUFHLE1BQU1OO1FBQ3hCLHdEQUF3RDtRQUN4RCxtRkFBbUY7UUFDbkYsTUFBTStHLFFBQVE7WUFDWixrQkFBa0JIO1FBQ3BCO1FBRUEsc0VBQXNFO1FBQ3RFLG9FQUFvRTtRQUNwRSxxRUFBcUU7UUFDckUsTUFBTUksYUFBYTtZQUFFcEUsUUFBUWdFO1FBQWE7UUFFMUMsa0JBQWtCO1FBQ2xCLE1BQU1LLGFBQWE7WUFDakJDLEtBQUs7Z0JBQ0ZIO2dCQUNBQzthQUNEO1FBQ0o7UUFFQSx5RUFBeUU7UUFDekUsNkNBQTZDO1FBQzdDLElBQUlGLGNBQWM7WUFDZkcsV0FBV0MsR0FBRyxDQUFDQyxJQUFJLENBQUM7Z0JBQUUsa0JBQWtCTDtZQUFhO1lBQ3JERyxXQUFXQyxHQUFHLENBQUNDLElBQUksQ0FBQztnQkFBRXZFLFFBQVFrRTtZQUFhO1FBQzlDO1FBRUEsTUFBTU0sWUFBWSxNQUFNOUcsTUFBTVcsSUFBSSxDQUFDZ0csWUFBWTFGLE9BQU87UUFDdEQsT0FBTzZGO0lBQ1QsRUFBRSxPQUFPekcsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsb0NBQW9DQTtRQUNsRCxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBRUssTUFBTTZGLGFBQWEsT0FBT0M7SUFDL0IsSUFBSTtRQUNGLE1BQU0sRUFBRWhILEtBQUssRUFBRUosS0FBSyxFQUFFLEdBQUcsTUFBTUY7UUFDL0IsTUFBTWdDLE1BQU0sSUFBSUM7UUFDaEIsTUFBTXNGLGNBQWNELFNBQVMxRSxNQUFNLEVBQUUsNENBQTRDO1FBRWpGLHFCQUFxQjtRQUNyQixJQUFJNEUsWUFBWSxTQUFTLFVBQVU7UUFDbkMsTUFBTUMsWUFBWSxNQUFNdkgsTUFBTTBCLE9BQU8sQ0FBQztZQUFFQyxLQUFLckIsV0FBVytHO1FBQWEsR0FBSTtZQUFFbkMsWUFBWTtnQkFBRWIsTUFBTTtZQUFFO1FBQUU7UUFDbkcsSUFBSWtELGFBQWFBLFVBQVVsRCxJQUFJLEVBQUU7WUFDN0JpRCxZQUFZQyxVQUFVbEQsSUFBSTtRQUM5QjtRQUVBLE1BQU1tRCxVQUFVO1lBQ2RuRCxNQUFNK0MsU0FBUy9DLElBQUk7WUFDbkJsQyxhQUFhaUYsU0FBU2pGLFdBQVcsSUFBSTtZQUNyQ08sUUFBUTJFO1lBQ1JJLFNBQVMsRUFBRTtZQUNYeEcsV0FBV2E7WUFDWGUsV0FBV2Y7UUFDYjtRQUVBLDJCQUEyQjtRQUMzQjBGLFFBQVFDLE9BQU8sQ0FBQ1IsSUFBSSxDQUFDO1lBQ2pCdkUsUUFBUTJFO1lBQ1JLLE1BQU07WUFDTkMsVUFBVTdGO1lBQ1Z1QyxNQUFNaUQsVUFBVSxtQkFBbUI7UUFDdkM7UUFFQSxNQUFNeEUsU0FBUyxNQUFNMUMsTUFBTTJDLFNBQVMsQ0FBQ3lFO1FBQ3JDLE9BQU87WUFBRSxHQUFHQSxPQUFPO1lBQUU3RixLQUFLbUIsT0FBT0UsVUFBVTtRQUFDO0lBQzlDLEVBQUUsT0FBT3ZDLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLHdCQUF3QkE7UUFDdEMsTUFBTSxJQUFJYSxNQUFNO0lBQ2xCO0FBQ0YsRUFBRTtBQUVLLE1BQU1zRyxhQUFhLE9BQU9ySCxJQUFJNkc7SUFDbkMsTUFBTTVGLFdBQVdsQixXQUFXQztJQUM1QixJQUFJLENBQUNpQixVQUFVLE9BQU87SUFFdEIsSUFBSTtRQUNGLE1BQU0sRUFBRXBCLEtBQUssRUFBRSxHQUFHLE1BQU1OO1FBQ3hCLE1BQU1vRCxZQUFZO1lBQUVDLE1BQU0sQ0FBQztRQUFFO1FBQzdCLElBQUlpRSxTQUFTL0MsSUFBSSxLQUFLaEIsV0FBV0gsVUFBVUMsSUFBSSxDQUFDa0IsSUFBSSxHQUFHK0MsU0FBUy9DLElBQUk7UUFDcEUsSUFBSStDLFNBQVNqRixXQUFXLEtBQUtrQixXQUFXSCxVQUFVQyxJQUFJLENBQUNoQixXQUFXLEdBQUdpRixTQUFTakYsV0FBVztRQUN6RmUsVUFBVUMsSUFBSSxDQUFDTixTQUFTLEdBQUcsSUFBSWQ7UUFFL0IsSUFBSXVCLE9BQU9DLElBQUksQ0FBQ0wsVUFBVUMsSUFBSSxFQUFFSyxNQUFNLEdBQUcsR0FBRztZQUN4QyxNQUFNVixTQUFTLE1BQU0xQyxNQUFNcUQsU0FBUyxDQUFDO2dCQUFFOUIsS0FBS0g7WUFBUyxHQUFHMEI7WUFDeEQsSUFBSUosT0FBT1ksWUFBWSxLQUFLLEdBQUcsT0FBTztRQUMxQztRQUVBLE1BQU1tRSxjQUFjLE1BQU16SCxNQUFNc0IsT0FBTyxDQUFDO1lBQUVDLEtBQUtIO1FBQVM7UUFDeEQsT0FBT3FHO0lBQ1QsRUFBRSxPQUFPcEgsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsd0JBQXdCQTtRQUN0QyxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBRUssTUFBTXdHLGFBQWEsT0FBT3ZIO0lBQy9CLE1BQU1pQixXQUFXbEIsV0FBV0M7SUFDNUIsSUFBSSxDQUFDaUIsVUFBVSxPQUFPO0lBQ3RCLElBQUk7UUFDRixNQUFNLEVBQUVwQixLQUFLLEVBQUUsR0FBRyxNQUFNTjtRQUN4Qix1RUFBdUU7UUFDdkUsTUFBTWdELFNBQVMsTUFBTTFDLE1BQU15RCxTQUFTLENBQUM7WUFBRWxDLEtBQUtIO1FBQVM7UUFDckQsT0FBT3NCLE9BQU9nQixZQUFZLEdBQUc7SUFDL0IsRUFBRSxPQUFPckQsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsd0JBQXdCQTtRQUN0QyxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBRUssTUFBTXlHLGdCQUFnQixPQUFPbkYsUUFBUW9GO0lBQzFDLE1BQU1DLGVBQWUzSCxXQUFXc0M7SUFDaEMsSUFBSSxDQUFDcUYsY0FBYyxPQUFPO0lBQzFCLElBQUksQ0FBQ0QsY0FBYyxDQUFDQSxXQUFXdEYsTUFBTSxFQUFFLE1BQU0sSUFBSXBCLE1BQU07SUFFdkQsTUFBTTRHLGVBQWVGLFdBQVd0RixNQUFNLEVBQUUsZ0NBQWdDO0lBRXhFLElBQUk7UUFDRixNQUFNLEVBQUV0QyxLQUFLLEVBQUVKLEtBQUssRUFBRSxHQUFHLE1BQU1GO1FBQy9CLE1BQU1nQyxNQUFNLElBQUlDO1FBRWhCLHNCQUFzQjtRQUN0QixJQUFJb0csYUFBYSxVQUFVLFVBQVU7UUFDckMsTUFBTUMsYUFBYSxNQUFNcEksTUFBTTBCLE9BQU8sQ0FBQztZQUFFQyxLQUFLckIsV0FBVzRIO1FBQWMsR0FBRztZQUFFaEQsWUFBWTtnQkFBRWIsTUFBTTtZQUFFO1FBQUU7UUFDbkcsSUFBSStELGNBQWNBLFdBQVcvRCxJQUFJLEVBQUU7WUFDaEM4RCxhQUFhQyxXQUFXL0QsSUFBSTtRQUNoQztRQUVBLE1BQU1nRSxlQUFlO1lBQ25CM0YsUUFBUXdGO1lBQ1JSLE1BQU1NLFdBQVdOLElBQUksSUFBSTtZQUN6QkMsVUFBVTdGO1lBQ1Z1QyxNQUFNOEQsV0FBVyxvQkFBb0I7UUFDdkM7UUFFQSwwREFBMEQ7UUFDMUQsTUFBTTNCLE9BQU8sTUFBTXBHLE1BQU1zQixPQUFPLENBQUM7WUFBRUMsS0FBS3NHO1lBQWMsa0JBQWtCQztRQUFhO1FBQ3JGLElBQUkxQixNQUFNO1lBQ045RixRQUFRNEgsR0FBRyxDQUFDO1lBQ1osT0FBTzlCLE1BQU0sbUJBQW1CO1FBQ3BDO1FBRUEsa0VBQWtFO1FBQ2xFLE1BQU0xRCxTQUFTLE1BQU0xQyxNQUFNcUQsU0FBUyxDQUNsQztZQUFFOUIsS0FBS3NHO1FBQWEsR0FDcEI7WUFDRU0sT0FBTztnQkFBRWQsU0FBU1k7WUFBYTtZQUMvQmxGLE1BQU07Z0JBQUVOLFdBQVdmO1lBQUk7UUFDekI7UUFHRixJQUFJZ0IsT0FBT1ksWUFBWSxLQUFLLEdBQUcsT0FBTztRQUV0QyxNQUFNbUUsY0FBYyxNQUFNekgsTUFBTXNCLE9BQU8sQ0FBQztZQUFFQyxLQUFLc0c7UUFBYTtRQUM1RCxPQUFPSjtJQUVULEVBQUUsT0FBT3BILE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDZCQUE2QkE7UUFDM0MsTUFBTSxJQUFJYSxNQUFNO0lBQ2xCO0FBQ0YsRUFBRTtBQUVLLE1BQU1rSCxtQkFBbUIsT0FBTzVGLFFBQVE2RjtJQUM3QyxNQUFNUixlQUFlM0gsV0FBV3NDO0lBQ2hDLElBQUksQ0FBQ3FGLGNBQWMsT0FBTztJQUMxQixJQUFJLENBQUNRLGdCQUFnQixNQUFNLElBQUluSCxNQUFNO0lBRXJDLE1BQU1vSCxxQkFBcUJELGVBQWU5QixRQUFRO0lBRWxELElBQUk7UUFDRixNQUFNLEVBQUV2RyxLQUFLLEVBQUUsR0FBRyxNQUFNTjtRQUN4QixNQUFNZ0MsTUFBTSxJQUFJQztRQUVoQixzRUFBc0U7UUFDdEUsTUFBTXlFLE9BQU8sTUFBTXBHLE1BQU1zQixPQUFPLENBQUM7WUFBRUMsS0FBS3NHO1FBQWE7UUFDckQsSUFBSSxDQUFDekIsTUFBTSxPQUFPLE1BQU0saUJBQWlCO1FBRXpDLE1BQU1tQyxpQkFBaUJuQyxLQUFLaUIsT0FBTyxDQUFDMUcsSUFBSSxDQUFDNkgsQ0FBQUEsSUFBS0EsRUFBRWxHLE1BQU0sS0FBS2dHO1FBQzNELElBQUksQ0FBQ0MsZ0JBQWdCO1lBQ2pCLDRDQUE0QztZQUM1QyxPQUFPbkMsTUFBTSw4Q0FBOEM7UUFDL0Q7UUFFQSw2QkFBNkI7UUFDN0IsSUFBSW1DLGVBQWVqQixJQUFJLEtBQUssU0FBUztZQUNqQyxNQUFNLElBQUlwRyxNQUFNO1FBQ3BCO1FBRUEsMERBQTBEO1FBQzFELE1BQU13QixTQUFTLE1BQU0xQyxNQUFNcUQsU0FBUyxDQUNsQztZQUFFOUIsS0FBS3NHO1FBQWEsR0FDcEI7WUFDRWpELE9BQU87Z0JBQUV5QyxTQUFTO29CQUFFL0UsUUFBUWdHO2dCQUFtQjtZQUFFO1lBQ2pEdkYsTUFBTTtnQkFBRU4sV0FBV2Y7WUFBSTtRQUN6QjtRQUdGLElBQUlnQixPQUFPK0YsYUFBYSxLQUFLLEdBQUc7WUFDOUIsK0RBQStEO1lBQy9EbkksUUFBUTRILEdBQUcsQ0FBQztRQUNkO1FBRUEsTUFBTVQsY0FBYyxNQUFNekgsTUFBTXNCLE9BQU8sQ0FBQztZQUFFQyxLQUFLc0c7UUFBYTtRQUM1RCxPQUFPSjtJQUVULEVBQUUsT0FBT3BILE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLCtCQUErQkE7UUFDN0MsSUFBSUEsTUFBTXdGLE9BQU8sS0FBSyxpQ0FBaUM7WUFDbkQsTUFBTXhGO1FBQ1Y7UUFDQSxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFO0FBRUYsa0RBQWtEO0FBRWxELDRCQUE0QjtBQUVyQixNQUFNd0gsd0JBQXdCLE9BQU9uRTtJQUMxQyxNQUFNRSxpQkFBaUJ2RSxXQUFXcUU7SUFDbEMsSUFBSSxDQUFDRSxnQkFBZ0IsT0FBTyxFQUFFO0lBQzlCLElBQUk7UUFDRixNQUFNLEVBQUV4RSxRQUFRLEVBQUUsR0FBRyxNQUFNUDtRQUMzQiwwREFBMEQ7UUFDMUQsTUFBTWlKLGlCQUFpQixNQUFNMUksU0FBU1UsSUFBSSxDQUFDO1lBQUU0RCxVQUFVRTtRQUFlLEdBQUc3RCxJQUFJLENBQUM7WUFBRUMsV0FBVyxDQUFDO1FBQUUsR0FBR0ksT0FBTztRQUN4RyxPQUFPMEg7SUFDVCxFQUFFLE9BQU90SSxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyx5Q0FBeUNBO1FBQ3ZELE1BQU0sSUFBSWEsTUFBTTtJQUNsQjtBQUNGLEVBQUU7QUFFSyxNQUFNMEgsZ0JBQWdCLE9BQU9DO0lBQ2xDLElBQUksQ0FBQ0EsWUFBWXRFLFFBQVEsSUFBSSxDQUFDc0UsWUFBWXZHLE1BQU0sSUFBSSxDQUFDdUcsWUFBWS9HLE9BQU8sRUFBRTtRQUN4RSxNQUFNLElBQUlaLE1BQU07SUFDbEI7SUFDQSxNQUFNdUQsaUJBQWlCdkUsV0FBVzJJLFlBQVl0RSxRQUFRO0lBQ3RELG1EQUFtRDtJQUNuRCxNQUFNK0IsZUFBZXVDLFlBQVl2RyxNQUFNLENBQUNpRSxRQUFRO0lBRWhELElBQUksQ0FBQzlCLGdCQUFnQjtRQUNuQixNQUFNLElBQUl2RCxNQUFNO0lBQ2xCO0lBRUEsSUFBSTtRQUNGLE1BQU0sRUFBRWpCLFFBQVEsRUFBRUwsS0FBSyxFQUFFLEdBQUcsTUFBTUY7UUFDbEMsTUFBTWdDLE1BQU0sSUFBSUM7UUFFaEIseUJBQXlCO1FBQ3pCLElBQUltSCxnQkFBZ0IsUUFBUSxVQUFVO1FBQ3RDLE1BQU1DLGdCQUFnQixNQUFNbkosTUFBTTBCLE9BQU8sQ0FBQztZQUFFQyxLQUFLckIsV0FBV29HO1FBQWMsR0FBRztZQUFFeEIsWUFBWTtnQkFBRWIsTUFBTTtZQUFFO1FBQUU7UUFDdkcsSUFBSThFLGlCQUFpQkEsY0FBYzlFLElBQUksRUFBRTtZQUNyQzZFLGdCQUFnQkMsY0FBYzlFLElBQUk7UUFDdEM7UUFFQSxNQUFNK0UsYUFBYTtZQUNqQnpFLFVBQVVFO1lBQ1ZuQyxRQUFRZ0U7WUFDUnhFLFNBQVMrRyxZQUFZL0csT0FBTztZQUM1QlMsV0FBV3VHO1lBQ1hqSSxXQUFXYTtZQUNYZSxXQUFXZjtRQUNiO1FBQ0EsTUFBTWdCLFNBQVMsTUFBTXpDLFNBQVMwQyxTQUFTLENBQUNxRztRQUN4QyxPQUFPO1lBQUUsR0FBR0EsVUFBVTtZQUFFekgsS0FBS21CLE9BQU9FLFVBQVU7UUFBQztJQUNqRCxFQUFFLE9BQU92QyxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQywyQkFBMkJBO1FBQ3pDLE1BQU0sSUFBSWEsTUFBTTtJQUNsQjtBQUNGLEVBQUU7QUFFSyxNQUFNK0gsZ0JBQWdCLE9BQU85SSxJQUFJMEk7SUFDdEMsTUFBTXpILFdBQVdsQixXQUFXQztJQUM1QixJQUFJLENBQUNpQixVQUFVLE9BQU87SUFDdEIsSUFBSSxDQUFDeUgsWUFBWS9HLE9BQU8sRUFBRTtRQUN4QixNQUFNLElBQUlaLE1BQU07SUFDbEI7SUFFQSxJQUFJO1FBQ0YsTUFBTSxFQUFFakIsUUFBUSxFQUFFLEdBQUcsTUFBTVA7UUFDM0IsTUFBTW9ELFlBQVk7WUFDaEJDLE1BQU07Z0JBQ0pqQixTQUFTK0csWUFBWS9HLE9BQU87Z0JBQzVCVyxXQUFXLElBQUlkO1lBQ2pCO1FBQ0Y7UUFDQSxNQUFNZSxTQUFTLE1BQU16QyxTQUFTb0QsU0FBUyxDQUFDO1lBQUU5QixLQUFLSDtRQUFTLEdBQUcwQjtRQUMzRCxJQUFJSixPQUFPWSxZQUFZLEtBQUssR0FBRyxPQUFPO1FBRXRDLE1BQU00RixpQkFBaUIsTUFBTWpKLFNBQVNxQixPQUFPLENBQUM7WUFBRUMsS0FBS0g7UUFBUztRQUM5RCxPQUFPOEg7SUFDVCxFQUFFLE9BQU83SSxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQywyQkFBMkJBO1FBQ3pDLE1BQU0sSUFBSWEsTUFBTTtJQUNsQjtBQUNGLEVBQUU7QUFFSyxNQUFNaUksZ0JBQWdCLE9BQU9oSjtJQUNsQyxNQUFNaUIsV0FBV2xCLFdBQVdDO0lBQzVCLElBQUksQ0FBQ2lCLFVBQVUsT0FBTztJQUN0QixJQUFJO1FBQ0YsTUFBTSxFQUFFbkIsUUFBUSxFQUFFLEdBQUcsTUFBTVA7UUFDM0IsTUFBTWdELFNBQVMsTUFBTXpDLFNBQVN3RCxTQUFTLENBQUM7WUFBRWxDLEtBQUtIO1FBQVM7UUFDeEQsT0FBT3NCLE9BQU9nQixZQUFZLEdBQUc7SUFDL0IsRUFBRSxPQUFPckQsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsMkJBQTJCQTtRQUN6QyxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFLENBRUYseURBQXlEO0NBQ3pEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFxQkEiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmF1ZGlcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9tcHRQcm9cXFByb21wdFByb1xcbGliXFxkYi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25uZWN0VG9EYXRhYmFzZSB9IGZyb20gJy4vbW9uZ29kYic7XG5pbXBvcnQgeyBPYmplY3RJZCB9IGZyb20gJ21vbmdvZGInO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkIH0gZnJvbSAnLi9hdXRoLXV0aWxzJzsgLy8gQXNzdW1pbmcgYXV0aC11dGlscyBoYW5kbGVzIHBhc3N3b3JkIGhhc2hpbmdcblxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IHRoZSBkYXRhYmFzZSBhbmQgY29sbGVjdGlvbnMuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldENvbGxlY3Rpb25zKCkge1xuICBjb25zdCB7IGRiIH0gPSBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xuICByZXR1cm4ge1xuICAgIHVzZXJzOiBkYi5jb2xsZWN0aW9uKCd1c2VycycpLFxuICAgIHByb21wdHM6IGRiLmNvbGxlY3Rpb24oJ3Byb21wdHMnKSxcbiAgICBjb2xsZWN0aW9uczogZGIuY29sbGVjdGlvbignY29sbGVjdGlvbnMnKSxcbiAgICB0ZWFtczogZGIuY29sbGVjdGlvbigndGVhbXMnKSxcbiAgICBjb21tZW50czogZGIuY29sbGVjdGlvbignY29tbWVudHMnKSxcbiAgfTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gY29udmVydCBzdHJpbmcgSUQgdG8gT2JqZWN0SWQuXG4gKiBSZXR1cm5zIG51bGwgaWYgdGhlIElEIGlzIGludmFsaWQuXG4gKi9cbmZ1bmN0aW9uIHRvT2JqZWN0SWQoaWQpIHtcbiAgaWYgKCFpZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChpZCkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICB0cnkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0SWQoaWQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIEhhbmRsZSBwb3RlbnRpYWwgZXJyb3JzIGR1cmluZyBPYmplY3RJZCBjcmVhdGlvbiBpZiBuZWVkZWRcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgT2JqZWN0SWQ6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vLyAtLS0gUHJvbXB0IEZ1bmN0aW9ucyAtLS1cblxuZXhwb3J0IGNvbnN0IGdldEFsbFByb21wdHMgPSBhc3luYyAoZmlsdGVyID0ge30sIG9wdGlvbnMgPSB7fSkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgcHJvbXB0cyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICBjb25zdCBjdXJzb3IgPSBwcm9tcHRzLmZpbmQoZmlsdGVyKTtcbiAgICBcbiAgICAvLyBBZGQgc29ydGluZyBpZiBzcGVjaWZpZWQgaW4gb3B0aW9uc1xuICAgIGlmIChvcHRpb25zLnNvcnQpIHtcbiAgICAgIGN1cnNvci5zb3J0KG9wdGlvbnMuc29ydCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY3Vyc29yLnNvcnQoeyBjcmVhdGVkQXQ6IC0xIH0pOyAvLyBEZWZhdWx0IHNvcnQ6IG5ld2VzdCBmaXJzdFxuICAgIH1cblxuICAgIC8vIEFkZCBsaW1pdCBpZiBzcGVjaWZpZWRcbiAgICBpZiAob3B0aW9ucy5saW1pdCkge1xuICAgICAgY3Vyc29yLmxpbWl0KG9wdGlvbnMubGltaXQpO1xuICAgIH1cblxuICAgIC8vIEFkZCBza2lwIGZvciBwYWdpbmF0aW9uIGlmIHNwZWNpZmllZFxuICAgIGlmIChvcHRpb25zLnNraXApIHtcbiAgICAgICAgY3Vyc29yLnNraXAob3B0aW9ucy5za2lwKTtcbiAgICB9XG5cbiAgICBjb25zdCBhbGxQcm9tcHRzID0gYXdhaXQgY3Vyc29yLnRvQXJyYXkoKTtcbiAgICByZXR1cm4gYWxsUHJvbXB0cztcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWxsIHByb21wdHM6XCIsIGVycm9yKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBmZXRjaGluZyBwcm9tcHRzLlwiKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGdldFByb21wdEJ5SWQgPSBhc3luYyAoaWQpID0+IHtcbiAgY29uc3Qgb2JqZWN0SWQgPSB0b09iamVjdElkKGlkKTtcbiAgaWYgKCFvYmplY3RJZCkgcmV0dXJuIG51bGw7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBwcm9tcHRzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xuICAgIGNvbnN0IHByb21wdCA9IGF3YWl0IHByb21wdHMuZmluZE9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XG4gICAgcmV0dXJuIHByb21wdDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgcHJvbXB0IGJ5IElEOlwiLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgcHJvbXB0LlwiKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVByb21wdCA9IGFzeW5jIChwcm9tcHREYXRhKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBwcm9tcHRzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgbmV3UHJvbXB0ID0ge1xuICAgICAgdGl0bGU6IHByb21wdERhdGEudGl0bGUsXG4gICAgICBjb250ZW50OiBwcm9tcHREYXRhLmNvbnRlbnQsXG4gICAgICBkZXNjcmlwdGlvbjogcHJvbXB0RGF0YS5kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICAgIHRhZ3M6IHByb21wdERhdGEudGFncyB8fCBbXSxcbiAgICAgIGFpUGxhdGZvcm06IHByb21wdERhdGEuYWlQbGF0Zm9ybSB8fCAnQ2hhdEdQVCcsXG4gICAgICByYXRpbmc6IHByb21wdERhdGEucmF0aW5nIHx8IDAsXG4gICAgICB1c2FnZUNvdW50OiBwcm9tcHREYXRhLnVzYWdlQ291bnQgfHwgMCxcbiAgICAgIHN1Y2Nlc3NSYXRlOiBwcm9tcHREYXRhLnN1Y2Nlc3NSYXRlIHx8IDAsXG4gICAgICB2aXNpYmlsaXR5OiBwcm9tcHREYXRhLnZpc2liaWxpdHkgfHwgJ3ByaXZhdGUnLFxuICAgICAgdXNlcklkOiBwcm9tcHREYXRhLnVzZXJJZCwgLy8gU2hvdWxkIGNvbWUgZnJvbSBhdXRoZW50aWNhdGVkIHNlc3Npb25cbiAgICAgIGNyZWF0ZWRCeTogcHJvbXB0RGF0YS5jcmVhdGVkQnksIC8vIE9wdGlvbmFsOiBTdG9yZSBjcmVhdG9yJ3MgbmFtZS9pbmZvXG4gICAgICB0ZWFtSWQ6IHByb21wdERhdGEudGVhbUlkID8gdG9PYmplY3RJZChwcm9tcHREYXRhLnRlYW1JZCkgOiBudWxsLCAvLyBDb252ZXJ0IHRlYW1JZCBpZiBwcmVzZW50XG4gICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgIHVwZGF0ZWRBdDogbm93LFxuICAgIH07XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvbXB0cy5pbnNlcnRPbmUobmV3UHJvbXB0KTtcbiAgICByZXR1cm4geyAuLi5uZXdQcm9tcHQsIF9pZDogcmVzdWx0Lmluc2VydGVkSWQgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgcHJvbXB0OlwiLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgY3JlYXRpbmcgcHJvbXB0LlwiKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHVwZGF0ZVByb21wdCA9IGFzeW5jIChpZCwgcHJvbXB0RGF0YSkgPT4ge1xuICBjb25zdCBvYmplY3RJZCA9IHRvT2JqZWN0SWQoaWQpO1xuICBpZiAoIW9iamVjdElkKSByZXR1cm4gbnVsbDtcblxuICB0cnkge1xuICAgIGNvbnN0IHsgcHJvbXB0cyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICBjb25zdCB1cGRhdGVEb2MgPSB7ICRzZXQ6IHt9IH07XG5cbiAgICAvLyBBZGQgZmllbGRzIHRvIHVwZGF0ZSBvbmx5IGlmIHRoZXkgYXJlIHByb3ZpZGVkXG4gICAgZm9yIChjb25zdCBrZXkgb2YgWyd0aXRsZScsICdjb250ZW50JywgJ2Rlc2NyaXB0aW9uJywgJ3RhZ3MnLCAnYWlQbGF0Zm9ybScsICdyYXRpbmcnLCAndXNhZ2VDb3VudCcsICdzdWNjZXNzUmF0ZScsICd2aXNpYmlsaXR5JywgJ2NyZWF0ZWRCeSddKSB7XG4gICAgICBpZiAocHJvbXB0RGF0YVtrZXldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdXBkYXRlRG9jLiRzZXRba2V5XSA9IHByb21wdERhdGFba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gSGFuZGxlIHRlYW1JZCBzZXBhcmF0ZWx5IC0gYWxsb3cgc2V0dGluZyB0byBudWxsIG9yIGEgdmFsaWQgT2JqZWN0SWRcbiAgICBpZiAocHJvbXB0RGF0YS50ZWFtSWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB1cGRhdGVEb2MuJHNldC50ZWFtSWQgPSBwcm9tcHREYXRhLnRlYW1JZCA/IHRvT2JqZWN0SWQocHJvbXB0RGF0YS50ZWFtSWQpIDogbnVsbDtcbiAgICB9XG5cbiAgICAvLyBEb24ndCB1cGRhdGUgdXNlcklkIG9yIGNyZWF0ZWRBdFxuICAgIHVwZGF0ZURvYy4kc2V0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG5cbiAgICBpZiAoT2JqZWN0LmtleXModXBkYXRlRG9jLiRzZXQpLmxlbmd0aCA9PT0gMSkgeyAvLyBPbmx5IHVwZGF0ZWRBdFxuICAgICAgICAvLyBNYXliZSBza2lwIHVwZGF0ZSBpZiBvbmx5IHRpbWVzdGFtcCBjaGFuZ2VzP1xuICAgICAgICByZXR1cm4gcHJvbXB0cy5maW5kT25lKHsgX2lkOiBvYmplY3RJZCB9KTsgLy8gUmV0dXJuIGN1cnJlbnQgZG9jXG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvbXB0cy51cGRhdGVPbmUoeyBfaWQ6IG9iamVjdElkIH0sIHVwZGF0ZURvYyk7XG5cbiAgICBpZiAocmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgcmV0dXJuIG51bGw7IC8vIFByb21wdCBub3QgZm91bmRcbiAgICB9XG5cbiAgICBjb25zdCB1cGRhdGVkUHJvbXB0ID0gYXdhaXQgcHJvbXB0cy5maW5kT25lKHsgX2lkOiBvYmplY3RJZCB9KTtcbiAgICByZXR1cm4gdXBkYXRlZFByb21wdDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgcHJvbXB0OlwiLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgdXBkYXRpbmcgcHJvbXB0LlwiKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGRlbGV0ZVByb21wdCA9IGFzeW5jIChpZCkgPT4ge1xuICBjb25zdCBvYmplY3RJZCA9IHRvT2JqZWN0SWQoaWQpO1xuICBpZiAoIW9iamVjdElkKSByZXR1cm4gZmFsc2U7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB7IHByb21wdHMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XG4gICAgLy8gVE9ETzogQ29uc2lkZXIgZGVsZXRpbmcgYXNzb2NpYXRlZCBjb21tZW50cyBvciBoYW5kbGluZyBkZXBlbmRlbmNpZXNcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm9tcHRzLmRlbGV0ZU9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XG4gICAgcmV0dXJuIHJlc3VsdC5kZWxldGVkQ291bnQgPiAwO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyBwcm9tcHQ6XCIsIGVycm9yKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBkZWxldGluZyBwcm9tcHQuXCIpO1xuICB9XG59O1xuXG4vLyBUT0RPOiBJbXBsZW1lbnQgc2VhcmNoUHJvbXB0cyB1c2luZyBNb25nb0RCJ3MgdGV4dCBzZWFyY2ggb3IgY29tcGxleCBmaWx0ZXJpbmdcbi8vIGV4cG9ydCBjb25zdCBzZWFyY2hQcm9tcHRzID0gYXN5bmMgKHF1ZXJ5LCBvcHRpb25zID0ge30pID0+IHsgLi4uIH07XG5cbi8vIC0tLSBDb2xsZWN0aW9uIEZ1bmN0aW9ucyAtLS1cblxuZXhwb3J0IGNvbnN0IGdldEFsbENvbGxlY3Rpb25zID0gYXN5bmMgKGZpbHRlciA9IHt9LCBvcHRpb25zID0ge30pID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGNvbGxlY3Rpb25zIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xuICAgIGNvbnN0IGN1cnNvciA9IGNvbGxlY3Rpb25zLmZpbmQoZmlsdGVyKTtcbiAgICBpZiAob3B0aW9ucy5zb3J0KSBjdXJzb3Iuc29ydChvcHRpb25zLnNvcnQpO1xuICAgIGlmIChvcHRpb25zLmxpbWl0KSBjdXJzb3IubGltaXQob3B0aW9ucy5saW1pdCk7XG4gICAgaWYgKG9wdGlvbnMuc2tpcCkgY3Vyc29yLnNraXAob3B0aW9ucy5za2lwKTtcbiAgICBjb25zdCBhbGxDb2xsZWN0aW9ucyA9IGF3YWl0IGN1cnNvci50b0FycmF5KCk7XG4gICAgcmV0dXJuIGFsbENvbGxlY3Rpb25zO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBhbGwgY29sbGVjdGlvbnM6XCIsIGVycm9yKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBmZXRjaGluZyBjb2xsZWN0aW9ucy5cIik7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZXRDb2xsZWN0aW9uQnlJZCA9IGFzeW5jIChpZCkgPT4ge1xuICBjb25zdCBvYmplY3RJZCA9IHRvT2JqZWN0SWQoaWQpO1xuICBpZiAoIW9iamVjdElkKSByZXR1cm4gbnVsbDtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGNvbGxlY3Rpb25zIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xuICAgIC8vIE9wdGlvbmFsbHkgdXNlIGFnZ3JlZ2F0aW9uIHRvIHBvcHVsYXRlIHByb21wdHMgaWYgbmVlZGVkIGltbWVkaWF0ZWx5XG4gICAgY29uc3QgY29sbGVjdGlvbiA9IGF3YWl0IGNvbGxlY3Rpb25zLmZpbmRPbmUoeyBfaWQ6IG9iamVjdElkIH0pO1xuICAgIHJldHVybiBjb2xsZWN0aW9uO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBjb2xsZWN0aW9uIGJ5IElEOlwiLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgY29sbGVjdGlvbi5cIik7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVDb2xsZWN0aW9uID0gYXN5bmMgKGNvbGxlY3Rpb25EYXRhKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBjb2xsZWN0aW9ucyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IG5ld0NvbGxlY3Rpb24gPSB7XG4gICAgICBuYW1lOiBjb2xsZWN0aW9uRGF0YS5uYW1lLFxuICAgICAgZGVzY3JpcHRpb246IGNvbGxlY3Rpb25EYXRhLmRlc2NyaXB0aW9uIHx8ICcnLFxuICAgICAgdXNlcklkOiBjb2xsZWN0aW9uRGF0YS51c2VySWQsIC8vIEZyb20gc2Vzc2lvblxuICAgICAgcHJvbXB0czogW10sIC8vIFN0b3JlIHByb21wdCBPYmplY3RJZHMgaGVyZVxuICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICB9O1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbGxlY3Rpb25zLmluc2VydE9uZShuZXdDb2xsZWN0aW9uKTtcbiAgICByZXR1cm4geyAuLi5uZXdDb2xsZWN0aW9uLCBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIGNvbGxlY3Rpb246XCIsIGVycm9yKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBjcmVhdGluZyBjb2xsZWN0aW9uLlwiKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHVwZGF0ZUNvbGxlY3Rpb24gPSBhc3luYyAoaWQsIGNvbGxlY3Rpb25EYXRhKSA9PiB7XG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XG4gIGlmICghb2JqZWN0SWQpIHJldHVybiBudWxsO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgeyBjb2xsZWN0aW9ucyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICBjb25zdCB1cGRhdGVEb2MgPSB7ICRzZXQ6IHt9IH07XG4gICAgaWYgKGNvbGxlY3Rpb25EYXRhLm5hbWUgIT09IHVuZGVmaW5lZCkgdXBkYXRlRG9jLiRzZXQubmFtZSA9IGNvbGxlY3Rpb25EYXRhLm5hbWU7XG4gICAgaWYgKGNvbGxlY3Rpb25EYXRhLmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURvYy4kc2V0LmRlc2NyaXB0aW9uID0gY29sbGVjdGlvbkRhdGEuZGVzY3JpcHRpb247XG4gICAgLy8gTm90ZTogTWFuYWdpbmcgdGhlICdwcm9tcHRzJyBhcnJheSAoYWRkL3JlbW92ZSkgdHlwaWNhbGx5IGRvbmUgdmlhIHNlcGFyYXRlIGZ1bmN0aW9uc1xuICAgIHVwZGF0ZURvYy4kc2V0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG5cbiAgICBpZiAoT2JqZWN0LmtleXModXBkYXRlRG9jLiRzZXQpLmxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbGxlY3Rpb25zLnVwZGF0ZU9uZSh7IF9pZDogb2JqZWN0SWQgfSwgdXBkYXRlRG9jKTtcbiAgICAgIGlmIChyZXN1bHQubWF0Y2hlZENvdW50ID09PSAwKSByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCB1cGRhdGVkQ29sbGVjdGlvbiA9IGF3YWl0IGNvbGxlY3Rpb25zLmZpbmRPbmUoeyBfaWQ6IG9iamVjdElkIH0pO1xuICAgIHJldHVybiB1cGRhdGVkQ29sbGVjdGlvbjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgY29sbGVjdGlvbjpcIiwgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIHVwZGF0aW5nIGNvbGxlY3Rpb24uXCIpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZGVsZXRlQ29sbGVjdGlvbiA9IGFzeW5jIChpZCkgPT4ge1xuICBjb25zdCBvYmplY3RJZCA9IHRvT2JqZWN0SWQoaWQpO1xuICBpZiAoIW9iamVjdElkKSByZXR1cm4gZmFsc2U7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBjb2xsZWN0aW9ucyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb2xsZWN0aW9ucy5kZWxldGVPbmUoeyBfaWQ6IG9iamVjdElkIH0pO1xuICAgIHJldHVybiByZXN1bHQuZGVsZXRlZENvdW50ID4gMDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZGVsZXRpbmcgY29sbGVjdGlvbjpcIiwgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGRlbGV0aW5nIGNvbGxlY3Rpb24uXCIpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgYWRkUHJvbXB0VG9Db2xsZWN0aW9uID0gYXN5bmMgKGNvbGxlY3Rpb25JZCwgcHJvbXB0SWQpID0+IHtcbiAgY29uc3QgY29sbE9iamVjdElkID0gdG9PYmplY3RJZChjb2xsZWN0aW9uSWQpO1xuICBjb25zdCBwcm9tcHRPYmplY3RJZCA9IHRvT2JqZWN0SWQocHJvbXB0SWQpO1xuICBpZiAoIWNvbGxPYmplY3RJZCB8fCAhcHJvbXB0T2JqZWN0SWQpIHJldHVybiBudWxsO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgeyBjb2xsZWN0aW9ucyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICAvLyBVc2UgJGFkZFRvU2V0IHRvIGFkZCB0aGUgcHJvbXB0J3MgT2JqZWN0SWQgdG8gdGhlIGFycmF5IGlmIG5vdCBhbHJlYWR5IHByZXNlbnRcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb2xsZWN0aW9ucy51cGRhdGVPbmUoXG4gICAgICB7IF9pZDogY29sbE9iamVjdElkIH0sXG4gICAgICB7IFxuICAgICAgICAkYWRkVG9TZXQ6IHsgcHJvbXB0czogcHJvbXB0T2JqZWN0SWQgfSxcbiAgICAgICAgJHNldDogeyB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfVxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKHJlc3VsdC5tYXRjaGVkQ291bnQgPT09IDApIHJldHVybiBudWxsOyAvLyBDb2xsZWN0aW9uIG5vdCBmb3VuZFxuICAgIFxuICAgIGNvbnN0IHVwZGF0ZWRDb2xsZWN0aW9uID0gYXdhaXQgY29sbGVjdGlvbnMuZmluZE9uZSh7IF9pZDogY29sbE9iamVjdElkIH0pO1xuICAgIHJldHVybiB1cGRhdGVkQ29sbGVjdGlvbjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIHByb21wdCB0byBjb2xsZWN0aW9uOlwiLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgYWRkaW5nIHByb21wdCB0byBjb2xsZWN0aW9uLlwiKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHJlbW92ZVByb21wdEZyb21Db2xsZWN0aW9uID0gYXN5bmMgKGNvbGxlY3Rpb25JZCwgcHJvbXB0SWQpID0+IHtcbiAgY29uc3QgY29sbE9iamVjdElkID0gdG9PYmplY3RJZChjb2xsZWN0aW9uSWQpO1xuICBjb25zdCBwcm9tcHRPYmplY3RJZCA9IHRvT2JqZWN0SWQocHJvbXB0SWQpO1xuICBpZiAoIWNvbGxPYmplY3RJZCB8fCAhcHJvbXB0T2JqZWN0SWQpIHJldHVybiBudWxsO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgeyBjb2xsZWN0aW9ucyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICAvLyBVc2UgJHB1bGwgdG8gcmVtb3ZlIHRoZSBwcm9tcHQncyBPYmplY3RJZCBmcm9tIHRoZSBhcnJheVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbGxlY3Rpb25zLnVwZGF0ZU9uZShcbiAgICAgIHsgX2lkOiBjb2xsT2JqZWN0SWQgfSxcbiAgICAgIHsgXG4gICAgICAgICRwdWxsOiB7IHByb21wdHM6IHByb21wdE9iamVjdElkIH0sXG4gICAgICAgICRzZXQ6IHsgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0gXG4gICAgICB9XG4gICAgKTtcbiAgICBpZiAocmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkgcmV0dXJuIG51bGw7IC8vIENvbGxlY3Rpb24gbm90IGZvdW5kXG5cbiAgICBjb25zdCB1cGRhdGVkQ29sbGVjdGlvbiA9IGF3YWl0IGNvbGxlY3Rpb25zLmZpbmRPbmUoeyBfaWQ6IGNvbGxPYmplY3RJZCB9KTtcbiAgICByZXR1cm4gdXBkYXRlZENvbGxlY3Rpb247XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJlbW92aW5nIHByb21wdCBmcm9tIGNvbGxlY3Rpb246XCIsIGVycm9yKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSByZW1vdmluZyBwcm9tcHQgZnJvbSBjb2xsZWN0aW9uLlwiKTtcbiAgfVxufTtcblxuLy8gLS0tIFVzZXIgRnVuY3Rpb25zIC0tLVxuLy8gTm90ZTogVGhlc2UgYXJlIGJhc2ljIGltcGxlbWVudGF0aW9ucy4gQXV0aGVudGljYXRpb24gbGlicmFyaWVzIG9mdGVuIGhhbmRsZSB1c2VyIG1hbmFnZW1lbnQuXG5cbmV4cG9ydCBjb25zdCBnZXRBbGxVc2VycyA9IGFzeW5jIChmaWx0ZXIgPSB7fSwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyB1c2VycyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICAvLyBFeGNsdWRlIHBhc3N3b3JkIGZpZWxkIGJ5IGRlZmF1bHRcbiAgICBjb25zdCBjdXJzb3IgPSB1c2Vycy5maW5kKGZpbHRlciwgeyBwcm9qZWN0aW9uOiB7IHBhc3N3b3JkOiAwIH0gfSk7IFxuICAgIGlmIChvcHRpb25zLnNvcnQpIGN1cnNvci5zb3J0KG9wdGlvbnMuc29ydCk7XG4gICAgaWYgKG9wdGlvbnMubGltaXQpIGN1cnNvci5saW1pdChvcHRpb25zLmxpbWl0KTtcbiAgICBpZiAob3B0aW9ucy5za2lwKSBjdXJzb3Iuc2tpcChvcHRpb25zLnNraXApO1xuICAgIGNvbnN0IGFsbFVzZXJzID0gYXdhaXQgY3Vyc29yLnRvQXJyYXkoKTtcbiAgICByZXR1cm4gYWxsVXNlcnM7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFsbCB1c2VyczpcIiwgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGZldGNoaW5nIHVzZXJzLlwiKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGdldFVzZXJCeUlkID0gYXN5bmMgKGlkKSA9PiB7XG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XG4gIGlmICghb2JqZWN0SWQpIHJldHVybiBudWxsO1xuICB0cnkge1xuICAgIGNvbnN0IHsgdXNlcnMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBfaWQ6IG9iamVjdElkIH0sIHsgcHJvamVjdGlvbjogeyBwYXNzd29yZDogMCB9IH0pO1xuICAgIHJldHVybiB1c2VyO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyB1c2VyIGJ5IElEOlwiLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgdXNlci5cIik7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZXRVc2VyQnlFbWFpbCA9IGFzeW5jIChlbWFpbCkgPT4ge1xuICBpZiAoIWVtYWlsKSByZXR1cm4gbnVsbDtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHVzZXJzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xuICAgIC8vIEZpbmQgdXNlciBieSBlbWFpbCwgYnV0IERPIGluY2x1ZGUgcGFzc3dvcmQgZm9yIGF1dGhlbnRpY2F0aW9uIGNoZWNrc1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB1c2Vycy5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG4gICAgcmV0dXJuIHVzZXI7IFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyB1c2VyIGJ5IGVtYWlsOlwiLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgdXNlci5cIik7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVVc2VyID0gYXN5bmMgKHVzZXJEYXRhKSA9PiB7XG4gIGlmICghdXNlckRhdGEuZW1haWwgfHwgIXVzZXJEYXRhLnBhc3N3b3JkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRW1haWwgYW5kIHBhc3N3b3JkIGFyZSByZXF1aXJlZCB0byBjcmVhdGUgYSB1c2VyLlwiKTtcbiAgfVxuICBcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHVzZXJzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBhbHJlYWR5IGV4aXN0c1xuICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBlbWFpbDogdXNlckRhdGEuZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcbiAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVc2VyIHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhc2ggcGFzc3dvcmQgYmVmb3JlIHN0b3JpbmdcbiAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZCh1c2VyRGF0YS5wYXNzd29yZCk7XG4gICAgXG4gICAgY29uc3QgbmV3VXNlciA9IHtcbiAgICAgIG5hbWU6IHVzZXJEYXRhLm5hbWUgfHwgJycsXG4gICAgICBlbWFpbDogdXNlckRhdGEuZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgIGltYWdlOiB1c2VyRGF0YS5pbWFnZSB8fCBudWxsLFxuICAgICAgLy8gQWRkIHJvbGVzIG9yIG90aGVyIGZpZWxkcyBhcyBuZWVkZWRcbiAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgfTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2Vycy5pbnNlcnRPbmUobmV3VXNlcik7XG4gICAgLy8gUmV0dXJuIHVzZXIgZGF0YSB3aXRob3V0IHRoZSBwYXNzd29yZCBoYXNoXG4gICAgY29uc3QgeyBwYXNzd29yZCwgLi4udXNlcldpdGhvdXRQYXNzd29yZCB9ID0gbmV3VXNlcjtcbiAgICByZXR1cm4geyAuLi51c2VyV2l0aG91dFBhc3N3b3JkLCBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH07XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgdXNlcjpcIiwgZXJyb3IpO1xuICAgIC8vIFJldGhyb3cgc3BlY2lmaWMgZXJyb3JzIG9yIGEgZ2VuZXJpYyBvbmVcbiAgICBpZiAoZXJyb3IubWVzc2FnZSA9PT0gXCJVc2VyIHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgY3JlYXRpbmcgdXNlci5cIik7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVVc2VyID0gYXN5bmMgKGlkLCB1c2VyRGF0YSkgPT4ge1xuICBjb25zdCBvYmplY3RJZCA9IHRvT2JqZWN0SWQoaWQpO1xuICBpZiAoIW9iamVjdElkKSByZXR1cm4gbnVsbDtcblxuICB0cnkge1xuICAgIGNvbnN0IHsgdXNlcnMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XG4gICAgY29uc3QgdXBkYXRlRG9jID0geyAkc2V0OiB7fSB9O1xuXG4gICAgaWYgKHVzZXJEYXRhLm5hbWUgIT09IHVuZGVmaW5lZCkgdXBkYXRlRG9jLiRzZXQubmFtZSA9IHVzZXJEYXRhLm5hbWU7XG4gICAgaWYgKHVzZXJEYXRhLmltYWdlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURvYy4kc2V0LmltYWdlID0gdXNlckRhdGEuaW1hZ2U7XG4gICAgLy8gQWRkIG90aGVyIHVwZGF0YWJsZSBmaWVsZHMgKGUuZy4sIHJvbGVzKVxuICAgIFxuICAgIC8vIEhhbmRsZSBlbWFpbCBjaGFuZ2UgY2FyZWZ1bGx5XG4gICAgaWYgKHVzZXJEYXRhLmVtYWlsICYmIHR5cGVvZiB1c2VyRGF0YS5lbWFpbCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNvbnN0IG5ld0VtYWlsID0gdXNlckRhdGEuZW1haWwudG9Mb3dlckNhc2UoKTtcbiAgICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBlbWFpbDogbmV3RW1haWwgfSk7XG4gICAgICAvLyBBbGxvdyB1cGRhdGUgb25seSBpZiBlbWFpbCBkb2Vzbid0IGV4aXN0IE9SIGJlbG9uZ3MgdG8gdGhlIGN1cnJlbnQgdXNlclxuICAgICAgaWYgKGV4aXN0aW5nVXNlciAmJiAhZXhpc3RpbmdVc2VyLl9pZC5lcXVhbHMob2JqZWN0SWQpKSB7XG4gICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbWFpbCBhZGRyZXNzIGlzIGFscmVhZHkgaW4gdXNlLlwiKTtcbiAgICAgIH1cbiAgICAgIHVwZGF0ZURvYy4kc2V0LmVtYWlsID0gbmV3RW1haWw7XG4gICAgfVxuICAgIFxuICAgIC8vIERvIG5vdCBhbGxvdyBwYXNzd29yZCB1cGRhdGUgdGhyb3VnaCB0aGlzIGdlbmVyYWwgZnVuY3Rpb25cbiAgICAvLyBDcmVhdGUgYSBzcGVjaWZpYyBjaGFuZ2VQYXNzd29yZCBmdW5jdGlvbiBpZiBuZWVkZWRcblxuICAgIHVwZGF0ZURvYy4kc2V0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG5cbiAgICBpZiAoT2JqZWN0LmtleXModXBkYXRlRG9jLiRzZXQpLmxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJzLnVwZGF0ZU9uZSh7IF9pZDogb2JqZWN0SWQgfSwgdXBkYXRlRG9jKTtcbiAgICAgIGlmIChyZXN1bHQubWF0Y2hlZENvdW50ID09PSAwKSByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCB1cGRhdGVkVXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBfaWQ6IG9iamVjdElkIH0sIHsgcHJvamVjdGlvbjogeyBwYXNzd29yZDogMCB9IH0pO1xuICAgIHJldHVybiB1cGRhdGVkVXNlcjtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyB1c2VyOlwiLCBlcnJvcik7XG4gICAgIGlmIChlcnJvci5tZXNzYWdlID09PSBcIkVtYWlsIGFkZHJlc3MgaXMgYWxyZWFkeSBpbiB1c2UuXCIpIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIHVwZGF0aW5nIHVzZXIuXCIpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZGVsZXRlVXNlciA9IGFzeW5jIChpZCkgPT4ge1xuICBjb25zdCBvYmplY3RJZCA9IHRvT2JqZWN0SWQoaWQpO1xuICBpZiAoIW9iamVjdElkKSByZXR1cm4gZmFsc2U7XG4gIHRyeSB7XG4gICAgY29uc3QgeyB1c2VycyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICAvLyBUT0RPOiBIYW5kbGUgcmVsYXRlZCBkYXRhIGNsZWFudXAgKGUuZy4sIHJlYXNzaWduIHByb21wdHM/KVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJzLmRlbGV0ZU9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XG4gICAgcmV0dXJuIHJlc3VsdC5kZWxldGVkQ291bnQgPiAwO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyB1c2VyOlwiLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgZGVsZXRpbmcgdXNlci5cIik7XG4gIH1cbn07XG5cblxuLy8gLS0tIFRlYW0gRnVuY3Rpb25zIChhbHJlYWR5IHJlZmFjdG9yZWQpIC0tLVxuXG5leHBvcnQgY29uc3QgZ2V0VGVhbUJ5SWQgPSBhc3luYyAoaWQpID0+IHtcbiAgY29uc3Qgb2JqZWN0SWQgPSB0b09iamVjdElkKGlkKTtcbiAgaWYgKCFvYmplY3RJZCkgcmV0dXJuIG51bGw7IC8vIEludmFsaWQgSUQgZm9ybWF0XG4gIFxuICB0cnkge1xuICAgIGNvbnN0IHsgdGVhbXMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XG4gICAgLy8gRmV0Y2ggdGVhbSBhbmQgcG90ZW50aWFsbHkgcG9wdWxhdGUgbWVtYmVyIGRldGFpbHMgaWYgbmVlZGVkIGxhdGVyXG4gICAgY29uc3QgdGVhbSA9IGF3YWl0IHRlYW1zLmZpbmRPbmUoeyBfaWQ6IG9iamVjdElkIH0pO1xuICAgIFxuICAgIC8vIE9wdGlvbmFsbHkgY29udmVydCBtZW1iZXIgdXNlcklkcyBiYWNrIHRvIHN0cmluZyBpZiBuZWVkZWQgZm9yIGZyb250ZW5kXG4gICAgLy8gaWYgKHRlYW0gJiYgdGVhbS5tZW1iZXJzKSB7XG4gICAgLy8gICB0ZWFtLm1lbWJlcnMgPSB0ZWFtLm1lbWJlcnMubWFwKG1lbWJlciA9PiAoeyAuLi5tZW1iZXIsIHVzZXJJZDogbWVtYmVyLnVzZXJJZC50b1N0cmluZygpIH0pKTtcbiAgICAvLyB9XG4gICAgLy8gQ29udmVydCBtYWluIF9pZCB0byBzdHJpbmdcbiAgICAvLyBpZiAodGVhbSkgdGVhbS5faWQgPSB0ZWFtLl9pZC50b1N0cmluZygpO1xuXG4gICAgcmV0dXJuIHRlYW07IC8vIFJldHVybnMgdGhlIHRlYW0gZG9jdW1lbnQgb3IgbnVsbCBpZiBub3QgZm91bmRcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgdGVhbSBieSBJRDpcIiwgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGZldGNoaW5nIHRlYW0uXCIpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0VGVhbXNCeVVzZXJJZCA9IGFzeW5jICh1c2VySWQpID0+IHtcbiAgLy8gRW5zdXJlIHVzZXJJZCBpcyB0cmVhdGVkIGFzIGEgc3RyaW5nIGZvciBtYXRjaGluZyB1bmxlc3MgaXQncyBjbGVhcmx5IGFuIE9iamVjdElkXG4gIGNvbnN0IHVzZXJJZFN0cmluZyA9IHVzZXJJZC50b1N0cmluZygpOyBcbiAgY29uc3QgdXNlck9iamVjdElkID0gdG9PYmplY3RJZCh1c2VySWQpOyAvLyBBdHRlbXB0IGNvbnZlcnNpb25cblxuICB0cnkge1xuICAgIGNvbnN0IHsgdGVhbXMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XG4gICAgLy8gRmluZCB0ZWFtcyB3aGVyZSB0aGUgdXNlciBpcyB0aGUgb3duZXIgKHVzZXJJZCBmaWVsZClcbiAgICAvLyBPUiB0aGUgdXNlciBpcyBpbiB0aGUgbWVtYmVycyBhcnJheSAoYXNzdW1pbmcgbWVtYmVyLnVzZXJJZCBpcyBzdG9yZWQgYXMgc3RyaW5nKVxuICAgIGNvbnN0IHF1ZXJ5ID0ge1xuICAgICAgJ21lbWJlcnMudXNlcklkJzogdXNlcklkU3RyaW5nXG4gICAgfTtcblxuICAgIC8vIElmIHRoZSBvcmlnaW5hbCB1c2VySWQgd2FzICphbHNvKiB0aGUgb3duZXJJZCBmaWVsZCwgYWRkIHRoYXQgY2hlY2tcbiAgICAvLyBUaGlzIGRlcGVuZHMgb24gaG93IG93bmVyIGB1c2VySWRgIGlzIHN0b3JlZCAoc3RyaW5nIHZzIE9iamVjdElkKVxuICAgIC8vIExldCdzIGFzc3VtZSBvd25lciBgdXNlcklkYCBtaWdodCBtYXRjaCB0aGUgc3RyaW5nIElEIGZyb20gc2Vzc2lvblxuICAgIGNvbnN0IG93bmVyUXVlcnkgPSB7IHVzZXJJZDogdXNlcklkU3RyaW5nIH07XG5cbiAgICAvLyBDb21iaW5lIHF1ZXJpZXNcbiAgICBjb25zdCBmaW5hbFF1ZXJ5ID0ge1xuICAgICAgJG9yOiBbXG4gICAgICAgICBxdWVyeSxcbiAgICAgICAgIG93bmVyUXVlcnlcbiAgICAgICBdXG4gICAgfTtcbiAgICBcbiAgICAvLyBJZiB0aGUgdXNlcklkICp3YXMqIGEgdmFsaWQgT2JqZWN0SWQsIGFsc28gY2hlY2sgZm9yIE9iamVjdElkIG1hdGNoZXMgXG4gICAgLy8gKGluIGNhc2Ugc29tZSBJRHMgYXJlIHN0b3JlZCBhcyBPYmplY3RJZHMpXG4gICAgaWYgKHVzZXJPYmplY3RJZCkge1xuICAgICAgIGZpbmFsUXVlcnkuJG9yLnB1c2goeyAnbWVtYmVycy51c2VySWQnOiB1c2VyT2JqZWN0SWQgfSk7XG4gICAgICAgZmluYWxRdWVyeS4kb3IucHVzaCh7IHVzZXJJZDogdXNlck9iamVjdElkIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHVzZXJUZWFtcyA9IGF3YWl0IHRlYW1zLmZpbmQoZmluYWxRdWVyeSkudG9BcnJheSgpO1xuICAgIHJldHVybiB1c2VyVGVhbXM7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHRlYW1zIGJ5IHVzZXIgSUQ6XCIsIGVycm9yKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBmZXRjaGluZyB1c2VyJ3MgdGVhbXMuXCIpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgY3JlYXRlVGVhbSA9IGFzeW5jICh0ZWFtRGF0YSkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgdGVhbXMsIHVzZXJzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3Qgb3duZXJVc2VySWQgPSB0ZWFtRGF0YS51c2VySWQ7IC8vIEFzc3VtZSB0aGlzIGlzIHRoZSBzdHJpbmcgSUQgZnJvbSBzZXNzaW9uXG5cbiAgICAvLyBGZXRjaCBvd25lcidzIG5hbWVcbiAgICBsZXQgb3duZXJOYW1lID0gJ093bmVyJzsgLy8gRGVmYXVsdFxuICAgIGNvbnN0IG93bmVyVXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBfaWQ6IHRvT2JqZWN0SWQob3duZXJVc2VySWQpIH0gLCB7IHByb2plY3Rpb246IHsgbmFtZTogMSB9IH0pO1xuICAgIGlmIChvd25lclVzZXIgJiYgb3duZXJVc2VyLm5hbWUpIHtcbiAgICAgICAgb3duZXJOYW1lID0gb3duZXJVc2VyLm5hbWU7XG4gICAgfVxuXG4gICAgY29uc3QgbmV3VGVhbSA9IHtcbiAgICAgIG5hbWU6IHRlYW1EYXRhLm5hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogdGVhbURhdGEuZGVzY3JpcHRpb24gfHwgJycsXG4gICAgICB1c2VySWQ6IG93bmVyVXNlcklkLCAvLyBTdG9yZSB0aGUgb3duZXIncyBJRCAoc3RyaW5nIG9yIE9iamVjdElkIGNvbnNpc3RlbnRseSlcbiAgICAgIG1lbWJlcnM6IFtdLCAvLyBJbml0aWFsaXplIG1lbWJlcnNcbiAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgdXBkYXRlZEF0OiBub3csXG4gICAgfTtcblxuICAgIC8vIEFkZCBjcmVhdG9yIGFzIHRoZSBvd25lclxuICAgIG5ld1RlYW0ubWVtYmVycy5wdXNoKHtcbiAgICAgICAgdXNlcklkOiBvd25lclVzZXJJZCwgLy8gU3RvcmUgY29uc2lzdGVudGx5IChlLmcuLCBzdHJpbmcgSUQgZnJvbSBzZXNzaW9uKVxuICAgICAgICByb2xlOiAnb3duZXInLFxuICAgICAgICBqb2luZWRBdDogbm93LFxuICAgICAgICBuYW1lOiBvd25lck5hbWUgLy8gQWRkIG93bmVyJ3MgbmFtZVxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlYW1zLmluc2VydE9uZShuZXdUZWFtKTtcbiAgICByZXR1cm4geyAuLi5uZXdUZWFtLCBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIHRlYW06XCIsIGVycm9yKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBjcmVhdGluZyB0ZWFtLlwiKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHVwZGF0ZVRlYW0gPSBhc3luYyAoaWQsIHRlYW1EYXRhKSA9PiB7XG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XG4gIGlmICghb2JqZWN0SWQpIHJldHVybiBudWxsO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgeyB0ZWFtcyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICBjb25zdCB1cGRhdGVEb2MgPSB7ICRzZXQ6IHt9IH07XG4gICAgaWYgKHRlYW1EYXRhLm5hbWUgIT09IHVuZGVmaW5lZCkgdXBkYXRlRG9jLiRzZXQubmFtZSA9IHRlYW1EYXRhLm5hbWU7XG4gICAgaWYgKHRlYW1EYXRhLmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURvYy4kc2V0LmRlc2NyaXB0aW9uID0gdGVhbURhdGEuZGVzY3JpcHRpb247XG4gICAgdXBkYXRlRG9jLiRzZXQudXBkYXRlZEF0ID0gbmV3IERhdGUoKTtcblxuICAgIGlmIChPYmplY3Qua2V5cyh1cGRhdGVEb2MuJHNldCkubGVuZ3RoID4gMSkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0ZWFtcy51cGRhdGVPbmUoeyBfaWQ6IG9iamVjdElkIH0sIHVwZGF0ZURvYyk7XG4gICAgICAgIGlmIChyZXN1bHQubWF0Y2hlZENvdW50ID09PSAwKSByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCB1cGRhdGVkVGVhbSA9IGF3YWl0IHRlYW1zLmZpbmRPbmUoeyBfaWQ6IG9iamVjdElkIH0pO1xuICAgIHJldHVybiB1cGRhdGVkVGVhbTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgdGVhbTpcIiwgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIHVwZGF0aW5nIHRlYW0uXCIpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZGVsZXRlVGVhbSA9IGFzeW5jIChpZCkgPT4ge1xuICBjb25zdCBvYmplY3RJZCA9IHRvT2JqZWN0SWQoaWQpO1xuICBpZiAoIW9iamVjdElkKSByZXR1cm4gZmFsc2U7XG4gIHRyeSB7XG4gICAgY29uc3QgeyB0ZWFtcyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICAvLyBUT0RPOiBIYW5kbGUgcmVsYXRlZCBkYXRhIGNsZWFudXAgKGUuZy4sIHByb21wdHMgYmVsb25naW5nIHRvIHRlYW0/KVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlYW1zLmRlbGV0ZU9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XG4gICAgcmV0dXJuIHJlc3VsdC5kZWxldGVkQ291bnQgPiAwO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyB0ZWFtOlwiLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgZGVsZXRpbmcgdGVhbS5cIik7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBhZGRUZWFtTWVtYmVyID0gYXN5bmMgKHRlYW1JZCwgbWVtYmVyRGF0YSkgPT4ge1xuICBjb25zdCB0ZWFtT2JqZWN0SWQgPSB0b09iamVjdElkKHRlYW1JZCk7XG4gIGlmICghdGVhbU9iamVjdElkKSByZXR1cm4gbnVsbDtcbiAgaWYgKCFtZW1iZXJEYXRhIHx8ICFtZW1iZXJEYXRhLnVzZXJJZCkgdGhyb3cgbmV3IEVycm9yKFwiTWVtYmVyIHVzZXIgSUQgaXMgcmVxdWlyZWQuXCIpO1xuXG4gIGNvbnN0IG1lbWJlclVzZXJJZCA9IG1lbWJlckRhdGEudXNlcklkOyAvLyBBc3N1bWUgc3RyaW5nIElEIGZyb20gcmVxdWVzdFxuXG4gIHRyeSB7XG4gICAgY29uc3QgeyB0ZWFtcywgdXNlcnMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblxuICAgIC8vIEZldGNoIG1lbWJlcidzIG5hbWVcbiAgICBsZXQgbWVtYmVyTmFtZSA9ICdNZW1iZXInOyAvLyBEZWZhdWx0XG4gICAgY29uc3QgbWVtYmVyVXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBfaWQ6IHRvT2JqZWN0SWQobWVtYmVyVXNlcklkKSB9LCB7IHByb2plY3Rpb246IHsgbmFtZTogMSB9IH0pO1xuICAgICBpZiAobWVtYmVyVXNlciAmJiBtZW1iZXJVc2VyLm5hbWUpIHtcbiAgICAgICAgbWVtYmVyTmFtZSA9IG1lbWJlclVzZXIubmFtZTtcbiAgICB9XG5cbiAgICBjb25zdCBtZW1iZXJSZWNvcmQgPSB7XG4gICAgICB1c2VySWQ6IG1lbWJlclVzZXJJZCwgLy8gU3RvcmUgY29uc2lzdGVudGx5IGFzIHN0cmluZ1xuICAgICAgcm9sZTogbWVtYmVyRGF0YS5yb2xlIHx8ICdtZW1iZXInLFxuICAgICAgam9pbmVkQXQ6IG5vdyxcbiAgICAgIG5hbWU6IG1lbWJlck5hbWUgLy8gQWRkIG1lbWJlcidzIG5hbWVcbiAgICB9O1xuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhbHJlYWR5IGEgbWVtYmVyICh1c2luZyB0aGUgc3RyaW5nIElEKVxuICAgIGNvbnN0IHRlYW0gPSBhd2FpdCB0ZWFtcy5maW5kT25lKHsgX2lkOiB0ZWFtT2JqZWN0SWQsICdtZW1iZXJzLnVzZXJJZCc6IG1lbWJlclVzZXJJZCB9KTtcbiAgICBpZiAodGVhbSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlVzZXIgaXMgYWxyZWFkeSBhIG1lbWJlciBvZiB0aGlzIHRlYW0uXCIpO1xuICAgICAgICByZXR1cm4gdGVhbTsgLy8gQWxyZWFkeSBhIG1lbWJlclxuICAgIH1cblxuICAgIC8vIFVzZSAkYWRkVG9TZXQgKG9yICRwdXNoIGlmIGR1cGxpY2F0ZXMgYXJlIGltcG9zc2libGUvdW5kZXNpcmVkKVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlYW1zLnVwZGF0ZU9uZShcbiAgICAgIHsgX2lkOiB0ZWFtT2JqZWN0SWQgfSxcbiAgICAgIHsgXG4gICAgICAgICRwdXNoOiB7IG1lbWJlcnM6IG1lbWJlclJlY29yZCB9LCAvLyBVc2UgJHB1c2ggc2luY2Ugd2UgY2hlY2tlZCBleGlzdGVuY2VcbiAgICAgICAgJHNldDogeyB1cGRhdGVkQXQ6IG5vdyB9IFxuICAgICAgfVxuICAgICk7XG5cbiAgICBpZiAocmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkgcmV0dXJuIG51bGw7XG4gICAgXG4gICAgY29uc3QgdXBkYXRlZFRlYW0gPSBhd2FpdCB0ZWFtcy5maW5kT25lKHsgX2lkOiB0ZWFtT2JqZWN0SWQgfSk7XG4gICAgcmV0dXJuIHVwZGF0ZWRUZWFtO1xuICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhZGRpbmcgdGVhbSBtZW1iZXI6XCIsIGVycm9yKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBhZGRpbmcgdGVhbSBtZW1iZXIuXCIpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgcmVtb3ZlVGVhbU1lbWJlciA9IGFzeW5jICh0ZWFtSWQsIHVzZXJJZFRvUmVtb3ZlKSA9PiB7XG4gIGNvbnN0IHRlYW1PYmplY3RJZCA9IHRvT2JqZWN0SWQodGVhbUlkKTtcbiAgaWYgKCF0ZWFtT2JqZWN0SWQpIHJldHVybiBudWxsO1xuICBpZiAoIXVzZXJJZFRvUmVtb3ZlKSB0aHJvdyBuZXcgRXJyb3IoXCJVc2VyIElEIHRvIHJlbW92ZSBpcyByZXF1aXJlZC5cIik7XG5cbiAgY29uc3QgbWVtYmVyVXNlcklkU3RyaW5nID0gdXNlcklkVG9SZW1vdmUudG9TdHJpbmcoKTtcblxuICB0cnkge1xuICAgIGNvbnN0IHsgdGVhbXMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblxuICAgIC8vIEZpbmQgdGhlIHRlYW0gZmlyc3QgdG8gY2hlY2sgaWYgdGhlIHVzZXIgYmVpbmcgcmVtb3ZlZCBpcyB0aGUgb3duZXJcbiAgICBjb25zdCB0ZWFtID0gYXdhaXQgdGVhbXMuZmluZE9uZSh7IF9pZDogdGVhbU9iamVjdElkIH0pO1xuICAgIGlmICghdGVhbSkgcmV0dXJuIG51bGw7IC8vIFRlYW0gbm90IGZvdW5kXG5cbiAgICBjb25zdCBtZW1iZXJUb1JlbW92ZSA9IHRlYW0ubWVtYmVycy5maW5kKG0gPT4gbS51c2VySWQgPT09IG1lbWJlclVzZXJJZFN0cmluZyk7XG4gICAgaWYgKCFtZW1iZXJUb1JlbW92ZSkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIk1lbWJlciBub3QgZm91bmQgaW4gdGVhbS5cIik7XG4gICAgICAgIHJldHVybiB0ZWFtOyAvLyBNZW1iZXIgbm90IGZvdW5kLCByZXR1cm4gY3VycmVudCB0ZWFtIHN0YXRlXG4gICAgfVxuXG4gICAgLy8gUHJldmVudCByZW1vdmluZyB0aGUgb3duZXJcbiAgICBpZiAobWVtYmVyVG9SZW1vdmUucm9sZSA9PT0gJ293bmVyJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgcmVtb3ZlIHRoZSB0ZWFtIG93bmVyLlwiKTtcbiAgICB9XG5cbiAgICAvLyBVc2UgJHB1bGwgdG8gcmVtb3ZlIHRoZSBtZW1iZXIgYnkgdXNlcklkIChzdHJpbmcgbWF0Y2gpXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGVhbXMudXBkYXRlT25lKFxuICAgICAgeyBfaWQ6IHRlYW1PYmplY3RJZCB9LFxuICAgICAgeyBcbiAgICAgICAgJHB1bGw6IHsgbWVtYmVyczogeyB1c2VySWQ6IG1lbWJlclVzZXJJZFN0cmluZyB9IH0sIFxuICAgICAgICAkc2V0OiB7IHVwZGF0ZWRBdDogbm93IH1cbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKHJlc3VsdC5tb2RpZmllZENvdW50ID09PSAwKSB7XG4gICAgICAvLyBTaG91bGQgbm90IGhhcHBlbiBpZiBtZW1iZXIgd2FzIGZvdW5kLCBidXQgaGFuZGxlIGdyYWNlZnVsbHlcbiAgICAgIGNvbnNvbGUubG9nKFwiUHVsbCBvcGVyYXRpb24gZGlkIG5vdCBtb2RpZnkgdGhlIGRvY3VtZW50LlwiKTtcbiAgICB9XG5cbiAgICBjb25zdCB1cGRhdGVkVGVhbSA9IGF3YWl0IHRlYW1zLmZpbmRPbmUoeyBfaWQ6IHRlYW1PYmplY3RJZCB9KTtcbiAgICByZXR1cm4gdXBkYXRlZFRlYW07XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVtb3ZpbmcgdGVhbSBtZW1iZXI6XCIsIGVycm9yKTtcbiAgICBpZiAoZXJyb3IubWVzc2FnZSA9PT0gXCJDYW5ub3QgcmVtb3ZlIHRoZSB0ZWFtIG93bmVyLlwiKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSByZW1vdmluZyB0ZWFtIG1lbWJlci5cIik7XG4gIH1cbn07XG5cbi8vIFRPRE86IEltcGxlbWVudCB1cGRhdGVUZWFtTWVtYmVyIHJvbGUgaWYgbmVlZGVkXG5cbi8vIC0tLSBDb21tZW50IEZ1bmN0aW9ucyAtLS1cblxuZXhwb3J0IGNvbnN0IGdldENvbW1lbnRzQnlQcm9tcHRJZCA9IGFzeW5jIChwcm9tcHRJZCkgPT4ge1xuICBjb25zdCBwcm9tcHRPYmplY3RJZCA9IHRvT2JqZWN0SWQocHJvbXB0SWQpO1xuICBpZiAoIXByb21wdE9iamVjdElkKSByZXR1cm4gW107XG4gIHRyeSB7XG4gICAgY29uc3QgeyBjb21tZW50cyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICAvLyBGZXRjaCBjb21tZW50cyBhbmQgc29ydCBieSBjcmVhdGlvbiBkYXRlIChuZXdlc3QgZmlyc3QpXG4gICAgY29uc3QgcHJvbXB0Q29tbWVudHMgPSBhd2FpdCBjb21tZW50cy5maW5kKHsgcHJvbXB0SWQ6IHByb21wdE9iamVjdElkIH0pLnNvcnQoeyBjcmVhdGVkQXQ6IC0xIH0pLnRvQXJyYXkoKTtcbiAgICByZXR1cm4gcHJvbXB0Q29tbWVudHM7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbW1lbnRzIGJ5IHByb21wdCBJRDpcIiwgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGZldGNoaW5nIGNvbW1lbnRzLlwiKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNvbW1lbnQgPSBhc3luYyAoY29tbWVudERhdGEpID0+IHtcbiAgaWYgKCFjb21tZW50RGF0YS5wcm9tcHRJZCB8fCAhY29tbWVudERhdGEudXNlcklkIHx8ICFjb21tZW50RGF0YS5jb250ZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiUHJvbXB0IElELCBVc2VyIElELCBhbmQgY29udGVudCBhcmUgcmVxdWlyZWQgZm9yIGNvbW1lbnRzLlwiKTtcbiAgfVxuICBjb25zdCBwcm9tcHRPYmplY3RJZCA9IHRvT2JqZWN0SWQoY29tbWVudERhdGEucHJvbXB0SWQpO1xuICAvLyBBc3N1bWluZyB1c2VySWQgaXMgcGFzc2VkIGFzIHN0cmluZyBmcm9tIHNlc3Npb25cbiAgY29uc3QgdXNlcklkU3RyaW5nID0gY29tbWVudERhdGEudXNlcklkLnRvU3RyaW5nKCk7IFxuXG4gIGlmICghcHJvbXB0T2JqZWN0SWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIFByb21wdCBJRCBmb3JtYXQgZm9yIGNvbW1lbnQuXCIpO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB7IGNvbW1lbnRzLCB1c2VycyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuXG4gICAgLy8gRmV0Y2ggY29tbWVudGVyJ3MgbmFtZVxuICAgIGxldCBjcmVhdGVkQnlOYW1lID0gJ1VzZXInOyAvLyBEZWZhdWx0XG4gICAgY29uc3QgY29tbWVudGVyVXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBfaWQ6IHRvT2JqZWN0SWQodXNlcklkU3RyaW5nKSB9LCB7IHByb2plY3Rpb246IHsgbmFtZTogMSB9IH0pO1xuICAgIGlmIChjb21tZW50ZXJVc2VyICYmIGNvbW1lbnRlclVzZXIubmFtZSkge1xuICAgICAgICBjcmVhdGVkQnlOYW1lID0gY29tbWVudGVyVXNlci5uYW1lO1xuICAgIH1cblxuICAgIGNvbnN0IG5ld0NvbW1lbnQgPSB7XG4gICAgICBwcm9tcHRJZDogcHJvbXB0T2JqZWN0SWQsXG4gICAgICB1c2VySWQ6IHVzZXJJZFN0cmluZywgLy8gU3RvcmUgdXNlcklkIGNvbnNpc3RlbnRseSAoZS5nLiwgc3RyaW5nKVxuICAgICAgY29udGVudDogY29tbWVudERhdGEuY29udGVudCxcbiAgICAgIGNyZWF0ZWRCeTogY3JlYXRlZEJ5TmFtZSwgLy8gU3RvcmUgY29tbWVudGVyJ3MgbmFtZVxuICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICB9O1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbW1lbnRzLmluc2VydE9uZShuZXdDb21tZW50KTtcbiAgICByZXR1cm4geyAuLi5uZXdDb21tZW50LCBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIGNvbW1lbnQ6XCIsIGVycm9yKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBjcmVhdGluZyBjb21tZW50LlwiKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHVwZGF0ZUNvbW1lbnQgPSBhc3luYyAoaWQsIGNvbW1lbnREYXRhKSA9PiB7XG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XG4gIGlmICghb2JqZWN0SWQpIHJldHVybiBudWxsO1xuICBpZiAoIWNvbW1lbnREYXRhLmNvbnRlbnQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb21tZW50IGNvbnRlbnQgaXMgcmVxdWlyZWQgZm9yIHVwZGF0ZS5cIik7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHsgY29tbWVudHMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XG4gICAgY29uc3QgdXBkYXRlRG9jID0ge1xuICAgICAgJHNldDoge1xuICAgICAgICBjb250ZW50OiBjb21tZW50RGF0YS5jb250ZW50LFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9LFxuICAgIH07XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29tbWVudHMudXBkYXRlT25lKHsgX2lkOiBvYmplY3RJZCB9LCB1cGRhdGVEb2MpO1xuICAgIGlmIChyZXN1bHQubWF0Y2hlZENvdW50ID09PSAwKSByZXR1cm4gbnVsbDtcblxuICAgIGNvbnN0IHVwZGF0ZWRDb21tZW50ID0gYXdhaXQgY29tbWVudHMuZmluZE9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XG4gICAgcmV0dXJuIHVwZGF0ZWRDb21tZW50O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyBjb21tZW50OlwiLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgdXBkYXRpbmcgY29tbWVudC5cIik7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBkZWxldGVDb21tZW50ID0gYXN5bmMgKGlkKSA9PiB7XG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XG4gIGlmICghb2JqZWN0SWQpIHJldHVybiBmYWxzZTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGNvbW1lbnRzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbW1lbnRzLmRlbGV0ZU9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XG4gICAgcmV0dXJuIHJlc3VsdC5kZWxldGVkQ291bnQgPiAwO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyBjb21tZW50OlwiLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgZGVsZXRpbmcgY29tbWVudC5cIik7XG4gIH1cbn07XG5cbi8vIFJlbW92ZSB0aGUgb2xkIGluLW1lbW9yeSBkYXRhIGFuZCBpbml0aWFsaXphdGlvbiBsb2dpY1xuLypcbmxldCBwcm9tcHRzID0gW107XG5sZXQgY29sbGVjdGlvbnMgPSBbXTtcbmxldCB1c2VycyA9IFtdO1xubGV0IHRlYW1zID0gW107XG5sZXQgY29tbWVudHMgPSBbXTtcbmxldCBwcm9tcHRJZENvdW50ZXIgPSAxO1xubGV0IGNvbGxlY3Rpb25JZENvdW50ZXIgPSAxO1xubGV0IHVzZXJJZENvdW50ZXIgPSAxO1xubGV0IHRlYW1JZENvdW50ZXIgPSAxO1xubGV0IGNvbW1lbnRJZENvdW50ZXIgPSAxO1xuXG4vLyBBbGwgb2xkIGZ1bmN0aW9ucyBsaWtlOlxuZXhwb3J0IGNvbnN0IGdldEFsbFByb21wdHMgPSAoKSA9PiB7IC4uLiB9O1xuLy8gLi4uIGV0Yy5cblxuLy8gSW5pdGlhbGl6ZSB3aXRoIHNvbWUgc2FtcGxlIGRhdGEgLSBpbiByZWFsIGFwcCwgdGhpcyB3b3VsZCBiZSBsb2FkZWQgZnJvbSBkYXRhYmFzZVxuZXhwb3J0IGNvbnN0IGluaXRpYWxpemVEYiA9IGFzeW5jICgpID0+IHsgLi4uIH07XG5cbi8vIENhbGwgaW5pdGlhbGl6ZSB3aGVuIGltcG9ydGVkXG4oYXN5bmMgKCkgPT4geyAuLi4gfSkoKTtcbiovXG4iXSwibmFtZXMiOlsiY29ubmVjdFRvRGF0YWJhc2UiLCJPYmplY3RJZCIsImhhc2hQYXNzd29yZCIsImdldENvbGxlY3Rpb25zIiwiZGIiLCJ1c2VycyIsImNvbGxlY3Rpb24iLCJwcm9tcHRzIiwiY29sbGVjdGlvbnMiLCJ0ZWFtcyIsImNvbW1lbnRzIiwidG9PYmplY3RJZCIsImlkIiwiaXNWYWxpZCIsImVycm9yIiwiY29uc29sZSIsImdldEFsbFByb21wdHMiLCJmaWx0ZXIiLCJvcHRpb25zIiwiY3Vyc29yIiwiZmluZCIsInNvcnQiLCJjcmVhdGVkQXQiLCJsaW1pdCIsInNraXAiLCJhbGxQcm9tcHRzIiwidG9BcnJheSIsIkVycm9yIiwiZ2V0UHJvbXB0QnlJZCIsIm9iamVjdElkIiwicHJvbXB0IiwiZmluZE9uZSIsIl9pZCIsImNyZWF0ZVByb21wdCIsInByb21wdERhdGEiLCJub3ciLCJEYXRlIiwibmV3UHJvbXB0IiwidGl0bGUiLCJjb250ZW50IiwiZGVzY3JpcHRpb24iLCJ0YWdzIiwiYWlQbGF0Zm9ybSIsInJhdGluZyIsInVzYWdlQ291bnQiLCJzdWNjZXNzUmF0ZSIsInZpc2liaWxpdHkiLCJ1c2VySWQiLCJjcmVhdGVkQnkiLCJ0ZWFtSWQiLCJ1cGRhdGVkQXQiLCJyZXN1bHQiLCJpbnNlcnRPbmUiLCJpbnNlcnRlZElkIiwidXBkYXRlUHJvbXB0IiwidXBkYXRlRG9jIiwiJHNldCIsImtleSIsInVuZGVmaW5lZCIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJ1cGRhdGVPbmUiLCJtYXRjaGVkQ291bnQiLCJ1cGRhdGVkUHJvbXB0IiwiZGVsZXRlUHJvbXB0IiwiZGVsZXRlT25lIiwiZGVsZXRlZENvdW50IiwiZ2V0QWxsQ29sbGVjdGlvbnMiLCJhbGxDb2xsZWN0aW9ucyIsImdldENvbGxlY3Rpb25CeUlkIiwiY3JlYXRlQ29sbGVjdGlvbiIsImNvbGxlY3Rpb25EYXRhIiwibmV3Q29sbGVjdGlvbiIsIm5hbWUiLCJ1cGRhdGVDb2xsZWN0aW9uIiwidXBkYXRlZENvbGxlY3Rpb24iLCJkZWxldGVDb2xsZWN0aW9uIiwiYWRkUHJvbXB0VG9Db2xsZWN0aW9uIiwiY29sbGVjdGlvbklkIiwicHJvbXB0SWQiLCJjb2xsT2JqZWN0SWQiLCJwcm9tcHRPYmplY3RJZCIsIiRhZGRUb1NldCIsInJlbW92ZVByb21wdEZyb21Db2xsZWN0aW9uIiwiJHB1bGwiLCJnZXRBbGxVc2VycyIsInByb2plY3Rpb24iLCJwYXNzd29yZCIsImFsbFVzZXJzIiwiZ2V0VXNlckJ5SWQiLCJ1c2VyIiwiZ2V0VXNlckJ5RW1haWwiLCJlbWFpbCIsInRvTG93ZXJDYXNlIiwiY3JlYXRlVXNlciIsInVzZXJEYXRhIiwiZXhpc3RpbmdVc2VyIiwiaGFzaGVkUGFzc3dvcmQiLCJuZXdVc2VyIiwiaW1hZ2UiLCJ1c2VyV2l0aG91dFBhc3N3b3JkIiwibWVzc2FnZSIsInVwZGF0ZVVzZXIiLCJuZXdFbWFpbCIsImVxdWFscyIsInVwZGF0ZWRVc2VyIiwiZGVsZXRlVXNlciIsImdldFRlYW1CeUlkIiwidGVhbSIsImdldFRlYW1zQnlVc2VySWQiLCJ1c2VySWRTdHJpbmciLCJ0b1N0cmluZyIsInVzZXJPYmplY3RJZCIsInF1ZXJ5Iiwib3duZXJRdWVyeSIsImZpbmFsUXVlcnkiLCIkb3IiLCJwdXNoIiwidXNlclRlYW1zIiwiY3JlYXRlVGVhbSIsInRlYW1EYXRhIiwib3duZXJVc2VySWQiLCJvd25lck5hbWUiLCJvd25lclVzZXIiLCJuZXdUZWFtIiwibWVtYmVycyIsInJvbGUiLCJqb2luZWRBdCIsInVwZGF0ZVRlYW0iLCJ1cGRhdGVkVGVhbSIsImRlbGV0ZVRlYW0iLCJhZGRUZWFtTWVtYmVyIiwibWVtYmVyRGF0YSIsInRlYW1PYmplY3RJZCIsIm1lbWJlclVzZXJJZCIsIm1lbWJlck5hbWUiLCJtZW1iZXJVc2VyIiwibWVtYmVyUmVjb3JkIiwibG9nIiwiJHB1c2giLCJyZW1vdmVUZWFtTWVtYmVyIiwidXNlcklkVG9SZW1vdmUiLCJtZW1iZXJVc2VySWRTdHJpbmciLCJtZW1iZXJUb1JlbW92ZSIsIm0iLCJtb2RpZmllZENvdW50IiwiZ2V0Q29tbWVudHNCeVByb21wdElkIiwicHJvbXB0Q29tbWVudHMiLCJjcmVhdGVDb21tZW50IiwiY29tbWVudERhdGEiLCJjcmVhdGVkQnlOYW1lIiwiY29tbWVudGVyVXNlciIsIm5ld0NvbW1lbnQiLCJ1cGRhdGVDb21tZW50IiwidXBkYXRlZENvbW1lbnQiLCJkZWxldGVDb21tZW50Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/db.js\n");

/***/ }),

/***/ "(api-node)/./lib/mongodb.js":
/*!************************!*\
  !*** ./lib/mongodb.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   closeDatabaseConnection: () => (/* binding */ closeDatabaseConnection),\n/* harmony export */   connectToDatabase: () => (/* binding */ connectToDatabase),\n/* harmony export */   getCollection: () => (/* binding */ getCollection)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst uri = process.env.MONGODB_URI;\nconst dbName = process.env.MONGODB_DB;\nif (!uri) {\n    throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\n}\nif (!dbName) {\n    throw new Error('Please define the MONGODB_DB environment variable inside .env.local');\n}\nlet cachedClient = null;\nlet cachedDb = null;\n/**\r\n * Connects to the MongoDB database and returns the client and db instances.\r\n * Caches the connection to avoid reconnecting on every request in development.\r\n */ async function connectToDatabase() {\n    if (cachedClient && cachedDb) {\n        return {\n            client: cachedClient,\n            db: cachedDb\n        };\n    }\n    try {\n        const client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, {\n        });\n        await client.connect();\n        const db = client.db(dbName);\n        console.log(\"Successfully connected to MongoDB.\");\n        cachedClient = client;\n        cachedDb = db;\n        return {\n            client,\n            db\n        };\n    } catch (error) {\n        console.error(\"Failed to connect to MongoDB\", error);\n        throw new Error(\"Could not connect to database.\");\n    }\n}\n// Optional: Helper to close the connection (useful for scripts or tests)\nasync function closeDatabaseConnection() {\n    if (cachedClient) {\n        await cachedClient.close();\n        cachedClient = null;\n        cachedDb = null;\n        console.log(\"MongoDB connection closed.\");\n    }\n}\n// Helper function to get collection references\nasync function getCollection(collectionName) {\n    const { db } = await connectToDatabase();\n    return db.collection(collectionName);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9tb25nb2RiLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQXNDO0FBRXRDLE1BQU1DLE1BQU1DLFFBQVFDLEdBQUcsQ0FBQ0MsV0FBVztBQUNuQyxNQUFNQyxTQUFTSCxRQUFRQyxHQUFHLENBQUNHLFVBQVU7QUFFckMsSUFBSSxDQUFDTCxLQUFLO0lBQ1IsTUFBTSxJQUFJTSxNQUFNO0FBQ2xCO0FBRUEsSUFBSSxDQUFDRixRQUFRO0lBQ1gsTUFBTSxJQUFJRSxNQUFNO0FBQ2xCO0FBRUEsSUFBSUMsZUFBZTtBQUNuQixJQUFJQyxXQUFXO0FBRWY7OztDQUdDLEdBQ00sZUFBZUM7SUFDcEIsSUFBSUYsZ0JBQWdCQyxVQUFVO1FBQzVCLE9BQU87WUFBRUUsUUFBUUg7WUFBY0ksSUFBSUg7UUFBUztJQUM5QztJQUVBLElBQUk7UUFDRixNQUFNRSxTQUFTLElBQUlYLGdEQUFXQSxDQUFDQyxLQUFLO1FBR3BDO1FBRUEsTUFBTVUsT0FBT0UsT0FBTztRQUNwQixNQUFNRCxLQUFLRCxPQUFPQyxFQUFFLENBQUNQO1FBRXJCUyxRQUFRQyxHQUFHLENBQUM7UUFFWlAsZUFBZUc7UUFDZkYsV0FBV0c7UUFFWCxPQUFPO1lBQUVEO1lBQVFDO1FBQUc7SUFDdEIsRUFBRSxPQUFPSSxPQUFPO1FBQ2RGLFFBQVFFLEtBQUssQ0FBQyxnQ0FBZ0NBO1FBQzlDLE1BQU0sSUFBSVQsTUFBTTtJQUNsQjtBQUNGO0FBRUEseUVBQXlFO0FBQ2xFLGVBQWVVO0lBQ3BCLElBQUlULGNBQWM7UUFDaEIsTUFBTUEsYUFBYVUsS0FBSztRQUN4QlYsZUFBZTtRQUNmQyxXQUFXO1FBQ1hLLFFBQVFDLEdBQUcsQ0FBQztJQUNkO0FBQ0Y7QUFFQSwrQ0FBK0M7QUFDeEMsZUFBZUksY0FBY0MsY0FBYztJQUNoRCxNQUFNLEVBQUVSLEVBQUUsRUFBRSxHQUFHLE1BQU1GO0lBQ3JCLE9BQU9FLEdBQUdTLFVBQVUsQ0FBQ0Q7QUFDdkIiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmF1ZGlcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9tcHRQcm9cXFByb21wdFByb1xcbGliXFxtb25nb2RiLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5jb25zdCB1cmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcclxuY29uc3QgZGJOYW1lID0gcHJvY2Vzcy5lbnYuTU9OR09EQl9EQjtcclxuXHJcbmlmICghdXJpKSB7XHJcbiAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgZGVmaW5lIHRoZSBNT05HT0RCX1VSSSBlbnZpcm9ubWVudCB2YXJpYWJsZSBpbnNpZGUgLmVudi5sb2NhbCcpO1xyXG59XHJcblxyXG5pZiAoIWRiTmFtZSkge1xyXG4gIHRocm93IG5ldyBFcnJvcignUGxlYXNlIGRlZmluZSB0aGUgTU9OR09EQl9EQiBlbnZpcm9ubWVudCB2YXJpYWJsZSBpbnNpZGUgLmVudi5sb2NhbCcpO1xyXG59XHJcblxyXG5sZXQgY2FjaGVkQ2xpZW50ID0gbnVsbDtcclxubGV0IGNhY2hlZERiID0gbnVsbDtcclxuXHJcbi8qKlxyXG4gKiBDb25uZWN0cyB0byB0aGUgTW9uZ29EQiBkYXRhYmFzZSBhbmQgcmV0dXJucyB0aGUgY2xpZW50IGFuZCBkYiBpbnN0YW5jZXMuXHJcbiAqIENhY2hlcyB0aGUgY29ubmVjdGlvbiB0byBhdm9pZCByZWNvbm5lY3Rpbmcgb24gZXZlcnkgcmVxdWVzdCBpbiBkZXZlbG9wbWVudC5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb25uZWN0VG9EYXRhYmFzZSgpIHtcclxuICBpZiAoY2FjaGVkQ2xpZW50ICYmIGNhY2hlZERiKSB7XHJcbiAgICByZXR1cm4geyBjbGllbnQ6IGNhY2hlZENsaWVudCwgZGI6IGNhY2hlZERiIH07XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSwge1xyXG4gICAgICAvLyB1c2VOZXdVcmxQYXJzZXI6IHRydWUsIC8vIERlcHJlY2F0ZWQgaW4gbmV3ZXIgdmVyc2lvbnNcclxuICAgICAgLy8gdXNlVW5pZmllZFRvcG9sb2d5OiB0cnVlLCAvLyBEZXByZWNhdGVkIGluIG5ld2VyIHZlcnNpb25zXHJcbiAgICB9KTtcclxuXHJcbiAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgY29uc3QgZGIgPSBjbGllbnQuZGIoZGJOYW1lKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhcIlN1Y2Nlc3NmdWxseSBjb25uZWN0ZWQgdG8gTW9uZ29EQi5cIik7XHJcblxyXG4gICAgY2FjaGVkQ2xpZW50ID0gY2xpZW50O1xyXG4gICAgY2FjaGVkRGIgPSBkYjtcclxuXHJcbiAgICByZXR1cm4geyBjbGllbnQsIGRiIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY29ubmVjdCB0byBNb25nb0RCXCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBjb25uZWN0IHRvIGRhdGFiYXNlLlwiKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIE9wdGlvbmFsOiBIZWxwZXIgdG8gY2xvc2UgdGhlIGNvbm5lY3Rpb24gKHVzZWZ1bCBmb3Igc2NyaXB0cyBvciB0ZXN0cylcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsb3NlRGF0YWJhc2VDb25uZWN0aW9uKCkge1xyXG4gIGlmIChjYWNoZWRDbGllbnQpIHtcclxuICAgIGF3YWl0IGNhY2hlZENsaWVudC5jbG9zZSgpO1xyXG4gICAgY2FjaGVkQ2xpZW50ID0gbnVsbDtcclxuICAgIGNhY2hlZERiID0gbnVsbDtcclxuICAgIGNvbnNvbGUubG9nKFwiTW9uZ29EQiBjb25uZWN0aW9uIGNsb3NlZC5cIik7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IGNvbGxlY3Rpb24gcmVmZXJlbmNlc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29sbGVjdGlvbihjb2xsZWN0aW9uTmFtZSkge1xyXG4gIGNvbnN0IHsgZGIgfSA9IGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XHJcbiAgcmV0dXJuIGRiLmNvbGxlY3Rpb24oY29sbGVjdGlvbk5hbWUpO1xyXG59ICJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsImRiTmFtZSIsIk1PTkdPREJfREIiLCJFcnJvciIsImNhY2hlZENsaWVudCIsImNhY2hlZERiIiwiY29ubmVjdFRvRGF0YWJhc2UiLCJjbGllbnQiLCJkYiIsImNvbm5lY3QiLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJjbG9zZURhdGFiYXNlQ29ubmVjdGlvbiIsImNsb3NlIiwiZ2V0Q29sbGVjdGlvbiIsImNvbGxlY3Rpb25OYW1lIiwiY29sbGVjdGlvbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/mongodb.js\n");

/***/ }),

/***/ "(api-node)/./models/collection.js":
/*!******************************!*\
  !*** ./models/collection.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   collectionModel: () => (/* binding */ collectionModel),\n/* harmony export */   validateCollection: () => (/* binding */ validateCollection)\n/* harmony export */ });\n// Collection model structure\nconst collectionModel = {\n    id: Number,\n    name: String,\n    description: String,\n    prompts: Array,\n    createdAt: String,\n    updatedAt: String,\n    userId: String,\n    createdBy: String\n};\n// Validate collection data\nconst validateCollection = (data)=>{\n    const errors = {};\n    if (!data.name) {\n        errors.name = 'Name is required';\n    } else if (data.name.length < 3) {\n        errors.name = 'Name must be at least 3 characters';\n    } else if (data.name.length > 50) {\n        errors.name = 'Name must be less than 50 characters';\n    }\n    if (data.description && data.description.length > 200) {\n        errors.description = 'Description must be less than 200 characters';\n    }\n    if (data.prompts) {\n        if (!Array.isArray(data.prompts)) {\n            errors.prompts = 'Prompts must be an array';\n        } else {\n            for(let i = 0; i < data.prompts.length; i++){\n                const promptId = data.prompts[i];\n                if (typeof promptId !== 'number' && !Number.isInteger(parseInt(promptId))) {\n                    errors.prompts = 'All prompt IDs must be integers';\n                    break;\n                }\n            }\n        }\n    }\n    return {\n        isValid: Object.keys(errors).length === 0,\n        errors\n    };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL21vZGVscy9jb2xsZWN0aW9uLmpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsNkJBQTZCO0FBQ3RCLE1BQU1BLGtCQUFrQjtJQUM3QkMsSUFBSUM7SUFDSkMsTUFBTUM7SUFDTkMsYUFBYUQ7SUFDYkUsU0FBU0M7SUFDVEMsV0FBV0o7SUFDWEssV0FBV0w7SUFDWE0sUUFBUU47SUFDUk8sV0FBV1A7QUFDYixFQUFFO0FBRUYsMkJBQTJCO0FBQ3BCLE1BQU1RLHFCQUFxQixDQUFDQztJQUNqQyxNQUFNQyxTQUFTLENBQUM7SUFFaEIsSUFBSSxDQUFDRCxLQUFLVixJQUFJLEVBQUU7UUFDZFcsT0FBT1gsSUFBSSxHQUFHO0lBQ2hCLE9BQU8sSUFBSVUsS0FBS1YsSUFBSSxDQUFDWSxNQUFNLEdBQUcsR0FBRztRQUMvQkQsT0FBT1gsSUFBSSxHQUFHO0lBQ2hCLE9BQU8sSUFBSVUsS0FBS1YsSUFBSSxDQUFDWSxNQUFNLEdBQUcsSUFBSTtRQUNoQ0QsT0FBT1gsSUFBSSxHQUFHO0lBQ2hCO0lBRUEsSUFBSVUsS0FBS1IsV0FBVyxJQUFJUSxLQUFLUixXQUFXLENBQUNVLE1BQU0sR0FBRyxLQUFLO1FBQ3JERCxPQUFPVCxXQUFXLEdBQUc7SUFDdkI7SUFFQSxJQUFJUSxLQUFLUCxPQUFPLEVBQUU7UUFDaEIsSUFBSSxDQUFDQyxNQUFNUyxPQUFPLENBQUNILEtBQUtQLE9BQU8sR0FBRztZQUNoQ1EsT0FBT1IsT0FBTyxHQUFHO1FBQ25CLE9BQU87WUFDTCxJQUFLLElBQUlXLElBQUksR0FBR0EsSUFBSUosS0FBS1AsT0FBTyxDQUFDUyxNQUFNLEVBQUVFLElBQUs7Z0JBQzVDLE1BQU1DLFdBQVdMLEtBQUtQLE9BQU8sQ0FBQ1csRUFBRTtnQkFDaEMsSUFBSSxPQUFPQyxhQUFhLFlBQVksQ0FBQ2hCLE9BQU9pQixTQUFTLENBQUNDLFNBQVNGLFlBQVk7b0JBQ3pFSixPQUFPUixPQUFPLEdBQUc7b0JBQ2pCO2dCQUNGO1lBQ0Y7UUFDRjtJQUNGO0lBRUEsT0FBTztRQUNMZSxTQUFTQyxPQUFPQyxJQUFJLENBQUNULFFBQVFDLE1BQU0sS0FBSztRQUN4Q0Q7SUFDRjtBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmF1ZGlcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9tcHRQcm9cXFByb21wdFByb1xcbW9kZWxzXFxjb2xsZWN0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvbGxlY3Rpb24gbW9kZWwgc3RydWN0dXJlXG5leHBvcnQgY29uc3QgY29sbGVjdGlvbk1vZGVsID0ge1xuICBpZDogTnVtYmVyLFxuICBuYW1lOiBTdHJpbmcsXG4gIGRlc2NyaXB0aW9uOiBTdHJpbmcsXG4gIHByb21wdHM6IEFycmF5LCAvLyBvZiBwcm9tcHQgSURzXG4gIGNyZWF0ZWRBdDogU3RyaW5nLCAvLyBJU08gZGF0ZSBzdHJpbmdcbiAgdXBkYXRlZEF0OiBTdHJpbmcsIC8vIElTTyBkYXRlIHN0cmluZ1xuICB1c2VySWQ6IFN0cmluZywgLy8gSUQgb2YgdGhlIHVzZXIgd2hvIGNyZWF0ZWQgdGhlIGNvbGxlY3Rpb25cbiAgY3JlYXRlZEJ5OiBTdHJpbmcsIC8vIE5hbWUgb2YgdGhlIHVzZXIgd2hvIGNyZWF0ZWQgdGhlIGNvbGxlY3Rpb25cbn07XG5cbi8vIFZhbGlkYXRlIGNvbGxlY3Rpb24gZGF0YVxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlQ29sbGVjdGlvbiA9IChkYXRhKSA9PiB7XG4gIGNvbnN0IGVycm9ycyA9IHt9O1xuICBcbiAgaWYgKCFkYXRhLm5hbWUpIHtcbiAgICBlcnJvcnMubmFtZSA9ICdOYW1lIGlzIHJlcXVpcmVkJztcbiAgfSBlbHNlIGlmIChkYXRhLm5hbWUubGVuZ3RoIDwgMykge1xuICAgIGVycm9ycy5uYW1lID0gJ05hbWUgbXVzdCBiZSBhdCBsZWFzdCAzIGNoYXJhY3RlcnMnO1xuICB9IGVsc2UgaWYgKGRhdGEubmFtZS5sZW5ndGggPiA1MCkge1xuICAgIGVycm9ycy5uYW1lID0gJ05hbWUgbXVzdCBiZSBsZXNzIHRoYW4gNTAgY2hhcmFjdGVycyc7XG4gIH1cbiAgXG4gIGlmIChkYXRhLmRlc2NyaXB0aW9uICYmIGRhdGEuZGVzY3JpcHRpb24ubGVuZ3RoID4gMjAwKSB7XG4gICAgZXJyb3JzLmRlc2NyaXB0aW9uID0gJ0Rlc2NyaXB0aW9uIG11c3QgYmUgbGVzcyB0aGFuIDIwMCBjaGFyYWN0ZXJzJztcbiAgfVxuICBcbiAgaWYgKGRhdGEucHJvbXB0cykge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShkYXRhLnByb21wdHMpKSB7XG4gICAgICBlcnJvcnMucHJvbXB0cyA9ICdQcm9tcHRzIG11c3QgYmUgYW4gYXJyYXknO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEucHJvbXB0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBwcm9tcHRJZCA9IGRhdGEucHJvbXB0c1tpXTtcbiAgICAgICAgaWYgKHR5cGVvZiBwcm9tcHRJZCAhPT0gJ251bWJlcicgJiYgIU51bWJlci5pc0ludGVnZXIocGFyc2VJbnQocHJvbXB0SWQpKSkge1xuICAgICAgICAgIGVycm9ycy5wcm9tcHRzID0gJ0FsbCBwcm9tcHQgSURzIG11c3QgYmUgaW50ZWdlcnMnO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4ge1xuICAgIGlzVmFsaWQ6IE9iamVjdC5rZXlzKGVycm9ycykubGVuZ3RoID09PSAwLFxuICAgIGVycm9yc1xuICB9O1xufTtcbiJdLCJuYW1lcyI6WyJjb2xsZWN0aW9uTW9kZWwiLCJpZCIsIk51bWJlciIsIm5hbWUiLCJTdHJpbmciLCJkZXNjcmlwdGlvbiIsInByb21wdHMiLCJBcnJheSIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsInVzZXJJZCIsImNyZWF0ZWRCeSIsInZhbGlkYXRlQ29sbGVjdGlvbiIsImRhdGEiLCJlcnJvcnMiLCJsZW5ndGgiLCJpc0FycmF5IiwiaSIsInByb21wdElkIiwiaXNJbnRlZ2VyIiwicGFyc2VJbnQiLCJpc1ZhbGlkIiwiT2JqZWN0Iiwia2V5cyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./models/collection.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcollections&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccollections%5Cindex.js&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcollections&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccollections%5Cindex.js&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_collections_index_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\collections\\index.js */ \"(api-node)/./pages/api/collections/index.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_collections_index_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_collections_index_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_collections_index_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_collections_index_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/collections\",\n        pathname: \"/api/collections\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_collections_index_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGY29sbGVjdGlvbnMmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2NvbGxlY3Rpb25zJTVDaW5kZXguanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ0U7QUFDMUQ7QUFDZ0U7QUFDaEU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLDREQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyw0REFBUTtBQUNwQztBQUNPLHdCQUF3Qix5R0FBbUI7QUFDbEQ7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxjb2xsZWN0aW9uc1xcXFxpbmRleC5qc1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCAnZGVmYXVsdCcpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgJ2NvbmZpZycpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY29sbGVjdGlvbnNcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jb2xsZWN0aW9uc1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcollections&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccollections%5Cindex.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/collections/index.js":
/*!****************************************!*\
  !*** ./pages/api/collections/index.js ***!
  \****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/db */ \"(api-node)/./lib/db.js\");\n/* harmony import */ var _models_collection__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../models/collection */ \"(api-node)/./models/collection.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/auth */ \"(api-node)/./lib/auth.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_db__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_db__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\nasync function handler(req, res) {\n    switch(req.method){\n        case 'GET':\n            return getCollections(req, res);\n        case 'POST':\n            return addCollection(req, res);\n        default:\n            return res.status(405).json({\n                message: 'Method not allowed'\n            });\n    }\n}\n// Protect POST, PUT, DELETE methods\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.withAuthForMethods)(handler));\nasync function getCollections(req, res) {\n    try {\n        // Add await since getAllCollections is now async\n        const collections = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.getAllCollections)();\n        // Check if collections is undefined or null and provide a fallback\n        if (!collections) {\n            return res.status(200).json([]);\n        }\n        // Map MongoDB _id to id for frontend compatibility\n        const mappedCollections = collections.map((collection)=>({\n                id: collection._id.toString(),\n                ...collection,\n                _id: undefined // Remove _id to avoid duplication\n            }));\n        return res.status(200).json(mappedCollections);\n    } catch (error) {\n        console.error('Error getting collections:', error);\n        return res.status(500).json({\n            message: 'Internal server error'\n        });\n    }\n}\nasync function addCollection(req, res) {\n    try {\n        const { name, description } = req.body;\n        // Validate the collection data\n        const validation = (0,_models_collection__WEBPACK_IMPORTED_MODULE_1__.validateCollection)({\n            name,\n            description\n        });\n        if (!validation.isValid) {\n            return res.status(400).json({\n                errors: validation.errors\n            });\n        }\n        // Add user information from the session (NextAuth)\n        const userId = req.session?.user?.id;\n        const userName = req.session?.user?.name || 'Anonymous';\n        // Add await since createCollection is now async\n        const newCollection = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.createCollection)({\n            name,\n            description,\n            userId,\n            createdBy: userName\n        });\n        return res.status(201).json(newCollection);\n    } catch (error) {\n        console.error('Error adding collection:', error);\n        return res.status(500).json({\n            message: 'Internal server error'\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9jb2xsZWN0aW9ucy9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQXNFO0FBQ047QUFDVDtBQUV2RCxlQUFlSSxRQUFRQyxHQUFHLEVBQUVDLEdBQUc7SUFDN0IsT0FBUUQsSUFBSUUsTUFBTTtRQUNoQixLQUFLO1lBQ0gsT0FBT0MsZUFBZUgsS0FBS0M7UUFDN0IsS0FBSztZQUNILE9BQU9HLGNBQWNKLEtBQUtDO1FBQzVCO1lBQ0UsT0FBT0EsSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsU0FBUztZQUFxQjtJQUNoRTtBQUNGO0FBRUEsb0NBQW9DO0FBQ3BDLGlFQUFlVCw2REFBa0JBLENBQUNDLFFBQVFBLEVBQUM7QUFFM0MsZUFBZUksZUFBZUgsR0FBRyxFQUFFQyxHQUFHO0lBQ3BDLElBQUk7UUFDRixpREFBaUQ7UUFDakQsTUFBTU8sY0FBYyxNQUFNYiwwREFBaUJBO1FBRTNDLG1FQUFtRTtRQUNuRSxJQUFJLENBQUNhLGFBQWE7WUFDaEIsT0FBT1AsSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQyxFQUFFO1FBQ2hDO1FBRUEsbURBQW1EO1FBQ25ELE1BQU1HLG9CQUFvQkQsWUFBWUUsR0FBRyxDQUFDQyxDQUFBQSxhQUFlO2dCQUN2REMsSUFBSUQsV0FBV0UsR0FBRyxDQUFDQyxRQUFRO2dCQUMzQixHQUFHSCxVQUFVO2dCQUNiRSxLQUFLRSxVQUFVLGtDQUFrQztZQUNuRDtRQUVBLE9BQU9kLElBQUlJLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUNHO0lBQzlCLEVBQUUsT0FBT08sT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsOEJBQThCQTtRQUM1QyxPQUFPZixJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLFNBQVM7UUFBd0I7SUFDakU7QUFDRjtBQUVBLGVBQWVILGNBQWNKLEdBQUcsRUFBRUMsR0FBRztJQUNuQyxJQUFJO1FBQ0YsTUFBTSxFQUFFaUIsSUFBSSxFQUFFQyxXQUFXLEVBQUUsR0FBR25CLElBQUlvQixJQUFJO1FBRXRDLCtCQUErQjtRQUMvQixNQUFNQyxhQUFheEIsc0VBQWtCQSxDQUFDO1lBQUVxQjtZQUFNQztRQUFZO1FBRTFELElBQUksQ0FBQ0UsV0FBV0MsT0FBTyxFQUFFO1lBQ3ZCLE9BQU9yQixJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFaUIsUUFBUUYsV0FBV0UsTUFBTTtZQUFDO1FBQzFEO1FBRUEsbURBQW1EO1FBQ25ELE1BQU1DLFNBQVN4QixJQUFJeUIsT0FBTyxFQUFFQyxNQUFNZDtRQUNsQyxNQUFNZSxXQUFXM0IsSUFBSXlCLE9BQU8sRUFBRUMsTUFBTVIsUUFBUTtRQUU1QyxnREFBZ0Q7UUFDaEQsTUFBTVUsZ0JBQWdCLE1BQU1oQyx5REFBZ0JBLENBQUM7WUFDM0NzQjtZQUNBQztZQUNBSztZQUNBSyxXQUFXRjtRQUNiO1FBRUEsT0FBTzFCLElBQUlJLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUNzQjtJQUM5QixFQUFFLE9BQU9aLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDRCQUE0QkE7UUFDMUMsT0FBT2YsSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxTQUFTO1FBQXdCO0lBQ2pFO0FBQ0YiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmF1ZGlcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9tcHRQcm9cXFByb21wdFByb1xccGFnZXNcXGFwaVxcY29sbGVjdGlvbnNcXGluZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldEFsbENvbGxlY3Rpb25zLCBjcmVhdGVDb2xsZWN0aW9uIH0gZnJvbSAnLi4vLi4vLi4vbGliL2RiJztcbmltcG9ydCB7IHZhbGlkYXRlQ29sbGVjdGlvbiB9IGZyb20gJy4uLy4uLy4uL21vZGVscy9jb2xsZWN0aW9uJztcbmltcG9ydCB7IHdpdGhBdXRoRm9yTWV0aG9kcyB9IGZyb20gJy4uLy4uLy4uL2xpYi9hdXRoJztcblxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcykge1xuICBzd2l0Y2ggKHJlcS5tZXRob2QpIHtcbiAgICBjYXNlICdHRVQnOlxuICAgICAgcmV0dXJuIGdldENvbGxlY3Rpb25zKHJlcSwgcmVzKTtcbiAgICBjYXNlICdQT1NUJzpcbiAgICAgIHJldHVybiBhZGRDb2xsZWN0aW9uKHJlcSwgcmVzKTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgbWVzc2FnZTogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XG4gIH1cbn1cblxuLy8gUHJvdGVjdCBQT1NULCBQVVQsIERFTEVURSBtZXRob2RzXG5leHBvcnQgZGVmYXVsdCB3aXRoQXV0aEZvck1ldGhvZHMoaGFuZGxlcik7XG5cbmFzeW5jIGZ1bmN0aW9uIGdldENvbGxlY3Rpb25zKHJlcSwgcmVzKSB7XG4gIHRyeSB7XG4gICAgLy8gQWRkIGF3YWl0IHNpbmNlIGdldEFsbENvbGxlY3Rpb25zIGlzIG5vdyBhc3luY1xuICAgIGNvbnN0IGNvbGxlY3Rpb25zID0gYXdhaXQgZ2V0QWxsQ29sbGVjdGlvbnMoKTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiBjb2xsZWN0aW9ucyBpcyB1bmRlZmluZWQgb3IgbnVsbCBhbmQgcHJvdmlkZSBhIGZhbGxiYWNrXG4gICAgaWYgKCFjb2xsZWN0aW9ucykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKFtdKTtcbiAgICB9XG4gICAgXG4gICAgLy8gTWFwIE1vbmdvREIgX2lkIHRvIGlkIGZvciBmcm9udGVuZCBjb21wYXRpYmlsaXR5XG4gICAgY29uc3QgbWFwcGVkQ29sbGVjdGlvbnMgPSBjb2xsZWN0aW9ucy5tYXAoY29sbGVjdGlvbiA9PiAoe1xuICAgICAgaWQ6IGNvbGxlY3Rpb24uX2lkLnRvU3RyaW5nKCksXG4gICAgICAuLi5jb2xsZWN0aW9uLFxuICAgICAgX2lkOiB1bmRlZmluZWQgLy8gUmVtb3ZlIF9pZCB0byBhdm9pZCBkdXBsaWNhdGlvblxuICAgIH0pKTtcbiAgICBcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24obWFwcGVkQ29sbGVjdGlvbnMpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgY29sbGVjdGlvbnM6JywgZXJyb3IpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFkZENvbGxlY3Rpb24ocmVxLCByZXMpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IG5hbWUsIGRlc2NyaXB0aW9uIH0gPSByZXEuYm9keTtcbiAgICBcbiAgICAvLyBWYWxpZGF0ZSB0aGUgY29sbGVjdGlvbiBkYXRhXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlQ29sbGVjdGlvbih7IG5hbWUsIGRlc2NyaXB0aW9uIH0pO1xuICAgIFxuICAgIGlmICghdmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcnM6IHZhbGlkYXRpb24uZXJyb3JzIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBBZGQgdXNlciBpbmZvcm1hdGlvbiBmcm9tIHRoZSBzZXNzaW9uIChOZXh0QXV0aClcbiAgICBjb25zdCB1c2VySWQgPSByZXEuc2Vzc2lvbj8udXNlcj8uaWQ7XG4gICAgY29uc3QgdXNlck5hbWUgPSByZXEuc2Vzc2lvbj8udXNlcj8ubmFtZSB8fCAnQW5vbnltb3VzJztcbiAgICBcbiAgICAvLyBBZGQgYXdhaXQgc2luY2UgY3JlYXRlQ29sbGVjdGlvbiBpcyBub3cgYXN5bmNcbiAgICBjb25zdCBuZXdDb2xsZWN0aW9uID0gYXdhaXQgY3JlYXRlQ29sbGVjdGlvbih7IFxuICAgICAgbmFtZSwgXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHVzZXJJZCxcbiAgICAgIGNyZWF0ZWRCeTogdXNlck5hbWVcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDEpLmpzb24obmV3Q29sbGVjdGlvbik7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWRkaW5nIGNvbGxlY3Rpb246JywgZXJyb3IpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiZ2V0QWxsQ29sbGVjdGlvbnMiLCJjcmVhdGVDb2xsZWN0aW9uIiwidmFsaWRhdGVDb2xsZWN0aW9uIiwid2l0aEF1dGhGb3JNZXRob2RzIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsImdldENvbGxlY3Rpb25zIiwiYWRkQ29sbGVjdGlvbiIsInN0YXR1cyIsImpzb24iLCJtZXNzYWdlIiwiY29sbGVjdGlvbnMiLCJtYXBwZWRDb2xsZWN0aW9ucyIsIm1hcCIsImNvbGxlY3Rpb24iLCJpZCIsIl9pZCIsInRvU3RyaW5nIiwidW5kZWZpbmVkIiwiZXJyb3IiLCJjb25zb2xlIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiYm9keSIsInZhbGlkYXRpb24iLCJpc1ZhbGlkIiwiZXJyb3JzIiwidXNlcklkIiwic2Vzc2lvbiIsInVzZXIiLCJ1c2VyTmFtZSIsIm5ld0NvbGxlY3Rpb24iLCJjcmVhdGVkQnkiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/collections/index.js\n");

/***/ }),

/***/ "bcryptjs":
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/***/ ((module) => {

module.exports = import("bcryptjs");;

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next-auth/jwt":
/*!********************************!*\
  !*** external "next-auth/jwt" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("next-auth/jwt");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcollections&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccollections%5Cindex.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();