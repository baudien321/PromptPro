"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/prompts/[id]";
exports.ids = ["pages/api/prompts/[id]"];
exports.modules = {

/***/ "(api-node)/./lib/auth-utils.js":
/*!***************************!*\
  !*** ./lib/auth-utils.js ***!
  \***************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateToken: () => (/* binding */ generateToken),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword)\n/* harmony export */ });\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcryptjs */ \"bcryptjs\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_1__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([bcryptjs__WEBPACK_IMPORTED_MODULE_0__]);\nbcryptjs__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n/**\n * Hash a password using bcrypt\n * @param {string} password - Plain text password to hash\n * @returns {Promise<string>} - Hashed password\n */ const hashPassword = async (password)=>{\n    const salt = await bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].genSalt(12);\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hash(password, salt);\n};\n/**\n * Verify a password against a hash\n * @param {string} password - Plain text password to check\n * @param {string} hash - Hashed password to compare against\n * @returns {Promise<boolean>} - True if password matches hash\n */ const verifyPassword = async (password, hash)=>{\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].compare(password, hash);\n};\n/**\n * Generate a random token (e.g., for email confirmation, password reset)\n * @param {number} length - Length of the token\n * @returns {string} - Random token\n */ const generateToken = (length = 32)=>{\n    return crypto__WEBPACK_IMPORTED_MODULE_1___default().randomBytes(length).toString('hex');\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9hdXRoLXV0aWxzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUE4QjtBQUNGO0FBRTVCOzs7O0NBSUMsR0FDTSxNQUFNRSxlQUFlLE9BQU9DO0lBQ2pDLE1BQU1DLE9BQU8sTUFBTUosd0RBQWMsQ0FBQztJQUNsQyxPQUFPQSxxREFBVyxDQUFDRyxVQUFVQztBQUMvQixFQUFFO0FBRUY7Ozs7O0NBS0MsR0FDTSxNQUFNRyxpQkFBaUIsT0FBT0osVUFBVUc7SUFDN0MsT0FBT04sd0RBQWMsQ0FBQ0csVUFBVUc7QUFDbEMsRUFBRTtBQUVGOzs7O0NBSUMsR0FDTSxNQUFNRyxnQkFBZ0IsQ0FBQ0MsU0FBUyxFQUFFO0lBQ3ZDLE9BQU9ULHlEQUFrQixDQUFDUyxRQUFRRSxRQUFRLENBQUM7QUFDN0MsRUFBRSIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxiYXVkaVxcT25lRHJpdmVcXERlc2t0b3BcXFByb21wdFByb1xcUHJvbXB0UHJvXFxsaWJcXGF1dGgtdXRpbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5cbi8qKlxuICogSGFzaCBhIHBhc3N3b3JkIHVzaW5nIGJjcnlwdFxuICogQHBhcmFtIHtzdHJpbmd9IHBhc3N3b3JkIC0gUGxhaW4gdGV4dCBwYXNzd29yZCB0byBoYXNoXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSAtIEhhc2hlZCBwYXNzd29yZFxuICovXG5leHBvcnQgY29uc3QgaGFzaFBhc3N3b3JkID0gYXN5bmMgKHBhc3N3b3JkKSA9PiB7XG4gIGNvbnN0IHNhbHQgPSBhd2FpdCBiY3J5cHQuZ2VuU2FsdCgxMik7XG4gIHJldHVybiBiY3J5cHQuaGFzaChwYXNzd29yZCwgc2FsdCk7XG59O1xuXG4vKipcbiAqIFZlcmlmeSBhIHBhc3N3b3JkIGFnYWluc3QgYSBoYXNoXG4gKiBAcGFyYW0ge3N0cmluZ30gcGFzc3dvcmQgLSBQbGFpbiB0ZXh0IHBhc3N3b3JkIHRvIGNoZWNrXG4gKiBAcGFyYW0ge3N0cmluZ30gaGFzaCAtIEhhc2hlZCBwYXNzd29yZCB0byBjb21wYXJlIGFnYWluc3RcbiAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSAtIFRydWUgaWYgcGFzc3dvcmQgbWF0Y2hlcyBoYXNoXG4gKi9cbmV4cG9ydCBjb25zdCB2ZXJpZnlQYXNzd29yZCA9IGFzeW5jIChwYXNzd29yZCwgaGFzaCkgPT4ge1xuICByZXR1cm4gYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIGhhc2gpO1xufTtcblxuLyoqXG4gKiBHZW5lcmF0ZSBhIHJhbmRvbSB0b2tlbiAoZS5nLiwgZm9yIGVtYWlsIGNvbmZpcm1hdGlvbiwgcGFzc3dvcmQgcmVzZXQpXG4gKiBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIC0gTGVuZ3RoIG9mIHRoZSB0b2tlblxuICogQHJldHVybnMge3N0cmluZ30gLSBSYW5kb20gdG9rZW5cbiAqL1xuZXhwb3J0IGNvbnN0IGdlbmVyYXRlVG9rZW4gPSAobGVuZ3RoID0gMzIpID0+IHtcbiAgcmV0dXJuIGNyeXB0by5yYW5kb21CeXRlcyhsZW5ndGgpLnRvU3RyaW5nKCdoZXgnKTtcbn07Il0sIm5hbWVzIjpbImJjcnlwdCIsImNyeXB0byIsImhhc2hQYXNzd29yZCIsInBhc3N3b3JkIiwic2FsdCIsImdlblNhbHQiLCJoYXNoIiwidmVyaWZ5UGFzc3dvcmQiLCJjb21wYXJlIiwiZ2VuZXJhdGVUb2tlbiIsImxlbmd0aCIsInJhbmRvbUJ5dGVzIiwidG9TdHJpbmciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/auth-utils.js\n");

/***/ }),

/***/ "(api-node)/./lib/auth.js":
/*!*********************!*\
  !*** ./lib/auth.js ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAuthSession: () => (/* binding */ getAuthSession),\n/* harmony export */   withAuth: () => (/* binding */ withAuth),\n/* harmony export */   withAuthForMethods: () => (/* binding */ withAuthForMethods)\n/* harmony export */ });\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/jwt */ \"next-auth/jwt\");\n/* harmony import */ var next_auth_jwt__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__);\n\n/**\r\n * Check if the request is authenticated\r\n * @param {Object} req - The request object\r\n * @returns {Promise<Object|null>} - The user session or null if not authenticated\r\n */ async function getAuthSession(req) {\n    return await (0,next_auth_jwt__WEBPACK_IMPORTED_MODULE_0__.getToken)({\n        req,\n        secret: process.env.NEXTAUTH_SECRET\n    });\n}\n/**\r\n * Higher-order function that creates an API handler that requires authentication\r\n * @param {Function} handler - The API handler to protect\r\n * @returns {Function} - The protected API handler\r\n */ function withAuth(handler) {\n    return async (req, res)=>{\n        const session = await getAuthSession(req);\n        if (!session) {\n            return res.status(401).json({\n                error: \"Unauthorized\"\n            });\n        }\n        // Add the session to the request object\n        req.session = session;\n        // Also add a user property for compatibility\n        req.user = {\n            id: session.sub || session.id,\n            name: session.name,\n            email: session.email\n        };\n        // Call the original handler\n        return handler(req, res);\n    };\n}\n/**\r\n * Higher-order function that optionally requires authentication for certain methods\r\n * @param {Function} handler - The API handler \r\n * @param {Array} protectedMethods - HTTP methods that require authentication (e.g., ['POST', 'PUT', 'DELETE'])\r\n * @returns {Function} - The conditionally protected API handler\r\n */ function withAuthForMethods(handler, protectedMethods = [\n    'POST',\n    'PUT',\n    'DELETE'\n]) {\n    return async (req, res)=>{\n        // Check if the current method requires authentication\n        if (protectedMethods.includes(req.method)) {\n            const session = await getAuthSession(req);\n            if (!session) {\n                return res.status(401).json({\n                    error: \"Unauthorized\"\n                });\n            }\n            // Add the session to the request object\n            req.session = session;\n            // Also add a user property for compatibility\n            req.user = {\n                id: session.sub || session.id,\n                name: session.name,\n                email: session.email\n            };\n        }\n        // Call the original handler\n        return handler(req, res);\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9hdXRoLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQXlDO0FBRXpDOzs7O0NBSUMsR0FDTSxlQUFlQyxlQUFlQyxHQUFHO0lBQ3RDLE9BQU8sTUFBTUYsdURBQVFBLENBQUM7UUFBRUU7UUFBS0MsUUFBUUMsUUFBUUMsR0FBRyxDQUFDQyxlQUFlO0lBQUM7QUFDbkU7QUFFQTs7OztDQUlDLEdBQ00sU0FBU0MsU0FBU0MsT0FBTztJQUM5QixPQUFPLE9BQU9OLEtBQUtPO1FBQ2pCLE1BQU1DLFVBQVUsTUFBTVQsZUFBZUM7UUFFckMsSUFBSSxDQUFDUSxTQUFTO1lBQ1osT0FBT0QsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFlO1FBQ3REO1FBRUEsd0NBQXdDO1FBQ3hDWCxJQUFJUSxPQUFPLEdBQUdBO1FBRWQsNkNBQTZDO1FBQzdDUixJQUFJWSxJQUFJLEdBQUc7WUFDVEMsSUFBSUwsUUFBUU0sR0FBRyxJQUFJTixRQUFRSyxFQUFFO1lBQzdCRSxNQUFNUCxRQUFRTyxJQUFJO1lBQ2xCQyxPQUFPUixRQUFRUSxLQUFLO1FBQ3RCO1FBRUEsNEJBQTRCO1FBQzVCLE9BQU9WLFFBQVFOLEtBQUtPO0lBQ3RCO0FBQ0Y7QUFFQTs7Ozs7Q0FLQyxHQUNNLFNBQVNVLG1CQUFtQlgsT0FBTyxFQUFFWSxtQkFBbUI7SUFBQztJQUFRO0lBQU87Q0FBUztJQUN0RixPQUFPLE9BQU9sQixLQUFLTztRQUNqQixzREFBc0Q7UUFDdEQsSUFBSVcsaUJBQWlCQyxRQUFRLENBQUNuQixJQUFJb0IsTUFBTSxHQUFHO1lBQ3pDLE1BQU1aLFVBQVUsTUFBTVQsZUFBZUM7WUFFckMsSUFBSSxDQUFDUSxTQUFTO2dCQUNaLE9BQU9ELElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQUVDLE9BQU87Z0JBQWU7WUFDdEQ7WUFFQSx3Q0FBd0M7WUFDeENYLElBQUlRLE9BQU8sR0FBR0E7WUFFZCw2Q0FBNkM7WUFDN0NSLElBQUlZLElBQUksR0FBRztnQkFDVEMsSUFBSUwsUUFBUU0sR0FBRyxJQUFJTixRQUFRSyxFQUFFO2dCQUM3QkUsTUFBTVAsUUFBUU8sSUFBSTtnQkFDbEJDLE9BQU9SLFFBQVFRLEtBQUs7WUFDdEI7UUFDRjtRQUVBLDRCQUE0QjtRQUM1QixPQUFPVixRQUFRTixLQUFLTztJQUN0QjtBQUNGIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXGJhdWRpXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvbXB0UHJvXFxQcm9tcHRQcm9cXGxpYlxcYXV0aC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRUb2tlbiB9IGZyb20gXCJuZXh0LWF1dGgvand0XCI7XHJcblxyXG4vKipcclxuICogQ2hlY2sgaWYgdGhlIHJlcXVlc3QgaXMgYXV0aGVudGljYXRlZFxyXG4gKiBAcGFyYW0ge09iamVjdH0gcmVxIC0gVGhlIHJlcXVlc3Qgb2JqZWN0XHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdHxudWxsPn0gLSBUaGUgdXNlciBzZXNzaW9uIG9yIG51bGwgaWYgbm90IGF1dGhlbnRpY2F0ZWRcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoU2Vzc2lvbihyZXEpIHtcclxuICByZXR1cm4gYXdhaXQgZ2V0VG9rZW4oeyByZXEsIHNlY3JldDogcHJvY2Vzcy5lbnYuTkVYVEFVVEhfU0VDUkVUIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogSGlnaGVyLW9yZGVyIGZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhbiBBUEkgaGFuZGxlciB0aGF0IHJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgLSBUaGUgQVBJIGhhbmRsZXIgdG8gcHJvdGVjdFxyXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IC0gVGhlIHByb3RlY3RlZCBBUEkgaGFuZGxlclxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHdpdGhBdXRoKGhhbmRsZXIpIHtcclxuICByZXR1cm4gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0QXV0aFNlc3Npb24ocmVxKTtcclxuICAgIFxyXG4gICAgaWYgKCFzZXNzaW9uKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBBZGQgdGhlIHNlc3Npb24gdG8gdGhlIHJlcXVlc3Qgb2JqZWN0XHJcbiAgICByZXEuc2Vzc2lvbiA9IHNlc3Npb247XHJcbiAgICBcclxuICAgIC8vIEFsc28gYWRkIGEgdXNlciBwcm9wZXJ0eSBmb3IgY29tcGF0aWJpbGl0eVxyXG4gICAgcmVxLnVzZXIgPSB7XHJcbiAgICAgIGlkOiBzZXNzaW9uLnN1YiB8fCBzZXNzaW9uLmlkLFxyXG4gICAgICBuYW1lOiBzZXNzaW9uLm5hbWUsXHJcbiAgICAgIGVtYWlsOiBzZXNzaW9uLmVtYWlsXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBDYWxsIHRoZSBvcmlnaW5hbCBoYW5kbGVyXHJcbiAgICByZXR1cm4gaGFuZGxlcihyZXEsIHJlcyk7XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEhpZ2hlci1vcmRlciBmdW5jdGlvbiB0aGF0IG9wdGlvbmFsbHkgcmVxdWlyZXMgYXV0aGVudGljYXRpb24gZm9yIGNlcnRhaW4gbWV0aG9kc1xyXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIC0gVGhlIEFQSSBoYW5kbGVyIFxyXG4gKiBAcGFyYW0ge0FycmF5fSBwcm90ZWN0ZWRNZXRob2RzIC0gSFRUUCBtZXRob2RzIHRoYXQgcmVxdWlyZSBhdXRoZW50aWNhdGlvbiAoZS5nLiwgWydQT1NUJywgJ1BVVCcsICdERUxFVEUnXSlcclxuICogQHJldHVybnMge0Z1bmN0aW9ufSAtIFRoZSBjb25kaXRpb25hbGx5IHByb3RlY3RlZCBBUEkgaGFuZGxlclxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHdpdGhBdXRoRm9yTWV0aG9kcyhoYW5kbGVyLCBwcm90ZWN0ZWRNZXRob2RzID0gWydQT1NUJywgJ1BVVCcsICdERUxFVEUnXSkge1xyXG4gIHJldHVybiBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIC8vIENoZWNrIGlmIHRoZSBjdXJyZW50IG1ldGhvZCByZXF1aXJlcyBhdXRoZW50aWNhdGlvblxyXG4gICAgaWYgKHByb3RlY3RlZE1ldGhvZHMuaW5jbHVkZXMocmVxLm1ldGhvZCkpIHtcclxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldEF1dGhTZXNzaW9uKHJlcSk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIXNlc3Npb24pIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gQWRkIHRoZSBzZXNzaW9uIHRvIHRoZSByZXF1ZXN0IG9iamVjdFxyXG4gICAgICByZXEuc2Vzc2lvbiA9IHNlc3Npb247XHJcbiAgICAgIFxyXG4gICAgICAvLyBBbHNvIGFkZCBhIHVzZXIgcHJvcGVydHkgZm9yIGNvbXBhdGliaWxpdHlcclxuICAgICAgcmVxLnVzZXIgPSB7XHJcbiAgICAgICAgaWQ6IHNlc3Npb24uc3ViIHx8IHNlc3Npb24uaWQsXHJcbiAgICAgICAgbmFtZTogc2Vzc2lvbi5uYW1lLFxyXG4gICAgICAgIGVtYWlsOiBzZXNzaW9uLmVtYWlsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIENhbGwgdGhlIG9yaWdpbmFsIGhhbmRsZXJcclxuICAgIHJldHVybiBoYW5kbGVyKHJlcSwgcmVzKTtcclxuICB9O1xyXG59Il0sIm5hbWVzIjpbImdldFRva2VuIiwiZ2V0QXV0aFNlc3Npb24iLCJyZXEiLCJzZWNyZXQiLCJwcm9jZXNzIiwiZW52IiwiTkVYVEFVVEhfU0VDUkVUIiwid2l0aEF1dGgiLCJoYW5kbGVyIiwicmVzIiwic2Vzc2lvbiIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInVzZXIiLCJpZCIsInN1YiIsIm5hbWUiLCJlbWFpbCIsIndpdGhBdXRoRm9yTWV0aG9kcyIsInByb3RlY3RlZE1ldGhvZHMiLCJpbmNsdWRlcyIsIm1ldGhvZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/auth.js\n");

/***/ }),

/***/ "(api-node)/./lib/db.js":
/*!*******************!*\
  !*** ./lib/db.js ***!
  \*******************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addPromptToCollection: () => (/* binding */ addPromptToCollection),\n/* harmony export */   addTeamMember: () => (/* binding */ addTeamMember),\n/* harmony export */   createCollection: () => (/* binding */ createCollection),\n/* harmony export */   createComment: () => (/* binding */ createComment),\n/* harmony export */   createPrompt: () => (/* binding */ createPrompt),\n/* harmony export */   createTeam: () => (/* binding */ createTeam),\n/* harmony export */   createUser: () => (/* binding */ createUser),\n/* harmony export */   deleteCollection: () => (/* binding */ deleteCollection),\n/* harmony export */   deleteComment: () => (/* binding */ deleteComment),\n/* harmony export */   deletePrompt: () => (/* binding */ deletePrompt),\n/* harmony export */   deleteTeam: () => (/* binding */ deleteTeam),\n/* harmony export */   deleteUser: () => (/* binding */ deleteUser),\n/* harmony export */   getAllCollections: () => (/* binding */ getAllCollections),\n/* harmony export */   getAllPrompts: () => (/* binding */ getAllPrompts),\n/* harmony export */   getAllUsers: () => (/* binding */ getAllUsers),\n/* harmony export */   getCollectionById: () => (/* binding */ getCollectionById),\n/* harmony export */   getCommentsByPromptId: () => (/* binding */ getCommentsByPromptId),\n/* harmony export */   getPromptById: () => (/* binding */ getPromptById),\n/* harmony export */   getTeamById: () => (/* binding */ getTeamById),\n/* harmony export */   getTeamsByUserId: () => (/* binding */ getTeamsByUserId),\n/* harmony export */   getUserByEmail: () => (/* binding */ getUserByEmail),\n/* harmony export */   getUserById: () => (/* binding */ getUserById),\n/* harmony export */   removePromptFromCollection: () => (/* binding */ removePromptFromCollection),\n/* harmony export */   removeTeamMember: () => (/* binding */ removeTeamMember),\n/* harmony export */   updateCollection: () => (/* binding */ updateCollection),\n/* harmony export */   updateComment: () => (/* binding */ updateComment),\n/* harmony export */   updatePrompt: () => (/* binding */ updatePrompt),\n/* harmony export */   updateTeam: () => (/* binding */ updateTeam),\n/* harmony export */   updateUser: () => (/* binding */ updateUser)\n/* harmony export */ });\n/* harmony import */ var _mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./mongodb */ \"(api-node)/./lib/mongodb.js\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _auth_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./auth-utils */ \"(api-node)/./lib/auth-utils.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_auth_utils__WEBPACK_IMPORTED_MODULE_2__]);\n_auth_utils__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n // Assuming auth-utils handles password hashing\n/**\r\n * Helper function to get the database and collections.\r\n */ async function getCollections() {\n    const { db } = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.connectToDatabase)();\n    return {\n        users: db.collection('users'),\n        prompts: db.collection('prompts'),\n        collections: db.collection('collections'),\n        teams: db.collection('teams'),\n        comments: db.collection('comments')\n    };\n}\n/**\r\n * Helper function to convert string ID to ObjectId.\r\n * Returns null if the ID is invalid.\r\n */ function toObjectId(id) {\n    if (!id || !mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId.isValid(id)) {\n        return null;\n    }\n    try {\n        return new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(id);\n    } catch (error) {\n        // Handle potential errors during ObjectId creation if needed\n        console.error(\"Error creating ObjectId:\", error);\n        return null;\n    }\n}\n// --- Prompt Functions ---\nconst getAllPrompts = async (filter = {}, options = {})=>{\n    try {\n        const { prompts } = await getCollections();\n        const cursor = prompts.find(filter);\n        // Add sorting if specified in options\n        if (options.sort) {\n            cursor.sort(options.sort);\n        } else {\n            cursor.sort({\n                createdAt: -1\n            }); // Default sort: newest first\n        }\n        // Add limit if specified\n        if (options.limit) {\n            cursor.limit(options.limit);\n        }\n        // Add skip for pagination if specified\n        if (options.skip) {\n            cursor.skip(options.skip);\n        }\n        const allPrompts = await cursor.toArray();\n        return allPrompts;\n    } catch (error) {\n        console.error(\"Error fetching all prompts:\", error);\n        throw new Error(\"Database error while fetching prompts.\");\n    }\n};\nconst getPromptById = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { prompts } = await getCollections();\n        const prompt = await prompts.findOne({\n            _id: objectId\n        });\n        return prompt;\n    } catch (error) {\n        console.error(\"Error fetching prompt by ID:\", error);\n        throw new Error(\"Database error while fetching prompt.\");\n    }\n};\nconst createPrompt = async (promptData)=>{\n    try {\n        const { prompts } = await getCollections();\n        const now = new Date();\n        const newPrompt = {\n            title: promptData.title,\n            content: promptData.content,\n            description: promptData.description || '',\n            tags: promptData.tags || [],\n            aiPlatform: promptData.aiPlatform || 'ChatGPT',\n            rating: promptData.rating || 0,\n            usageCount: promptData.usageCount || 0,\n            successRate: promptData.successRate || 0,\n            visibility: promptData.visibility || 'private',\n            userId: promptData.userId,\n            createdBy: promptData.createdBy,\n            teamId: promptData.teamId ? toObjectId(promptData.teamId) : null,\n            createdAt: now,\n            updatedAt: now\n        };\n        const result = await prompts.insertOne(newPrompt);\n        return {\n            ...newPrompt,\n            _id: result.insertedId\n        };\n    } catch (error) {\n        console.error(\"Error creating prompt:\", error);\n        throw new Error(\"Database error while creating prompt.\");\n    }\n};\nconst updatePrompt = async (id, promptData)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { prompts } = await getCollections();\n        const updateDoc = {\n            $set: {}\n        };\n        // Add fields to update only if they are provided\n        for (const key of [\n            'title',\n            'content',\n            'description',\n            'tags',\n            'aiPlatform',\n            'rating',\n            'usageCount',\n            'successRate',\n            'visibility',\n            'createdBy'\n        ]){\n            if (promptData[key] !== undefined) {\n                updateDoc.$set[key] = promptData[key];\n            }\n        }\n        // Handle teamId separately - allow setting to null or a valid ObjectId\n        if (promptData.teamId !== undefined) {\n            updateDoc.$set.teamId = promptData.teamId ? toObjectId(promptData.teamId) : null;\n        }\n        // Don't update userId or createdAt\n        updateDoc.$set.updatedAt = new Date();\n        if (Object.keys(updateDoc.$set).length === 1) {\n            // Maybe skip update if only timestamp changes?\n            return prompts.findOne({\n                _id: objectId\n            }); // Return current doc\n        }\n        const result = await prompts.updateOne({\n            _id: objectId\n        }, updateDoc);\n        if (result.matchedCount === 0) {\n            return null; // Prompt not found\n        }\n        const updatedPrompt = await prompts.findOne({\n            _id: objectId\n        });\n        return updatedPrompt;\n    } catch (error) {\n        console.error(\"Error updating prompt:\", error);\n        throw new Error(\"Database error while updating prompt.\");\n    }\n};\nconst deletePrompt = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return false;\n    try {\n        const { prompts } = await getCollections();\n        // TODO: Consider deleting associated comments or handling dependencies\n        const result = await prompts.deleteOne({\n            _id: objectId\n        });\n        return result.deletedCount > 0;\n    } catch (error) {\n        console.error(\"Error deleting prompt:\", error);\n        throw new Error(\"Database error while deleting prompt.\");\n    }\n};\n// TODO: Implement searchPrompts using MongoDB's text search or complex filtering\n// export const searchPrompts = async (query, options = {}) => { ... };\n// --- Collection Functions ---\nconst getAllCollections = async (filter = {}, options = {})=>{\n    try {\n        const { collections } = await getCollections();\n        const cursor = collections.find(filter);\n        if (options.sort) cursor.sort(options.sort);\n        if (options.limit) cursor.limit(options.limit);\n        if (options.skip) cursor.skip(options.skip);\n        const allCollections = await cursor.toArray();\n        return allCollections;\n    } catch (error) {\n        console.error(\"Error fetching all collections:\", error);\n        throw new Error(\"Database error while fetching collections.\");\n    }\n};\nconst getCollectionById = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { collections } = await getCollections();\n        // Optionally use aggregation to populate prompts if needed immediately\n        const collection = await collections.findOne({\n            _id: objectId\n        });\n        return collection;\n    } catch (error) {\n        console.error(\"Error fetching collection by ID:\", error);\n        throw new Error(\"Database error while fetching collection.\");\n    }\n};\nconst createCollection = async (collectionData)=>{\n    try {\n        const { collections } = await getCollections();\n        const now = new Date();\n        const newCollection = {\n            name: collectionData.name,\n            description: collectionData.description || '',\n            userId: collectionData.userId,\n            prompts: [],\n            createdAt: now,\n            updatedAt: now\n        };\n        const result = await collections.insertOne(newCollection);\n        return {\n            ...newCollection,\n            _id: result.insertedId\n        };\n    } catch (error) {\n        console.error(\"Error creating collection:\", error);\n        throw new Error(\"Database error while creating collection.\");\n    }\n};\nconst updateCollection = async (id, collectionData)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { collections } = await getCollections();\n        const updateDoc = {\n            $set: {}\n        };\n        if (collectionData.name !== undefined) updateDoc.$set.name = collectionData.name;\n        if (collectionData.description !== undefined) updateDoc.$set.description = collectionData.description;\n        // Note: Managing the 'prompts' array (add/remove) typically done via separate functions\n        updateDoc.$set.updatedAt = new Date();\n        if (Object.keys(updateDoc.$set).length > 1) {\n            const result = await collections.updateOne({\n                _id: objectId\n            }, updateDoc);\n            if (result.matchedCount === 0) return null;\n        }\n        const updatedCollection = await collections.findOne({\n            _id: objectId\n        });\n        return updatedCollection;\n    } catch (error) {\n        console.error(\"Error updating collection:\", error);\n        throw new Error(\"Database error while updating collection.\");\n    }\n};\nconst deleteCollection = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return false;\n    try {\n        const { collections } = await getCollections();\n        const result = await collections.deleteOne({\n            _id: objectId\n        });\n        return result.deletedCount > 0;\n    } catch (error) {\n        console.error(\"Error deleting collection:\", error);\n        throw new Error(\"Database error while deleting collection.\");\n    }\n};\nconst addPromptToCollection = async (collectionId, promptId)=>{\n    const collObjectId = toObjectId(collectionId);\n    const promptObjectId = toObjectId(promptId);\n    if (!collObjectId || !promptObjectId) return null;\n    try {\n        const { collections } = await getCollections();\n        // Use $addToSet to add the prompt's ObjectId to the array if not already present\n        const result = await collections.updateOne({\n            _id: collObjectId\n        }, {\n            $addToSet: {\n                prompts: promptObjectId\n            },\n            $set: {\n                updatedAt: new Date()\n            }\n        });\n        if (result.matchedCount === 0) return null; // Collection not found\n        const updatedCollection = await collections.findOne({\n            _id: collObjectId\n        });\n        return updatedCollection;\n    } catch (error) {\n        console.error(\"Error adding prompt to collection:\", error);\n        throw new Error(\"Database error while adding prompt to collection.\");\n    }\n};\nconst removePromptFromCollection = async (collectionId, promptId)=>{\n    const collObjectId = toObjectId(collectionId);\n    const promptObjectId = toObjectId(promptId);\n    if (!collObjectId || !promptObjectId) return null;\n    try {\n        const { collections } = await getCollections();\n        // Use $pull to remove the prompt's ObjectId from the array\n        const result = await collections.updateOne({\n            _id: collObjectId\n        }, {\n            $pull: {\n                prompts: promptObjectId\n            },\n            $set: {\n                updatedAt: new Date()\n            }\n        });\n        if (result.matchedCount === 0) return null; // Collection not found\n        const updatedCollection = await collections.findOne({\n            _id: collObjectId\n        });\n        return updatedCollection;\n    } catch (error) {\n        console.error(\"Error removing prompt from collection:\", error);\n        throw new Error(\"Database error while removing prompt from collection.\");\n    }\n};\n// --- User Functions ---\n// Note: These are basic implementations. Authentication libraries often handle user management.\nconst getAllUsers = async (filter = {}, options = {})=>{\n    try {\n        const { users } = await getCollections();\n        // Exclude password field by default\n        const cursor = users.find(filter, {\n            projection: {\n                password: 0\n            }\n        });\n        if (options.sort) cursor.sort(options.sort);\n        if (options.limit) cursor.limit(options.limit);\n        if (options.skip) cursor.skip(options.skip);\n        const allUsers = await cursor.toArray();\n        return allUsers;\n    } catch (error) {\n        console.error(\"Error fetching all users:\", error);\n        throw new Error(\"Database error while fetching users.\");\n    }\n};\nconst getUserById = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { users } = await getCollections();\n        const user = await users.findOne({\n            _id: objectId\n        }, {\n            projection: {\n                password: 0\n            }\n        });\n        return user;\n    } catch (error) {\n        console.error(\"Error fetching user by ID:\", error);\n        throw new Error(\"Database error while fetching user.\");\n    }\n};\nconst getUserByEmail = async (email)=>{\n    if (!email) return null;\n    try {\n        const { users } = await getCollections();\n        // Find user by email, but DO include password for authentication checks\n        const user = await users.findOne({\n            email: email.toLowerCase()\n        });\n        return user;\n    } catch (error) {\n        console.error(\"Error fetching user by email:\", error);\n        throw new Error(\"Database error while fetching user.\");\n    }\n};\nconst createUser = async (userData)=>{\n    if (!userData.email || !userData.password) {\n        throw new Error(\"Email and password are required to create a user.\");\n    }\n    try {\n        const { users } = await getCollections();\n        const now = new Date();\n        // Check if user already exists\n        const existingUser = await users.findOne({\n            email: userData.email.toLowerCase()\n        });\n        if (existingUser) {\n            throw new Error(\"User with this email already exists.\");\n        }\n        // Hash password before storing\n        const hashedPassword = await (0,_auth_utils__WEBPACK_IMPORTED_MODULE_2__.hashPassword)(userData.password);\n        const newUser = {\n            name: userData.name || '',\n            email: userData.email.toLowerCase(),\n            password: hashedPassword,\n            image: userData.image || null,\n            // Add roles or other fields as needed\n            createdAt: now,\n            updatedAt: now\n        };\n        const result = await users.insertOne(newUser);\n        // Return user data without the password hash\n        const { password, ...userWithoutPassword } = newUser;\n        return {\n            ...userWithoutPassword,\n            _id: result.insertedId\n        };\n    } catch (error) {\n        console.error(\"Error creating user:\", error);\n        // Rethrow specific errors or a generic one\n        if (error.message === \"User with this email already exists.\") {\n            throw error;\n        }\n        throw new Error(\"Database error while creating user.\");\n    }\n};\nconst updateUser = async (id, userData)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { users } = await getCollections();\n        const updateDoc = {\n            $set: {}\n        };\n        if (userData.name !== undefined) updateDoc.$set.name = userData.name;\n        if (userData.image !== undefined) updateDoc.$set.image = userData.image;\n        // Add other updatable fields (e.g., roles)\n        // Handle email change carefully\n        if (userData.email && typeof userData.email === 'string') {\n            const newEmail = userData.email.toLowerCase();\n            const existingUser = await users.findOne({\n                email: newEmail\n            });\n            // Allow update only if email doesn't exist OR belongs to the current user\n            if (existingUser && !existingUser._id.equals(objectId)) {\n                throw new Error(\"Email address is already in use.\");\n            }\n            updateDoc.$set.email = newEmail;\n        }\n        // Do not allow password update through this general function\n        // Create a specific changePassword function if needed\n        updateDoc.$set.updatedAt = new Date();\n        if (Object.keys(updateDoc.$set).length > 1) {\n            const result = await users.updateOne({\n                _id: objectId\n            }, updateDoc);\n            if (result.matchedCount === 0) return null;\n        }\n        const updatedUser = await users.findOne({\n            _id: objectId\n        }, {\n            projection: {\n                password: 0\n            }\n        });\n        return updatedUser;\n    } catch (error) {\n        console.error(\"Error updating user:\", error);\n        if (error.message === \"Email address is already in use.\") {\n            throw error;\n        }\n        throw new Error(\"Database error while updating user.\");\n    }\n};\nconst deleteUser = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return false;\n    try {\n        const { users } = await getCollections();\n        // TODO: Handle related data cleanup (e.g., reassign prompts?)\n        const result = await users.deleteOne({\n            _id: objectId\n        });\n        return result.deletedCount > 0;\n    } catch (error) {\n        console.error(\"Error deleting user:\", error);\n        throw new Error(\"Database error while deleting user.\");\n    }\n};\n// --- Team Functions (already refactored) ---\nconst getTeamById = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null; // Invalid ID format\n    try {\n        const { teams } = await getCollections();\n        // Fetch team and potentially populate member details if needed later\n        const team = await teams.findOne({\n            _id: objectId\n        });\n        // Optionally convert member userIds back to string if needed for frontend\n        // if (team && team.members) {\n        //   team.members = team.members.map(member => ({ ...member, userId: member.userId.toString() }));\n        // }\n        // Convert main _id to string\n        // if (team) team._id = team._id.toString();\n        return team; // Returns the team document or null if not found\n    } catch (error) {\n        console.error(\"Error fetching team by ID:\", error);\n        throw new Error(\"Database error while fetching team.\");\n    }\n};\nconst getTeamsByUserId = async (userId)=>{\n    // Ensure userId is treated as a string for matching unless it's clearly an ObjectId\n    const userIdString = userId.toString();\n    const userObjectId = toObjectId(userId); // Attempt conversion\n    try {\n        const { teams } = await getCollections();\n        // Find teams where the user is the owner (userId field)\n        // OR the user is in the members array (assuming member.userId is stored as string)\n        const query = {\n            'members.userId': userIdString\n        };\n        // If the original userId was *also* the ownerId field, add that check\n        // This depends on how owner `userId` is stored (string vs ObjectId)\n        // Let's assume owner `userId` might match the string ID from session\n        const ownerQuery = {\n            userId: userIdString\n        };\n        // Combine queries\n        const finalQuery = {\n            $or: [\n                query,\n                ownerQuery\n            ]\n        };\n        // If the userId *was* a valid ObjectId, also check for ObjectId matches \n        // (in case some IDs are stored as ObjectIds)\n        if (userObjectId) {\n            finalQuery.$or.push({\n                'members.userId': userObjectId\n            });\n            finalQuery.$or.push({\n                userId: userObjectId\n            });\n        }\n        const userTeams = await teams.find(finalQuery).toArray();\n        return userTeams;\n    } catch (error) {\n        console.error(\"Error fetching teams by user ID:\", error);\n        throw new Error(\"Database error while fetching user's teams.\");\n    }\n};\nconst createTeam = async (teamData)=>{\n    try {\n        const { teams, users } = await getCollections();\n        const now = new Date();\n        const ownerUserId = teamData.userId; // Assume this is the string ID from session\n        // Fetch owner's name\n        let ownerName = 'Owner'; // Default\n        const ownerUser = await users.findOne({\n            _id: toObjectId(ownerUserId)\n        }, {\n            projection: {\n                name: 1\n            }\n        });\n        if (ownerUser && ownerUser.name) {\n            ownerName = ownerUser.name;\n        }\n        const newTeam = {\n            name: teamData.name,\n            description: teamData.description || '',\n            userId: ownerUserId,\n            members: [],\n            createdAt: now,\n            updatedAt: now\n        };\n        // Add creator as the owner\n        newTeam.members.push({\n            userId: ownerUserId,\n            role: 'owner',\n            joinedAt: now,\n            name: ownerName // Add owner's name\n        });\n        const result = await teams.insertOne(newTeam);\n        return {\n            ...newTeam,\n            _id: result.insertedId\n        };\n    } catch (error) {\n        console.error(\"Error creating team:\", error);\n        throw new Error(\"Database error while creating team.\");\n    }\n};\nconst updateTeam = async (id, teamData)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    try {\n        const { teams } = await getCollections();\n        const updateDoc = {\n            $set: {}\n        };\n        if (teamData.name !== undefined) updateDoc.$set.name = teamData.name;\n        if (teamData.description !== undefined) updateDoc.$set.description = teamData.description;\n        updateDoc.$set.updatedAt = new Date();\n        if (Object.keys(updateDoc.$set).length > 1) {\n            const result = await teams.updateOne({\n                _id: objectId\n            }, updateDoc);\n            if (result.matchedCount === 0) return null;\n        }\n        const updatedTeam = await teams.findOne({\n            _id: objectId\n        });\n        return updatedTeam;\n    } catch (error) {\n        console.error(\"Error updating team:\", error);\n        throw new Error(\"Database error while updating team.\");\n    }\n};\nconst deleteTeam = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return false;\n    try {\n        const { teams } = await getCollections();\n        // TODO: Handle related data cleanup (e.g., prompts belonging to team?)\n        const result = await teams.deleteOne({\n            _id: objectId\n        });\n        return result.deletedCount > 0;\n    } catch (error) {\n        console.error(\"Error deleting team:\", error);\n        throw new Error(\"Database error while deleting team.\");\n    }\n};\nconst addTeamMember = async (teamId, memberData)=>{\n    const teamObjectId = toObjectId(teamId);\n    if (!teamObjectId) return null;\n    if (!memberData || !memberData.userId) throw new Error(\"Member user ID is required.\");\n    const memberUserId = memberData.userId; // Assume string ID from request\n    try {\n        const { teams, users } = await getCollections();\n        const now = new Date();\n        // Fetch member's name\n        let memberName = 'Member'; // Default\n        const memberUser = await users.findOne({\n            _id: toObjectId(memberUserId)\n        }, {\n            projection: {\n                name: 1\n            }\n        });\n        if (memberUser && memberUser.name) {\n            memberName = memberUser.name;\n        }\n        const memberRecord = {\n            userId: memberUserId,\n            role: memberData.role || 'member',\n            joinedAt: now,\n            name: memberName // Add member's name\n        };\n        // Check if user is already a member (using the string ID)\n        const team = await teams.findOne({\n            _id: teamObjectId,\n            'members.userId': memberUserId\n        });\n        if (team) {\n            console.log(\"User is already a member of this team.\");\n            return team; // Already a member\n        }\n        // Use $addToSet (or $push if duplicates are impossible/undesired)\n        const result = await teams.updateOne({\n            _id: teamObjectId\n        }, {\n            $push: {\n                members: memberRecord\n            },\n            $set: {\n                updatedAt: now\n            }\n        });\n        if (result.matchedCount === 0) return null;\n        const updatedTeam = await teams.findOne({\n            _id: teamObjectId\n        });\n        return updatedTeam;\n    } catch (error) {\n        console.error(\"Error adding team member:\", error);\n        throw new Error(\"Database error while adding team member.\");\n    }\n};\nconst removeTeamMember = async (teamId, userIdToRemove)=>{\n    const teamObjectId = toObjectId(teamId);\n    if (!teamObjectId) return null;\n    if (!userIdToRemove) throw new Error(\"User ID to remove is required.\");\n    const memberUserIdString = userIdToRemove.toString();\n    try {\n        const { teams } = await getCollections();\n        const now = new Date();\n        // Find the team first to check if the user being removed is the owner\n        const team = await teams.findOne({\n            _id: teamObjectId\n        });\n        if (!team) return null; // Team not found\n        const memberToRemove = team.members.find((m)=>m.userId === memberUserIdString);\n        if (!memberToRemove) {\n            // console.log(\"Member not found in team.\");\n            return team; // Member not found, return current team state\n        }\n        // Prevent removing the owner\n        if (memberToRemove.role === 'owner') {\n            throw new Error(\"Cannot remove the team owner.\");\n        }\n        // Use $pull to remove the member by userId (string match)\n        const result = await teams.updateOne({\n            _id: teamObjectId\n        }, {\n            $pull: {\n                members: {\n                    userId: memberUserIdString\n                }\n            },\n            $set: {\n                updatedAt: now\n            }\n        });\n        if (result.modifiedCount === 0) {\n            // Should not happen if member was found, but handle gracefully\n            console.log(\"Pull operation did not modify the document.\");\n        }\n        const updatedTeam = await teams.findOne({\n            _id: teamObjectId\n        });\n        return updatedTeam;\n    } catch (error) {\n        console.error(\"Error removing team member:\", error);\n        if (error.message === \"Cannot remove the team owner.\") {\n            throw error;\n        }\n        throw new Error(\"Database error while removing team member.\");\n    }\n};\n// TODO: Implement updateTeamMember role if needed\n// --- Comment Functions ---\nconst getCommentsByPromptId = async (promptId)=>{\n    const promptObjectId = toObjectId(promptId);\n    if (!promptObjectId) return [];\n    try {\n        const { comments } = await getCollections();\n        // Fetch comments and sort by creation date (newest first)\n        const promptComments = await comments.find({\n            promptId: promptObjectId\n        }).sort({\n            createdAt: -1\n        }).toArray();\n        return promptComments;\n    } catch (error) {\n        console.error(\"Error fetching comments by prompt ID:\", error);\n        throw new Error(\"Database error while fetching comments.\");\n    }\n};\nconst createComment = async (commentData)=>{\n    if (!commentData.promptId || !commentData.userId || !commentData.content) {\n        throw new Error(\"Prompt ID, User ID, and content are required for comments.\");\n    }\n    const promptObjectId = toObjectId(commentData.promptId);\n    // Assuming userId is passed as string from session\n    const userIdString = commentData.userId.toString();\n    if (!promptObjectId) {\n        throw new Error(\"Invalid Prompt ID format for comment.\");\n    }\n    try {\n        const { comments, users } = await getCollections();\n        const now = new Date();\n        // Fetch commenter's name\n        let createdByName = 'User'; // Default\n        const commenterUser = await users.findOne({\n            _id: toObjectId(userIdString)\n        }, {\n            projection: {\n                name: 1\n            }\n        });\n        if (commenterUser && commenterUser.name) {\n            createdByName = commenterUser.name;\n        }\n        const newComment = {\n            promptId: promptObjectId,\n            userId: userIdString,\n            content: commentData.content,\n            createdBy: createdByName,\n            createdAt: now,\n            updatedAt: now\n        };\n        const result = await comments.insertOne(newComment);\n        return {\n            ...newComment,\n            _id: result.insertedId\n        };\n    } catch (error) {\n        console.error(\"Error creating comment:\", error);\n        throw new Error(\"Database error while creating comment.\");\n    }\n};\nconst updateComment = async (id, commentData)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return null;\n    if (!commentData.content) {\n        throw new Error(\"Comment content is required for update.\");\n    }\n    try {\n        const { comments } = await getCollections();\n        const updateDoc = {\n            $set: {\n                content: commentData.content,\n                updatedAt: new Date()\n            }\n        };\n        const result = await comments.updateOne({\n            _id: objectId\n        }, updateDoc);\n        if (result.matchedCount === 0) return null;\n        const updatedComment = await comments.findOne({\n            _id: objectId\n        });\n        return updatedComment;\n    } catch (error) {\n        console.error(\"Error updating comment:\", error);\n        throw new Error(\"Database error while updating comment.\");\n    }\n};\nconst deleteComment = async (id)=>{\n    const objectId = toObjectId(id);\n    if (!objectId) return false;\n    try {\n        const { comments } = await getCollections();\n        const result = await comments.deleteOne({\n            _id: objectId\n        });\n        return result.deletedCount > 0;\n    } catch (error) {\n        console.error(\"Error deleting comment:\", error);\n        throw new Error(\"Database error while deleting comment.\");\n    }\n}; // Remove the old in-memory data and initialization logic\n /*\r\nlet prompts = [];\r\nlet collections = [];\r\nlet users = [];\r\nlet teams = [];\r\nlet comments = [];\r\nlet promptIdCounter = 1;\r\nlet collectionIdCounter = 1;\r\nlet userIdCounter = 1;\r\nlet teamIdCounter = 1;\r\nlet commentIdCounter = 1;\r\n\r\n// All old functions like:\r\nexport const getAllPrompts = () => { ... };\r\n// ... etc.\r\n\r\n// Initialize with some sample data - in real app, this would be loaded from database\r\nexport const initializeDb = async () => { ... };\r\n\r\n// Call initialize when imported\r\n(async () => { ... })();\r\n*/ \n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UztRQUM5RCxPQUFPOEg7SUFDVCxFQUFFLE9BQU83SSxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQywyQkFBMkJBO1FBQ3pDLE1BQU0sSUFBSWEsTUFBTTtJQUNsQjtBQUNGLEVBQUU7QUFFSyxNQUFNaUksZ0JBQWdCLE9BQU9oSjtJQUNsQyxNQUFNaUIsV0FBV2xCLFdBQVdDO0lBQzVCLElBQUksQ0FBQ2lCLFVBQVUsT0FBTztJQUN0QixJQUFJO1FBQ0YsTUFBTSxFQUFFbkIsUUFBUSxFQUFFLEdBQUcsTUFBTVA7UUFDM0IsTUFBTWdELFNBQVMsTUFBTXpDLFNBQVN3RCxTQUFTLENBQUM7WUFBRWxDLEtBQUtIO1FBQVM7UUFDeEQsT0FBT3NCLE9BQU9nQixZQUFZLEdBQUc7SUFDL0IsRUFBRSxPQUFPckQsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsMkJBQTJCQTtRQUN6QyxNQUFNLElBQUlhLE1BQU07SUFDbEI7QUFDRixFQUFFLENBRUYseURBQXlEO0NBQ3pEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFxQkEiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmF1ZGlcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9tcHRQcm9cXFByb21wdFByb1xcbGliXFxkYi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25uZWN0VG9EYXRhYmFzZSB9IGZyb20gJy4vbW9uZ29kYic7XHJcbmltcG9ydCB7IE9iamVjdElkIH0gZnJvbSAnbW9uZ29kYic7XHJcbmltcG9ydCB7IGhhc2hQYXNzd29yZCB9IGZyb20gJy4vYXV0aC11dGlscyc7IC8vIEFzc3VtaW5nIGF1dGgtdXRpbHMgaGFuZGxlcyBwYXNzd29yZCBoYXNoaW5nXHJcblxyXG4vKipcclxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGdldCB0aGUgZGF0YWJhc2UgYW5kIGNvbGxlY3Rpb25zLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZ2V0Q29sbGVjdGlvbnMoKSB7XHJcbiAgY29uc3QgeyBkYiB9ID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICByZXR1cm4ge1xyXG4gICAgdXNlcnM6IGRiLmNvbGxlY3Rpb24oJ3VzZXJzJyksXHJcbiAgICBwcm9tcHRzOiBkYi5jb2xsZWN0aW9uKCdwcm9tcHRzJyksXHJcbiAgICBjb2xsZWN0aW9uczogZGIuY29sbGVjdGlvbignY29sbGVjdGlvbnMnKSxcclxuICAgIHRlYW1zOiBkYi5jb2xsZWN0aW9uKCd0ZWFtcycpLFxyXG4gICAgY29tbWVudHM6IGRiLmNvbGxlY3Rpb24oJ2NvbW1lbnRzJyksXHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBjb252ZXJ0IHN0cmluZyBJRCB0byBPYmplY3RJZC5cclxuICogUmV0dXJucyBudWxsIGlmIHRoZSBJRCBpcyBpbnZhbGlkLlxyXG4gKi9cclxuZnVuY3Rpb24gdG9PYmplY3RJZChpZCkge1xyXG4gIGlmICghaWQgfHwgIU9iamVjdElkLmlzVmFsaWQoaWQpKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgdHJ5IHtcclxuICAgIHJldHVybiBuZXcgT2JqZWN0SWQoaWQpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAvLyBIYW5kbGUgcG90ZW50aWFsIGVycm9ycyBkdXJpbmcgT2JqZWN0SWQgY3JlYXRpb24gaWYgbmVlZGVkXHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgT2JqZWN0SWQ6XCIsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLy8gLS0tIFByb21wdCBGdW5jdGlvbnMgLS0tXHJcblxyXG5leHBvcnQgY29uc3QgZ2V0QWxsUHJvbXB0cyA9IGFzeW5jIChmaWx0ZXIgPSB7fSwgb3B0aW9ucyA9IHt9KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgcHJvbXB0cyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICAgIGNvbnN0IGN1cnNvciA9IHByb21wdHMuZmluZChmaWx0ZXIpO1xyXG4gICAgXHJcbiAgICAvLyBBZGQgc29ydGluZyBpZiBzcGVjaWZpZWQgaW4gb3B0aW9uc1xyXG4gICAgaWYgKG9wdGlvbnMuc29ydCkge1xyXG4gICAgICBjdXJzb3Iuc29ydChvcHRpb25zLnNvcnQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjdXJzb3Iuc29ydCh7IGNyZWF0ZWRBdDogLTEgfSk7IC8vIERlZmF1bHQgc29ydDogbmV3ZXN0IGZpcnN0XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQWRkIGxpbWl0IGlmIHNwZWNpZmllZFxyXG4gICAgaWYgKG9wdGlvbnMubGltaXQpIHtcclxuICAgICAgY3Vyc29yLmxpbWl0KG9wdGlvbnMubGltaXQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFkZCBza2lwIGZvciBwYWdpbmF0aW9uIGlmIHNwZWNpZmllZFxyXG4gICAgaWYgKG9wdGlvbnMuc2tpcCkge1xyXG4gICAgICAgIGN1cnNvci5za2lwKG9wdGlvbnMuc2tpcCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYWxsUHJvbXB0cyA9IGF3YWl0IGN1cnNvci50b0FycmF5KCk7XHJcbiAgICByZXR1cm4gYWxsUHJvbXB0cztcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFsbCBwcm9tcHRzOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBmZXRjaGluZyBwcm9tcHRzLlwiKTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0UHJvbXB0QnlJZCA9IGFzeW5jIChpZCkgPT4ge1xyXG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XHJcbiAgaWYgKCFvYmplY3RJZCkgcmV0dXJuIG51bGw7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgcHJvbXB0cyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICAgIGNvbnN0IHByb21wdCA9IGF3YWl0IHByb21wdHMuZmluZE9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XHJcbiAgICByZXR1cm4gcHJvbXB0O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgcHJvbXB0IGJ5IElEOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBmZXRjaGluZyBwcm9tcHQuXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVQcm9tcHQgPSBhc3luYyAocHJvbXB0RGF0YSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHByb21wdHMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgY29uc3QgbmV3UHJvbXB0ID0ge1xyXG4gICAgICB0aXRsZTogcHJvbXB0RGF0YS50aXRsZSxcclxuICAgICAgY29udGVudDogcHJvbXB0RGF0YS5jb250ZW50LFxyXG4gICAgICBkZXNjcmlwdGlvbjogcHJvbXB0RGF0YS5kZXNjcmlwdGlvbiB8fCAnJyxcclxuICAgICAgdGFnczogcHJvbXB0RGF0YS50YWdzIHx8IFtdLFxyXG4gICAgICBhaVBsYXRmb3JtOiBwcm9tcHREYXRhLmFpUGxhdGZvcm0gfHwgJ0NoYXRHUFQnLFxyXG4gICAgICByYXRpbmc6IHByb21wdERhdGEucmF0aW5nIHx8IDAsXHJcbiAgICAgIHVzYWdlQ291bnQ6IHByb21wdERhdGEudXNhZ2VDb3VudCB8fCAwLFxyXG4gICAgICBzdWNjZXNzUmF0ZTogcHJvbXB0RGF0YS5zdWNjZXNzUmF0ZSB8fCAwLFxyXG4gICAgICB2aXNpYmlsaXR5OiBwcm9tcHREYXRhLnZpc2liaWxpdHkgfHwgJ3ByaXZhdGUnLFxyXG4gICAgICB1c2VySWQ6IHByb21wdERhdGEudXNlcklkLCAvLyBTaG91bGQgY29tZSBmcm9tIGF1dGhlbnRpY2F0ZWQgc2Vzc2lvblxyXG4gICAgICBjcmVhdGVkQnk6IHByb21wdERhdGEuY3JlYXRlZEJ5LCAvLyBPcHRpb25hbDogU3RvcmUgY3JlYXRvcidzIG5hbWUvaW5mb1xyXG4gICAgICB0ZWFtSWQ6IHByb21wdERhdGEudGVhbUlkID8gdG9PYmplY3RJZChwcm9tcHREYXRhLnRlYW1JZCkgOiBudWxsLCAvLyBDb252ZXJ0IHRlYW1JZCBpZiBwcmVzZW50XHJcbiAgICAgIGNyZWF0ZWRBdDogbm93LFxyXG4gICAgICB1cGRhdGVkQXQ6IG5vdyxcclxuICAgIH07XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm9tcHRzLmluc2VydE9uZShuZXdQcm9tcHQpO1xyXG4gICAgcmV0dXJuIHsgLi4ubmV3UHJvbXB0LCBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjcmVhdGluZyBwcm9tcHQ6XCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGNyZWF0aW5nIHByb21wdC5cIik7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHVwZGF0ZVByb21wdCA9IGFzeW5jIChpZCwgcHJvbXB0RGF0YSkgPT4ge1xyXG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XHJcbiAgaWYgKCFvYmplY3RJZCkgcmV0dXJuIG51bGw7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHByb21wdHMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XHJcbiAgICBjb25zdCB1cGRhdGVEb2MgPSB7ICRzZXQ6IHt9IH07XHJcblxyXG4gICAgLy8gQWRkIGZpZWxkcyB0byB1cGRhdGUgb25seSBpZiB0aGV5IGFyZSBwcm92aWRlZFxyXG4gICAgZm9yIChjb25zdCBrZXkgb2YgWyd0aXRsZScsICdjb250ZW50JywgJ2Rlc2NyaXB0aW9uJywgJ3RhZ3MnLCAnYWlQbGF0Zm9ybScsICdyYXRpbmcnLCAndXNhZ2VDb3VudCcsICdzdWNjZXNzUmF0ZScsICd2aXNpYmlsaXR5JywgJ2NyZWF0ZWRCeSddKSB7XHJcbiAgICAgIGlmIChwcm9tcHREYXRhW2tleV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHVwZGF0ZURvYy4kc2V0W2tleV0gPSBwcm9tcHREYXRhW2tleV07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIEhhbmRsZSB0ZWFtSWQgc2VwYXJhdGVseSAtIGFsbG93IHNldHRpbmcgdG8gbnVsbCBvciBhIHZhbGlkIE9iamVjdElkXHJcbiAgICBpZiAocHJvbXB0RGF0YS50ZWFtSWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHVwZGF0ZURvYy4kc2V0LnRlYW1JZCA9IHByb21wdERhdGEudGVhbUlkID8gdG9PYmplY3RJZChwcm9tcHREYXRhLnRlYW1JZCkgOiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERvbid0IHVwZGF0ZSB1c2VySWQgb3IgY3JlYXRlZEF0XHJcbiAgICB1cGRhdGVEb2MuJHNldC51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgIGlmIChPYmplY3Qua2V5cyh1cGRhdGVEb2MuJHNldCkubGVuZ3RoID09PSAxKSB7IC8vIE9ubHkgdXBkYXRlZEF0XHJcbiAgICAgICAgLy8gTWF5YmUgc2tpcCB1cGRhdGUgaWYgb25seSB0aW1lc3RhbXAgY2hhbmdlcz9cclxuICAgICAgICByZXR1cm4gcHJvbXB0cy5maW5kT25lKHsgX2lkOiBvYmplY3RJZCB9KTsgLy8gUmV0dXJuIGN1cnJlbnQgZG9jXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvbXB0cy51cGRhdGVPbmUoeyBfaWQ6IG9iamVjdElkIH0sIHVwZGF0ZURvYyk7XHJcblxyXG4gICAgaWYgKHJlc3VsdC5tYXRjaGVkQ291bnQgPT09IDApIHtcclxuICAgICAgcmV0dXJuIG51bGw7IC8vIFByb21wdCBub3QgZm91bmRcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1cGRhdGVkUHJvbXB0ID0gYXdhaXQgcHJvbXB0cy5maW5kT25lKHsgX2lkOiBvYmplY3RJZCB9KTtcclxuICAgIHJldHVybiB1cGRhdGVkUHJvbXB0O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgcHJvbXB0OlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSB1cGRhdGluZyBwcm9tcHQuXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBkZWxldGVQcm9tcHQgPSBhc3luYyAoaWQpID0+IHtcclxuICBjb25zdCBvYmplY3RJZCA9IHRvT2JqZWN0SWQoaWQpO1xyXG4gIGlmICghb2JqZWN0SWQpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgcHJvbXB0cyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICAgIC8vIFRPRE86IENvbnNpZGVyIGRlbGV0aW5nIGFzc29jaWF0ZWQgY29tbWVudHMgb3IgaGFuZGxpbmcgZGVwZW5kZW5jaWVzXHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm9tcHRzLmRlbGV0ZU9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XHJcbiAgICByZXR1cm4gcmVzdWx0LmRlbGV0ZWRDb3VudCA+IDA7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyBwcm9tcHQ6XCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGRlbGV0aW5nIHByb21wdC5cIik7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gVE9ETzogSW1wbGVtZW50IHNlYXJjaFByb21wdHMgdXNpbmcgTW9uZ29EQidzIHRleHQgc2VhcmNoIG9yIGNvbXBsZXggZmlsdGVyaW5nXHJcbi8vIGV4cG9ydCBjb25zdCBzZWFyY2hQcm9tcHRzID0gYXN5bmMgKHF1ZXJ5LCBvcHRpb25zID0ge30pID0+IHsgLi4uIH07XHJcblxyXG4vLyAtLS0gQ29sbGVjdGlvbiBGdW5jdGlvbnMgLS0tXHJcblxyXG5leHBvcnQgY29uc3QgZ2V0QWxsQ29sbGVjdGlvbnMgPSBhc3luYyAoZmlsdGVyID0ge30sIG9wdGlvbnMgPSB7fSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGNvbGxlY3Rpb25zIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgY29uc3QgY3Vyc29yID0gY29sbGVjdGlvbnMuZmluZChmaWx0ZXIpO1xyXG4gICAgaWYgKG9wdGlvbnMuc29ydCkgY3Vyc29yLnNvcnQob3B0aW9ucy5zb3J0KTtcclxuICAgIGlmIChvcHRpb25zLmxpbWl0KSBjdXJzb3IubGltaXQob3B0aW9ucy5saW1pdCk7XHJcbiAgICBpZiAob3B0aW9ucy5za2lwKSBjdXJzb3Iuc2tpcChvcHRpb25zLnNraXApO1xyXG4gICAgY29uc3QgYWxsQ29sbGVjdGlvbnMgPSBhd2FpdCBjdXJzb3IudG9BcnJheSgpO1xyXG4gICAgcmV0dXJuIGFsbENvbGxlY3Rpb25zO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWxsIGNvbGxlY3Rpb25zOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBmZXRjaGluZyBjb2xsZWN0aW9ucy5cIik7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGdldENvbGxlY3Rpb25CeUlkID0gYXN5bmMgKGlkKSA9PiB7XHJcbiAgY29uc3Qgb2JqZWN0SWQgPSB0b09iamVjdElkKGlkKTtcclxuICBpZiAoIW9iamVjdElkKSByZXR1cm4gbnVsbDtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBjb2xsZWN0aW9ucyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICAgIC8vIE9wdGlvbmFsbHkgdXNlIGFnZ3JlZ2F0aW9uIHRvIHBvcHVsYXRlIHByb21wdHMgaWYgbmVlZGVkIGltbWVkaWF0ZWx5XHJcbiAgICBjb25zdCBjb2xsZWN0aW9uID0gYXdhaXQgY29sbGVjdGlvbnMuZmluZE9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XHJcbiAgICByZXR1cm4gY29sbGVjdGlvbjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbGxlY3Rpb24gYnkgSUQ6XCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGZldGNoaW5nIGNvbGxlY3Rpb24uXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVDb2xsZWN0aW9uID0gYXN5bmMgKGNvbGxlY3Rpb25EYXRhKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgY29sbGVjdGlvbnMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgY29uc3QgbmV3Q29sbGVjdGlvbiA9IHtcclxuICAgICAgbmFtZTogY29sbGVjdGlvbkRhdGEubmFtZSxcclxuICAgICAgZGVzY3JpcHRpb246IGNvbGxlY3Rpb25EYXRhLmRlc2NyaXB0aW9uIHx8ICcnLFxyXG4gICAgICB1c2VySWQ6IGNvbGxlY3Rpb25EYXRhLnVzZXJJZCwgLy8gRnJvbSBzZXNzaW9uXHJcbiAgICAgIHByb21wdHM6IFtdLCAvLyBTdG9yZSBwcm9tcHQgT2JqZWN0SWRzIGhlcmVcclxuICAgICAgY3JlYXRlZEF0OiBub3csXHJcbiAgICAgIHVwZGF0ZWRBdDogbm93LFxyXG4gICAgfTtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbGxlY3Rpb25zLmluc2VydE9uZShuZXdDb2xsZWN0aW9uKTtcclxuICAgIHJldHVybiB7IC4uLm5ld0NvbGxlY3Rpb24sIF9pZDogcmVzdWx0Lmluc2VydGVkSWQgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIGNvbGxlY3Rpb246XCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGNyZWF0aW5nIGNvbGxlY3Rpb24uXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCB1cGRhdGVDb2xsZWN0aW9uID0gYXN5bmMgKGlkLCBjb2xsZWN0aW9uRGF0YSkgPT4ge1xyXG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XHJcbiAgaWYgKCFvYmplY3RJZCkgcmV0dXJuIG51bGw7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGNvbGxlY3Rpb25zIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgY29uc3QgdXBkYXRlRG9jID0geyAkc2V0OiB7fSB9O1xyXG4gICAgaWYgKGNvbGxlY3Rpb25EYXRhLm5hbWUgIT09IHVuZGVmaW5lZCkgdXBkYXRlRG9jLiRzZXQubmFtZSA9IGNvbGxlY3Rpb25EYXRhLm5hbWU7XHJcbiAgICBpZiAoY29sbGVjdGlvbkRhdGEuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkgdXBkYXRlRG9jLiRzZXQuZGVzY3JpcHRpb24gPSBjb2xsZWN0aW9uRGF0YS5kZXNjcmlwdGlvbjtcclxuICAgIC8vIE5vdGU6IE1hbmFnaW5nIHRoZSAncHJvbXB0cycgYXJyYXkgKGFkZC9yZW1vdmUpIHR5cGljYWxseSBkb25lIHZpYSBzZXBhcmF0ZSBmdW5jdGlvbnNcclxuICAgIHVwZGF0ZURvYy4kc2V0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XHJcblxyXG4gICAgaWYgKE9iamVjdC5rZXlzKHVwZGF0ZURvYy4kc2V0KS5sZW5ndGggPiAxKSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbGxlY3Rpb25zLnVwZGF0ZU9uZSh7IF9pZDogb2JqZWN0SWQgfSwgdXBkYXRlRG9jKTtcclxuICAgICAgaWYgKHJlc3VsdC5tYXRjaGVkQ291bnQgPT09IDApIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHVwZGF0ZWRDb2xsZWN0aW9uID0gYXdhaXQgY29sbGVjdGlvbnMuZmluZE9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XHJcbiAgICByZXR1cm4gdXBkYXRlZENvbGxlY3Rpb247XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyBjb2xsZWN0aW9uOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSB1cGRhdGluZyBjb2xsZWN0aW9uLlwiKTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZGVsZXRlQ29sbGVjdGlvbiA9IGFzeW5jIChpZCkgPT4ge1xyXG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XHJcbiAgaWYgKCFvYmplY3RJZCkgcmV0dXJuIGZhbHNlO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGNvbGxlY3Rpb25zIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29sbGVjdGlvbnMuZGVsZXRlT25lKHsgX2lkOiBvYmplY3RJZCB9KTtcclxuICAgIHJldHVybiByZXN1bHQuZGVsZXRlZENvdW50ID4gMDtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGRlbGV0aW5nIGNvbGxlY3Rpb246XCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGRlbGV0aW5nIGNvbGxlY3Rpb24uXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBhZGRQcm9tcHRUb0NvbGxlY3Rpb24gPSBhc3luYyAoY29sbGVjdGlvbklkLCBwcm9tcHRJZCkgPT4ge1xyXG4gIGNvbnN0IGNvbGxPYmplY3RJZCA9IHRvT2JqZWN0SWQoY29sbGVjdGlvbklkKTtcclxuICBjb25zdCBwcm9tcHRPYmplY3RJZCA9IHRvT2JqZWN0SWQocHJvbXB0SWQpO1xyXG4gIGlmICghY29sbE9iamVjdElkIHx8ICFwcm9tcHRPYmplY3RJZCkgcmV0dXJuIG51bGw7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGNvbGxlY3Rpb25zIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgLy8gVXNlICRhZGRUb1NldCB0byBhZGQgdGhlIHByb21wdCdzIE9iamVjdElkIHRvIHRoZSBhcnJheSBpZiBub3QgYWxyZWFkeSBwcmVzZW50XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb2xsZWN0aW9ucy51cGRhdGVPbmUoXHJcbiAgICAgIHsgX2lkOiBjb2xsT2JqZWN0SWQgfSxcclxuICAgICAgeyBcclxuICAgICAgICAkYWRkVG9TZXQ6IHsgcHJvbXB0czogcHJvbXB0T2JqZWN0SWQgfSxcclxuICAgICAgICAkc2V0OiB7IHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgICBpZiAocmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkgcmV0dXJuIG51bGw7IC8vIENvbGxlY3Rpb24gbm90IGZvdW5kXHJcbiAgICBcclxuICAgIGNvbnN0IHVwZGF0ZWRDb2xsZWN0aW9uID0gYXdhaXQgY29sbGVjdGlvbnMuZmluZE9uZSh7IF9pZDogY29sbE9iamVjdElkIH0pO1xyXG4gICAgcmV0dXJuIHVwZGF0ZWRDb2xsZWN0aW9uO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIHByb21wdCB0byBjb2xsZWN0aW9uOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBhZGRpbmcgcHJvbXB0IHRvIGNvbGxlY3Rpb24uXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCByZW1vdmVQcm9tcHRGcm9tQ29sbGVjdGlvbiA9IGFzeW5jIChjb2xsZWN0aW9uSWQsIHByb21wdElkKSA9PiB7XHJcbiAgY29uc3QgY29sbE9iamVjdElkID0gdG9PYmplY3RJZChjb2xsZWN0aW9uSWQpO1xyXG4gIGNvbnN0IHByb21wdE9iamVjdElkID0gdG9PYmplY3RJZChwcm9tcHRJZCk7XHJcbiAgaWYgKCFjb2xsT2JqZWN0SWQgfHwgIXByb21wdE9iamVjdElkKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgY29sbGVjdGlvbnMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XHJcbiAgICAvLyBVc2UgJHB1bGwgdG8gcmVtb3ZlIHRoZSBwcm9tcHQncyBPYmplY3RJZCBmcm9tIHRoZSBhcnJheVxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29sbGVjdGlvbnMudXBkYXRlT25lKFxyXG4gICAgICB7IF9pZDogY29sbE9iamVjdElkIH0sXHJcbiAgICAgIHsgXHJcbiAgICAgICAgJHB1bGw6IHsgcHJvbXB0czogcHJvbXB0T2JqZWN0SWQgfSxcclxuICAgICAgICAkc2V0OiB7IHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9IFxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgaWYgKHJlc3VsdC5tYXRjaGVkQ291bnQgPT09IDApIHJldHVybiBudWxsOyAvLyBDb2xsZWN0aW9uIG5vdCBmb3VuZFxyXG5cclxuICAgIGNvbnN0IHVwZGF0ZWRDb2xsZWN0aW9uID0gYXdhaXQgY29sbGVjdGlvbnMuZmluZE9uZSh7IF9pZDogY29sbE9iamVjdElkIH0pO1xyXG4gICAgcmV0dXJuIHVwZGF0ZWRDb2xsZWN0aW9uO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVtb3ZpbmcgcHJvbXB0IGZyb20gY29sbGVjdGlvbjpcIiwgZXJyb3IpO1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgcmVtb3ZpbmcgcHJvbXB0IGZyb20gY29sbGVjdGlvbi5cIik7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gLS0tIFVzZXIgRnVuY3Rpb25zIC0tLVxyXG4vLyBOb3RlOiBUaGVzZSBhcmUgYmFzaWMgaW1wbGVtZW50YXRpb25zLiBBdXRoZW50aWNhdGlvbiBsaWJyYXJpZXMgb2Z0ZW4gaGFuZGxlIHVzZXIgbWFuYWdlbWVudC5cclxuXHJcbmV4cG9ydCBjb25zdCBnZXRBbGxVc2VycyA9IGFzeW5jIChmaWx0ZXIgPSB7fSwgb3B0aW9ucyA9IHt9KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgdXNlcnMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XHJcbiAgICAvLyBFeGNsdWRlIHBhc3N3b3JkIGZpZWxkIGJ5IGRlZmF1bHRcclxuICAgIGNvbnN0IGN1cnNvciA9IHVzZXJzLmZpbmQoZmlsdGVyLCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KTsgXHJcbiAgICBpZiAob3B0aW9ucy5zb3J0KSBjdXJzb3Iuc29ydChvcHRpb25zLnNvcnQpO1xyXG4gICAgaWYgKG9wdGlvbnMubGltaXQpIGN1cnNvci5saW1pdChvcHRpb25zLmxpbWl0KTtcclxuICAgIGlmIChvcHRpb25zLnNraXApIGN1cnNvci5za2lwKG9wdGlvbnMuc2tpcCk7XHJcbiAgICBjb25zdCBhbGxVc2VycyA9IGF3YWl0IGN1cnNvci50b0FycmF5KCk7XHJcbiAgICByZXR1cm4gYWxsVXNlcnM7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBhbGwgdXNlcnM6XCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGZldGNoaW5nIHVzZXJzLlwiKTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0VXNlckJ5SWQgPSBhc3luYyAoaWQpID0+IHtcclxuICBjb25zdCBvYmplY3RJZCA9IHRvT2JqZWN0SWQoaWQpO1xyXG4gIGlmICghb2JqZWN0SWQpIHJldHVybiBudWxsO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHVzZXJzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBfaWQ6IG9iamVjdElkIH0sIHsgcHJvamVjdGlvbjogeyBwYXNzd29yZDogMCB9IH0pO1xyXG4gICAgcmV0dXJuIHVzZXI7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyB1c2VyIGJ5IElEOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBmZXRjaGluZyB1c2VyLlwiKTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0VXNlckJ5RW1haWwgPSBhc3luYyAoZW1haWwpID0+IHtcclxuICBpZiAoIWVtYWlsKSByZXR1cm4gbnVsbDtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB1c2VycyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICAgIC8vIEZpbmQgdXNlciBieSBlbWFpbCwgYnV0IERPIGluY2x1ZGUgcGFzc3dvcmQgZm9yIGF1dGhlbnRpY2F0aW9uIGNoZWNrc1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcclxuICAgIHJldHVybiB1c2VyOyBcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHVzZXIgYnkgZW1haWw6XCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGZldGNoaW5nIHVzZXIuXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVVc2VyID0gYXN5bmMgKHVzZXJEYXRhKSA9PiB7XHJcbiAgaWYgKCF1c2VyRGF0YS5lbWFpbCB8fCAhdXNlckRhdGEucGFzc3dvcmQpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkVtYWlsIGFuZCBwYXNzd29yZCBhcmUgcmVxdWlyZWQgdG8gY3JlYXRlIGEgdXNlci5cIik7XHJcbiAgfVxyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHVzZXJzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcclxuICAgIFxyXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBhbHJlYWR5IGV4aXN0c1xyXG4gICAgY29uc3QgZXhpc3RpbmdVc2VyID0gYXdhaXQgdXNlcnMuZmluZE9uZSh7IGVtYWlsOiB1c2VyRGF0YS5lbWFpbC50b0xvd2VyQ2FzZSgpIH0pO1xyXG4gICAgaWYgKGV4aXN0aW5nVXNlcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVc2VyIHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEhhc2ggcGFzc3dvcmQgYmVmb3JlIHN0b3JpbmdcclxuICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgaGFzaFBhc3N3b3JkKHVzZXJEYXRhLnBhc3N3b3JkKTtcclxuICAgIFxyXG4gICAgY29uc3QgbmV3VXNlciA9IHtcclxuICAgICAgbmFtZTogdXNlckRhdGEubmFtZSB8fCAnJyxcclxuICAgICAgZW1haWw6IHVzZXJEYXRhLmVtYWlsLnRvTG93ZXJDYXNlKCksXHJcbiAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcclxuICAgICAgaW1hZ2U6IHVzZXJEYXRhLmltYWdlIHx8IG51bGwsXHJcbiAgICAgIC8vIEFkZCByb2xlcyBvciBvdGhlciBmaWVsZHMgYXMgbmVlZGVkXHJcbiAgICAgIGNyZWF0ZWRBdDogbm93LFxyXG4gICAgICB1cGRhdGVkQXQ6IG5vdyxcclxuICAgIH07XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2Vycy5pbnNlcnRPbmUobmV3VXNlcik7XHJcbiAgICAvLyBSZXR1cm4gdXNlciBkYXRhIHdpdGhvdXQgdGhlIHBhc3N3b3JkIGhhc2hcclxuICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLnVzZXJXaXRob3V0UGFzc3dvcmQgfSA9IG5ld1VzZXI7XHJcbiAgICByZXR1cm4geyAuLi51c2VyV2l0aG91dFBhc3N3b3JkLCBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH07XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgdXNlcjpcIiwgZXJyb3IpO1xyXG4gICAgLy8gUmV0aHJvdyBzcGVjaWZpYyBlcnJvcnMgb3IgYSBnZW5lcmljIG9uZVxyXG4gICAgaWYgKGVycm9yLm1lc3NhZ2UgPT09IFwiVXNlciB3aXRoIHRoaXMgZW1haWwgYWxyZWFkeSBleGlzdHMuXCIpIHtcclxuICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGNyZWF0aW5nIHVzZXIuXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCB1cGRhdGVVc2VyID0gYXN5bmMgKGlkLCB1c2VyRGF0YSkgPT4ge1xyXG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XHJcbiAgaWYgKCFvYmplY3RJZCkgcmV0dXJuIG51bGw7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHVzZXJzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgY29uc3QgdXBkYXRlRG9jID0geyAkc2V0OiB7fSB9O1xyXG5cclxuICAgIGlmICh1c2VyRGF0YS5uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURvYy4kc2V0Lm5hbWUgPSB1c2VyRGF0YS5uYW1lO1xyXG4gICAgaWYgKHVzZXJEYXRhLmltYWdlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURvYy4kc2V0LmltYWdlID0gdXNlckRhdGEuaW1hZ2U7XHJcbiAgICAvLyBBZGQgb3RoZXIgdXBkYXRhYmxlIGZpZWxkcyAoZS5nLiwgcm9sZXMpXHJcbiAgICBcclxuICAgIC8vIEhhbmRsZSBlbWFpbCBjaGFuZ2UgY2FyZWZ1bGx5XHJcbiAgICBpZiAodXNlckRhdGEuZW1haWwgJiYgdHlwZW9mIHVzZXJEYXRhLmVtYWlsID09PSAnc3RyaW5nJykge1xyXG4gICAgICBjb25zdCBuZXdFbWFpbCA9IHVzZXJEYXRhLmVtYWlsLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBlbWFpbDogbmV3RW1haWwgfSk7XHJcbiAgICAgIC8vIEFsbG93IHVwZGF0ZSBvbmx5IGlmIGVtYWlsIGRvZXNuJ3QgZXhpc3QgT1IgYmVsb25ncyB0byB0aGUgY3VycmVudCB1c2VyXHJcbiAgICAgIGlmIChleGlzdGluZ1VzZXIgJiYgIWV4aXN0aW5nVXNlci5faWQuZXF1YWxzKG9iamVjdElkKSkge1xyXG4gICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbWFpbCBhZGRyZXNzIGlzIGFscmVhZHkgaW4gdXNlLlwiKTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVEb2MuJHNldC5lbWFpbCA9IG5ld0VtYWlsO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBEbyBub3QgYWxsb3cgcGFzc3dvcmQgdXBkYXRlIHRocm91Z2ggdGhpcyBnZW5lcmFsIGZ1bmN0aW9uXHJcbiAgICAvLyBDcmVhdGUgYSBzcGVjaWZpYyBjaGFuZ2VQYXNzd29yZCBmdW5jdGlvbiBpZiBuZWVkZWRcclxuXHJcbiAgICB1cGRhdGVEb2MuJHNldC51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgIGlmIChPYmplY3Qua2V5cyh1cGRhdGVEb2MuJHNldCkubGVuZ3RoID4gMSkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2Vycy51cGRhdGVPbmUoeyBfaWQ6IG9iamVjdElkIH0sIHVwZGF0ZURvYyk7XHJcbiAgICAgIGlmIChyZXN1bHQubWF0Y2hlZENvdW50ID09PSAwKSByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1cGRhdGVkVXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBfaWQ6IG9iamVjdElkIH0sIHsgcHJvamVjdGlvbjogeyBwYXNzd29yZDogMCB9IH0pO1xyXG4gICAgcmV0dXJuIHVwZGF0ZWRVc2VyO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVwZGF0aW5nIHVzZXI6XCIsIGVycm9yKTtcclxuICAgICBpZiAoZXJyb3IubWVzc2FnZSA9PT0gXCJFbWFpbCBhZGRyZXNzIGlzIGFscmVhZHkgaW4gdXNlLlwiKSB7XHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSB1cGRhdGluZyB1c2VyLlwiKTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZGVsZXRlVXNlciA9IGFzeW5jIChpZCkgPT4ge1xyXG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XHJcbiAgaWYgKCFvYmplY3RJZCkgcmV0dXJuIGZhbHNlO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHVzZXJzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgLy8gVE9ETzogSGFuZGxlIHJlbGF0ZWQgZGF0YSBjbGVhbnVwIChlLmcuLCByZWFzc2lnbiBwcm9tcHRzPylcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJzLmRlbGV0ZU9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XHJcbiAgICByZXR1cm4gcmVzdWx0LmRlbGV0ZWRDb3VudCA+IDA7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyB1c2VyOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBkZWxldGluZyB1c2VyLlwiKTtcclxuICB9XHJcbn07XHJcblxyXG5cclxuLy8gLS0tIFRlYW0gRnVuY3Rpb25zIChhbHJlYWR5IHJlZmFjdG9yZWQpIC0tLVxyXG5cclxuZXhwb3J0IGNvbnN0IGdldFRlYW1CeUlkID0gYXN5bmMgKGlkKSA9PiB7XHJcbiAgY29uc3Qgb2JqZWN0SWQgPSB0b09iamVjdElkKGlkKTtcclxuICBpZiAoIW9iamVjdElkKSByZXR1cm4gbnVsbDsgLy8gSW52YWxpZCBJRCBmb3JtYXRcclxuICBcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB0ZWFtcyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICAgIC8vIEZldGNoIHRlYW0gYW5kIHBvdGVudGlhbGx5IHBvcHVsYXRlIG1lbWJlciBkZXRhaWxzIGlmIG5lZWRlZCBsYXRlclxyXG4gICAgY29uc3QgdGVhbSA9IGF3YWl0IHRlYW1zLmZpbmRPbmUoeyBfaWQ6IG9iamVjdElkIH0pO1xyXG4gICAgXHJcbiAgICAvLyBPcHRpb25hbGx5IGNvbnZlcnQgbWVtYmVyIHVzZXJJZHMgYmFjayB0byBzdHJpbmcgaWYgbmVlZGVkIGZvciBmcm9udGVuZFxyXG4gICAgLy8gaWYgKHRlYW0gJiYgdGVhbS5tZW1iZXJzKSB7XHJcbiAgICAvLyAgIHRlYW0ubWVtYmVycyA9IHRlYW0ubWVtYmVycy5tYXAobWVtYmVyID0+ICh7IC4uLm1lbWJlciwgdXNlcklkOiBtZW1iZXIudXNlcklkLnRvU3RyaW5nKCkgfSkpO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gQ29udmVydCBtYWluIF9pZCB0byBzdHJpbmdcclxuICAgIC8vIGlmICh0ZWFtKSB0ZWFtLl9pZCA9IHRlYW0uX2lkLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgcmV0dXJuIHRlYW07IC8vIFJldHVybnMgdGhlIHRlYW0gZG9jdW1lbnQgb3IgbnVsbCBpZiBub3QgZm91bmRcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHRlYW0gYnkgSUQ6XCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGZldGNoaW5nIHRlYW0uXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRUZWFtc0J5VXNlcklkID0gYXN5bmMgKHVzZXJJZCkgPT4ge1xyXG4gIC8vIEVuc3VyZSB1c2VySWQgaXMgdHJlYXRlZCBhcyBhIHN0cmluZyBmb3IgbWF0Y2hpbmcgdW5sZXNzIGl0J3MgY2xlYXJseSBhbiBPYmplY3RJZFxyXG4gIGNvbnN0IHVzZXJJZFN0cmluZyA9IHVzZXJJZC50b1N0cmluZygpOyBcclxuICBjb25zdCB1c2VyT2JqZWN0SWQgPSB0b09iamVjdElkKHVzZXJJZCk7IC8vIEF0dGVtcHQgY29udmVyc2lvblxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB0ZWFtcyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICAgIC8vIEZpbmQgdGVhbXMgd2hlcmUgdGhlIHVzZXIgaXMgdGhlIG93bmVyICh1c2VySWQgZmllbGQpXHJcbiAgICAvLyBPUiB0aGUgdXNlciBpcyBpbiB0aGUgbWVtYmVycyBhcnJheSAoYXNzdW1pbmcgbWVtYmVyLnVzZXJJZCBpcyBzdG9yZWQgYXMgc3RyaW5nKVxyXG4gICAgY29uc3QgcXVlcnkgPSB7XHJcbiAgICAgICdtZW1iZXJzLnVzZXJJZCc6IHVzZXJJZFN0cmluZ1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBJZiB0aGUgb3JpZ2luYWwgdXNlcklkIHdhcyAqYWxzbyogdGhlIG93bmVySWQgZmllbGQsIGFkZCB0aGF0IGNoZWNrXHJcbiAgICAvLyBUaGlzIGRlcGVuZHMgb24gaG93IG93bmVyIGB1c2VySWRgIGlzIHN0b3JlZCAoc3RyaW5nIHZzIE9iamVjdElkKVxyXG4gICAgLy8gTGV0J3MgYXNzdW1lIG93bmVyIGB1c2VySWRgIG1pZ2h0IG1hdGNoIHRoZSBzdHJpbmcgSUQgZnJvbSBzZXNzaW9uXHJcbiAgICBjb25zdCBvd25lclF1ZXJ5ID0geyB1c2VySWQ6IHVzZXJJZFN0cmluZyB9O1xyXG5cclxuICAgIC8vIENvbWJpbmUgcXVlcmllc1xyXG4gICAgY29uc3QgZmluYWxRdWVyeSA9IHtcclxuICAgICAgJG9yOiBbXHJcbiAgICAgICAgIHF1ZXJ5LFxyXG4gICAgICAgICBvd25lclF1ZXJ5XHJcbiAgICAgICBdXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBJZiB0aGUgdXNlcklkICp3YXMqIGEgdmFsaWQgT2JqZWN0SWQsIGFsc28gY2hlY2sgZm9yIE9iamVjdElkIG1hdGNoZXMgXHJcbiAgICAvLyAoaW4gY2FzZSBzb21lIElEcyBhcmUgc3RvcmVkIGFzIE9iamVjdElkcylcclxuICAgIGlmICh1c2VyT2JqZWN0SWQpIHtcclxuICAgICAgIGZpbmFsUXVlcnkuJG9yLnB1c2goeyAnbWVtYmVycy51c2VySWQnOiB1c2VyT2JqZWN0SWQgfSk7XHJcbiAgICAgICBmaW5hbFF1ZXJ5LiRvci5wdXNoKHsgdXNlcklkOiB1c2VyT2JqZWN0SWQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXNlclRlYW1zID0gYXdhaXQgdGVhbXMuZmluZChmaW5hbFF1ZXJ5KS50b0FycmF5KCk7XHJcbiAgICByZXR1cm4gdXNlclRlYW1zO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgdGVhbXMgYnkgdXNlciBJRDpcIiwgZXJyb3IpO1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgdXNlcidzIHRlYW1zLlwiKTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgY3JlYXRlVGVhbSA9IGFzeW5jICh0ZWFtRGF0YSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHRlYW1zLCB1c2VycyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XHJcbiAgICBjb25zdCBvd25lclVzZXJJZCA9IHRlYW1EYXRhLnVzZXJJZDsgLy8gQXNzdW1lIHRoaXMgaXMgdGhlIHN0cmluZyBJRCBmcm9tIHNlc3Npb25cclxuXHJcbiAgICAvLyBGZXRjaCBvd25lcidzIG5hbWVcclxuICAgIGxldCBvd25lck5hbWUgPSAnT3duZXInOyAvLyBEZWZhdWx0XHJcbiAgICBjb25zdCBvd25lclVzZXIgPSBhd2FpdCB1c2Vycy5maW5kT25lKHsgX2lkOiB0b09iamVjdElkKG93bmVyVXNlcklkKSB9ICwgeyBwcm9qZWN0aW9uOiB7IG5hbWU6IDEgfSB9KTtcclxuICAgIGlmIChvd25lclVzZXIgJiYgb3duZXJVc2VyLm5hbWUpIHtcclxuICAgICAgICBvd25lck5hbWUgPSBvd25lclVzZXIubmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBuZXdUZWFtID0ge1xyXG4gICAgICBuYW1lOiB0ZWFtRGF0YS5uYW1lLFxyXG4gICAgICBkZXNjcmlwdGlvbjogdGVhbURhdGEuZGVzY3JpcHRpb24gfHwgJycsXHJcbiAgICAgIHVzZXJJZDogb3duZXJVc2VySWQsIC8vIFN0b3JlIHRoZSBvd25lcidzIElEIChzdHJpbmcgb3IgT2JqZWN0SWQgY29uc2lzdGVudGx5KVxyXG4gICAgICBtZW1iZXJzOiBbXSwgLy8gSW5pdGlhbGl6ZSBtZW1iZXJzXHJcbiAgICAgIGNyZWF0ZWRBdDogbm93LFxyXG4gICAgICB1cGRhdGVkQXQ6IG5vdyxcclxuICAgIH07XHJcblxyXG4gICAgLy8gQWRkIGNyZWF0b3IgYXMgdGhlIG93bmVyXHJcbiAgICBuZXdUZWFtLm1lbWJlcnMucHVzaCh7XHJcbiAgICAgICAgdXNlcklkOiBvd25lclVzZXJJZCwgLy8gU3RvcmUgY29uc2lzdGVudGx5IChlLmcuLCBzdHJpbmcgSUQgZnJvbSBzZXNzaW9uKVxyXG4gICAgICAgIHJvbGU6ICdvd25lcicsXHJcbiAgICAgICAgam9pbmVkQXQ6IG5vdyxcclxuICAgICAgICBuYW1lOiBvd25lck5hbWUgLy8gQWRkIG93bmVyJ3MgbmFtZVxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlYW1zLmluc2VydE9uZShuZXdUZWFtKTtcclxuICAgIHJldHVybiB7IC4uLm5ld1RlYW0sIF9pZDogcmVzdWx0Lmluc2VydGVkSWQgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIHRlYW06XCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGNyZWF0aW5nIHRlYW0uXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCB1cGRhdGVUZWFtID0gYXN5bmMgKGlkLCB0ZWFtRGF0YSkgPT4ge1xyXG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XHJcbiAgaWYgKCFvYmplY3RJZCkgcmV0dXJuIG51bGw7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHRlYW1zIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgY29uc3QgdXBkYXRlRG9jID0geyAkc2V0OiB7fSB9O1xyXG4gICAgaWYgKHRlYW1EYXRhLm5hbWUgIT09IHVuZGVmaW5lZCkgdXBkYXRlRG9jLiRzZXQubmFtZSA9IHRlYW1EYXRhLm5hbWU7XHJcbiAgICBpZiAodGVhbURhdGEuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkgdXBkYXRlRG9jLiRzZXQuZGVzY3JpcHRpb24gPSB0ZWFtRGF0YS5kZXNjcmlwdGlvbjtcclxuICAgIHVwZGF0ZURvYy4kc2V0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XHJcblxyXG4gICAgaWYgKE9iamVjdC5rZXlzKHVwZGF0ZURvYy4kc2V0KS5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGVhbXMudXBkYXRlT25lKHsgX2lkOiBvYmplY3RJZCB9LCB1cGRhdGVEb2MpO1xyXG4gICAgICAgIGlmIChyZXN1bHQubWF0Y2hlZENvdW50ID09PSAwKSByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1cGRhdGVkVGVhbSA9IGF3YWl0IHRlYW1zLmZpbmRPbmUoeyBfaWQ6IG9iamVjdElkIH0pO1xyXG4gICAgcmV0dXJuIHVwZGF0ZWRUZWFtO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgdGVhbTpcIiwgZXJyb3IpO1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgdXBkYXRpbmcgdGVhbS5cIik7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGRlbGV0ZVRlYW0gPSBhc3luYyAoaWQpID0+IHtcclxuICBjb25zdCBvYmplY3RJZCA9IHRvT2JqZWN0SWQoaWQpO1xyXG4gIGlmICghb2JqZWN0SWQpIHJldHVybiBmYWxzZTtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB0ZWFtcyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICAgIC8vIFRPRE86IEhhbmRsZSByZWxhdGVkIGRhdGEgY2xlYW51cCAoZS5nLiwgcHJvbXB0cyBiZWxvbmdpbmcgdG8gdGVhbT8pXHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0ZWFtcy5kZWxldGVPbmUoeyBfaWQ6IG9iamVjdElkIH0pO1xyXG4gICAgcmV0dXJuIHJlc3VsdC5kZWxldGVkQ291bnQgPiAwO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZGVsZXRpbmcgdGVhbTpcIiwgZXJyb3IpO1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgZGVsZXRpbmcgdGVhbS5cIik7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGFkZFRlYW1NZW1iZXIgPSBhc3luYyAodGVhbUlkLCBtZW1iZXJEYXRhKSA9PiB7XHJcbiAgY29uc3QgdGVhbU9iamVjdElkID0gdG9PYmplY3RJZCh0ZWFtSWQpO1xyXG4gIGlmICghdGVhbU9iamVjdElkKSByZXR1cm4gbnVsbDtcclxuICBpZiAoIW1lbWJlckRhdGEgfHwgIW1lbWJlckRhdGEudXNlcklkKSB0aHJvdyBuZXcgRXJyb3IoXCJNZW1iZXIgdXNlciBJRCBpcyByZXF1aXJlZC5cIik7XHJcblxyXG4gIGNvbnN0IG1lbWJlclVzZXJJZCA9IG1lbWJlckRhdGEudXNlcklkOyAvLyBBc3N1bWUgc3RyaW5nIElEIGZyb20gcmVxdWVzdFxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB0ZWFtcywgdXNlcnMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgIC8vIEZldGNoIG1lbWJlcidzIG5hbWVcclxuICAgIGxldCBtZW1iZXJOYW1lID0gJ01lbWJlcic7IC8vIERlZmF1bHRcclxuICAgIGNvbnN0IG1lbWJlclVzZXIgPSBhd2FpdCB1c2Vycy5maW5kT25lKHsgX2lkOiB0b09iamVjdElkKG1lbWJlclVzZXJJZCkgfSwgeyBwcm9qZWN0aW9uOiB7IG5hbWU6IDEgfSB9KTtcclxuICAgICBpZiAobWVtYmVyVXNlciAmJiBtZW1iZXJVc2VyLm5hbWUpIHtcclxuICAgICAgICBtZW1iZXJOYW1lID0gbWVtYmVyVXNlci5uYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG1lbWJlclJlY29yZCA9IHtcclxuICAgICAgdXNlcklkOiBtZW1iZXJVc2VySWQsIC8vIFN0b3JlIGNvbnNpc3RlbnRseSBhcyBzdHJpbmdcclxuICAgICAgcm9sZTogbWVtYmVyRGF0YS5yb2xlIHx8ICdtZW1iZXInLFxyXG4gICAgICBqb2luZWRBdDogbm93LFxyXG4gICAgICBuYW1lOiBtZW1iZXJOYW1lIC8vIEFkZCBtZW1iZXIncyBuYW1lXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgYWxyZWFkeSBhIG1lbWJlciAodXNpbmcgdGhlIHN0cmluZyBJRClcclxuICAgIGNvbnN0IHRlYW0gPSBhd2FpdCB0ZWFtcy5maW5kT25lKHsgX2lkOiB0ZWFtT2JqZWN0SWQsICdtZW1iZXJzLnVzZXJJZCc6IG1lbWJlclVzZXJJZCB9KTtcclxuICAgIGlmICh0ZWFtKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJVc2VyIGlzIGFscmVhZHkgYSBtZW1iZXIgb2YgdGhpcyB0ZWFtLlwiKTtcclxuICAgICAgICByZXR1cm4gdGVhbTsgLy8gQWxyZWFkeSBhIG1lbWJlclxyXG4gICAgfVxyXG5cclxuICAgIC8vIFVzZSAkYWRkVG9TZXQgKG9yICRwdXNoIGlmIGR1cGxpY2F0ZXMgYXJlIGltcG9zc2libGUvdW5kZXNpcmVkKVxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGVhbXMudXBkYXRlT25lKFxyXG4gICAgICB7IF9pZDogdGVhbU9iamVjdElkIH0sXHJcbiAgICAgIHsgXHJcbiAgICAgICAgJHB1c2g6IHsgbWVtYmVyczogbWVtYmVyUmVjb3JkIH0sIC8vIFVzZSAkcHVzaCBzaW5jZSB3ZSBjaGVja2VkIGV4aXN0ZW5jZVxyXG4gICAgICAgICRzZXQ6IHsgdXBkYXRlZEF0OiBub3cgfSBcclxuICAgICAgfVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAocmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkgcmV0dXJuIG51bGw7XHJcbiAgICBcclxuICAgIGNvbnN0IHVwZGF0ZWRUZWFtID0gYXdhaXQgdGVhbXMuZmluZE9uZSh7IF9pZDogdGVhbU9iamVjdElkIH0pO1xyXG4gICAgcmV0dXJuIHVwZGF0ZWRUZWFtO1xyXG4gICAgXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhZGRpbmcgdGVhbSBtZW1iZXI6XCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGFkZGluZyB0ZWFtIG1lbWJlci5cIik7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHJlbW92ZVRlYW1NZW1iZXIgPSBhc3luYyAodGVhbUlkLCB1c2VySWRUb1JlbW92ZSkgPT4ge1xyXG4gIGNvbnN0IHRlYW1PYmplY3RJZCA9IHRvT2JqZWN0SWQodGVhbUlkKTtcclxuICBpZiAoIXRlYW1PYmplY3RJZCkgcmV0dXJuIG51bGw7XHJcbiAgaWYgKCF1c2VySWRUb1JlbW92ZSkgdGhyb3cgbmV3IEVycm9yKFwiVXNlciBJRCB0byByZW1vdmUgaXMgcmVxdWlyZWQuXCIpO1xyXG5cclxuICBjb25zdCBtZW1iZXJVc2VySWRTdHJpbmcgPSB1c2VySWRUb1JlbW92ZS50b1N0cmluZygpO1xyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB0ZWFtcyB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XHJcblxyXG4gICAgLy8gRmluZCB0aGUgdGVhbSBmaXJzdCB0byBjaGVjayBpZiB0aGUgdXNlciBiZWluZyByZW1vdmVkIGlzIHRoZSBvd25lclxyXG4gICAgY29uc3QgdGVhbSA9IGF3YWl0IHRlYW1zLmZpbmRPbmUoeyBfaWQ6IHRlYW1PYmplY3RJZCB9KTtcclxuICAgIGlmICghdGVhbSkgcmV0dXJuIG51bGw7IC8vIFRlYW0gbm90IGZvdW5kXHJcblxyXG4gICAgY29uc3QgbWVtYmVyVG9SZW1vdmUgPSB0ZWFtLm1lbWJlcnMuZmluZChtID0+IG0udXNlcklkID09PSBtZW1iZXJVc2VySWRTdHJpbmcpO1xyXG4gICAgaWYgKCFtZW1iZXJUb1JlbW92ZSkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiTWVtYmVyIG5vdCBmb3VuZCBpbiB0ZWFtLlwiKTtcclxuICAgICAgICByZXR1cm4gdGVhbTsgLy8gTWVtYmVyIG5vdCBmb3VuZCwgcmV0dXJuIGN1cnJlbnQgdGVhbSBzdGF0ZVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFByZXZlbnQgcmVtb3ZpbmcgdGhlIG93bmVyXHJcbiAgICBpZiAobWVtYmVyVG9SZW1vdmUucm9sZSA9PT0gJ293bmVyJykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCByZW1vdmUgdGhlIHRlYW0gb3duZXIuXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVzZSAkcHVsbCB0byByZW1vdmUgdGhlIG1lbWJlciBieSB1c2VySWQgKHN0cmluZyBtYXRjaClcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlYW1zLnVwZGF0ZU9uZShcclxuICAgICAgeyBfaWQ6IHRlYW1PYmplY3RJZCB9LFxyXG4gICAgICB7IFxyXG4gICAgICAgICRwdWxsOiB7IG1lbWJlcnM6IHsgdXNlcklkOiBtZW1iZXJVc2VySWRTdHJpbmcgfSB9LCBcclxuICAgICAgICAkc2V0OiB7IHVwZGF0ZWRBdDogbm93IH1cclxuICAgICAgfVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDApIHtcclxuICAgICAgLy8gU2hvdWxkIG5vdCBoYXBwZW4gaWYgbWVtYmVyIHdhcyBmb3VuZCwgYnV0IGhhbmRsZSBncmFjZWZ1bGx5XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiUHVsbCBvcGVyYXRpb24gZGlkIG5vdCBtb2RpZnkgdGhlIGRvY3VtZW50LlwiKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1cGRhdGVkVGVhbSA9IGF3YWl0IHRlYW1zLmZpbmRPbmUoeyBfaWQ6IHRlYW1PYmplY3RJZCB9KTtcclxuICAgIHJldHVybiB1cGRhdGVkVGVhbTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZW1vdmluZyB0ZWFtIG1lbWJlcjpcIiwgZXJyb3IpO1xyXG4gICAgaWYgKGVycm9yLm1lc3NhZ2UgPT09IFwiQ2Fubm90IHJlbW92ZSB0aGUgdGVhbSBvd25lci5cIikge1xyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgcmVtb3ZpbmcgdGVhbSBtZW1iZXIuXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIFRPRE86IEltcGxlbWVudCB1cGRhdGVUZWFtTWVtYmVyIHJvbGUgaWYgbmVlZGVkXHJcblxyXG4vLyAtLS0gQ29tbWVudCBGdW5jdGlvbnMgLS0tXHJcblxyXG5leHBvcnQgY29uc3QgZ2V0Q29tbWVudHNCeVByb21wdElkID0gYXN5bmMgKHByb21wdElkKSA9PiB7XHJcbiAgY29uc3QgcHJvbXB0T2JqZWN0SWQgPSB0b09iamVjdElkKHByb21wdElkKTtcclxuICBpZiAoIXByb21wdE9iamVjdElkKSByZXR1cm4gW107XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgY29tbWVudHMgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XHJcbiAgICAvLyBGZXRjaCBjb21tZW50cyBhbmQgc29ydCBieSBjcmVhdGlvbiBkYXRlIChuZXdlc3QgZmlyc3QpXHJcbiAgICBjb25zdCBwcm9tcHRDb21tZW50cyA9IGF3YWl0IGNvbW1lbnRzLmZpbmQoeyBwcm9tcHRJZDogcHJvbXB0T2JqZWN0SWQgfSkuc29ydCh7IGNyZWF0ZWRBdDogLTEgfSkudG9BcnJheSgpO1xyXG4gICAgcmV0dXJuIHByb21wdENvbW1lbnRzO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgY29tbWVudHMgYnkgcHJvbXB0IElEOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSBmZXRjaGluZyBjb21tZW50cy5cIik7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNvbW1lbnQgPSBhc3luYyAoY29tbWVudERhdGEpID0+IHtcclxuICBpZiAoIWNvbW1lbnREYXRhLnByb21wdElkIHx8ICFjb21tZW50RGF0YS51c2VySWQgfHwgIWNvbW1lbnREYXRhLmNvbnRlbnQpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIlByb21wdCBJRCwgVXNlciBJRCwgYW5kIGNvbnRlbnQgYXJlIHJlcXVpcmVkIGZvciBjb21tZW50cy5cIik7XHJcbiAgfVxyXG4gIGNvbnN0IHByb21wdE9iamVjdElkID0gdG9PYmplY3RJZChjb21tZW50RGF0YS5wcm9tcHRJZCk7XHJcbiAgLy8gQXNzdW1pbmcgdXNlcklkIGlzIHBhc3NlZCBhcyBzdHJpbmcgZnJvbSBzZXNzaW9uXHJcbiAgY29uc3QgdXNlcklkU3RyaW5nID0gY29tbWVudERhdGEudXNlcklkLnRvU3RyaW5nKCk7IFxyXG5cclxuICBpZiAoIXByb21wdE9iamVjdElkKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIFByb21wdCBJRCBmb3JtYXQgZm9yIGNvbW1lbnQuXCIpO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgY29tbWVudHMsIHVzZXJzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcclxuXHJcbiAgICAvLyBGZXRjaCBjb21tZW50ZXIncyBuYW1lXHJcbiAgICBsZXQgY3JlYXRlZEJ5TmFtZSA9ICdVc2VyJzsgLy8gRGVmYXVsdFxyXG4gICAgY29uc3QgY29tbWVudGVyVXNlciA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoeyBfaWQ6IHRvT2JqZWN0SWQodXNlcklkU3RyaW5nKSB9LCB7IHByb2plY3Rpb246IHsgbmFtZTogMSB9IH0pO1xyXG4gICAgaWYgKGNvbW1lbnRlclVzZXIgJiYgY29tbWVudGVyVXNlci5uYW1lKSB7XHJcbiAgICAgICAgY3JlYXRlZEJ5TmFtZSA9IGNvbW1lbnRlclVzZXIubmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBuZXdDb21tZW50ID0ge1xyXG4gICAgICBwcm9tcHRJZDogcHJvbXB0T2JqZWN0SWQsXHJcbiAgICAgIHVzZXJJZDogdXNlcklkU3RyaW5nLCAvLyBTdG9yZSB1c2VySWQgY29uc2lzdGVudGx5IChlLmcuLCBzdHJpbmcpXHJcbiAgICAgIGNvbnRlbnQ6IGNvbW1lbnREYXRhLmNvbnRlbnQsXHJcbiAgICAgIGNyZWF0ZWRCeTogY3JlYXRlZEJ5TmFtZSwgLy8gU3RvcmUgY29tbWVudGVyJ3MgbmFtZVxyXG4gICAgICBjcmVhdGVkQXQ6IG5vdyxcclxuICAgICAgdXBkYXRlZEF0OiBub3csXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29tbWVudHMuaW5zZXJ0T25lKG5ld0NvbW1lbnQpO1xyXG4gICAgcmV0dXJuIHsgLi4ubmV3Q29tbWVudCwgX2lkOiByZXN1bHQuaW5zZXJ0ZWRJZCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgY29tbWVudDpcIiwgZXJyb3IpO1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3Igd2hpbGUgY3JlYXRpbmcgY29tbWVudC5cIik7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHVwZGF0ZUNvbW1lbnQgPSBhc3luYyAoaWQsIGNvbW1lbnREYXRhKSA9PiB7XHJcbiAgY29uc3Qgb2JqZWN0SWQgPSB0b09iamVjdElkKGlkKTtcclxuICBpZiAoIW9iamVjdElkKSByZXR1cm4gbnVsbDtcclxuICBpZiAoIWNvbW1lbnREYXRhLmNvbnRlbnQpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkNvbW1lbnQgY29udGVudCBpcyByZXF1aXJlZCBmb3IgdXBkYXRlLlwiKTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGNvbW1lbnRzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgY29uc3QgdXBkYXRlRG9jID0ge1xyXG4gICAgICAkc2V0OiB7XHJcbiAgICAgICAgY29udGVudDogY29tbWVudERhdGEuY29udGVudCxcclxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29tbWVudHMudXBkYXRlT25lKHsgX2lkOiBvYmplY3RJZCB9LCB1cGRhdGVEb2MpO1xyXG4gICAgaWYgKHJlc3VsdC5tYXRjaGVkQ291bnQgPT09IDApIHJldHVybiBudWxsO1xyXG5cclxuICAgIGNvbnN0IHVwZGF0ZWRDb21tZW50ID0gYXdhaXQgY29tbWVudHMuZmluZE9uZSh7IF9pZDogb2JqZWN0SWQgfSk7XHJcbiAgICByZXR1cm4gdXBkYXRlZENvbW1lbnQ7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyBjb21tZW50OlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvciB3aGlsZSB1cGRhdGluZyBjb21tZW50LlwiKTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZGVsZXRlQ29tbWVudCA9IGFzeW5jIChpZCkgPT4ge1xyXG4gIGNvbnN0IG9iamVjdElkID0gdG9PYmplY3RJZChpZCk7XHJcbiAgaWYgKCFvYmplY3RJZCkgcmV0dXJuIGZhbHNlO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGNvbW1lbnRzIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29tbWVudHMuZGVsZXRlT25lKHsgX2lkOiBvYmplY3RJZCB9KTtcclxuICAgIHJldHVybiByZXN1bHQuZGVsZXRlZENvdW50ID4gMDtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGRlbGV0aW5nIGNvbW1lbnQ6XCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yIHdoaWxlIGRlbGV0aW5nIGNvbW1lbnQuXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIFJlbW92ZSB0aGUgb2xkIGluLW1lbW9yeSBkYXRhIGFuZCBpbml0aWFsaXphdGlvbiBsb2dpY1xyXG4vKlxyXG5sZXQgcHJvbXB0cyA9IFtdO1xyXG5sZXQgY29sbGVjdGlvbnMgPSBbXTtcclxubGV0IHVzZXJzID0gW107XHJcbmxldCB0ZWFtcyA9IFtdO1xyXG5sZXQgY29tbWVudHMgPSBbXTtcclxubGV0IHByb21wdElkQ291bnRlciA9IDE7XHJcbmxldCBjb2xsZWN0aW9uSWRDb3VudGVyID0gMTtcclxubGV0IHVzZXJJZENvdW50ZXIgPSAxO1xyXG5sZXQgdGVhbUlkQ291bnRlciA9IDE7XHJcbmxldCBjb21tZW50SWRDb3VudGVyID0gMTtcclxuXHJcbi8vIEFsbCBvbGQgZnVuY3Rpb25zIGxpa2U6XHJcbmV4cG9ydCBjb25zdCBnZXRBbGxQcm9tcHRzID0gKCkgPT4geyAuLi4gfTtcclxuLy8gLi4uIGV0Yy5cclxuXHJcbi8vIEluaXRpYWxpemUgd2l0aCBzb21lIHNhbXBsZSBkYXRhIC0gaW4gcmVhbCBhcHAsIHRoaXMgd291bGQgYmUgbG9hZGVkIGZyb20gZGF0YWJhc2VcclxuZXhwb3J0IGNvbnN0IGluaXRpYWxpemVEYiA9IGFzeW5jICgpID0+IHsgLi4uIH07XHJcblxyXG4vLyBDYWxsIGluaXRpYWxpemUgd2hlbiBpbXBvcnRlZFxyXG4oYXN5bmMgKCkgPT4geyAuLi4gfSkoKTtcclxuKi9cclxuIl0sIm5hbWVzIjpbImNvbm5lY3RUb0RhdGFiYXNlIiwiT2JqZWN0SWQiLCJoYXNoUGFzc3dvcmQiLCJnZXRDb2xsZWN0aW9ucyIsImRiIiwidXNlcnMiLCJjb2xsZWN0aW9uIiwicHJvbXB0cyIsImNvbGxlY3Rpb25zIiwidGVhbXMiLCJjb21tZW50cyIsInRvT2JqZWN0SWQiLCJpZCIsImlzVmFsaWQiLCJlcnJvciIsImNvbnNvbGUiLCJnZXRBbGxQcm9tcHRzIiwiZmlsdGVyIiwib3B0aW9ucyIsImN1cnNvciIsImZpbmQiLCJzb3J0IiwiY3JlYXRlZEF0IiwibGltaXQiLCJza2lwIiwiYWxsUHJvbXB0cyIsInRvQXJyYXkiLCJFcnJvciIsImdldFByb21wdEJ5SWQiLCJvYmplY3RJZCIsInByb21wdCIsImZpbmRPbmUiLCJfaWQiLCJjcmVhdGVQcm9tcHQiLCJwcm9tcHREYXRhIiwibm93IiwiRGF0ZSIsIm5ld1Byb21wdCIsInRpdGxlIiwiY29udGVudCIsImRlc2NyaXB0aW9uIiwidGFncyIsImFpUGxhdGZvcm0iLCJyYXRpbmciLCJ1c2FnZUNvdW50Iiwic3VjY2Vzc1JhdGUiLCJ2aXNpYmlsaXR5IiwidXNlcklkIiwiY3JlYXRlZEJ5IiwidGVhbUlkIiwidXBkYXRlZEF0IiwicmVzdWx0IiwiaW5zZXJ0T25lIiwiaW5zZXJ0ZWRJZCIsInVwZGF0ZVByb21wdCIsInVwZGF0ZURvYyIsIiRzZXQiLCJrZXkiLCJ1bmRlZmluZWQiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwidXBkYXRlT25lIiwibWF0Y2hlZENvdW50IiwidXBkYXRlZFByb21wdCIsImRlbGV0ZVByb21wdCIsImRlbGV0ZU9uZSIsImRlbGV0ZWRDb3VudCIsImdldEFsbENvbGxlY3Rpb25zIiwiYWxsQ29sbGVjdGlvbnMiLCJnZXRDb2xsZWN0aW9uQnlJZCIsImNyZWF0ZUNvbGxlY3Rpb24iLCJjb2xsZWN0aW9uRGF0YSIsIm5ld0NvbGxlY3Rpb24iLCJuYW1lIiwidXBkYXRlQ29sbGVjdGlvbiIsInVwZGF0ZWRDb2xsZWN0aW9uIiwiZGVsZXRlQ29sbGVjdGlvbiIsImFkZFByb21wdFRvQ29sbGVjdGlvbiIsImNvbGxlY3Rpb25JZCIsInByb21wdElkIiwiY29sbE9iamVjdElkIiwicHJvbXB0T2JqZWN0SWQiLCIkYWRkVG9TZXQiLCJyZW1vdmVQcm9tcHRGcm9tQ29sbGVjdGlvbiIsIiRwdWxsIiwiZ2V0QWxsVXNlcnMiLCJwcm9qZWN0aW9uIiwicGFzc3dvcmQiLCJhbGxVc2VycyIsImdldFVzZXJCeUlkIiwidXNlciIsImdldFVzZXJCeUVtYWlsIiwiZW1haWwiLCJ0b0xvd2VyQ2FzZSIsImNyZWF0ZVVzZXIiLCJ1c2VyRGF0YSIsImV4aXN0aW5nVXNlciIsImhhc2hlZFBhc3N3b3JkIiwibmV3VXNlciIsImltYWdlIiwidXNlcldpdGhvdXRQYXNzd29yZCIsIm1lc3NhZ2UiLCJ1cGRhdGVVc2VyIiwibmV3RW1haWwiLCJlcXVhbHMiLCJ1cGRhdGVkVXNlciIsImRlbGV0ZVVzZXIiLCJnZXRUZWFtQnlJZCIsInRlYW0iLCJnZXRUZWFtc0J5VXNlcklkIiwidXNlcklkU3RyaW5nIiwidG9TdHJpbmciLCJ1c2VyT2JqZWN0SWQiLCJxdWVyeSIsIm93bmVyUXVlcnkiLCJmaW5hbFF1ZXJ5IiwiJG9yIiwicHVzaCIsInVzZXJUZWFtcyIsImNyZWF0ZVRlYW0iLCJ0ZWFtRGF0YSIsIm93bmVyVXNlcklkIiwib3duZXJOYW1lIiwib3duZXJVc2VyIiwibmV3VGVhbSIsIm1lbWJlcnMiLCJyb2xlIiwiam9pbmVkQXQiLCJ1cGRhdGVUZWFtIiwidXBkYXRlZFRlYW0iLCJkZWxldGVUZWFtIiwiYWRkVGVhbU1lbWJlciIsIm1lbWJlckRhdGEiLCJ0ZWFtT2JqZWN0SWQiLCJtZW1iZXJVc2VySWQiLCJtZW1iZXJOYW1lIiwibWVtYmVyVXNlciIsIm1lbWJlclJlY29yZCIsImxvZyIsIiRwdXNoIiwicmVtb3ZlVGVhbU1lbWJlciIsInVzZXJJZFRvUmVtb3ZlIiwibWVtYmVyVXNlcklkU3RyaW5nIiwibWVtYmVyVG9SZW1vdmUiLCJtIiwibW9kaWZpZWRDb3VudCIsImdldENvbW1lbnRzQnlQcm9tcHRJZCIsInByb21wdENvbW1lbnRzIiwiY3JlYXRlQ29tbWVudCIsImNvbW1lbnREYXRhIiwiY3JlYXRlZEJ5TmFtZSIsImNvbW1lbnRlclVzZXIiLCJuZXdDb21tZW50IiwidXBkYXRlQ29tbWVudCIsInVwZGF0ZWRDb21tZW50IiwiZGVsZXRlQ29tbWVudCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/db.js\n");

/***/ }),

/***/ "(api-node)/./lib/mongodb.js":
/*!************************!*\
  !*** ./lib/mongodb.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   closeDatabaseConnection: () => (/* binding */ closeDatabaseConnection),\n/* harmony export */   connectToDatabase: () => (/* binding */ connectToDatabase),\n/* harmony export */   getCollection: () => (/* binding */ getCollection)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst uri = process.env.MONGODB_URI;\nconst dbName = process.env.MONGODB_DB;\nif (!uri) {\n    throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\n}\nif (!dbName) {\n    throw new Error('Please define the MONGODB_DB environment variable inside .env.local');\n}\nlet cachedClient = null;\nlet cachedDb = null;\n/**\r\n * Connects to the MongoDB database and returns the client and db instances.\r\n * Caches the connection to avoid reconnecting on every request in development.\r\n */ async function connectToDatabase() {\n    if (cachedClient && cachedDb) {\n        return {\n            client: cachedClient,\n            db: cachedDb\n        };\n    }\n    try {\n        const client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, {\n        });\n        await client.connect();\n        const db = client.db(dbName);\n        console.log(\"Successfully connected to MongoDB.\");\n        cachedClient = client;\n        cachedDb = db;\n        return {\n            client,\n            db\n        };\n    } catch (error) {\n        console.error(\"Failed to connect to MongoDB\", error);\n        throw new Error(\"Could not connect to database.\");\n    }\n}\n// Optional: Helper to close the connection (useful for scripts or tests)\nasync function closeDatabaseConnection() {\n    if (cachedClient) {\n        await cachedClient.close();\n        cachedClient = null;\n        cachedDb = null;\n        console.log(\"MongoDB connection closed.\");\n    }\n}\n// Helper function to get collection references\nasync function getCollection(collectionName) {\n    const { db } = await connectToDatabase();\n    return db.collection(collectionName);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9tb25nb2RiLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQXNDO0FBRXRDLE1BQU1DLE1BQU1DLFFBQVFDLEdBQUcsQ0FBQ0MsV0FBVztBQUNuQyxNQUFNQyxTQUFTSCxRQUFRQyxHQUFHLENBQUNHLFVBQVU7QUFFckMsSUFBSSxDQUFDTCxLQUFLO0lBQ1IsTUFBTSxJQUFJTSxNQUFNO0FBQ2xCO0FBRUEsSUFBSSxDQUFDRixRQUFRO0lBQ1gsTUFBTSxJQUFJRSxNQUFNO0FBQ2xCO0FBRUEsSUFBSUMsZUFBZTtBQUNuQixJQUFJQyxXQUFXO0FBRWY7OztDQUdDLEdBQ00sZUFBZUM7SUFDcEIsSUFBSUYsZ0JBQWdCQyxVQUFVO1FBQzVCLE9BQU87WUFBRUUsUUFBUUg7WUFBY0ksSUFBSUg7UUFBUztJQUM5QztJQUVBLElBQUk7UUFDRixNQUFNRSxTQUFTLElBQUlYLGdEQUFXQSxDQUFDQyxLQUFLO1FBR3BDO1FBRUEsTUFBTVUsT0FBT0UsT0FBTztRQUNwQixNQUFNRCxLQUFLRCxPQUFPQyxFQUFFLENBQUNQO1FBRXJCUyxRQUFRQyxHQUFHLENBQUM7UUFFWlAsZUFBZUc7UUFDZkYsV0FBV0c7UUFFWCxPQUFPO1lBQUVEO1lBQVFDO1FBQUc7SUFDdEIsRUFBRSxPQUFPSSxPQUFPO1FBQ2RGLFFBQVFFLEtBQUssQ0FBQyxnQ0FBZ0NBO1FBQzlDLE1BQU0sSUFBSVQsTUFBTTtJQUNsQjtBQUNGO0FBRUEseUVBQXlFO0FBQ2xFLGVBQWVVO0lBQ3BCLElBQUlULGNBQWM7UUFDaEIsTUFBTUEsYUFBYVUsS0FBSztRQUN4QlYsZUFBZTtRQUNmQyxXQUFXO1FBQ1hLLFFBQVFDLEdBQUcsQ0FBQztJQUNkO0FBQ0Y7QUFFQSwrQ0FBK0M7QUFDeEMsZUFBZUksY0FBY0MsY0FBYztJQUNoRCxNQUFNLEVBQUVSLEVBQUUsRUFBRSxHQUFHLE1BQU1GO0lBQ3JCLE9BQU9FLEdBQUdTLFVBQVUsQ0FBQ0Q7QUFDdkIiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmF1ZGlcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9tcHRQcm9cXFByb21wdFByb1xcbGliXFxtb25nb2RiLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5jb25zdCB1cmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcclxuY29uc3QgZGJOYW1lID0gcHJvY2Vzcy5lbnYuTU9OR09EQl9EQjtcclxuXHJcbmlmICghdXJpKSB7XHJcbiAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgZGVmaW5lIHRoZSBNT05HT0RCX1VSSSBlbnZpcm9ubWVudCB2YXJpYWJsZSBpbnNpZGUgLmVudi5sb2NhbCcpO1xyXG59XHJcblxyXG5pZiAoIWRiTmFtZSkge1xyXG4gIHRocm93IG5ldyBFcnJvcignUGxlYXNlIGRlZmluZSB0aGUgTU9OR09EQl9EQiBlbnZpcm9ubWVudCB2YXJpYWJsZSBpbnNpZGUgLmVudi5sb2NhbCcpO1xyXG59XHJcblxyXG5sZXQgY2FjaGVkQ2xpZW50ID0gbnVsbDtcclxubGV0IGNhY2hlZERiID0gbnVsbDtcclxuXHJcbi8qKlxyXG4gKiBDb25uZWN0cyB0byB0aGUgTW9uZ29EQiBkYXRhYmFzZSBhbmQgcmV0dXJucyB0aGUgY2xpZW50IGFuZCBkYiBpbnN0YW5jZXMuXHJcbiAqIENhY2hlcyB0aGUgY29ubmVjdGlvbiB0byBhdm9pZCByZWNvbm5lY3Rpbmcgb24gZXZlcnkgcmVxdWVzdCBpbiBkZXZlbG9wbWVudC5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb25uZWN0VG9EYXRhYmFzZSgpIHtcclxuICBpZiAoY2FjaGVkQ2xpZW50ICYmIGNhY2hlZERiKSB7XHJcbiAgICByZXR1cm4geyBjbGllbnQ6IGNhY2hlZENsaWVudCwgZGI6IGNhY2hlZERiIH07XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSwge1xyXG4gICAgICAvLyB1c2VOZXdVcmxQYXJzZXI6IHRydWUsIC8vIERlcHJlY2F0ZWQgaW4gbmV3ZXIgdmVyc2lvbnNcclxuICAgICAgLy8gdXNlVW5pZmllZFRvcG9sb2d5OiB0cnVlLCAvLyBEZXByZWNhdGVkIGluIG5ld2VyIHZlcnNpb25zXHJcbiAgICB9KTtcclxuXHJcbiAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgY29uc3QgZGIgPSBjbGllbnQuZGIoZGJOYW1lKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhcIlN1Y2Nlc3NmdWxseSBjb25uZWN0ZWQgdG8gTW9uZ29EQi5cIik7XHJcblxyXG4gICAgY2FjaGVkQ2xpZW50ID0gY2xpZW50O1xyXG4gICAgY2FjaGVkRGIgPSBkYjtcclxuXHJcbiAgICByZXR1cm4geyBjbGllbnQsIGRiIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY29ubmVjdCB0byBNb25nb0RCXCIsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBjb25uZWN0IHRvIGRhdGFiYXNlLlwiKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIE9wdGlvbmFsOiBIZWxwZXIgdG8gY2xvc2UgdGhlIGNvbm5lY3Rpb24gKHVzZWZ1bCBmb3Igc2NyaXB0cyBvciB0ZXN0cylcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsb3NlRGF0YWJhc2VDb25uZWN0aW9uKCkge1xyXG4gIGlmIChjYWNoZWRDbGllbnQpIHtcclxuICAgIGF3YWl0IGNhY2hlZENsaWVudC5jbG9zZSgpO1xyXG4gICAgY2FjaGVkQ2xpZW50ID0gbnVsbDtcclxuICAgIGNhY2hlZERiID0gbnVsbDtcclxuICAgIGNvbnNvbGUubG9nKFwiTW9uZ29EQiBjb25uZWN0aW9uIGNsb3NlZC5cIik7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IGNvbGxlY3Rpb24gcmVmZXJlbmNlc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29sbGVjdGlvbihjb2xsZWN0aW9uTmFtZSkge1xyXG4gIGNvbnN0IHsgZGIgfSA9IGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XHJcbiAgcmV0dXJuIGRiLmNvbGxlY3Rpb24oY29sbGVjdGlvbk5hbWUpO1xyXG59ICJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsImRiTmFtZSIsIk1PTkdPREJfREIiLCJFcnJvciIsImNhY2hlZENsaWVudCIsImNhY2hlZERiIiwiY29ubmVjdFRvRGF0YWJhc2UiLCJjbGllbnQiLCJkYiIsImNvbm5lY3QiLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJjbG9zZURhdGFiYXNlQ29ubmVjdGlvbiIsImNsb3NlIiwiZ2V0Q29sbGVjdGlvbiIsImNvbGxlY3Rpb25OYW1lIiwiY29sbGVjdGlvbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/mongodb.js\n");

/***/ }),

/***/ "(api-node)/./lib/mongoose.js":
/*!*************************!*\
  !*** ./lib/mongoose.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\n// Cache the connection promise to avoid reconnecting on every call\nlet connectionPromise = null;\nconst connectDB = async ()=>{\n    // If a connection promise exists, return it to reuse the connection\n    if (connectionPromise) {\n        // console.log(\"Using cached Mongoose connection\");\n        return connectionPromise;\n    }\n    // Check for MongoDB URI environment variable\n    if (!process.env.MONGODB_URI) {\n        throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\n    }\n    // Create a new connection promise\n    console.log(\"Creating new Mongoose connection...\");\n    connectionPromise = mongoose__WEBPACK_IMPORTED_MODULE_0___default().connect(process.env.MONGODB_URI, {\n        dbName: process.env.MONGODB_DB || 'PromptPro',\n        // Recommended options (check Mongoose docs for latest)\n        useNewUrlParser: true,\n        useUnifiedTopology: true\n    }).then((mongooseInstance)=>{\n        console.log(\"Mongoose connected successfully.\");\n        return mongooseInstance; // The resolved value of the promise\n    }).catch((err)=>{\n        console.error(\"Mongoose connection error:\", err);\n        connectionPromise = null; // Reset promise on error so retry is possible\n        throw err; // Re-throw error to be caught by the calling function\n    });\n    return connectionPromise;\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (connectDB);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9tb25nb29zZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBZ0M7QUFFaEMsbUVBQW1FO0FBQ25FLElBQUlDLG9CQUFvQjtBQUV4QixNQUFNQyxZQUFZO0lBQ2hCLG9FQUFvRTtJQUNwRSxJQUFJRCxtQkFBbUI7UUFDckIsbURBQW1EO1FBQ25ELE9BQU9BO0lBQ1Q7SUFFQSw2Q0FBNkM7SUFDN0MsSUFBSSxDQUFDRSxRQUFRQyxHQUFHLENBQUNDLFdBQVcsRUFBRTtRQUM1QixNQUFNLElBQUlDLE1BQU07SUFDbEI7SUFFQSxrQ0FBa0M7SUFDbENDLFFBQVFDLEdBQUcsQ0FBQztJQUNaUCxvQkFBb0JELHVEQUFnQixDQUFDRyxRQUFRQyxHQUFHLENBQUNDLFdBQVcsRUFBRTtRQUM1REssUUFBUVAsUUFBUUMsR0FBRyxDQUFDTyxVQUFVLElBQUk7UUFDbEMsdURBQXVEO1FBQ3ZEQyxpQkFBaUI7UUFDakJDLG9CQUFvQjtJQUN0QixHQUFHQyxJQUFJLENBQUMsQ0FBQ0M7UUFDUFIsUUFBUUMsR0FBRyxDQUFDO1FBQ1osT0FBT08sa0JBQWtCLG9DQUFvQztJQUMvRCxHQUFHQyxLQUFLLENBQUNDLENBQUFBO1FBQ1BWLFFBQVFXLEtBQUssQ0FBQyw4QkFBOEJEO1FBQzVDaEIsb0JBQW9CLE1BQU0sOENBQThDO1FBQ3hFLE1BQU1nQixLQUFLLHNEQUFzRDtJQUNuRTtJQUVBLE9BQU9oQjtBQUNUO0FBRUEsaUVBQWVDLFNBQVNBLEVBQUMiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmF1ZGlcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9tcHRQcm9cXFByb21wdFByb1xcbGliXFxtb25nb29zZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xyXG5cclxuLy8gQ2FjaGUgdGhlIGNvbm5lY3Rpb24gcHJvbWlzZSB0byBhdm9pZCByZWNvbm5lY3Rpbmcgb24gZXZlcnkgY2FsbFxyXG5sZXQgY29ubmVjdGlvblByb21pc2UgPSBudWxsO1xyXG5cclxuY29uc3QgY29ubmVjdERCID0gYXN5bmMgKCkgPT4ge1xyXG4gIC8vIElmIGEgY29ubmVjdGlvbiBwcm9taXNlIGV4aXN0cywgcmV0dXJuIGl0IHRvIHJldXNlIHRoZSBjb25uZWN0aW9uXHJcbiAgaWYgKGNvbm5lY3Rpb25Qcm9taXNlKSB7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhcIlVzaW5nIGNhY2hlZCBNb25nb29zZSBjb25uZWN0aW9uXCIpO1xyXG4gICAgcmV0dXJuIGNvbm5lY3Rpb25Qcm9taXNlO1xyXG4gIH1cclxuXHJcbiAgLy8gQ2hlY2sgZm9yIE1vbmdvREIgVVJJIGVudmlyb25tZW50IHZhcmlhYmxlXHJcbiAgaWYgKCFwcm9jZXNzLmVudi5NT05HT0RCX1VSSSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgZGVmaW5lIHRoZSBNT05HT0RCX1VSSSBlbnZpcm9ubWVudCB2YXJpYWJsZSBpbnNpZGUgLmVudi5sb2NhbCcpO1xyXG4gIH1cclxuXHJcbiAgLy8gQ3JlYXRlIGEgbmV3IGNvbm5lY3Rpb24gcHJvbWlzZVxyXG4gIGNvbnNvbGUubG9nKFwiQ3JlYXRpbmcgbmV3IE1vbmdvb3NlIGNvbm5lY3Rpb24uLi5cIik7XHJcbiAgY29ubmVjdGlvblByb21pc2UgPSBtb25nb29zZS5jb25uZWN0KHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJLCB7XHJcbiAgICBkYk5hbWU6IHByb2Nlc3MuZW52Lk1PTkdPREJfREIgfHwgJ1Byb21wdFBybycsIC8vIFVzZSBzcGVjaWZpYyBEQiBuYW1lIG9yIGRlZmF1bHRcclxuICAgIC8vIFJlY29tbWVuZGVkIG9wdGlvbnMgKGNoZWNrIE1vbmdvb3NlIGRvY3MgZm9yIGxhdGVzdClcclxuICAgIHVzZU5ld1VybFBhcnNlcjogdHJ1ZSxcclxuICAgIHVzZVVuaWZpZWRUb3BvbG9neTogdHJ1ZSxcclxuICB9KS50aGVuKChtb25nb29zZUluc3RhbmNlKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhcIk1vbmdvb3NlIGNvbm5lY3RlZCBzdWNjZXNzZnVsbHkuXCIpO1xyXG4gICAgcmV0dXJuIG1vbmdvb3NlSW5zdGFuY2U7IC8vIFRoZSByZXNvbHZlZCB2YWx1ZSBvZiB0aGUgcHJvbWlzZVxyXG4gIH0pLmNhdGNoKGVyciA9PiB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiTW9uZ29vc2UgY29ubmVjdGlvbiBlcnJvcjpcIiwgZXJyKTtcclxuICAgIGNvbm5lY3Rpb25Qcm9taXNlID0gbnVsbDsgLy8gUmVzZXQgcHJvbWlzZSBvbiBlcnJvciBzbyByZXRyeSBpcyBwb3NzaWJsZVxyXG4gICAgdGhyb3cgZXJyOyAvLyBSZS10aHJvdyBlcnJvciB0byBiZSBjYXVnaHQgYnkgdGhlIGNhbGxpbmcgZnVuY3Rpb25cclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGNvbm5lY3Rpb25Qcm9taXNlO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY29ubmVjdERCOyAiXSwibmFtZXMiOlsibW9uZ29vc2UiLCJjb25uZWN0aW9uUHJvbWlzZSIsImNvbm5lY3REQiIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIkVycm9yIiwiY29uc29sZSIsImxvZyIsImNvbm5lY3QiLCJkYk5hbWUiLCJNT05HT0RCX0RCIiwidXNlTmV3VXJsUGFyc2VyIiwidXNlVW5pZmllZFRvcG9sb2d5IiwidGhlbiIsIm1vbmdvb3NlSW5zdGFuY2UiLCJjYXRjaCIsImVyciIsImVycm9yIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/mongoose.js\n");

/***/ }),

/***/ "(api-node)/./lib/permissions.js":
/*!****************************!*\
  !*** ./lib/permissions.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ROLES: () => (/* binding */ ROLES),\n/* harmony export */   ROLE_CAPABILITIES: () => (/* binding */ ROLE_CAPABILITIES),\n/* harmony export */   canInviteMembers: () => (/* binding */ canInviteMembers),\n/* harmony export */   canManagePrompt: () => (/* binding */ canManagePrompt),\n/* harmony export */   canManageTeam: () => (/* binding */ canManageTeam),\n/* harmony export */   canRemoveMembers: () => (/* binding */ canRemoveMembers),\n/* harmony export */   hasCapability: () => (/* binding */ hasCapability),\n/* harmony export */   isAdmin: () => (/* binding */ isAdmin),\n/* harmony export */   isAdminOrEditor: () => (/* binding */ isAdminOrEditor),\n/* harmony export */   isRole: () => (/* binding */ isRole)\n/* harmony export */ });\n/* harmony import */ var _lib_teamUtils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teamUtils */ \"(api-node)/./lib/teamUtils.js\");\n/**\n * Permissions utility for the PromptPro application\n * This file serves as the central reference for role-based capabilities\n */ \n/**\n * Role definitions with their capabilities\n */ const ROLES = {\n    OWNER: 'owner',\n    ADMIN: 'admin',\n    MEMBER: 'member'\n};\n/**\n * Role capabilities matrix\n * Defines what each role can do within the application\n */ const ROLE_CAPABILITIES = {\n    [ROLES.OWNER]: {\n        canManageTeamSettings: true,\n        canInviteMembers: true,\n        canRemoveMembers: true,\n        canEditAnyPrompt: true,\n        canDeleteAnyPrompt: true,\n        canControlTeamVisibility: true,\n        canViewTeamPrompts: true,\n        canCreatePrompts: true,\n        canEditOwnPrompts: true,\n        canCommentOnPrompts: true\n    },\n    [ROLES.ADMIN]: {\n        canManageTeamSettings: true,\n        canInviteMembers: true,\n        canRemoveMembers: true,\n        canEditAnyPrompt: true,\n        canDeleteAnyPrompt: true,\n        canControlTeamVisibility: true,\n        canViewTeamPrompts: true,\n        canCreatePrompts: true,\n        canEditOwnPrompts: true,\n        canCommentOnPrompts: true\n    },\n    [ROLES.MEMBER]: {\n        canManageTeamSettings: false,\n        canInviteMembers: false,\n        canRemoveMembers: false,\n        canEditAnyPrompt: false,\n        canDeleteAnyPrompt: false,\n        canControlTeamVisibility: false,\n        canViewTeamPrompts: true,\n        canCreatePrompts: true,\n        canEditOwnPrompts: true,\n        canCommentOnPrompts: true\n    }\n};\n/**\n * Check if a user has a specific capability within a team\n * @param {Object} team - The team object\n * @param {string} userId - The user ID\n * @param {string} capability - The capability to check (e.g., 'canEditAnyPrompt')\n * @returns {boolean} - Whether the user has the capability\n */ function hasCapability(team, userId, capability) {\n    if (!team || !userId || !capability) return false;\n    const role = (0,_lib_teamUtils__WEBPACK_IMPORTED_MODULE_0__.getMemberRole)(team, userId);\n    if (!role) return false;\n    return ROLE_CAPABILITIES[role][capability] || false;\n}\n/**\n * Check if a user can manage a particular prompt\n * @param {Object} team - The team object\n * @param {string} userId - The user ID\n * @param {Object} prompt - The prompt object\n * @param {string} action - The action: 'view', 'edit', 'delete'\n * @returns {boolean} - Whether the user can perform the action on the prompt\n */ function canManagePrompt(team, userId, prompt, action) {\n    if (!team || !userId || !prompt) return false;\n    // Get user's role in the team\n    const role = (0,_lib_teamUtils__WEBPACK_IMPORTED_MODULE_0__.getMemberRole)(team, userId);\n    if (!role) return false;\n    const isCreator = String(prompt.userId) === String(userId);\n    switch(action){\n        case 'view':\n            // All team members can view team prompts\n            return hasCapability(team, userId, 'canViewTeamPrompts');\n        case 'edit':\n            // Admin/Owner can edit any prompt, Members can only edit their own\n            return hasCapability(team, userId, 'canEditAnyPrompt') || isCreator && hasCapability(team, userId, 'canEditOwnPrompts');\n        case 'delete':\n            // Only Admin/Owner can delete prompts\n            return hasCapability(team, userId, 'canDeleteAnyPrompt') || // Optionally allow creators to delete their own prompts\n            isCreator && hasCapability(team, userId, 'canDeleteOwnPrompts');\n        default:\n            return false;\n    }\n}\n/**\n * Check if a user can manage team settings\n * @param {Object} team - The team object\n * @param {string} userId - The user ID\n * @returns {boolean} - Whether the user can manage team settings\n */ function canManageTeam(team, userId) {\n    return hasCapability(team, userId, 'canManageTeamSettings');\n}\n/**\n * Check if a user can invite members to a team\n * @param {Object} team - The team object\n * @param {string} userId - The user ID\n * @returns {boolean} - Whether the user can invite members\n */ function canInviteMembers(team, userId) {\n    return hasCapability(team, userId, 'canInviteMembers');\n}\n/**\n * Check if a user can remove members from a team\n * @param {Object} team - The team object\n * @param {string} userId - The user ID\n * @returns {boolean} - Whether the user can remove members\n */ function canRemoveMembers(team, userId) {\n    return hasCapability(team, userId, 'canRemoveMembers');\n}\n// --- NEW: Simple Global Role Check Helpers ---\n/**\n * Checks if the user object (from session/token) has a specific role or one of several roles.\n * Assumes user object has a 'role' property.\n * @param {Object} user - The user object (e.g., from req.user or useSession)\n * @param {string|string[]} requiredRoleOrRoles - The role name (string) or an array of allowed role names.\n * @returns {boolean} - True if the user has the required role, false otherwise.\n */ function isRole(user, requiredRoleOrRoles) {\n    if (!user || !user.role) {\n        return false;\n    }\n    if (Array.isArray(requiredRoleOrRoles)) {\n        return requiredRoleOrRoles.includes(user.role);\n    } else {\n        return user.role === requiredRoleOrRoles;\n    }\n}\n/**\n * Checks if the user is an Admin or an Editor.\n * @param {Object} user - The user object (e.g., from req.user or useSession)\n * @returns {boolean} - True if the user is an admin or editor.\n */ function isAdminOrEditor(user) {\n    // Assuming your roles are defined in the User model schema enum\n    return isRole(user, [\n        'admin',\n        'editor'\n    ]);\n}\n/**\n * Checks if the user is an Admin.\n * @param {Object} user - The user object (e.g., from req.user or useSession)\n * @returns {boolean} - True if the user is an admin.\n */ function isAdmin(user) {\n    return isRole(user, 'admin');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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NUMsSUFBSSxDQUFDRCxRQUFRLENBQUNBLEtBQUtSLElBQUksRUFBRTtRQUNyQixPQUFPO0lBQ1g7SUFFQSxJQUFJVSxNQUFNQyxPQUFPLENBQUNGLHNCQUFzQjtRQUNwQyxPQUFPQSxvQkFBb0JHLFFBQVEsQ0FBQ0osS0FBS1IsSUFBSTtJQUNqRCxPQUFPO1FBQ0gsT0FBT1EsS0FBS1IsSUFBSSxLQUFLUztJQUN6QjtBQUNKO0FBRUE7Ozs7Q0FJQyxHQUNNLFNBQVNJLGdCQUFnQkwsSUFBSTtJQUNoQyxnRUFBZ0U7SUFDaEUsT0FBT0QsT0FBT0MsTUFBTTtRQUFDO1FBQVM7S0FBUztBQUMzQztBQUVBOzs7O0NBSUMsR0FDTSxTQUFTTSxRQUFRTixJQUFJO0lBQ3hCLE9BQU9ELE9BQU9DLE1BQU07QUFDeEIiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmF1ZGlcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9tcHRQcm9cXFByb21wdFByb1xcbGliXFxwZXJtaXNzaW9ucy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBlcm1pc3Npb25zIHV0aWxpdHkgZm9yIHRoZSBQcm9tcHRQcm8gYXBwbGljYXRpb25cbiAqIFRoaXMgZmlsZSBzZXJ2ZXMgYXMgdGhlIGNlbnRyYWwgcmVmZXJlbmNlIGZvciByb2xlLWJhc2VkIGNhcGFiaWxpdGllc1xuICovXG5cbmltcG9ydCB7IGdldE1lbWJlclJvbGUgfSBmcm9tICcuLi9saWIvdGVhbVV0aWxzJztcblxuLyoqXG4gKiBSb2xlIGRlZmluaXRpb25zIHdpdGggdGhlaXIgY2FwYWJpbGl0aWVzXG4gKi9cbmV4cG9ydCBjb25zdCBST0xFUyA9IHtcbiAgT1dORVI6ICdvd25lcicsXG4gIEFETUlOOiAnYWRtaW4nLFxuICBNRU1CRVI6ICdtZW1iZXInLFxufTtcblxuLyoqXG4gKiBSb2xlIGNhcGFiaWxpdGllcyBtYXRyaXhcbiAqIERlZmluZXMgd2hhdCBlYWNoIHJvbGUgY2FuIGRvIHdpdGhpbiB0aGUgYXBwbGljYXRpb25cbiAqL1xuZXhwb3J0IGNvbnN0IFJPTEVfQ0FQQUJJTElUSUVTID0ge1xuICBbUk9MRVMuT1dORVJdOiB7XG4gICAgY2FuTWFuYWdlVGVhbVNldHRpbmdzOiB0cnVlLFxuICAgIGNhbkludml0ZU1lbWJlcnM6IHRydWUsXG4gICAgY2FuUmVtb3ZlTWVtYmVyczogdHJ1ZSxcbiAgICBjYW5FZGl0QW55UHJvbXB0OiB0cnVlLFxuICAgIGNhbkRlbGV0ZUFueVByb21wdDogdHJ1ZSxcbiAgICBjYW5Db250cm9sVGVhbVZpc2liaWxpdHk6IHRydWUsXG4gICAgY2FuVmlld1RlYW1Qcm9tcHRzOiB0cnVlLFxuICAgIGNhbkNyZWF0ZVByb21wdHM6IHRydWUsXG4gICAgY2FuRWRpdE93blByb21wdHM6IHRydWUsXG4gICAgY2FuQ29tbWVudE9uUHJvbXB0czogdHJ1ZSxcbiAgfSxcbiAgW1JPTEVTLkFETUlOXToge1xuICAgIGNhbk1hbmFnZVRlYW1TZXR0aW5nczogdHJ1ZSxcbiAgICBjYW5JbnZpdGVNZW1iZXJzOiB0cnVlLFxuICAgIGNhblJlbW92ZU1lbWJlcnM6IHRydWUsXG4gICAgY2FuRWRpdEFueVByb21wdDogdHJ1ZSxcbiAgICBjYW5EZWxldGVBbnlQcm9tcHQ6IHRydWUsXG4gICAgY2FuQ29udHJvbFRlYW1WaXNpYmlsaXR5OiB0cnVlLFxuICAgIGNhblZpZXdUZWFtUHJvbXB0czogdHJ1ZSxcbiAgICBjYW5DcmVhdGVQcm9tcHRzOiB0cnVlLFxuICAgIGNhbkVkaXRPd25Qcm9tcHRzOiB0cnVlLFxuICAgIGNhbkNvbW1lbnRPblByb21wdHM6IHRydWUsXG4gIH0sXG4gIFtST0xFUy5NRU1CRVJdOiB7XG4gICAgY2FuTWFuYWdlVGVhbVNldHRpbmdzOiBmYWxzZSxcbiAgICBjYW5JbnZpdGVNZW1iZXJzOiBmYWxzZSxcbiAgICBjYW5SZW1vdmVNZW1iZXJzOiBmYWxzZSxcbiAgICBjYW5FZGl0QW55UHJvbXB0OiBmYWxzZSxcbiAgICBjYW5EZWxldGVBbnlQcm9tcHQ6IGZhbHNlLFxuICAgIGNhbkNvbnRyb2xUZWFtVmlzaWJpbGl0eTogZmFsc2UsXG4gICAgY2FuVmlld1RlYW1Qcm9tcHRzOiB0cnVlLFxuICAgIGNhbkNyZWF0ZVByb21wdHM6IHRydWUsXG4gICAgY2FuRWRpdE93blByb21wdHM6IHRydWUsXG4gICAgY2FuQ29tbWVudE9uUHJvbXB0czogdHJ1ZSxcbiAgfSxcbn07XG5cbi8qKlxuICogQ2hlY2sgaWYgYSB1c2VyIGhhcyBhIHNwZWNpZmljIGNhcGFiaWxpdHkgd2l0aGluIGEgdGVhbVxuICogQHBhcmFtIHtPYmplY3R9IHRlYW0gLSBUaGUgdGVhbSBvYmplY3RcbiAqIEBwYXJhbSB7c3RyaW5nfSB1c2VySWQgLSBUaGUgdXNlciBJRFxuICogQHBhcmFtIHtzdHJpbmd9IGNhcGFiaWxpdHkgLSBUaGUgY2FwYWJpbGl0eSB0byBjaGVjayAoZS5nLiwgJ2NhbkVkaXRBbnlQcm9tcHQnKVxuICogQHJldHVybnMge2Jvb2xlYW59IC0gV2hldGhlciB0aGUgdXNlciBoYXMgdGhlIGNhcGFiaWxpdHlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhhc0NhcGFiaWxpdHkodGVhbSwgdXNlcklkLCBjYXBhYmlsaXR5KSB7XG4gIGlmICghdGVhbSB8fCAhdXNlcklkIHx8ICFjYXBhYmlsaXR5KSByZXR1cm4gZmFsc2U7XG4gIFxuICBjb25zdCByb2xlID0gZ2V0TWVtYmVyUm9sZSh0ZWFtLCB1c2VySWQpO1xuICBpZiAoIXJvbGUpIHJldHVybiBmYWxzZTtcbiAgXG4gIHJldHVybiBST0xFX0NBUEFCSUxJVElFU1tyb2xlXVtjYXBhYmlsaXR5XSB8fCBmYWxzZTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIHVzZXIgY2FuIG1hbmFnZSBhIHBhcnRpY3VsYXIgcHJvbXB0XG4gKiBAcGFyYW0ge09iamVjdH0gdGVhbSAtIFRoZSB0ZWFtIG9iamVjdFxuICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFRoZSB1c2VyIElEXG4gKiBAcGFyYW0ge09iamVjdH0gcHJvbXB0IC0gVGhlIHByb21wdCBvYmplY3RcbiAqIEBwYXJhbSB7c3RyaW5nfSBhY3Rpb24gLSBUaGUgYWN0aW9uOiAndmlldycsICdlZGl0JywgJ2RlbGV0ZSdcbiAqIEByZXR1cm5zIHtib29sZWFufSAtIFdoZXRoZXIgdGhlIHVzZXIgY2FuIHBlcmZvcm0gdGhlIGFjdGlvbiBvbiB0aGUgcHJvbXB0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYW5NYW5hZ2VQcm9tcHQodGVhbSwgdXNlcklkLCBwcm9tcHQsIGFjdGlvbikge1xuICBpZiAoIXRlYW0gfHwgIXVzZXJJZCB8fCAhcHJvbXB0KSByZXR1cm4gZmFsc2U7XG4gIFxuICAvLyBHZXQgdXNlcidzIHJvbGUgaW4gdGhlIHRlYW1cbiAgY29uc3Qgcm9sZSA9IGdldE1lbWJlclJvbGUodGVhbSwgdXNlcklkKTtcbiAgaWYgKCFyb2xlKSByZXR1cm4gZmFsc2U7XG4gIFxuICBjb25zdCBpc0NyZWF0b3IgPSBTdHJpbmcocHJvbXB0LnVzZXJJZCkgPT09IFN0cmluZyh1c2VySWQpO1xuICBcbiAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICBjYXNlICd2aWV3JzpcbiAgICAgIC8vIEFsbCB0ZWFtIG1lbWJlcnMgY2FuIHZpZXcgdGVhbSBwcm9tcHRzXG4gICAgICByZXR1cm4gaGFzQ2FwYWJpbGl0eSh0ZWFtLCB1c2VySWQsICdjYW5WaWV3VGVhbVByb21wdHMnKTtcbiAgICAgIFxuICAgIGNhc2UgJ2VkaXQnOlxuICAgICAgLy8gQWRtaW4vT3duZXIgY2FuIGVkaXQgYW55IHByb21wdCwgTWVtYmVycyBjYW4gb25seSBlZGl0IHRoZWlyIG93blxuICAgICAgcmV0dXJuIGhhc0NhcGFiaWxpdHkodGVhbSwgdXNlcklkLCAnY2FuRWRpdEFueVByb21wdCcpIHx8IFxuICAgICAgICAgICAgIChpc0NyZWF0b3IgJiYgaGFzQ2FwYWJpbGl0eSh0ZWFtLCB1c2VySWQsICdjYW5FZGl0T3duUHJvbXB0cycpKTtcbiAgICAgIFxuICAgIGNhc2UgJ2RlbGV0ZSc6XG4gICAgICAvLyBPbmx5IEFkbWluL093bmVyIGNhbiBkZWxldGUgcHJvbXB0c1xuICAgICAgcmV0dXJuIGhhc0NhcGFiaWxpdHkodGVhbSwgdXNlcklkLCAnY2FuRGVsZXRlQW55UHJvbXB0JykgfHxcbiAgICAgICAgICAgICAvLyBPcHRpb25hbGx5IGFsbG93IGNyZWF0b3JzIHRvIGRlbGV0ZSB0aGVpciBvd24gcHJvbXB0c1xuICAgICAgICAgICAgIChpc0NyZWF0b3IgJiYgaGFzQ2FwYWJpbGl0eSh0ZWFtLCB1c2VySWQsICdjYW5EZWxldGVPd25Qcm9tcHRzJykpO1xuICAgICAgXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIENoZWNrIGlmIGEgdXNlciBjYW4gbWFuYWdlIHRlYW0gc2V0dGluZ3NcbiAqIEBwYXJhbSB7T2JqZWN0fSB0ZWFtIC0gVGhlIHRlYW0gb2JqZWN0XG4gKiBAcGFyYW0ge3N0cmluZ30gdXNlcklkIC0gVGhlIHVzZXIgSURcbiAqIEByZXR1cm5zIHtib29sZWFufSAtIFdoZXRoZXIgdGhlIHVzZXIgY2FuIG1hbmFnZSB0ZWFtIHNldHRpbmdzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYW5NYW5hZ2VUZWFtKHRlYW0sIHVzZXJJZCkge1xuICByZXR1cm4gaGFzQ2FwYWJpbGl0eSh0ZWFtLCB1c2VySWQsICdjYW5NYW5hZ2VUZWFtU2V0dGluZ3MnKTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIHVzZXIgY2FuIGludml0ZSBtZW1iZXJzIHRvIGEgdGVhbVxuICogQHBhcmFtIHtPYmplY3R9IHRlYW0gLSBUaGUgdGVhbSBvYmplY3RcbiAqIEBwYXJhbSB7c3RyaW5nfSB1c2VySWQgLSBUaGUgdXNlciBJRFxuICogQHJldHVybnMge2Jvb2xlYW59IC0gV2hldGhlciB0aGUgdXNlciBjYW4gaW52aXRlIG1lbWJlcnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbkludml0ZU1lbWJlcnModGVhbSwgdXNlcklkKSB7XG4gIHJldHVybiBoYXNDYXBhYmlsaXR5KHRlYW0sIHVzZXJJZCwgJ2Nhbkludml0ZU1lbWJlcnMnKTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIHVzZXIgY2FuIHJlbW92ZSBtZW1iZXJzIGZyb20gYSB0ZWFtXG4gKiBAcGFyYW0ge09iamVjdH0gdGVhbSAtIFRoZSB0ZWFtIG9iamVjdFxuICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFRoZSB1c2VyIElEXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gLSBXaGV0aGVyIHRoZSB1c2VyIGNhbiByZW1vdmUgbWVtYmVyc1xuICovXG5leHBvcnQgZnVuY3Rpb24gY2FuUmVtb3ZlTWVtYmVycyh0ZWFtLCB1c2VySWQpIHtcbiAgcmV0dXJuIGhhc0NhcGFiaWxpdHkodGVhbSwgdXNlcklkLCAnY2FuUmVtb3ZlTWVtYmVycycpO1xufVxuXG4vLyAtLS0gTkVXOiBTaW1wbGUgR2xvYmFsIFJvbGUgQ2hlY2sgSGVscGVycyAtLS1cblxuLyoqXG4gKiBDaGVja3MgaWYgdGhlIHVzZXIgb2JqZWN0IChmcm9tIHNlc3Npb24vdG9rZW4pIGhhcyBhIHNwZWNpZmljIHJvbGUgb3Igb25lIG9mIHNldmVyYWwgcm9sZXMuXG4gKiBBc3N1bWVzIHVzZXIgb2JqZWN0IGhhcyBhICdyb2xlJyBwcm9wZXJ0eS5cbiAqIEBwYXJhbSB7T2JqZWN0fSB1c2VyIC0gVGhlIHVzZXIgb2JqZWN0IChlLmcuLCBmcm9tIHJlcS51c2VyIG9yIHVzZVNlc3Npb24pXG4gKiBAcGFyYW0ge3N0cmluZ3xzdHJpbmdbXX0gcmVxdWlyZWRSb2xlT3JSb2xlcyAtIFRoZSByb2xlIG5hbWUgKHN0cmluZykgb3IgYW4gYXJyYXkgb2YgYWxsb3dlZCByb2xlIG5hbWVzLlxuICogQHJldHVybnMge2Jvb2xlYW59IC0gVHJ1ZSBpZiB0aGUgdXNlciBoYXMgdGhlIHJlcXVpcmVkIHJvbGUsIGZhbHNlIG90aGVyd2lzZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzUm9sZSh1c2VyLCByZXF1aXJlZFJvbGVPclJvbGVzKSB7XG4gICAgaWYgKCF1c2VyIHx8ICF1c2VyLnJvbGUpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmIChBcnJheS5pc0FycmF5KHJlcXVpcmVkUm9sZU9yUm9sZXMpKSB7XG4gICAgICAgIHJldHVybiByZXF1aXJlZFJvbGVPclJvbGVzLmluY2x1ZGVzKHVzZXIucm9sZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHVzZXIucm9sZSA9PT0gcmVxdWlyZWRSb2xlT3JSb2xlcztcbiAgICB9XG59XG5cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSB1c2VyIGlzIGFuIEFkbWluIG9yIGFuIEVkaXRvci5cbiAqIEBwYXJhbSB7T2JqZWN0fSB1c2VyIC0gVGhlIHVzZXIgb2JqZWN0IChlLmcuLCBmcm9tIHJlcS51c2VyIG9yIHVzZVNlc3Npb24pXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gLSBUcnVlIGlmIHRoZSB1c2VyIGlzIGFuIGFkbWluIG9yIGVkaXRvci5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzQWRtaW5PckVkaXRvcih1c2VyKSB7XG4gICAgLy8gQXNzdW1pbmcgeW91ciByb2xlcyBhcmUgZGVmaW5lZCBpbiB0aGUgVXNlciBtb2RlbCBzY2hlbWEgZW51bVxuICAgIHJldHVybiBpc1JvbGUodXNlciwgWydhZG1pbicsICdlZGl0b3InXSk7XG59XG5cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSB1c2VyIGlzIGFuIEFkbWluLlxuICogQHBhcmFtIHtPYmplY3R9IHVzZXIgLSBUaGUgdXNlciBvYmplY3QgKGUuZy4sIGZyb20gcmVxLnVzZXIgb3IgdXNlU2Vzc2lvbilcbiAqIEByZXR1cm5zIHtib29sZWFufSAtIFRydWUgaWYgdGhlIHVzZXIgaXMgYW4gYWRtaW4uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0FkbWluKHVzZXIpIHtcbiAgICByZXR1cm4gaXNSb2xlKHVzZXIsICdhZG1pbicpO1xufSAiXSwibmFtZXMiOlsiZ2V0TWVtYmVyUm9sZSIsIlJPTEVTIiwiT1dORVIiLCJBRE1JTiIsIk1FTUJFUiIsIlJPTEVfQ0FQQUJJTElUSUVTIiwiY2FuTWFuYWdlVGVhbVNldHRpbmdzIiwiY2FuSW52aXRlTWVtYmVycyIsImNhblJlbW92ZU1lbWJlcnMiLCJjYW5FZGl0QW55UHJvbXB0IiwiY2FuRGVsZXRlQW55UHJvbXB0IiwiY2FuQ29udHJvbFRlYW1WaXNpYmlsaXR5IiwiY2FuVmlld1RlYW1Qcm9tcHRzIiwiY2FuQ3JlYXRlUHJvbXB0cyIsImNhbkVkaXRPd25Qcm9tcHRzIiwiY2FuQ29tbWVudE9uUHJvbXB0cyIsImhhc0NhcGFiaWxpdHkiLCJ0ZWFtIiwidXNlcklkIiwiY2FwYWJpbGl0eSIsInJvbGUiLCJjYW5NYW5hZ2VQcm9tcHQiLCJwcm9tcHQiLCJhY3Rpb24iLCJpc0NyZWF0b3IiLCJTdHJpbmciLCJjYW5NYW5hZ2VUZWFtIiwiaXNSb2xlIiwidXNlciIsInJlcXVpcmVkUm9sZU9yUm9sZXMiLCJBcnJheSIsImlzQXJyYXkiLCJpbmNsdWRlcyIsImlzQWRtaW5PckVkaXRvciIsImlzQWRtaW4iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/permissions.js\n");

/***/ }),

/***/ "(api-node)/./lib/repositories/promptRepository.js":
/*!**********************************************!*\
  !*** ./lib/repositories/promptRepository.js ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createPrompt: () => (/* binding */ createPrompt),\n/* harmony export */   deletePrompt: () => (/* binding */ deletePrompt),\n/* harmony export */   getAllPrompts: () => (/* binding */ getAllPrompts),\n/* harmony export */   getPromptById: () => (/* binding */ getPromptById),\n/* harmony export */   incrementUsageCount: () => (/* binding */ incrementUsageCount),\n/* harmony export */   searchPrompts: () => (/* binding */ searchPrompts),\n/* harmony export */   updatePrompt: () => (/* binding */ updatePrompt)\n/* harmony export */ });\n/* harmony import */ var _mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../mongodb */ \"(api-node)/./lib/mongodb.js\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst COLLECTION_NAME = 'prompts';\n/**\r\n * Get all prompts with optional filtering\r\n * @param {Object} filter - Optional filter criteria\r\n * @returns {Promise<Array>} Array of prompts\r\n */ async function getAllPrompts(filter = {}) {\n    const collection = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.getCollection)(COLLECTION_NAME);\n    const prompts = await collection.find(filter).toArray();\n    return prompts.map(mapMongoPrompt);\n}\n/**\r\n * Get a single prompt by ID\r\n * @param {string} id - Prompt ID\r\n * @returns {Promise<Object|null>} Prompt object or null\r\n */ async function getPromptById(id) {\n    const collection = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.getCollection)(COLLECTION_NAME);\n    const prompt = await collection.findOne({\n        _id: new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(id)\n    });\n    return prompt ? mapMongoPrompt(prompt) : null;\n}\n/**\r\n * Create a new prompt\r\n * @param {Object} promptData - Prompt data\r\n * @returns {Promise<Object>} Created prompt\r\n */ async function createPrompt(promptData) {\n    const collection = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.getCollection)(COLLECTION_NAME);\n    const newPrompt = {\n        ...promptData,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        usageCount: 0,\n        rating: promptData.rating || 0\n    };\n    const result = await collection.insertOne(newPrompt);\n    return {\n        id: result.insertedId.toString(),\n        ...newPrompt\n    };\n}\n/**\r\n * Update an existing prompt\r\n * @param {string} id - Prompt ID\r\n * @param {Object} promptData - Updated prompt data\r\n * @returns {Promise<Object|null>} Updated prompt or null\r\n */ async function updatePrompt(id, promptData) {\n    const collection = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.getCollection)(COLLECTION_NAME);\n    const updatedPrompt = {\n        ...promptData,\n        updatedAt: new Date()\n    };\n    // Don't override these fields if not explicitly provided\n    delete updatedPrompt._id;\n    delete updatedPrompt.id;\n    delete updatedPrompt.createdAt;\n    const result = await collection.findOneAndUpdate({\n        _id: new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(id)\n    }, {\n        $set: updatedPrompt\n    }, {\n        returnDocument: 'after'\n    });\n    return result.value ? mapMongoPrompt(result.value) : null;\n}\n/**\r\n * Delete a prompt\r\n * @param {string} id - Prompt ID\r\n * @returns {Promise<boolean>} Success flag\r\n */ async function deletePrompt(id) {\n    const collection = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.getCollection)(COLLECTION_NAME);\n    const result = await collection.deleteOne({\n        _id: new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(id)\n    });\n    return result.deletedCount === 1;\n}\n/**\r\n * Increment prompt usage count\r\n * @param {string} id - Prompt ID\r\n * @returns {Promise<Object|null>} Updated prompt or null\r\n */ async function incrementUsageCount(id) {\n    const collection = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.getCollection)(COLLECTION_NAME);\n    const result = await collection.findOneAndUpdate({\n        _id: new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(id)\n    }, {\n        $inc: {\n            usageCount: 1\n        }\n    }, {\n        returnDocument: 'after'\n    });\n    return result.value ? mapMongoPrompt(result.value) : null;\n}\n/**\r\n * Search prompts with advanced filtering\r\n * @param {string} query - Search text\r\n * @param {Object} options - Search options\r\n * @returns {Promise<Array>} Array of matching prompts\r\n */ async function searchPrompts(query, options = {}) {\n    const collection = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.getCollection)(COLLECTION_NAME);\n    // Build MongoDB query\n    const filter = {};\n    // Text search if query provided\n    if (query && query.trim() !== '') {\n        filter.$or = [\n            {\n                title: {\n                    $regex: query,\n                    $options: 'i'\n                }\n            },\n            {\n                content: {\n                    $regex: query,\n                    $options: 'i'\n                }\n            },\n            {\n                description: {\n                    $regex: query,\n                    $options: 'i'\n                }\n            },\n            {\n                tags: {\n                    $in: [\n                        query\n                    ]\n                }\n            }\n        ];\n    }\n    // Apply filters\n    if (options.userId) {\n        filter.userId = options.userId;\n    }\n    if (options.teamId) {\n        filter.$or = filter.$or || [];\n        filter.$or.push({\n            teamId: options.teamId\n        }, {\n            visibility: 'team',\n            teamId: options.teamId\n        });\n    }\n    if (options.visibility) {\n        filter.visibility = options.visibility;\n    }\n    if (options.aiPlatform) {\n        filter.aiPlatform = options.aiPlatform;\n    }\n    if (options.minRating) {\n        filter.rating = {\n            $gte: parseFloat(options.minRating)\n        };\n    }\n    if (options.minUsageCount) {\n        filter.usageCount = {\n            $gte: parseInt(options.minUsageCount, 10)\n        };\n    }\n    if (options.tags && options.tags.length > 0) {\n        const tags = Array.isArray(options.tags) ? options.tags : [\n            options.tags\n        ];\n        if (options.tagMatchType === 'any') {\n            filter.tags = {\n                $in: tags\n            };\n        } else {\n            filter.tags = {\n                $all: tags\n            };\n        }\n    }\n    // Sort options\n    const sort = {};\n    if (options.sortBy) {\n        sort[options.sortBy] = options.sortDirection === 'desc' ? -1 : 1;\n    } else {\n        sort.createdAt = -1; // Default sort by newest\n    }\n    const prompts = await collection.find(filter).sort(sort).limit(options.limit || 100).toArray();\n    return prompts.map(mapMongoPrompt);\n}\n/**\r\n * Map MongoDB document to app model (handling _id conversion)\r\n * @param {Object} doc - MongoDB document\r\n * @returns {Object} Mapped prompt object\r\n */ function mapMongoPrompt(doc) {\n    return {\n        id: doc._id.toString(),\n        ...doc,\n        _id: undefined\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9yZXBvc2l0b3JpZXMvcHJvbXB0UmVwb3NpdG9yeS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQTJDO0FBQ1I7QUFFbkMsTUFBTUUsa0JBQWtCO0FBRXhCOzs7O0NBSUMsR0FDTSxlQUFlQyxjQUFjQyxTQUFTLENBQUMsQ0FBQztJQUM3QyxNQUFNQyxhQUFhLE1BQU1MLHVEQUFhQSxDQUFDRTtJQUN2QyxNQUFNSSxVQUFVLE1BQU1ELFdBQVdFLElBQUksQ0FBQ0gsUUFBUUksT0FBTztJQUNyRCxPQUFPRixRQUFRRyxHQUFHLENBQUNDO0FBQ3JCO0FBRUE7Ozs7Q0FJQyxHQUNNLGVBQWVDLGNBQWNDLEVBQUU7SUFDcEMsTUFBTVAsYUFBYSxNQUFNTCx1REFBYUEsQ0FBQ0U7SUFDdkMsTUFBTVcsU0FBUyxNQUFNUixXQUFXUyxPQUFPLENBQUM7UUFBRUMsS0FBSyxJQUFJZCw2Q0FBUUEsQ0FBQ1c7SUFBSTtJQUNoRSxPQUFPQyxTQUFTSCxlQUFlRyxVQUFVO0FBQzNDO0FBRUE7Ozs7Q0FJQyxHQUNNLGVBQWVHLGFBQWFDLFVBQVU7SUFDM0MsTUFBTVosYUFBYSxNQUFNTCx1REFBYUEsQ0FBQ0U7SUFFdkMsTUFBTWdCLFlBQVk7UUFDaEIsR0FBR0QsVUFBVTtRQUNiRSxXQUFXLElBQUlDO1FBQ2ZDLFdBQVcsSUFBSUQ7UUFDZkUsWUFBWTtRQUNaQyxRQUFRTixXQUFXTSxNQUFNLElBQUk7SUFDL0I7SUFFQSxNQUFNQyxTQUFTLE1BQU1uQixXQUFXb0IsU0FBUyxDQUFDUDtJQUUxQyxPQUFPO1FBQ0xOLElBQUlZLE9BQU9FLFVBQVUsQ0FBQ0MsUUFBUTtRQUM5QixHQUFHVCxTQUFTO0lBQ2Q7QUFDRjtBQUVBOzs7OztDQUtDLEdBQ00sZUFBZVUsYUFBYWhCLEVBQUUsRUFBRUssVUFBVTtJQUMvQyxNQUFNWixhQUFhLE1BQU1MLHVEQUFhQSxDQUFDRTtJQUV2QyxNQUFNMkIsZ0JBQWdCO1FBQ3BCLEdBQUdaLFVBQVU7UUFDYkks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QUFRUSxJQUFJLElBQUlSLFFBQVFRLElBQUksQ0FBQ1ksTUFBTSxHQUFHLEdBQUc7UUFDM0MsTUFBTVosT0FBT2EsTUFBTUMsT0FBTyxDQUFDdEIsUUFBUVEsSUFBSSxJQUFJUixRQUFRUSxJQUFJLEdBQUc7WUFBQ1IsUUFBUVEsSUFBSTtTQUFDO1FBRXhFLElBQUlSLFFBQVF1QixZQUFZLEtBQUssT0FBTztZQUNsQzVELE9BQU82QyxJQUFJLEdBQUc7Z0JBQUVDLEtBQUtEO1lBQUs7UUFDNUIsT0FBTztZQUNMN0MsT0FBTzZDLElBQUksR0FBRztnQkFBRWdCLE1BQU1oQjtZQUFLO1FBQzdCO0lBQ0Y7SUFFQSxlQUFlO0lBQ2YsTUFBTWlCLE9BQU8sQ0FBQztJQUNkLElBQUl6QixRQUFRMEIsTUFBTSxFQUFFO1FBQ2xCRCxJQUFJLENBQUN6QixRQUFRMEIsTUFBTSxDQUFDLEdBQUcxQixRQUFRMkIsYUFBYSxLQUFLLFNBQVMsQ0FBQyxJQUFJO0lBQ2pFLE9BQU87UUFDTEYsS0FBSy9DLFNBQVMsR0FBRyxDQUFDLEdBQUcseUJBQXlCO0lBQ2hEO0lBRUEsTUFBTWIsVUFBVSxNQUFNRCxXQUNuQkUsSUFBSSxDQUFDSCxRQUNMOEQsSUFBSSxDQUFDQSxNQUNMRyxLQUFLLENBQUM1QixRQUFRNEIsS0FBSyxJQUFJLEtBQ3ZCN0QsT0FBTztJQUVWLE9BQU9GLFFBQVFHLEdBQUcsQ0FBQ0M7QUFDckI7QUFFQTs7OztDQUlDLEdBQ0QsU0FBU0EsZUFBZTRELEdBQUc7SUFDekIsT0FBTztRQUNMMUQsSUFBSTBELElBQUl2RCxHQUFHLENBQUNZLFFBQVE7UUFDcEIsR0FBRzJDLEdBQUc7UUFDTnZELEtBQUt3RDtJQUNQO0FBQ0YiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmF1ZGlcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9tcHRQcm9cXFByb21wdFByb1xcbGliXFxyZXBvc2l0b3JpZXNcXHByb21wdFJlcG9zaXRvcnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0Q29sbGVjdGlvbiB9IGZyb20gJy4uL21vbmdvZGInO1xyXG5pbXBvcnQgeyBPYmplY3RJZCB9IGZyb20gJ21vbmdvZGInO1xyXG5cclxuY29uc3QgQ09MTEVDVElPTl9OQU1FID0gJ3Byb21wdHMnO1xyXG5cclxuLyoqXHJcbiAqIEdldCBhbGwgcHJvbXB0cyB3aXRoIG9wdGlvbmFsIGZpbHRlcmluZ1xyXG4gKiBAcGFyYW0ge09iamVjdH0gZmlsdGVyIC0gT3B0aW9uYWwgZmlsdGVyIGNyaXRlcmlhXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPEFycmF5Pn0gQXJyYXkgb2YgcHJvbXB0c1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFsbFByb21wdHMoZmlsdGVyID0ge30pIHtcclxuICBjb25zdCBjb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29sbGVjdGlvbihDT0xMRUNUSU9OX05BTUUpO1xyXG4gIGNvbnN0IHByb21wdHMgPSBhd2FpdCBjb2xsZWN0aW9uLmZpbmQoZmlsdGVyKS50b0FycmF5KCk7XHJcbiAgcmV0dXJuIHByb21wdHMubWFwKG1hcE1vbmdvUHJvbXB0KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhIHNpbmdsZSBwcm9tcHQgYnkgSURcclxuICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gUHJvbXB0IElEXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdHxudWxsPn0gUHJvbXB0IG9iamVjdCBvciBudWxsXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UHJvbXB0QnlJZChpZCkge1xyXG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb2xsZWN0aW9uKENPTExFQ1RJT05fTkFNRSk7XHJcbiAgY29uc3QgcHJvbXB0ID0gYXdhaXQgY29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoaWQpIH0pO1xyXG4gIHJldHVybiBwcm9tcHQgPyBtYXBNb25nb1Byb21wdChwcm9tcHQpIDogbnVsbDtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhIG5ldyBwcm9tcHRcclxuICogQHBhcmFtIHtPYmplY3R9IHByb21wdERhdGEgLSBQcm9tcHQgZGF0YVxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3Q+fSBDcmVhdGVkIHByb21wdFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVByb21wdChwcm9tcHREYXRhKSB7XHJcbiAgY29uc3QgY29sbGVjdGlvbiA9IGF3YWl0IGdldENvbGxlY3Rpb24oQ09MTEVDVElPTl9OQU1FKTtcclxuICBcclxuICBjb25zdCBuZXdQcm9tcHQgPSB7XHJcbiAgICAuLi5wcm9tcHREYXRhLFxyXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgdXNhZ2VDb3VudDogMCxcclxuICAgIHJhdGluZzogcHJvbXB0RGF0YS5yYXRpbmcgfHwgMFxyXG4gIH07XHJcbiAgXHJcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29sbGVjdGlvbi5pbnNlcnRPbmUobmV3UHJvbXB0KTtcclxuICBcclxuICByZXR1cm4ge1xyXG4gICAgaWQ6IHJlc3VsdC5pbnNlcnRlZElkLnRvU3RyaW5nKCksXHJcbiAgICAuLi5uZXdQcm9tcHRcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogVXBkYXRlIGFuIGV4aXN0aW5nIHByb21wdFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gaWQgLSBQcm9tcHQgSURcclxuICogQHBhcmFtIHtPYmplY3R9IHByb21wdERhdGEgLSBVcGRhdGVkIHByb21wdCBkYXRhXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdHxudWxsPn0gVXBkYXRlZCBwcm9tcHQgb3IgbnVsbFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVByb21wdChpZCwgcHJvbXB0RGF0YSkge1xyXG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb2xsZWN0aW9uKENPTExFQ1RJT05fTkFNRSk7XHJcbiAgXHJcbiAgY29uc3QgdXBkYXRlZFByb21wdCA9IHtcclxuICAgIC4uLnByb21wdERhdGEsXHJcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcclxuICB9O1xyXG4gIFxyXG4gIC8vIERvbid0IG92ZXJyaWRlIHRoZXNlIGZpZWxkcyBpZiBub3QgZXhwbGljaXRseSBwcm92aWRlZFxyXG4gIGRlbGV0ZSB1cGRhdGVkUHJvbXB0Ll9pZDtcclxuICBkZWxldGUgdXBkYXRlZFByb21wdC5pZDtcclxuICBkZWxldGUgdXBkYXRlZFByb21wdC5jcmVhdGVkQXQ7XHJcbiAgXHJcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29sbGVjdGlvbi5maW5kT25lQW5kVXBkYXRlKFxyXG4gICAgeyBfaWQ6IG5ldyBPYmplY3RJZChpZCkgfSxcclxuICAgIHsgJHNldDogdXBkYXRlZFByb21wdCB9LFxyXG4gICAgeyByZXR1cm5Eb2N1bWVudDogJ2FmdGVyJyB9XHJcbiAgKTtcclxuICBcclxuICByZXR1cm4gcmVzdWx0LnZhbHVlID8gbWFwTW9uZ29Qcm9tcHQocmVzdWx0LnZhbHVlKSA6IG51bGw7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZWxldGUgYSBwcm9tcHRcclxuICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gUHJvbXB0IElEXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBTdWNjZXNzIGZsYWdcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVQcm9tcHQoaWQpIHtcclxuICBjb25zdCBjb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29sbGVjdGlvbihDT0xMRUNUSU9OX05BTUUpO1xyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbGxlY3Rpb24uZGVsZXRlT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoaWQpIH0pO1xyXG4gIHJldHVybiByZXN1bHQuZGVsZXRlZENvdW50ID09PSAxO1xyXG59XHJcblxyXG4vKipcclxuICogSW5jcmVtZW50IHByb21wdCB1c2FnZSBjb3VudFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gaWQgLSBQcm9tcHQgSURcclxuICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0fG51bGw+fSBVcGRhdGVkIHByb21wdCBvciBudWxsXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5jcmVtZW50VXNhZ2VDb3VudChpZCkge1xyXG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb2xsZWN0aW9uKENPTExFQ1RJT05fTkFNRSk7XHJcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29sbGVjdGlvbi5maW5kT25lQW5kVXBkYXRlKFxyXG4gICAgeyBfaWQ6IG5ldyBPYmplY3RJZChpZCkgfSxcclxuICAgIHsgJGluYzogeyB1c2FnZUNvdW50OiAxIH0gfSxcclxuICAgIHsgcmV0dXJuRG9jdW1lbnQ6ICdhZnRlcicgfVxyXG4gICk7XHJcbiAgXHJcbiAgcmV0dXJuIHJlc3VsdC52YWx1ZSA/IG1hcE1vbmdvUHJvbXB0KHJlc3VsdC52YWx1ZSkgOiBudWxsO1xyXG59XHJcblxyXG4vKipcclxuICogU2VhcmNoIHByb21wdHMgd2l0aCBhZHZhbmNlZCBmaWx0ZXJpbmdcclxuICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5IC0gU2VhcmNoIHRleHRcclxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBTZWFyY2ggb3B0aW9uc1xyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxBcnJheT59IEFycmF5IG9mIG1hdGNoaW5nIHByb21wdHNcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZWFyY2hQcm9tcHRzKHF1ZXJ5LCBvcHRpb25zID0ge30pIHtcclxuICBjb25zdCBjb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29sbGVjdGlvbihDT0xMRUNUSU9OX05BTUUpO1xyXG4gIFxyXG4gIC8vIEJ1aWxkIE1vbmdvREIgcXVlcnlcclxuICBjb25zdCBmaWx0ZXIgPSB7fTtcclxuICBcclxuICAvLyBUZXh0IHNlYXJjaCBpZiBxdWVyeSBwcm92aWRlZFxyXG4gIGlmIChxdWVyeSAmJiBxdWVyeS50cmltKCkgIT09ICcnKSB7XHJcbiAgICBmaWx0ZXIuJG9yID0gW1xyXG4gICAgICB7IHRpdGxlOiB7ICRyZWdleDogcXVlcnksICRvcHRpb25zOiAnaScgfSB9LFxyXG4gICAgICB7IGNvbnRlbnQ6IHsgJHJlZ2V4OiBxdWVyeSwgJG9wdGlvbnM6ICdpJyB9IH0sXHJcbiAgICAgIHsgZGVzY3JpcHRpb246IHsgJHJlZ2V4OiBxdWVyeSwgJG9wdGlvbnM6ICdpJyB9IH0sXHJcbiAgICAgIHsgdGFnczogeyAkaW46IFtxdWVyeV0gfSB9XHJcbiAgICBdO1xyXG4gIH1cclxuICBcclxuICAvLyBBcHBseSBmaWx0ZXJzXHJcbiAgaWYgKG9wdGlvbnMudXNlcklkKSB7XHJcbiAgICBmaWx0ZXIudXNlcklkID0gb3B0aW9ucy51c2VySWQ7XHJcbiAgfVxyXG4gIFxyXG4gIGlmIChvcHRpb25zLnRlYW1JZCkge1xyXG4gICAgZmlsdGVyLiRvciA9IGZpbHRlci4kb3IgfHwgW107XHJcbiAgICBmaWx0ZXIuJG9yLnB1c2goXHJcbiAgICAgIHsgdGVhbUlkOiBvcHRpb25zLnRlYW1JZCB9LFxyXG4gICAgICB7IHZpc2liaWxpdHk6ICd0ZWFtJywgdGVhbUlkOiBvcHRpb25zLnRlYW1JZCB9XHJcbiAgICApO1xyXG4gIH1cclxuICBcclxuICBpZiAob3B0aW9ucy52aXNpYmlsaXR5KSB7XHJcbiAgICBmaWx0ZXIudmlzaWJpbGl0eSA9IG9wdGlvbnMudmlzaWJpbGl0eTtcclxuICB9XHJcbiAgXHJcbiAgaWYgKG9wdGlvbnMuYWlQbGF0Zm9ybSkge1xyXG4gICAgZmlsdGVyLmFpUGxhdGZvcm0gPSBvcHRpb25zLmFpUGxhdGZvcm07XHJcbiAgfVxyXG4gIFxyXG4gIGlmIChvcHRpb25zLm1pblJhdGluZykge1xyXG4gICAgZmlsdGVyLnJhdGluZyA9IHsgJGd0ZTogcGFyc2VGbG9hdChvcHRpb25zLm1pblJhdGluZykgfTtcclxuICB9XHJcbiAgXHJcbiAgaWYgKG9wdGlvbnMubWluVXNhZ2VDb3VudCkge1xyXG4gICAgZmlsdGVyLnVzYWdlQ291bnQgPSB7ICRndGU6IHBhcnNlSW50KG9wdGlvbnMubWluVXNhZ2VDb3VudCwgMTApIH07XHJcbiAgfVxyXG4gIFxyXG4gIGlmIChvcHRpb25zLnRhZ3MgJiYgb3B0aW9ucy50YWdzLmxlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHRhZ3MgPSBBcnJheS5pc0FycmF5KG9wdGlvbnMudGFncykgPyBvcHRpb25zLnRhZ3MgOiBbb3B0aW9ucy50YWdzXTtcclxuICAgIFxyXG4gICAgaWYgKG9wdGlvbnMudGFnTWF0Y2hUeXBlID09PSAnYW55Jykge1xyXG4gICAgICBmaWx0ZXIudGFncyA9IHsgJGluOiB0YWdzIH07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBmaWx0ZXIudGFncyA9IHsgJGFsbDogdGFncyB9O1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvLyBTb3J0IG9wdGlvbnNcclxuICBjb25zdCBzb3J0ID0ge307XHJcbiAgaWYgKG9wdGlvbnMuc29ydEJ5KSB7XHJcbiAgICBzb3J0W29wdGlvbnMuc29ydEJ5XSA9IG9wdGlvbnMuc29ydERpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gLTEgOiAxO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBzb3J0LmNyZWF0ZWRBdCA9IC0xOyAvLyBEZWZhdWx0IHNvcnQgYnkgbmV3ZXN0XHJcbiAgfVxyXG4gIFxyXG4gIGNvbnN0IHByb21wdHMgPSBhd2FpdCBjb2xsZWN0aW9uXHJcbiAgICAuZmluZChmaWx0ZXIpXHJcbiAgICAuc29ydChzb3J0KVxyXG4gICAgLmxpbWl0KG9wdGlvbnMubGltaXQgfHwgMTAwKVxyXG4gICAgLnRvQXJyYXkoKTtcclxuICBcclxuICByZXR1cm4gcHJvbXB0cy5tYXAobWFwTW9uZ29Qcm9tcHQpO1xyXG59XHJcblxyXG4vKipcclxuICogTWFwIE1vbmdvREIgZG9jdW1lbnQgdG8gYXBwIG1vZGVsIChoYW5kbGluZyBfaWQgY29udmVyc2lvbilcclxuICogQHBhcmFtIHtPYmplY3R9IGRvYyAtIE1vbmdvREIgZG9jdW1lbnRcclxuICogQHJldHVybnMge09iamVjdH0gTWFwcGVkIHByb21wdCBvYmplY3RcclxuICovXHJcbmZ1bmN0aW9uIG1hcE1vbmdvUHJvbXB0KGRvYykge1xyXG4gIHJldHVybiB7XHJcbiAgICBpZDogZG9jLl9pZC50b1N0cmluZygpLFxyXG4gICAgLi4uZG9jLFxyXG4gICAgX2lkOiB1bmRlZmluZWRcclxuICB9O1xyXG59ICJdLCJuYW1lcyI6WyJnZXRDb2xsZWN0aW9uIiwiT2JqZWN0SWQiLCJDT0xMRUNUSU9OX05BTUUiLCJnZXRBbGxQcm9tcHRzIiwiZmlsdGVyIiwiY29sbGVjdGlvbiIsInByb21wdHMiLCJmaW5kIiwidG9BcnJheSIsIm1hcCIsIm1hcE1vbmdvUHJvbXB0IiwiZ2V0UHJvbXB0QnlJZCIsImlkIiwicHJvbXB0IiwiZmluZE9uZSIsIl9pZCIsImNyZWF0ZVByb21wdCIsInByb21wdERhdGEiLCJuZXdQcm9tcHQiLCJjcmVhdGVkQXQiLCJEYXRlIiwidXBkYXRlZEF0IiwidXNhZ2VDb3VudCIsInJhdGluZyIsInJlc3VsdCIsImluc2VydE9uZSIsImluc2VydGVkSWQiLCJ0b1N0cmluZyIsInVwZGF0ZVByb21wdCIsInVwZGF0ZWRQcm9tcHQiLCJmaW5kT25lQW5kVXBkYXRlIiwiJHNldCIsInJldHVybkRvY3VtZW50IiwidmFsdWUiLCJkZWxldGVQcm9tcHQiLCJkZWxldGVPbmUiLCJkZWxldGVkQ291bnQiLCJpbmNyZW1lbnRVc2FnZUNvdW50IiwiJGluYyIsInNlYXJjaFByb21wdHMiLCJxdWVyeSIsIm9wdGlvbnMiLCJ0cmltIiwiJG9yIiwidGl0bGUiLCIkcmVnZXgiLCIkb3B0aW9ucyIsImNvbnRlbnQiLCJkZXNjcmlwdGlvbiIsInRhZ3MiLCIkaW4iLCJ1c2VySWQiLCJ0ZWFtSWQiLCJwdXNoIiwidmlzaWJpbGl0eSIsImFpUGxhdGZvcm0iLCJtaW5SYXRpbmciLCIkZ3RlIiwicGFyc2VGbG9hdCIsIm1pblVzYWdlQ291bnQiLCJwYXJzZUludCIsImxlbmd0aCIsIkFycmF5IiwiaXNBcnJheSIsInRhZ01hdGNoVHlwZSIsIiRhbGwiLCJzb3J0Iiwic29ydEJ5Iiwic29ydERpcmVjdGlvbiIsImxpbWl0IiwiZG9jIiwidW5kZWZpbmVkIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/repositories/promptRepository.js\n");

/***/ }),

/***/ "(api-node)/./lib/teamUtils.js":
/*!**************************!*\
  !*** ./lib/teamUtils.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getMemberRole: () => (/* binding */ getMemberRole),\n/* harmony export */   isTeamAdmin: () => (/* binding */ isTeamAdmin),\n/* harmony export */   isTeamMember: () => (/* binding */ isTeamMember),\n/* harmony export */   sanitizeTeam: () => (/* binding */ sanitizeTeam),\n/* harmony export */   validateTeam: () => (/* binding */ validateTeam)\n/* harmony export */ });\n/**\r\n * Team utility functions for validation, sanitization, and role checks.\r\n * These functions are safe to use on both server and client side\r\n * as they do not depend on the Mongoose model itself.\r\n */ /**\r\n * Validate team data\r\n * @param {Object} data - Team data to validate\r\n * @returns {Object} Validation result with errors if any\r\n */ const validateTeam = (data, isUpdate = false)=>{\n    const errors = {};\n    // Name is required unless this is an update\n    if (!isUpdate || data.name !== undefined) {\n        if (!data.name || data.name.trim() === '') {\n            errors.name = 'Team name is required';\n        } else if (data.name.length > 100) {\n            errors.name = 'Team name must be less than 100 characters';\n        }\n    }\n    // Description length check if provided\n    if (data.description && data.description.length > 500) {\n        errors.description = 'Team description must be less than 500 characters';\n    }\n    // Creator required for new teams\n    if (!isUpdate && !data.userId) {\n        errors.userId = 'Creator ID is required';\n    }\n    return {\n        isValid: Object.keys(errors).length === 0,\n        errors\n    };\n};\n/**\r\n * Sanitize team data for safe display\r\n * @param {Object} team - Team data to sanitize\r\n * @returns {Object} Sanitized team data\r\n */ const sanitizeTeam = (team)=>{\n    return {\n        ...team\n    };\n};\n/**\r\n * Get member role in team\r\n * This function expects the team object to potentially have a `members` array\r\n * where each member has a `user` (with an `equals` method, like a Mongoose ObjectId) and a `role`.\r\n * @param {Object} team - Team object\r\n * @param {string} userId - User ID to check\r\n * @returns {string|null} Member role or null if not a member\r\n */ const getMemberRole = (team, userId)=>{\n    if (!team) {\n        return null;\n    }\n    // The check for m.user?.equals(userId) assumes the `user` field might be populated\n    // or it might be just the ID. The `.equals` method is typical for Mongoose ObjectIds.\n    // If userId is not an ObjectId on the server, direct comparison might be needed.\n    // Using optional chaining `?.` for safety.\n    const member = team.members?.find((m)=>// Check if m.user exists and has an 'equals' method (likely ObjectId)\n        m.user && typeof m.user.equals === 'function' ? m.user.equals(userId) : m.user === userId);\n    return member ? member.role : null;\n};\n/**\r\n * Check if user has admin privileges in team\r\n * @param {Object} team - Team object\r\n * @param {string} userId - User ID to check\r\n * @returns {boolean} True if user is owner or admin\r\n */ const isTeamAdmin = (team, userId)=>{\n    if (!team) return false;\n    const role = getMemberRole(team, userId);\n    return role === 'owner' || role === 'admin';\n};\n/**\r\n * Check if user is a member of the team\r\n * @param {Object} team - Team object\r\n * @param {string} userId - User ID to check\r\n * @returns {boolean} True if user is a team member\r\n */ const isTeamMember = (team, userId)=>{\n    if (!team) return false;\n    return getMemberRole(team, userId) !== null;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi90ZWFtVXRpbHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7OztDQUlDLEdBRUQ7Ozs7Q0FJQyxHQUNNLE1BQU1BLGVBQWUsQ0FBQ0MsTUFBTUMsV0FBVyxLQUFLO0lBQ2pELE1BQU1DLFNBQVMsQ0FBQztJQUVoQiw0Q0FBNEM7SUFDNUMsSUFBSSxDQUFDRCxZQUFZRCxLQUFLRyxJQUFJLEtBQUtDLFdBQVc7UUFDeEMsSUFBSSxDQUFDSixLQUFLRyxJQUFJLElBQUlILEtBQUtHLElBQUksQ0FBQ0UsSUFBSSxPQUFPLElBQUk7WUFDekNILE9BQU9DLElBQUksR0FBRztRQUNoQixPQUFPLElBQUlILEtBQUtHLElBQUksQ0FBQ0csTUFBTSxHQUFHLEtBQUs7WUFDakNKLE9BQU9DLElBQUksR0FBRztRQUNoQjtJQUNGO0lBRUEsdUNBQXVDO0lBQ3ZDLElBQUlILEtBQUtPLFdBQVcsSUFBSVAsS0FBS08sV0FBVyxDQUFDRCxNQUFNLEdBQUcsS0FBSztRQUNyREosT0FBT0ssV0FBVyxHQUFHO0lBQ3ZCO0lBRUEsaUNBQWlDO0lBQ2pDLElBQUksQ0FBQ04sWUFBWSxDQUFDRCxLQUFLUSxNQUFNLEVBQUU7UUFDN0JOLE9BQU9NLE1BQU0sR0FBRztJQUNsQjtJQUVBLE9BQU87UUFDTEMsU0FBU0MsT0FBT0MsSUFBSSxDQUFDVCxRQUFRSSxNQUFNLEtBQUs7UUFDeENKO0lBQ0Y7QUFDRixFQUFFO0FBRUY7Ozs7Q0FJQyxHQUNNLE1BQU1VLGVBQWUsQ0FBQ0M7SUFDM0IsT0FBTztRQUNMLEdBQUdBLElBQUk7SUFFVDtBQUNGLEVBQUU7QUFFRjs7Ozs7OztDQU9DLEdBQ00sTUFBTUMsZ0JBQWdCLENBQUNELE1BQU1MO0lBQ2xDLElBQUksQ0FBQ0ssTUFBTTtRQUNQLE9BQU87SUFDWDtJQUVBLG1GQUFtRjtJQUNuRixzRkFBc0Y7SUFDdEYsaUZBQWlGO0lBQ2pGLDJDQUEyQztJQUMzQyxNQUFNRSxTQUFTRixLQUFLRyxPQUFPLEVBQUVDLEtBQUtDLENBQUFBLElBQ2hDLHNFQUFzRTtRQUN0RUEsRUFBRUMsSUFBSSxJQUFJLE9BQU9ELEVBQUVDLElBQUksQ0FBQ0MsTUFBTSxLQUFLLGFBQy9CRixFQUFFQyxJQUFJLENBQUNDLE1BQU0sQ0FBQ1osVUFFZFUsRUFBRUMsSUFBSSxLQUFLWDtJQUdqQixPQUFPTyxTQUFTQSxPQUFPTSxJQUFJLEdBQUc7QUFDaEMsRUFBRTtBQUVGOzs7OztDQUtDLEdBQ00sTUFBTUMsY0FBYyxDQUFDVCxNQUFNTDtJQUNoQyxJQUFJLENBQUNLLE1BQU0sT0FBTztJQUNsQixNQUFNUSxPQUFPUCxjQUFjRCxNQUFNTDtJQUNqQyxPQUFPYSxTQUFTLFdBQVdBLFNBQVM7QUFDdEMsRUFBRTtBQUVGOzs7OztDQUtDLEdBQ00sTUFBTUUsZUFBZSxDQUFDVixNQUFNTDtJQUNoQyxJQUFJLENBQUNLLE1BQU0sT0FBTztJQUNuQixPQUFPQyxjQUFjRCxNQUFNTCxZQUFZO0FBQ3pDLEVBQUUiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmF1ZGlcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9tcHRQcm9cXFByb21wdFByb1xcbGliXFx0ZWFtVXRpbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFRlYW0gdXRpbGl0eSBmdW5jdGlvbnMgZm9yIHZhbGlkYXRpb24sIHNhbml0aXphdGlvbiwgYW5kIHJvbGUgY2hlY2tzLlxyXG4gKiBUaGVzZSBmdW5jdGlvbnMgYXJlIHNhZmUgdG8gdXNlIG9uIGJvdGggc2VydmVyIGFuZCBjbGllbnQgc2lkZVxyXG4gKiBhcyB0aGV5IGRvIG5vdCBkZXBlbmQgb24gdGhlIE1vbmdvb3NlIG1vZGVsIGl0c2VsZi5cclxuICovXHJcblxyXG4vKipcclxuICogVmFsaWRhdGUgdGVhbSBkYXRhXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gVGVhbSBkYXRhIHRvIHZhbGlkYXRlXHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IFZhbGlkYXRpb24gcmVzdWx0IHdpdGggZXJyb3JzIGlmIGFueVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlVGVhbSA9IChkYXRhLCBpc1VwZGF0ZSA9IGZhbHNlKSA9PiB7XHJcbiAgY29uc3QgZXJyb3JzID0ge307XHJcblxyXG4gIC8vIE5hbWUgaXMgcmVxdWlyZWQgdW5sZXNzIHRoaXMgaXMgYW4gdXBkYXRlXHJcbiAgaWYgKCFpc1VwZGF0ZSB8fCBkYXRhLm5hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgaWYgKCFkYXRhLm5hbWUgfHwgZGF0YS5uYW1lLnRyaW0oKSA9PT0gJycpIHtcclxuICAgICAgZXJyb3JzLm5hbWUgPSAnVGVhbSBuYW1lIGlzIHJlcXVpcmVkJztcclxuICAgIH0gZWxzZSBpZiAoZGF0YS5uYW1lLmxlbmd0aCA+IDEwMCkge1xyXG4gICAgICBlcnJvcnMubmFtZSA9ICdUZWFtIG5hbWUgbXVzdCBiZSBsZXNzIHRoYW4gMTAwIGNoYXJhY3RlcnMnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gRGVzY3JpcHRpb24gbGVuZ3RoIGNoZWNrIGlmIHByb3ZpZGVkXHJcbiAgaWYgKGRhdGEuZGVzY3JpcHRpb24gJiYgZGF0YS5kZXNjcmlwdGlvbi5sZW5ndGggPiA1MDApIHtcclxuICAgIGVycm9ycy5kZXNjcmlwdGlvbiA9ICdUZWFtIGRlc2NyaXB0aW9uIG11c3QgYmUgbGVzcyB0aGFuIDUwMCBjaGFyYWN0ZXJzJztcclxuICB9XHJcblxyXG4gIC8vIENyZWF0b3IgcmVxdWlyZWQgZm9yIG5ldyB0ZWFtc1xyXG4gIGlmICghaXNVcGRhdGUgJiYgIWRhdGEudXNlcklkKSB7XHJcbiAgICBlcnJvcnMudXNlcklkID0gJ0NyZWF0b3IgSUQgaXMgcmVxdWlyZWQnO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGlzVmFsaWQ6IE9iamVjdC5rZXlzKGVycm9ycykubGVuZ3RoID09PSAwLFxyXG4gICAgZXJyb3JzLFxyXG4gIH07XHJcbn07XHJcblxyXG4vKipcclxuICogU2FuaXRpemUgdGVhbSBkYXRhIGZvciBzYWZlIGRpc3BsYXlcclxuICogQHBhcmFtIHtPYmplY3R9IHRlYW0gLSBUZWFtIGRhdGEgdG8gc2FuaXRpemVcclxuICogQHJldHVybnMge09iamVjdH0gU2FuaXRpemVkIHRlYW0gZGF0YVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IHNhbml0aXplVGVhbSA9ICh0ZWFtKSA9PiB7XHJcbiAgcmV0dXJuIHtcclxuICAgIC4uLnRlYW0sXHJcbiAgICAvLyBSZW1vdmUgYW55IHNlbnNpdGl2ZSBpbmZvcm1hdGlvbiBpZiBuZWVkZWRcclxuICB9O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEdldCBtZW1iZXIgcm9sZSBpbiB0ZWFtXHJcbiAqIFRoaXMgZnVuY3Rpb24gZXhwZWN0cyB0aGUgdGVhbSBvYmplY3QgdG8gcG90ZW50aWFsbHkgaGF2ZSBhIGBtZW1iZXJzYCBhcnJheVxyXG4gKiB3aGVyZSBlYWNoIG1lbWJlciBoYXMgYSBgdXNlcmAgKHdpdGggYW4gYGVxdWFsc2AgbWV0aG9kLCBsaWtlIGEgTW9uZ29vc2UgT2JqZWN0SWQpIGFuZCBhIGByb2xlYC5cclxuICogQHBhcmFtIHtPYmplY3R9IHRlYW0gLSBUZWFtIG9iamVjdFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdXNlcklkIC0gVXNlciBJRCB0byBjaGVja1xyXG4gKiBAcmV0dXJucyB7c3RyaW5nfG51bGx9IE1lbWJlciByb2xlIG9yIG51bGwgaWYgbm90IGEgbWVtYmVyXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZ2V0TWVtYmVyUm9sZSA9ICh0ZWFtLCB1c2VySWQpID0+IHtcclxuICBpZiAoIXRlYW0pIHtcclxuICAgICAgcmV0dXJuIG51bGw7IFxyXG4gIH1cclxuICBcclxuICAvLyBUaGUgY2hlY2sgZm9yIG0udXNlcj8uZXF1YWxzKHVzZXJJZCkgYXNzdW1lcyB0aGUgYHVzZXJgIGZpZWxkIG1pZ2h0IGJlIHBvcHVsYXRlZFxyXG4gIC8vIG9yIGl0IG1pZ2h0IGJlIGp1c3QgdGhlIElELiBUaGUgYC5lcXVhbHNgIG1ldGhvZCBpcyB0eXBpY2FsIGZvciBNb25nb29zZSBPYmplY3RJZHMuXHJcbiAgLy8gSWYgdXNlcklkIGlzIG5vdCBhbiBPYmplY3RJZCBvbiB0aGUgc2VydmVyLCBkaXJlY3QgY29tcGFyaXNvbiBtaWdodCBiZSBuZWVkZWQuXHJcbiAgLy8gVXNpbmcgb3B0aW9uYWwgY2hhaW5pbmcgYD8uYCBmb3Igc2FmZXR5LlxyXG4gIGNvbnN0IG1lbWJlciA9IHRlYW0ubWVtYmVycz8uZmluZChtID0+IFxyXG4gICAgLy8gQ2hlY2sgaWYgbS51c2VyIGV4aXN0cyBhbmQgaGFzIGFuICdlcXVhbHMnIG1ldGhvZCAobGlrZWx5IE9iamVjdElkKVxyXG4gICAgbS51c2VyICYmIHR5cGVvZiBtLnVzZXIuZXF1YWxzID09PSAnZnVuY3Rpb24nIFxyXG4gICAgICA/IG0udXNlci5lcXVhbHModXNlcklkKSBcclxuICAgICAgLy8gT3RoZXJ3aXNlLCB0cnkgY29tcGFyaW5nIGRpcmVjdGx5IChhc3N1bWluZyBtLnVzZXIgbWlnaHQgYmUgYSBzdHJpbmcgSUQpXHJcbiAgICAgIDogbS51c2VyID09PSB1c2VySWRcclxuICApO1xyXG4gIFxyXG4gIHJldHVybiBtZW1iZXIgPyBtZW1iZXIucm9sZSA6IG51bGw7XHJcbn07XHJcblxyXG4vKipcclxuICogQ2hlY2sgaWYgdXNlciBoYXMgYWRtaW4gcHJpdmlsZWdlcyBpbiB0ZWFtXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSB0ZWFtIC0gVGVhbSBvYmplY3RcclxuICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSUQgdG8gY2hlY2tcclxuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdXNlciBpcyBvd25lciBvciBhZG1pblxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGlzVGVhbUFkbWluID0gKHRlYW0sIHVzZXJJZCkgPT4ge1xyXG4gIGlmICghdGVhbSkgcmV0dXJuIGZhbHNlOyBcclxuICBjb25zdCByb2xlID0gZ2V0TWVtYmVyUm9sZSh0ZWFtLCB1c2VySWQpO1xyXG4gIHJldHVybiByb2xlID09PSAnb3duZXInIHx8IHJvbGUgPT09ICdhZG1pbic7XHJcbn07XHJcblxyXG4vKipcclxuICogQ2hlY2sgaWYgdXNlciBpcyBhIG1lbWJlciBvZiB0aGUgdGVhbVxyXG4gKiBAcGFyYW0ge09iamVjdH0gdGVhbSAtIFRlYW0gb2JqZWN0XHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB1c2VySWQgLSBVc2VyIElEIHRvIGNoZWNrXHJcbiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHVzZXIgaXMgYSB0ZWFtIG1lbWJlclxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGlzVGVhbU1lbWJlciA9ICh0ZWFtLCB1c2VySWQpID0+IHtcclxuICAgaWYgKCF0ZWFtKSByZXR1cm4gZmFsc2U7XHJcbiAgcmV0dXJuIGdldE1lbWJlclJvbGUodGVhbSwgdXNlcklkKSAhPT0gbnVsbDtcclxufTsgIl0sIm5hbWVzIjpbInZhbGlkYXRlVGVhbSIsImRhdGEiLCJpc1VwZGF0ZSIsImVycm9ycyIsIm5hbWUiLCJ1bmRlZmluZWQiLCJ0cmltIiwibGVuZ3RoIiwiZGVzY3JpcHRpb24iLCJ1c2VySWQiLCJpc1ZhbGlkIiwiT2JqZWN0Iiwia2V5cyIsInNhbml0aXplVGVhbSIsInRlYW0iLCJnZXRNZW1iZXJSb2xlIiwibWVtYmVyIiwibWVtYmVycyIsImZpbmQiLCJtIiwidXNlciIsImVxdWFscyIsInJvbGUiLCJpc1RlYW1BZG1pbiIsImlzVGVhbU1lbWJlciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/teamUtils.js\n");

/***/ }),

/***/ "(api-node)/./models/auditLog.js":
/*!****************************!*\
  !*** ./models/auditLog.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   logAuditEvent: () => (/* binding */ logAuditEvent)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst AuditLogSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    timestamp: {\n        type: Date,\n        default: Date.now,\n        index: true,\n        required: true\n    },\n    userId: {\n        type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n        ref: 'User',\n        index: true\n    },\n    action: {\n        type: String,\n        required: [\n            true,\n            'Action identifier is required.'\n        ],\n        trim: true,\n        index: true\n    },\n    targetType: {\n        type: String,\n        trim: true,\n        index: true\n    },\n    targetId: {\n        type: String,\n        trim: true,\n        index: true\n    },\n    details: {\n        type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.Mixed,\n        default: {}\n    }\n}, {\n    timestamps: {\n        createdAt: 'timestamp',\n        updatedAt: false\n    } // Use timestamp as createdAt, disable updatedAt\n});\n// Compound indexes for common audit queries\nAuditLogSchema.index({\n    userId: 1,\n    timestamp: -1\n});\nAuditLogSchema.index({\n    action: 1,\n    timestamp: -1\n});\nAuditLogSchema.index({\n    targetType: 1,\n    targetId: 1,\n    timestamp: -1\n});\n// Consider adding TTL index if logs should expire automatically\n// AuditLogSchema.index({ timestamp: 1 }, { expireAfterSeconds: 365 * 24 * 60 * 60 }); // 1 year\nconst AuditLog = mongoose__WEBPACK_IMPORTED_MODULE_0__.models.AuditLog || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model('AuditLog', AuditLogSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AuditLog);\n// Helper function to simplify logging (can be placed in a lib file)\nasync function logAuditEvent(data) {\n    try {\n        // Ensure required fields are present\n        if (!data.action) {\n            throw new Error('Audit log requires an action.');\n        }\n        // Add timestamp if not provided (should be handled by default, but safety check)\n        if (!data.timestamp) {\n            data.timestamp = new Date();\n        }\n        const logEntry = new AuditLog(data);\n        await logEntry.save();\n        console.log(`[Audit Log] Action: ${data.action}, User: ${data.userId || 'System'}, Target: ${data.targetType || 'N/A'}:${data.targetId || 'N/A'}`);\n    } catch (error) {\n        console.error('Failed to save audit log:', error, 'Data:', data);\n    // Decide how to handle logging failures (e.g., log to console, metrics)\n    // Avoid throwing error here to prevent disruption of the main API flow\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL21vZGVscy9hdWRpdExvZy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQW9EO0FBRXBELE1BQU1HLGlCQUFpQixJQUFJRiw0Q0FBTUEsQ0FBQztJQUM5QkcsV0FBVztRQUNQQyxNQUFNQztRQUNOQyxTQUFTRCxLQUFLRSxHQUFHO1FBQ2pCQyxPQUFPO1FBQ1BDLFVBQVU7SUFDZDtJQUNBQyxRQUFRO1FBQ0pOLE1BQU1KLDRDQUFNQSxDQUFDVyxLQUFLLENBQUNDLFFBQVE7UUFDM0JDLEtBQUs7UUFDTEwsT0FBTztJQUVYO0lBQ0FNLFFBQVE7UUFDSlYsTUFBTVc7UUFDTk4sVUFBVTtZQUFDO1lBQU07U0FBaUM7UUFDbERPLE1BQU07UUFDTlIsT0FBTztJQUlYO0lBQ0FTLFlBQVk7UUFDUmIsTUFBTVc7UUFDTkMsTUFBTTtRQUNOUixPQUFPO0lBRVg7SUFDQVUsVUFBVTtRQUNOZCxNQUFNVztRQUNOQyxNQUFNO1FBQ05SLE9BQU87SUFDWDtJQUNBVyxTQUFTO1FBQ0xmLE1BQU1KLDRDQUFNQSxDQUFDVyxLQUFLLENBQUNTLEtBQUs7UUFDeEJkLFNBQVMsQ0FBQztJQUtkO0FBQ0osR0FBRztJQUNDZSxZQUFZO1FBQUVDLFdBQVc7UUFBYUMsV0FBVztJQUFNLEVBQUUsZ0RBQWdEO0FBQzdHO0FBRUEsNENBQTRDO0FBQzVDckIsZUFBZU0sS0FBSyxDQUFDO0lBQUVFLFFBQVE7SUFBR1AsV0FBVyxDQUFDO0FBQUU7QUFDaERELGVBQWVNLEtBQUssQ0FBQztJQUFFTSxRQUFRO0lBQUdYLFdBQVcsQ0FBQztBQUFFO0FBQ2hERCxlQUFlTSxLQUFLLENBQUM7SUFBRVMsWUFBWTtJQUFHQyxVQUFVO0lBQUdmLFdBQVcsQ0FBQztBQUFFO0FBRWpFLGdFQUFnRTtBQUNoRSxnR0FBZ0c7QUFFaEcsTUFBTXFCLFdBQVd2Qiw0Q0FBTUEsQ0FBQ3VCLFFBQVEsSUFBSXpCLHFEQUFjLENBQUMsWUFBWUc7QUFFL0QsaUVBQWVzQixRQUFRQSxFQUFDO0FBRXhCLG9FQUFvRTtBQUM3RCxlQUFlRSxjQUFjQyxJQUFJO0lBQ3BDLElBQUk7UUFDQSxxQ0FBcUM7UUFDckMsSUFBSSxDQUFDQSxLQUFLYixNQUFNLEVBQUU7WUFDZCxNQUFNLElBQUljLE1BQU07UUFDcEI7UUFDQSxpRkFBaUY7UUFDakYsSUFBSSxDQUFDRCxLQUFLeEIsU0FBUyxFQUFFO1lBQ2pCd0IsS0FBS3hCLFNBQVMsR0FBRyxJQUFJRTtRQUN6QjtRQUVBLE1BQU13QixXQUFXLElBQUlMLFNBQVNHO1FBQzlCLE1BQU1FLFNBQVNDLElBQUk7UUFDbkJDLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLG9CQUFvQixFQUFFTCxLQUFLYixNQUFNLENBQUMsUUFBUSxFQUFFYSxLQUFLakIsTUFBTSxJQUFJLFNBQVMsVUFBVSxFQUFFaUIsS0FBS1YsVUFBVSxJQUFJLE1BQU0sQ0FBQyxFQUFFVSxLQUFLVCxRQUFRLElBQUksT0FBTztJQUNySixFQUFFLE9BQU9lLE9BQU87UUFDWkYsUUFBUUUsS0FBSyxDQUFDLDZCQUE2QkEsT0FBTyxTQUFTTjtJQUMzRCx3RUFBd0U7SUFDeEUsdUVBQXVFO0lBQzNFO0FBQ0oiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYmF1ZGlcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9tcHRQcm9cXFByb21wdFByb1xcbW9kZWxzXFxhdWRpdExvZy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UsIHsgU2NoZW1hLCBtb2RlbHMgfSBmcm9tICdtb25nb29zZSc7XHJcblxyXG5jb25zdCBBdWRpdExvZ1NjaGVtYSA9IG5ldyBTY2hlbWEoe1xyXG4gICAgdGltZXN0YW1wOiB7XHJcbiAgICAgICAgdHlwZTogRGF0ZSxcclxuICAgICAgICBkZWZhdWx0OiBEYXRlLm5vdyxcclxuICAgICAgICBpbmRleDogdHJ1ZSxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgIH0sXHJcbiAgICB1c2VySWQ6IHsgLy8gVGhlIHVzZXIgd2hvIHBlcmZvcm1lZCB0aGUgYWN0aW9uIChpZiBhcHBsaWNhYmxlKVxyXG4gICAgICAgIHR5cGU6IFNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICByZWY6ICdVc2VyJyxcclxuICAgICAgICBpbmRleDogdHJ1ZSxcclxuICAgICAgICAvLyByZXF1aXJlZDogdHJ1ZSwgLy8gTm90IHN0cmljdGx5IHJlcXVpcmVkIGlmIGFjdGlvbiBpcyBzeXN0ZW0tcmVsYXRlZD9cclxuICAgIH0sXHJcbiAgICBhY3Rpb246IHsgLy8gQSBzcGVjaWZpYyBpZGVudGlmaWVyIGZvciB0aGUgYWN0aW9uIHBlcmZvcm1lZFxyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICByZXF1aXJlZDogW3RydWUsICdBY3Rpb24gaWRlbnRpZmllciBpcyByZXF1aXJlZC4nXSxcclxuICAgICAgICB0cmltOiB0cnVlLFxyXG4gICAgICAgIGluZGV4OiB0cnVlLFxyXG4gICAgICAgIC8vIEV4YW1wbGVzOiAnbG9naW4nLCAnbG9nb3V0JywgJ2NyZWF0ZV9wcm9tcHQnLCAnZGVsZXRlX3Byb21wdCcsIFxyXG4gICAgICAgIC8vICAgICAgICAgICAndXBkYXRlX3RlYW1fcm9sZScsICdhZGRfdGVhbV9tZW1iZXInLCAncmVtb3ZlX3RlYW1fbWVtYmVyJyxcclxuICAgICAgICAvLyAgICAgICAgICAgJ3VwZ3JhZGVfcGxhbicsICdjYW5jZWxfc3Vic2NyaXB0aW9uJ1xyXG4gICAgfSxcclxuICAgIHRhcmdldFR5cGU6IHsgLy8gVGhlIHR5cGUgb2YgZW50aXR5IGFmZmVjdGVkIGJ5IHRoZSBhY3Rpb25cclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgdHJpbTogdHJ1ZSxcclxuICAgICAgICBpbmRleDogdHJ1ZSxcclxuICAgICAgICAvLyBFeGFtcGxlczogJ3VzZXInLCAncHJvbXB0JywgJ3RlYW0nLCAnY29tbWVudCcsICdzdWJzY3JpcHRpb24nLCAnc3lzdGVtJ1xyXG4gICAgfSxcclxuICAgIHRhcmdldElkOiB7IC8vIFRoZSBzcGVjaWZpYyBJRCBvZiB0aGUgZW50aXR5IGFmZmVjdGVkIChjYW4gYmUgT2JqZWN0SWQgb3Igb3RoZXIgc3RyaW5nIElEKVxyXG4gICAgICAgIHR5cGU6IFN0cmluZywgXHJcbiAgICAgICAgdHJpbTogdHJ1ZSxcclxuICAgICAgICBpbmRleDogdHJ1ZSxcclxuICAgIH0sXHJcbiAgICBkZXRhaWxzOiB7IC8vIEFkZGl0aW9uYWwgY29udGV4dCBhYm91dCB0aGUgZXZlbnRcclxuICAgICAgICB0eXBlOiBTY2hlbWEuVHlwZXMuTWl4ZWQsIC8vIEFsbG93cyBzdG9yaW5nIG9iamVjdHMgd2l0aCB2YXJ5aW5nIHN0cnVjdHVyZXNcclxuICAgICAgICBkZWZhdWx0OiB7fVxyXG4gICAgICAgIC8vIEV4YW1wbGVzOiBcclxuICAgICAgICAvLyBGb3IgbG9naW46IHsgaXBBZGRyZXNzOiAnMS4yLjMuNCcsIHVzZXJBZ2VudDogJy4uLicgfVxyXG4gICAgICAgIC8vIEZvciB1cGRhdGU6IHsgZmllbGQ6ICdyb2xlJywgb2xkVmFsdWU6ICdtZW1iZXInLCBuZXdWYWx1ZTogJ2FkbWluJyB9XHJcbiAgICAgICAgLy8gRm9yIGRlbGV0ZTogeyBkZWxldGVkT2JqZWN0TmFtZTogJ015IE9sZCBQcm9tcHQnIH1cclxuICAgIH1cclxufSwge1xyXG4gICAgdGltZXN0YW1wczogeyBjcmVhdGVkQXQ6ICd0aW1lc3RhbXAnLCB1cGRhdGVkQXQ6IGZhbHNlIH0gLy8gVXNlIHRpbWVzdGFtcCBhcyBjcmVhdGVkQXQsIGRpc2FibGUgdXBkYXRlZEF0XHJcbn0pO1xyXG5cclxuLy8gQ29tcG91bmQgaW5kZXhlcyBmb3IgY29tbW9uIGF1ZGl0IHF1ZXJpZXNcclxuQXVkaXRMb2dTY2hlbWEuaW5kZXgoeyB1c2VySWQ6IDEsIHRpbWVzdGFtcDogLTEgfSk7XHJcbkF1ZGl0TG9nU2NoZW1hLmluZGV4KHsgYWN0aW9uOiAxLCB0aW1lc3RhbXA6IC0xIH0pO1xyXG5BdWRpdExvZ1NjaGVtYS5pbmRleCh7IHRhcmdldFR5cGU6IDEsIHRhcmdldElkOiAxLCB0aW1lc3RhbXA6IC0xIH0pO1xyXG5cclxuLy8gQ29uc2lkZXIgYWRkaW5nIFRUTCBpbmRleCBpZiBsb2dzIHNob3VsZCBleHBpcmUgYXV0b21hdGljYWxseVxyXG4vLyBBdWRpdExvZ1NjaGVtYS5pbmRleCh7IHRpbWVzdGFtcDogMSB9LCB7IGV4cGlyZUFmdGVyU2Vjb25kczogMzY1ICogMjQgKiA2MCAqIDYwIH0pOyAvLyAxIHllYXJcclxuXHJcbmNvbnN0IEF1ZGl0TG9nID0gbW9kZWxzLkF1ZGl0TG9nIHx8IG1vbmdvb3NlLm1vZGVsKCdBdWRpdExvZycsIEF1ZGl0TG9nU2NoZW1hKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IEF1ZGl0TG9nO1xyXG5cclxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIHNpbXBsaWZ5IGxvZ2dpbmcgKGNhbiBiZSBwbGFjZWQgaW4gYSBsaWIgZmlsZSlcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ0F1ZGl0RXZlbnQoZGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICAvLyBFbnN1cmUgcmVxdWlyZWQgZmllbGRzIGFyZSBwcmVzZW50XHJcbiAgICAgICAgaWYgKCFkYXRhLmFjdGlvbikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1ZGl0IGxvZyByZXF1aXJlcyBhbiBhY3Rpb24uJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEFkZCB0aW1lc3RhbXAgaWYgbm90IHByb3ZpZGVkIChzaG91bGQgYmUgaGFuZGxlZCBieSBkZWZhdWx0LCBidXQgc2FmZXR5IGNoZWNrKVxyXG4gICAgICAgIGlmICghZGF0YS50aW1lc3RhbXApIHtcclxuICAgICAgICAgICAgZGF0YS50aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBsb2dFbnRyeSA9IG5ldyBBdWRpdExvZyhkYXRhKTtcclxuICAgICAgICBhd2FpdCBsb2dFbnRyeS5zYXZlKCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coYFtBdWRpdCBMb2ddIEFjdGlvbjogJHtkYXRhLmFjdGlvbn0sIFVzZXI6ICR7ZGF0YS51c2VySWQgfHwgJ1N5c3RlbSd9LCBUYXJnZXQ6ICR7ZGF0YS50YXJnZXRUeXBlIHx8ICdOL0EnfToke2RhdGEudGFyZ2V0SWQgfHwgJ04vQSd9YCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzYXZlIGF1ZGl0IGxvZzonLCBlcnJvciwgJ0RhdGE6JywgZGF0YSk7XHJcbiAgICAgICAgLy8gRGVjaWRlIGhvdyB0byBoYW5kbGUgbG9nZ2luZyBmYWlsdXJlcyAoZS5nLiwgbG9nIHRvIGNvbnNvbGUsIG1ldHJpY3MpXHJcbiAgICAgICAgLy8gQXZvaWQgdGhyb3dpbmcgZXJyb3IgaGVyZSB0byBwcmV2ZW50IGRpc3J1cHRpb24gb2YgdGhlIG1haW4gQVBJIGZsb3dcclxuICAgIH1cclxufSAiXSwibmFtZXMiOlsibW9uZ29vc2UiLCJTY2hlbWEiLCJtb2RlbHMiLCJBdWRpdExvZ1NjaGVtYSIsInRpbWVzdGFtcCIsInR5cGUiLCJEYXRlIiwiZGVmYXVsdCIsIm5vdyIsImluZGV4IiwicmVxdWlyZWQiLCJ1c2VySWQiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwiYWN0aW9uIiwiU3RyaW5nIiwidHJpbSIsInRhcmdldFR5cGUiLCJ0YXJnZXRJZCIsImRldGFpbHMiLCJNaXhlZCIsInRpbWVzdGFtcHMiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJBdWRpdExvZyIsIm1vZGVsIiwibG9nQXVkaXRFdmVudCIsImRhdGEiLCJFcnJvciIsImxvZ0VudHJ5Iiwic2F2ZSIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./models/auditLog.js\n");

/***/ }),

/***/ "(api-node)/./models/prompt.js":
/*!**************************!*\
  !*** ./models/prompt.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SUPPORTED_AI_PLATFORMS: () => (/* binding */ SUPPORTED_AI_PLATFORMS),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   validatePrompt: () => (/* binding */ validatePrompt)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\n// Prompt model structure\n// Define supported AI platforms\nconst SUPPORTED_AI_PLATFORMS = [\n    'ChatGPT',\n    'Claude',\n    'Gemini',\n    'MidJourney',\n    'DALL-E',\n    'Other' // Allow a generic 'Other' category\n];\nconst RatingSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    user: {\n        type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n        ref: 'User',\n        required: true\n    },\n    value: {\n        type: Number,\n        required: true,\n        min: 1,\n        max: 5\n    }\n}, {\n    _id: false\n}); // Don't create separate _id for subdocuments\nconst PromptSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    title: {\n        type: String,\n        required: [\n            true,\n            'Title is required.'\n        ],\n        trim: true,\n        minlength: [\n            3,\n            'Title must be at least 3 characters.'\n        ],\n        maxlength: [\n            150,\n            'Title cannot exceed 150 characters.'\n        ] // Increased length slightly\n    },\n    text: {\n        type: String,\n        required: [\n            true,\n            'Prompt text is required.'\n        ],\n        trim: true,\n        minlength: [\n            10,\n            'Prompt text must be at least 10 characters.'\n        ]\n    },\n    description: {\n        type: String,\n        trim: true,\n        maxlength: [\n            500,\n            'Description cannot exceed 500 characters.'\n        ]\n    },\n    creator: {\n        type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n        ref: 'User',\n        required: [\n            true,\n            'Creator is required.'\n        ]\n    },\n    tags: [\n        {\n            type: String,\n            trim: true,\n            lowercase: true,\n            validate: [\n                arrayLimit,\n                '{PATH} exceeds the limit of 10 tags'\n            ]\n        }\n    ],\n    platformCompatibility: [\n        {\n            type: String,\n            enum: SUPPORTED_AI_PLATFORMS // Validate against the list\n        }\n    ],\n    // Basic performance tracking fields\n    usageCount: {\n        type: Number,\n        default: 0,\n        min: 0\n    },\n    ratings: [\n        RatingSchema\n    ],\n    successCount: {\n        type: Number,\n        default: 0,\n        min: 0\n    },\n    failureCount: {\n        type: Number,\n        default: 0,\n        min: 0\n    },\n    visibility: {\n        type: String,\n        enum: [\n            'private',\n            'team',\n            'public'\n        ],\n        default: 'private',\n        required: true,\n        index: true\n    },\n    teamId: {\n        type: mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema.Types.ObjectId,\n        ref: 'Team',\n        index: true,\n        sparse: true\n    },\n    isEffective: {\n        type: Boolean,\n        default: null,\n        index: true\n    },\n    variables: {\n        type: [\n            String\n        ],\n        default: []\n    },\n    version: {\n        type: Number,\n        default: 1\n    }\n}, {\n    timestamps: true // Automatically add createdAt and updatedAt\n});\n// --- Indexing --- \n// Index fields that are often queried/sorted\nPromptSchema.index({\n    creator: 1,\n    createdAt: -1\n});\nPromptSchema.index({\n    tags: 1\n});\nPromptSchema.index({\n    title: 'text',\n    description: 'text'\n}); // For text search later\nPromptSchema.index({\n    teamId: 1\n}); // Add index for teamId\nPromptSchema.index({\n    title: 'text',\n    text: 'text',\n    description: 'text',\n    tags: 'text'\n});\n// --- Virtuals (Example: Average Rating - Calculation might be complex/deferred) ---\n/*\nPromptSchema.virtual('averageRating').get(function() {\n    if (this.ratings && this.ratings.length > 0) {\n        const sum = this.ratings.reduce((acc, rating) => acc + rating.value, 0);\n        return sum / this.ratings.length;\n    }\n    return 0;\n});\n\nPromptSchema.virtual('successRate').get(function() {\n    const totalFeedback = this.successCount + this.failureCount;\n    if (totalFeedback === 0) {\n        return null; // Or 0, depending on desired representation\n    }\n    return (this.successCount / totalFeedback) * 100;\n});\n\n// Ensure virtuals are included when converting to JSON/Object\nPromptSchema.set('toJSON', { virtuals: true });\nPromptSchema.set('toObject', { virtuals: true });\n*/ // --- Model Creation ---\nconst Prompt = mongoose__WEBPACK_IMPORTED_MODULE_0__.models.Prompt || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model('Prompt', PromptSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Prompt);\n// --- Validation Function ---\nfunction validatePrompt(data) {\n    const errors = {};\n    let isValid = true;\n    // Check for required fields\n    if (!data.title || typeof data.title !== 'string' || data.title.trim().length === 0) {\n        errors.title = 'Title is required.';\n        isValid = false;\n    }\n    // Check the actual schema field 'text'\n    if (!data.text || typeof data.text !== 'string' || data.text.trim().length === 0) {\n        errors.text = 'Prompt text is required.'; // Changed key to 'text'\n        isValid = false;\n    }\n    // Potential future checks: length constraints, tag formats, etc.\n    // Note: Mongoose schema validation will handle more detailed checks later.\n    return {\n        isValid,\n        errors\n    };\n}\n// Helper function for array limit validation\nfunction arrayLimit(val) {\n    return val.length <= 10;\n}\n// Ensure teamId is present if visibility is 'team'\nPromptSchema.path('teamId').validate(function(value) {\n    return this.visibility !== 'team' || value != null;\n}, 'Team ID is required when visibility is set to team.'); // Pre-save hook to increment version (Example - adjust if needed)\n // PromptSchema.pre('save', function(next) {\n //     if (!this.isNew && this.isModified()) {\n //         this.version += 1;\n //     }\n //     next();\n // });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWtFO0NBQ2xFLDRDQUE0QztDQUM1Qyw4Q0FBOEM7Q0FDOUMsNkJBQTZCO0NBQzdCLFFBQVE7Q0FDUixjQUFjO0NBQ2QsTUFBTSIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxiYXVkaVxcT25lRHJpdmVcXERlc2t0b3BcXFByb21wdFByb1xcUHJvbXB0UHJvXFxtb2RlbHNcXHByb21wdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UsIHsgU2NoZW1hLCBtb2RlbHMgfSBmcm9tICdtb25nb29zZSc7XG5cbi8vIFByb21wdCBtb2RlbCBzdHJ1Y3R1cmVcblxuLy8gRGVmaW5lIHN1cHBvcnRlZCBBSSBwbGF0Zm9ybXNcbmV4cG9ydCBjb25zdCBTVVBQT1JURURfQUlfUExBVEZPUk1TID0gW1xuICAnQ2hhdEdQVCcsIFxuICAnQ2xhdWRlJywgXG4gICdHZW1pbmknLCBcbiAgJ01pZEpvdXJuZXknLCBcbiAgJ0RBTEwtRScsXG4gICdPdGhlcicgLy8gQWxsb3cgYSBnZW5lcmljICdPdGhlcicgY2F0ZWdvcnlcbl07XG5cbmNvbnN0IFJhdGluZ1NjaGVtYSA9IG5ldyBTY2hlbWEoe1xuICAgIHVzZXI6IHsgdHlwZTogU2NoZW1hLlR5cGVzLk9iamVjdElkLCByZWY6ICdVc2VyJywgcmVxdWlyZWQ6IHRydWUgfSxcbiAgICB2YWx1ZToge1xuICAgICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICBtaW46IDEsXG4gICAgICAgIG1heDogNVxuICAgIH1cbn0sIHsgX2lkOiBmYWxzZSB9KTsgLy8gRG9uJ3QgY3JlYXRlIHNlcGFyYXRlIF9pZCBmb3Igc3ViZG9jdW1lbnRzXG5cbmNvbnN0IFByb21wdFNjaGVtYSA9IG5ldyBTY2hlbWEoe1xuICAgIHRpdGxlOiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgcmVxdWlyZWQ6IFt0cnVlLCAnVGl0bGUgaXMgcmVxdWlyZWQuJ10sXG4gICAgICAgIHRyaW06IHRydWUsXG4gICAgICAgIG1pbmxlbmd0aDogWzMsICdUaXRsZSBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVycy4nXSxcbiAgICAgICAgbWF4bGVuZ3RoOiBbMTUwLCAnVGl0bGUgY2Fubm90IGV4Y2VlZCAxNTAgY2hhcmFjdGVycy4nXSAvLyBJbmNyZWFzZWQgbGVuZ3RoIHNsaWdodGx5XG4gICAgfSxcbiAgICB0ZXh0OiB7IC8vIFJlbmFtZWQgZnJvbSBjb250ZW50XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgcmVxdWlyZWQ6IFt0cnVlLCAnUHJvbXB0IHRleHQgaXMgcmVxdWlyZWQuJ10sXG4gICAgICAgIHRyaW06IHRydWUsXG4gICAgICAgIG1pbmxlbmd0aDogWzEwLCAnUHJvbXB0IHRleHQgbXVzdCBiZSBhdCBsZWFzdCAxMCBjaGFyYWN0ZXJzLiddXG4gICAgfSxcbiAgICBkZXNjcmlwdGlvbjoge1xuICAgICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICAgIHRyaW06IHRydWUsXG4gICAgICAgIG1heGxlbmd0aDogWzUwMCwgJ0Rlc2NyaXB0aW9uIGNhbm5vdCBleGNlZWQgNTAwIGNoYXJhY3RlcnMuJ11cbiAgICB9LFxuICAgIGNyZWF0b3I6IHtcbiAgICAgICAgdHlwZTogU2NoZW1hLlR5cGVzLk9iamVjdElkLFxuICAgICAgICByZWY6ICdVc2VyJyxcbiAgICAgICAgcmVxdWlyZWQ6IFt0cnVlLCAnQ3JlYXRvciBpcyByZXF1aXJlZC4nXVxuICAgIH0sXG4gICAgdGFnczogW3tcbiAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICB0cmltOiB0cnVlLFxuICAgICAgICBsb3dlcmNhc2U6IHRydWUsIC8vIFN0b3JlIHRhZ3MgY29uc2lzdGVudGx5XG4gICAgICAgIHZhbGlkYXRlOiBbYXJyYXlMaW1pdCwgJ3tQQVRIfSBleGNlZWRzIHRoZSBsaW1pdCBvZiAxMCB0YWdzJ11cbiAgICB9XSxcbiAgICBwbGF0Zm9ybUNvbXBhdGliaWxpdHk6IFt7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZW51bTogU1VQUE9SVEVEX0FJX1BMQVRGT1JNUyAvLyBWYWxpZGF0ZSBhZ2FpbnN0IHRoZSBsaXN0XG4gICAgfV0sXG4gICAgLy8gQmFzaWMgcGVyZm9ybWFuY2UgdHJhY2tpbmcgZmllbGRzXG4gICAgdXNhZ2VDb3VudDoge1xuICAgICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICAgIGRlZmF1bHQ6IDAsXG4gICAgICAgIG1pbjogMFxuICAgIH0sXG4gICAgcmF0aW5nczogW1JhdGluZ1NjaGVtYV0sIC8vIEFycmF5IHRvIHN0b3JlIGluZGl2aWR1YWwgdXNlciByYXRpbmdzXG4gICAgc3VjY2Vzc0NvdW50OiB7XG4gICAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgICAgZGVmYXVsdDogMCxcbiAgICAgICAgbWluOiAwXG4gICAgfSxcbiAgICBmYWlsdXJlQ291bnQ6IHtcbiAgICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgICBkZWZhdWx0OiAwLFxuICAgICAgICBtaW46IDBcbiAgICB9LFxuICAgIHZpc2liaWxpdHk6IHtcbiAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICBlbnVtOiBbJ3ByaXZhdGUnLCAndGVhbScsICdwdWJsaWMnXSwgLy8gRGVmaW5lIHBvc3NpYmxlIHZpc2liaWxpdHkgc3RhdGVzXG4gICAgICAgIGRlZmF1bHQ6ICdwcml2YXRlJywgLy8gRGVmYXVsdCB0byBwcml2YXRlIHVubGVzcyBzcGVjaWZpZWRcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIGluZGV4OiB0cnVlXG4gICAgfSxcbiAgICB0ZWFtSWQ6IHtcbiAgICAgICAgdHlwZTogU2NoZW1hLlR5cGVzLk9iamVjdElkLFxuICAgICAgICByZWY6ICdUZWFtJywgLy8gUmVmZXJlbmNlIHRoZSBUZWFtIG1vZGVsXG4gICAgICAgIGluZGV4OiB0cnVlLFxuICAgICAgICBzcGFyc2U6IHRydWVcbiAgICB9LFxuICAgIGlzRWZmZWN0aXZlOiB7XG4gICAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICAgIGRlZmF1bHQ6IG51bGwsIC8vIFVzZSBudWxsIHRvIHNpZ25pZnkgdW5zZXQvdW5rbm93biBzdGF0dXNcbiAgICAgICAgaW5kZXg6IHRydWVcbiAgICB9LFxuICAgIHZhcmlhYmxlczoge1xuICAgICAgICB0eXBlOiBbU3RyaW5nXSwgLy8gQXJyYXkgb2YgdmFyaWFibGUgbmFtZXMgKGUuZy4sIFtcImN1c3RvbWVyTmFtZVwiLCBcInByb2R1Y3RcIl0pXG4gICAgICAgIGRlZmF1bHQ6IFtdXG4gICAgfSxcbiAgICB2ZXJzaW9uOiB7XG4gICAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgICAgZGVmYXVsdDogMVxuICAgIH0sXG4gICAgLy8gaGlzdG9yeTogW1Byb21wdEhpc3RvcnlTY2hlbWFdIC8vIElmIGltcGxlbWVudGluZyB2ZXJzaW9uIGhpc3RvcnkgbGF0ZXJcbn0sIHtcbiAgICB0aW1lc3RhbXBzOiB0cnVlIC8vIEF1dG9tYXRpY2FsbHkgYWRkIGNyZWF0ZWRBdCBhbmQgdXBkYXRlZEF0XG59KTtcblxuLy8gLS0tIEluZGV4aW5nIC0tLSBcbi8vIEluZGV4IGZpZWxkcyB0aGF0IGFyZSBvZnRlbiBxdWVyaWVkL3NvcnRlZFxuUHJvbXB0U2NoZW1hLmluZGV4KHsgY3JlYXRvcjogMSwgY3JlYXRlZEF0OiAtMSB9KTtcblByb21wdFNjaGVtYS5pbmRleCh7IHRhZ3M6IDEgfSk7XG5Qcm9tcHRTY2hlbWEuaW5kZXgoeyB0aXRsZTogJ3RleHQnLCBkZXNjcmlwdGlvbjogJ3RleHQnIH0pOyAvLyBGb3IgdGV4dCBzZWFyY2ggbGF0ZXJcblByb21wdFNjaGVtYS5pbmRleCh7IHRlYW1JZDogMSB9KTsgLy8gQWRkIGluZGV4IGZvciB0ZWFtSWRcblByb21wdFNjaGVtYS5pbmRleCh7IHRpdGxlOiAndGV4dCcsIHRleHQ6ICd0ZXh0JywgZGVzY3JpcHRpb246ICd0ZXh0JywgdGFnczogJ3RleHQnIH0pO1xuXG4vLyAtLS0gVmlydHVhbHMgKEV4YW1wbGU6IEF2ZXJhZ2UgUmF0aW5nIC0gQ2FsY3VsYXRpb24gbWlnaHQgYmUgY29tcGxleC9kZWZlcnJlZCkgLS0tXG4vKlxuUHJvbXB0U2NoZW1hLnZpcnR1YWwoJ2F2ZXJhZ2VSYXRpbmcnKS5nZXQoZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMucmF0aW5ncyAmJiB0aGlzLnJhdGluZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBzdW0gPSB0aGlzLnJhdGluZ3MucmVkdWNlKChhY2MsIHJhdGluZykgPT4gYWNjICsgcmF0aW5nLnZhbHVlLCAwKTtcbiAgICAgICAgcmV0dXJuIHN1bSAvIHRoaXMucmF0aW5ncy5sZW5ndGg7XG4gICAgfVxuICAgIHJldHVybiAwO1xufSk7XG5cblByb21wdFNjaGVtYS52aXJ0dWFsKCdzdWNjZXNzUmF0ZScpLmdldChmdW5jdGlvbigpIHtcbiAgICBjb25zdCB0b3RhbEZlZWRiYWNrID0gdGhpcy5zdWNjZXNzQ291bnQgKyB0aGlzLmZhaWx1cmVDb3VudDtcbiAgICBpZiAodG90YWxGZWVkYmFjayA9PT0gMCkge1xuICAgICAgICByZXR1cm4gbnVsbDsgLy8gT3IgMCwgZGVwZW5kaW5nIG9uIGRlc2lyZWQgcmVwcmVzZW50YXRpb25cbiAgICB9XG4gICAgcmV0dXJuICh0aGlzLnN1Y2Nlc3NDb3VudCAvIHRvdGFsRmVlZGJhY2spICogMTAwO1xufSk7XG5cbi8vIEVuc3VyZSB2aXJ0dWFscyBhcmUgaW5jbHVkZWQgd2hlbiBjb252ZXJ0aW5nIHRvIEpTT04vT2JqZWN0XG5Qcm9tcHRTY2hlbWEuc2V0KCd0b0pTT04nLCB7IHZpcnR1YWxzOiB0cnVlIH0pO1xuUHJvbXB0U2NoZW1hLnNldCgndG9PYmplY3QnLCB7IHZpcnR1YWxzOiB0cnVlIH0pO1xuKi9cblxuLy8gLS0tIE1vZGVsIENyZWF0aW9uIC0tLVxuY29uc3QgUHJvbXB0ID0gbW9kZWxzLlByb21wdCB8fCBtb25nb29zZS5tb2RlbCgnUHJvbXB0JywgUHJvbXB0U2NoZW1hKTtcblxuZXhwb3J0IGRlZmF1bHQgUHJvbXB0O1xuXG4vLyAtLS0gVmFsaWRhdGlvbiBGdW5jdGlvbiAtLS1cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVByb21wdChkYXRhKSB7XG4gICAgY29uc3QgZXJyb3JzID0ge307XG4gICAgbGV0IGlzVmFsaWQgPSB0cnVlO1xuXG4gICAgLy8gQ2hlY2sgZm9yIHJlcXVpcmVkIGZpZWxkc1xuICAgIGlmICghZGF0YS50aXRsZSB8fCB0eXBlb2YgZGF0YS50aXRsZSAhPT0gJ3N0cmluZycgfHwgZGF0YS50aXRsZS50cmltKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGVycm9ycy50aXRsZSA9ICdUaXRsZSBpcyByZXF1aXJlZC4nO1xuICAgICAgICBpc1ZhbGlkID0gZmFsc2U7XG4gICAgfVxuICAgIC8vIENoZWNrIHRoZSBhY3R1YWwgc2NoZW1hIGZpZWxkICd0ZXh0J1xuICAgIGlmICghZGF0YS50ZXh0IHx8IHR5cGVvZiBkYXRhLnRleHQgIT09ICdzdHJpbmcnIHx8IGRhdGEudGV4dC50cmltKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGVycm9ycy50ZXh0ID0gJ1Byb21wdCB0ZXh0IGlzIHJlcXVpcmVkLic7IC8vIENoYW5nZWQga2V5IHRvICd0ZXh0J1xuICAgICAgICBpc1ZhbGlkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gUG90ZW50aWFsIGZ1dHVyZSBjaGVja3M6IGxlbmd0aCBjb25zdHJhaW50cywgdGFnIGZvcm1hdHMsIGV0Yy5cbiAgICAvLyBOb3RlOiBNb25nb29zZSBzY2hlbWEgdmFsaWRhdGlvbiB3aWxsIGhhbmRsZSBtb3JlIGRldGFpbGVkIGNoZWNrcyBsYXRlci5cblxuICAgIHJldHVybiB7XG4gICAgICAgIGlzVmFsaWQsXG4gICAgICAgIGVycm9yc1xuICAgIH07XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbiBmb3IgYXJyYXkgbGltaXQgdmFsaWRhdGlvblxuZnVuY3Rpb24gYXJyYXlMaW1pdCh2YWwpIHtcbiAgcmV0dXJuIHZhbC5sZW5ndGggPD0gMTA7XG59XG5cbi8vIEVuc3VyZSB0ZWFtSWQgaXMgcHJlc2VudCBpZiB2aXNpYmlsaXR5IGlzICd0ZWFtJ1xuUHJvbXB0U2NoZW1hLnBhdGgoJ3RlYW1JZCcpLnZhbGlkYXRlKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgcmV0dXJuIHRoaXMudmlzaWJpbGl0eSAhPT0gJ3RlYW0nIHx8IHZhbHVlICE9IG51bGw7XG59LCAnVGVhbSBJRCBpcyByZXF1aXJlZCB3aGVuIHZpc2liaWxpdHkgaXMgc2V0IHRvIHRlYW0uJyk7XG5cbi8vIFByZS1zYXZlIGhvb2sgdG8gaW5jcmVtZW50IHZlcnNpb24gKEV4YW1wbGUgLSBhZGp1c3QgaWYgbmVlZGVkKVxuLy8gUHJvbXB0U2NoZW1hLnByZSgnc2F2ZScsIGZ1bmN0aW9uKG5leHQpIHtcbi8vICAgICBpZiAoIXRoaXMuaXNOZXcgJiYgdGhpcy5pc01vZGlmaWVkKCkpIHtcbi8vICAgICAgICAgdGhpcy52ZXJzaW9uICs9IDE7XG4vLyAgICAgfVxuLy8gICAgIG5leHQoKTtcbi8vIH0pO1xuIl0sIm5hbWVzIjpbIm1vbmdvb3NlIiwiU2NoZW1hIiwibW9kZWxzIiwiU1VQUE9SVEVEX0FJX1BMQVRGT1JNUyIsIlJhdGluZ1NjaGVtYSIsInVzZXIiLCJ0eXBlIiwiVHlwZXMiLCJPYmplY3RJZCIsInJlZiIsInJlcXVpcmVkIiwidmFsdWUiLCJOdW1iZXIiLCJtaW4iLCJtYXgiLCJfaWQiLCJQcm9tcHRTY2hlbWEiLCJ0aXRsZSIsIlN0cmluZyIsInRyaW0iLCJtaW5sZW5ndGgiLCJtYXhsZW5ndGgiLCJ0ZXh0IiwiZGVzY3JpcHRpb24iLCJjcmVhdG9yIiwidGFncyIsImxvd2VyY2FzZSIsInZhbGlkYXRlIiwiYXJyYXlMaW1pdCIsInBsYXRmb3JtQ29tcGF0aWJpbGl0eSIsImVudW0iLCJ1c2FnZUNvdW50IiwiZGVmYXVsdCIsInJhdGluZ3MiLCJzdWNjZXNzQ291bnQiLCJmYWlsdXJlQ291bnQiLCJ2aXNpYmlsaXR5IiwiaW5kZXgiLCJ0ZWFtSWQiLCJzcGFyc2UiLCJpc0VmZmVjdGl2ZSIsIkJvb2xlYW4iLCJ2YXJpYWJsZXMiLCJ2ZXJzaW9uIiwidGltZXN0YW1wcyIsImNyZWF0ZWRBdCIsIlByb21wdCIsIm1vZGVsIiwidmFsaWRhdGVQcm9tcHQiLCJkYXRhIiwiZXJyb3JzIiwiaXNWYWxpZCIsImxlbmd0aCIsInZhbCIsInBhdGgiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./models/prompt.js\n");

/***/ }),

/***/ "(api-node)/./models/user.js":
/*!************************!*\
  !*** ./models/user.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   sanitizeUser: () => (/* binding */ sanitizeUser),\n/* harmony export */   validateUser: () => (/* binding */ validateUser)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\n// Define the User Schema using Mongoose\nconst UserSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    username: {\n        type: String,\n        required: [\n            true,\n            'Username is required.'\n        ],\n        unique: [\n            true,\n            'Username already exists.'\n        ],\n        match: [\n            /^(?=.{4,20}$)(?![_.])(?!.*[_.]{2})[a-zA-Z0-9._]+(?<![_.])$/,\n            \"Username invalid, it should contain 4-20 alphanumeric letters and be unique!\"\n        ] // Example regex validation\n    },\n    name: {\n        type: String,\n        required: [\n            true,\n            'Name is required.'\n        ],\n        trim: true\n    },\n    email: {\n        type: String,\n        required: [\n            true,\n            'Email is required.'\n        ],\n        unique: true,\n        lowercase: true,\n        trim: true,\n        match: [\n            /\\S+@\\S+\\.\\S+/,\n            'Please use a valid email address.'\n        ]\n    },\n    password: {\n        type: String,\n        required: [\n            true,\n            'Password is required.'\n        ],\n        select: false // Prevents password hash from being sent by default\n    },\n    image: {\n        type: String\n    },\n    role: {\n        type: String,\n        enum: [\n            'user',\n            'admin'\n        ],\n        default: 'user'\n    },\n    bio: {\n        type: String,\n        maxlength: 160 // Example constraint\n    },\n    preferences: {\n        type: Object // Or define a more specific sub-schema if needed\n    },\n    hasCompletedOnboarding: {\n        type: Boolean,\n        default: false\n    },\n    // --- Payment/Plan Fields ---\n    plan: {\n        type: String,\n        enum: [\n            'Free',\n            'Pro'\n        ],\n        default: 'Free' // Default to the 'Free' plan\n    },\n    promptCount: {\n        type: Number,\n        default: 0,\n        min: 0 // Ensure count doesn't go below zero\n    },\n    stripeCustomerId: {\n        type: String,\n        index: true // Index if you often look up users by Stripe ID\n    }\n}, {\n    timestamps: true\n}); // Enable automatic timestamps\n// Create the User model if it doesn't already exist\nconst User = mongoose__WEBPACK_IMPORTED_MODULE_0__.models.User || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model('User', UserSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (User);\n// Validation for user data (consider adapting to Mongoose validation or using alongside)\nconst validateUser = (data)=>{\n    const errors = {};\n    // Username validation\n    if (!data.username) {\n        errors.username = 'Username is required';\n    } else if (data.username.length < 4 || data.username.length > 20) {\n        errors.username = 'Username must be between 4 and 20 characters';\n    }\n    if (!/^[a-zA-Z0-9._]+$/.test(data.username) || data.username.includes('..') || data.username.startsWith('.') || data.username.endsWith('.') || data.username.startsWith('_') || data.username.endsWith('_')) {\n        // Check if username exists first before applying regex if making optional\n        if (data.username) errors.username = 'Username contains invalid characters.';\n    }\n    // Name validation (removed - no longer required on signup)\n    /*\r\n  if (!data.name) {\r\n    errors.name = 'Name is required';\r\n  } else if (data.name.length < 2) {\r\n    errors.name = 'Name must be at least 2 characters';\r\n  }\r\n  */ // Email validation\n    if (!data.email) {\n        errors.email = 'Email is required';\n    } else if (!/\\S+@\\S+\\.\\S+/.test(data.email)) {\n        errors.email = 'Email is invalid';\n    }\n    // Password validation (for input, not the hash)\n    // Note: Mongoose handles required check. This is for length etc. on signup.\n    if (data.password !== undefined) {\n        if (data.password.length < 8) {\n            errors.password = 'Password must be at least 8 characters';\n        }\n    }\n    return {\n        isValid: Object.keys(errors).length === 0,\n        errors\n    };\n};\n// Method to sanitize user data for client-side (remove sensitive info)\n// Adapt this if you fetch user data using Mongoose and need to hide fields\n// Mongoose 'select: false' on password helps, but this can be used for other fields\nconst sanitizeUser = (user)=>{\n    if (!user) return null;\n    // If user is a Mongoose document, convert to object first\n    const userObject = typeof user.toObject === 'function' ? user.toObject() : user;\n    const { password, __v, ...sanitizedUser } = userObject; // Remove password and __v\n    return sanitizedUser;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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M0N5QixPQUFPekIsS0FBSyxHQUFHO0lBQ2pCO0lBRUEsZ0RBQWdEO0lBQ2hELDRFQUE0RTtJQUM1RSxJQUFJd0IsS0FBS3RCLFFBQVEsS0FBSzZCLFdBQVc7UUFDL0IsSUFBSVAsS0FBS3RCLFFBQVEsQ0FBQ3dCLE1BQU0sR0FBRyxHQUFHO1lBQzVCRCxPQUFPdkIsUUFBUSxHQUFHO1FBQ3BCO0lBQ0Y7SUFFQSxPQUFPO1FBQ0w4QixTQUFTckIsT0FBT3NCLElBQUksQ0FBQ1IsUUFBUUMsTUFBTSxLQUFLO1FBQ3hDRDtJQUNGO0FBQ0YsRUFBRTtBQUVGLHVFQUF1RTtBQUN2RSwyRUFBMkU7QUFDM0Usb0ZBQW9GO0FBQzdFLE1BQU1TLGVBQWUsQ0FBQ0M7SUFDM0IsSUFBSSxDQUFDQSxNQUFNLE9BQU87SUFFbEIsMERBQTBEO0lBQzFELE1BQU1DLGFBQWEsT0FBT0QsS0FBS0UsUUFBUSxLQUFLLGFBQWFGLEtBQUtFLFFBQVEsS0FBS0Y7SUFFM0UsTUFBTSxFQUFFakMsUUFBUSxFQUFFb0MsR0FBRyxFQUFFLEdBQUdDLGVBQWUsR0FBR0gsWUFBWSwwQkFBMEI7SUFDbEYsT0FBT0c7QUFDVCxFQUFFIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXGJhdWRpXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvbXB0UHJvXFxQcm9tcHRQcm9cXG1vZGVsc1xcdXNlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UsIHsgU2NoZW1hLCBtb2RlbHMgfSBmcm9tICdtb25nb29zZSc7XHJcblxyXG4vLyBEZWZpbmUgdGhlIFVzZXIgU2NoZW1hIHVzaW5nIE1vbmdvb3NlXHJcbmNvbnN0IFVzZXJTY2hlbWEgPSBuZXcgU2NoZW1hKHtcclxuICB1c2VybmFtZToge1xyXG4gICAgdHlwZTogU3RyaW5nLFxyXG4gICAgcmVxdWlyZWQ6IFt0cnVlLCAnVXNlcm5hbWUgaXMgcmVxdWlyZWQuJ10sXHJcbiAgICB1bmlxdWU6IFt0cnVlLCAnVXNlcm5hbWUgYWxyZWFkeSBleGlzdHMuJ10sXHJcbiAgICBtYXRjaDogWy9eKD89Lns0LDIwfSQpKD8hW18uXSkoPyEuKltfLl17Mn0pW2EtekEtWjAtOS5fXSsoPzwhW18uXSkkLywgXCJVc2VybmFtZSBpbnZhbGlkLCBpdCBzaG91bGQgY29udGFpbiA0LTIwIGFscGhhbnVtZXJpYyBsZXR0ZXJzIGFuZCBiZSB1bmlxdWUhXCJdIC8vIEV4YW1wbGUgcmVnZXggdmFsaWRhdGlvblxyXG4gIH0sXHJcbiAgbmFtZToge1xyXG4gICAgdHlwZTogU3RyaW5nLFxyXG4gICAgcmVxdWlyZWQ6IFt0cnVlLCAnTmFtZSBpcyByZXF1aXJlZC4nXSxcclxuICAgIHRyaW06IHRydWVcclxuICB9LFxyXG4gIGVtYWlsOiB7XHJcbiAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICByZXF1aXJlZDogW3RydWUsICdFbWFpbCBpcyByZXF1aXJlZC4nXSxcclxuICAgIHVuaXF1ZTogdHJ1ZSxcclxuICAgIGxvd2VyY2FzZTogdHJ1ZSxcclxuICAgIHRyaW06IHRydWUsXHJcbiAgICBtYXRjaDogWy9cXFMrQFxcUytcXC5cXFMrLywgJ1BsZWFzZSB1c2UgYSB2YWxpZCBlbWFpbCBhZGRyZXNzLiddXHJcbiAgfSxcclxuICBwYXNzd29yZDoge1xyXG4gICAgdHlwZTogU3RyaW5nLFxyXG4gICAgcmVxdWlyZWQ6IFt0cnVlLCAnUGFzc3dvcmQgaXMgcmVxdWlyZWQuJ10sIC8vIFdpbGwgc3RvcmUgdGhlIGhhc2hcclxuICAgIHNlbGVjdDogZmFsc2UgLy8gUHJldmVudHMgcGFzc3dvcmQgaGFzaCBmcm9tIGJlaW5nIHNlbnQgYnkgZGVmYXVsdFxyXG4gIH0sXHJcbiAgaW1hZ2U6IHtcclxuICAgIHR5cGU6IFN0cmluZywgLy8gVVJMIHRvIHByb2ZpbGUgaW1hZ2VcclxuICB9LFxyXG4gIHJvbGU6IHtcclxuICAgIHR5cGU6IFN0cmluZyxcclxuICAgIGVudW06IFsndXNlcicsICdhZG1pbiddLFxyXG4gICAgZGVmYXVsdDogJ3VzZXInXHJcbiAgfSxcclxuICBiaW86IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBtYXhsZW5ndGg6IDE2MCAvLyBFeGFtcGxlIGNvbnN0cmFpbnRcclxuICB9LFxyXG4gIHByZWZlcmVuY2VzOiB7XHJcbiAgICAgIHR5cGU6IE9iamVjdCAvLyBPciBkZWZpbmUgYSBtb3JlIHNwZWNpZmljIHN1Yi1zY2hlbWEgaWYgbmVlZGVkXHJcbiAgfSxcclxuICBoYXNDb21wbGV0ZWRPbmJvYXJkaW5nOiB7XHJcbiAgICB0eXBlOiBCb29sZWFuLFxyXG4gICAgZGVmYXVsdDogZmFsc2VcclxuICB9LFxyXG4gIC8vIC0tLSBQYXltZW50L1BsYW4gRmllbGRzIC0tLVxyXG4gIHBsYW46IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBlbnVtOiBbJ0ZyZWUnLCAnUHJvJ10sIC8vIFVzZSAnRnJlZScgYW5kICdQcm8nIGZvciBwbGFuIG5hbWVzXHJcbiAgICAgIGRlZmF1bHQ6ICdGcmVlJyAvLyBEZWZhdWx0IHRvIHRoZSAnRnJlZScgcGxhblxyXG4gIH0sXHJcbiAgcHJvbXB0Q291bnQ6IHtcclxuICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICBkZWZhdWx0OiAwLFxyXG4gICAgICBtaW46IDAgLy8gRW5zdXJlIGNvdW50IGRvZXNuJ3QgZ28gYmVsb3cgemVyb1xyXG4gIH0sXHJcbiAgc3RyaXBlQ3VzdG9tZXJJZDogeyAvLyBPcHRpb25hbDogU3RvcmUgU3RyaXBlIEN1c3RvbWVyIElEIGlmIHVzaW5nIFN0cmlwZVxyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIGluZGV4OiB0cnVlIC8vIEluZGV4IGlmIHlvdSBvZnRlbiBsb29rIHVwIHVzZXJzIGJ5IFN0cmlwZSBJRFxyXG4gIH0sXHJcbiAgLy8gTW9uZ29vc2UgYXV0b21hdGljYWxseSBhZGRzIGNyZWF0ZWRBdCBhbmQgdXBkYXRlZEF0XHJcbn0sIHsgdGltZXN0YW1wczogdHJ1ZSB9KTsgLy8gRW5hYmxlIGF1dG9tYXRpYyB0aW1lc3RhbXBzXHJcblxyXG4vLyBDcmVhdGUgdGhlIFVzZXIgbW9kZWwgaWYgaXQgZG9lc24ndCBhbHJlYWR5IGV4aXN0XHJcbmNvbnN0IFVzZXIgPSBtb2RlbHMuVXNlciB8fCBtb25nb29zZS5tb2RlbCgnVXNlcicsIFVzZXJTY2hlbWEpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgVXNlcjtcclxuXHJcbi8vIFZhbGlkYXRpb24gZm9yIHVzZXIgZGF0YSAoY29uc2lkZXIgYWRhcHRpbmcgdG8gTW9uZ29vc2UgdmFsaWRhdGlvbiBvciB1c2luZyBhbG9uZ3NpZGUpXHJcbmV4cG9ydCBjb25zdCB2YWxpZGF0ZVVzZXIgPSAoZGF0YSkgPT4ge1xyXG4gIGNvbnN0IGVycm9ycyA9IHt9O1xyXG5cclxuICAvLyBVc2VybmFtZSB2YWxpZGF0aW9uXHJcbiAgaWYgKCFkYXRhLnVzZXJuYW1lKSB7XHJcbiAgICAgIGVycm9ycy51c2VybmFtZSA9ICdVc2VybmFtZSBpcyByZXF1aXJlZCc7XHJcbiAgfSBlbHNlIGlmIChkYXRhLnVzZXJuYW1lLmxlbmd0aCA8IDQgfHwgZGF0YS51c2VybmFtZS5sZW5ndGggPiAyMCkge1xyXG4gICAgICBlcnJvcnMudXNlcm5hbWUgPSAnVXNlcm5hbWUgbXVzdCBiZSBiZXR3ZWVuIDQgYW5kIDIwIGNoYXJhY3RlcnMnO1xyXG4gIH1cclxuICBpZiAoIS9eW2EtekEtWjAtOS5fXSskLy50ZXN0KGRhdGEudXNlcm5hbWUpIHx8IGRhdGEudXNlcm5hbWUuaW5jbHVkZXMoJy4uJykgfHwgZGF0YS51c2VybmFtZS5zdGFydHNXaXRoKCcuJykgfHwgZGF0YS51c2VybmFtZS5lbmRzV2l0aCgnLicpIHx8IGRhdGEudXNlcm5hbWUuc3RhcnRzV2l0aCgnXycpIHx8IGRhdGEudXNlcm5hbWUuZW5kc1dpdGgoJ18nKSkge1xyXG4gICAgICAvLyBDaGVjayBpZiB1c2VybmFtZSBleGlzdHMgZmlyc3QgYmVmb3JlIGFwcGx5aW5nIHJlZ2V4IGlmIG1ha2luZyBvcHRpb25hbFxyXG4gICAgICBpZihkYXRhLnVzZXJuYW1lKSBlcnJvcnMudXNlcm5hbWUgPSAnVXNlcm5hbWUgY29udGFpbnMgaW52YWxpZCBjaGFyYWN0ZXJzLic7XHJcbiAgfVxyXG5cclxuICAvLyBOYW1lIHZhbGlkYXRpb24gKHJlbW92ZWQgLSBubyBsb25nZXIgcmVxdWlyZWQgb24gc2lnbnVwKVxyXG4gIC8qXHJcbiAgaWYgKCFkYXRhLm5hbWUpIHtcclxuICAgIGVycm9ycy5uYW1lID0gJ05hbWUgaXMgcmVxdWlyZWQnO1xyXG4gIH0gZWxzZSBpZiAoZGF0YS5uYW1lLmxlbmd0aCA8IDIpIHtcclxuICAgIGVycm9ycy5uYW1lID0gJ05hbWUgbXVzdCBiZSBhdCBsZWFzdCAyIGNoYXJhY3RlcnMnO1xyXG4gIH1cclxuICAqL1xyXG5cclxuICAvLyBFbWFpbCB2YWxpZGF0aW9uXHJcbiAgaWYgKCFkYXRhLmVtYWlsKSB7XHJcbiAgICBlcnJvcnMuZW1haWwgPSAnRW1haWwgaXMgcmVxdWlyZWQnO1xyXG4gIH0gZWxzZSBpZiAoIS9cXFMrQFxcUytcXC5cXFMrLy50ZXN0KGRhdGEuZW1haWwpKSB7XHJcbiAgICBlcnJvcnMuZW1haWwgPSAnRW1haWwgaXMgaW52YWxpZCc7XHJcbiAgfVxyXG5cclxuICAvLyBQYXNzd29yZCB2YWxpZGF0aW9uIChmb3IgaW5wdXQsIG5vdCB0aGUgaGFzaClcclxuICAvLyBOb3RlOiBNb25nb29zZSBoYW5kbGVzIHJlcXVpcmVkIGNoZWNrLiBUaGlzIGlzIGZvciBsZW5ndGggZXRjLiBvbiBzaWdudXAuXHJcbiAgaWYgKGRhdGEucGFzc3dvcmQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgaWYgKGRhdGEucGFzc3dvcmQubGVuZ3RoIDwgOCkge1xyXG4gICAgICBlcnJvcnMucGFzc3dvcmQgPSAnUGFzc3dvcmQgbXVzdCBiZSBhdCBsZWFzdCA4IGNoYXJhY3RlcnMnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGlzVmFsaWQ6IE9iamVjdC5rZXlzKGVycm9ycykubGVuZ3RoID09PSAwLFxyXG4gICAgZXJyb3JzXHJcbiAgfTtcclxufTtcclxuXHJcbi8vIE1ldGhvZCB0byBzYW5pdGl6ZSB1c2VyIGRhdGEgZm9yIGNsaWVudC1zaWRlIChyZW1vdmUgc2Vuc2l0aXZlIGluZm8pXHJcbi8vIEFkYXB0IHRoaXMgaWYgeW91IGZldGNoIHVzZXIgZGF0YSB1c2luZyBNb25nb29zZSBhbmQgbmVlZCB0byBoaWRlIGZpZWxkc1xyXG4vLyBNb25nb29zZSAnc2VsZWN0OiBmYWxzZScgb24gcGFzc3dvcmQgaGVscHMsIGJ1dCB0aGlzIGNhbiBiZSB1c2VkIGZvciBvdGhlciBmaWVsZHNcclxuZXhwb3J0IGNvbnN0IHNhbml0aXplVXNlciA9ICh1c2VyKSA9PiB7XHJcbiAgaWYgKCF1c2VyKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgLy8gSWYgdXNlciBpcyBhIE1vbmdvb3NlIGRvY3VtZW50LCBjb252ZXJ0IHRvIG9iamVjdCBmaXJzdFxyXG4gIGNvbnN0IHVzZXJPYmplY3QgPSB0eXBlb2YgdXNlci50b09iamVjdCA9PT0gJ2Z1bmN0aW9uJyA/IHVzZXIudG9PYmplY3QoKSA6IHVzZXI7XHJcblxyXG4gIGNvbnN0IHsgcGFzc3dvcmQsIF9fdiwgLi4uc2FuaXRpemVkVXNlciB9ID0gdXNlck9iamVjdDsgLy8gUmVtb3ZlIHBhc3N3b3JkIGFuZCBfX3ZcclxuICByZXR1cm4gc2FuaXRpemVkVXNlcjtcclxufTsiXSwibmFtZXMiOlsibW9uZ29vc2UiLCJTY2hlbWEiLCJtb2RlbHMiLCJVc2VyU2NoZW1hIiwidXNlcm5hbWUiLCJ0eXBlIiwiU3RyaW5nIiwicmVxdWlyZWQiLCJ1bmlxdWUiLCJtYXRjaCIsIm5hbWUiLCJ0cmltIiwiZW1haWwiLCJsb3dlcmNhc2UiLCJwYXNzd29yZCIsInNlbGVjdCIsImltYWdlIiwicm9sZSIsImVudW0iLCJkZWZhdWx0IiwiYmlvIiwibWF4bGVuZ3RoIiwicHJlZmVyZW5jZXMiLCJPYmplY3QiLCJoYXNDb21wbGV0ZWRPbmJvYXJkaW5nIiwiQm9vbGVhbiIsInBsYW4iLCJwcm9tcHRDb3VudCIsIk51bWJlciIsIm1pbiIsInN0cmlwZUN1c3RvbWVySWQiLCJpbmRleCIsInRpbWVzdGFtcHMiLCJVc2VyIiwibW9kZWwiLCJ2YWxpZGF0ZVVzZXIiLCJkYXRhIiwiZXJyb3JzIiwibGVuZ3RoIiwidGVzdCIsImluY2x1ZGVzIiwic3RhcnRzV2l0aCIsImVuZHNXaXRoIiwidW5kZWZpbmVkIiwiaXNWYWxpZCIsImtleXMiLCJzYW5pdGl6ZVVzZXIiLCJ1c2VyIiwidXNlck9iamVjdCIsInRvT2JqZWN0IiwiX192Iiwic2FuaXRpemVkVXNlciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./models/user.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fprompts%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cprompts%5C%5Bid%5D.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fprompts%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cprompts%5C%5Bid%5D.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_prompts_id_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\prompts\\[id].js */ \"(api-node)/./pages/api/prompts/[id].js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_prompts_id_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_prompts_id_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_prompts_id_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_prompts_id_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/prompts/[id]\",\n        pathname: \"/api/prompts/[id]\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_prompts_id_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGcHJvbXB0cyUyRiU1QmlkJTVEJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNwcm9tcHRzJTVDJTVCaWQlNUQuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ0U7QUFDMUQ7QUFDMkQ7QUFDM0Q7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHFEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxxREFBUTtBQUNwQztBQUNPLHdCQUF3Qix5R0FBbUI7QUFDbEQ7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxwcm9tcHRzXFxcXFtpZF0uanNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgJ2RlZmF1bHQnKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsICdjb25maWcnKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3Byb21wdHMvW2lkXVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3Byb21wdHMvW2lkXVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fprompts%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cprompts%5C%5Bid%5D.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/prompts/[id].js":
/*!***********************************!*\
  !*** ./pages/api/prompts/[id].js ***!
  \***********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _models_prompt__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../models/prompt */ \"(api-node)/./models/prompt.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/auth */ \"(api-node)/./lib/auth.js\");\n/* harmony import */ var _lib_repositories_promptRepository__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/repositories/promptRepository */ \"(api-node)/./lib/repositories/promptRepository.js\");\n/* harmony import */ var _lib_permissions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/permissions */ \"(api-node)/./lib/permissions.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../lib/db */ \"(api-node)/./lib/db.js\");\n/* harmony import */ var _models_user__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../models/user */ \"(api-node)/./models/user.js\");\n/* harmony import */ var _lib_mongoose__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../lib/mongoose */ \"(api-node)/./lib/mongoose.js\");\n/* harmony import */ var _models_auditLog__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../models/auditLog */ \"(api-node)/./models/auditLog.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_db__WEBPACK_IMPORTED_MODULE_4__]);\n_lib_db__WEBPACK_IMPORTED_MODULE_4__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n // Import User model\n\n // Import audit log helper\nasync function handler(req, res) {\n    const { id } = req.query;\n    // Set cache control headers to prevent caching\n    res.setHeader('Cache-Control', 'no-store, no-cache, must-revalidate, proxy-revalidate');\n    res.setHeader('Pragma', 'no-cache');\n    res.setHeader('Expires', '0');\n    if (!id) {\n        return res.status(400).json({\n            message: 'Prompt ID is required'\n        });\n    }\n    switch(req.method){\n        case 'GET':\n            return getPrompt(req, res, id);\n        case 'PUT':\n            return updatePrompt(req, res, id);\n        case 'DELETE':\n            return deletePrompt(req, res, id);\n        default:\n            return res.status(405).json({\n                message: 'Method not allowed'\n            });\n    }\n}\n// Apply authentication to PUT and DELETE methods\n// GET is public or based on prompt visibility (handled in getPrompt if needed)\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.withAuthForMethods)(handler, [\n    'PUT',\n    'DELETE'\n]));\nasync function getPrompt(req, res, id) {\n    try {\n        const prompt = await _lib_repositories_promptRepository__WEBPACK_IMPORTED_MODULE_2__.getPromptById(id);\n        if (!prompt) {\n            return res.status(404).json({\n                message: 'Prompt not found'\n            });\n        }\n        // Check visibility and permissions for non-public prompts\n        if (prompt.visibility !== 'public') {\n            const sessionUserId = String(req.session?.sub || '');\n            // For private prompts, only the creator can view\n            if (prompt.visibility === 'private') {\n                if (String(prompt.userId) !== sessionUserId) {\n                    return res.status(403).json({\n                        message: 'Not authorized to view this prompt'\n                    });\n                }\n            } else if (prompt.visibility === 'team' && prompt.teamId) {\n                // Skip check if no user is logged in (will be handled by client-side)\n                if (sessionUserId) {\n                    const team = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_4__.getTeamById)(prompt.teamId);\n                    if (!team) {\n                        return res.status(404).json({\n                            message: 'Team not found'\n                        });\n                    }\n                    // Check if user can view the team prompt\n                    if (!(0,_lib_permissions__WEBPACK_IMPORTED_MODULE_3__.canManagePrompt)(team, sessionUserId, prompt, 'view')) {\n                        return res.status(403).json({\n                            message: 'Not authorized to view this prompt'\n                        });\n                    }\n                }\n            }\n        }\n        // Ensure userId is returned as a string for consistent comparison\n        const promptWithStringId = {\n            ...prompt,\n            userId: String(prompt.userId)\n        };\n        return res.status(200).json(promptWithStringId);\n    } catch (error) {\n        console.error('Error getting prompt:', error);\n        return res.status(500).json({\n            message: 'Internal server error'\n        });\n    }\n}\nasync function updatePrompt(req, res, id) {\n    try {\n        // Verify the prompt exists\n        const existingPrompt = await _lib_repositories_promptRepository__WEBPACK_IMPORTED_MODULE_2__.getPromptById(id);\n        if (!existingPrompt) {\n            return res.status(404).json({\n                message: 'Prompt not found'\n            });\n        }\n        // --- Authorization Check ---\n        // Get user ID from session (populated by withAuthForMethods)\n        const sessionUserId = String(req.session?.sub || '');\n        const promptUserId = String(existingPrompt.userId || '');\n        console.log('API - Update - Session User ID:', sessionUserId);\n        console.log('API - Update - Prompt User ID:', promptUserId);\n        // Check authorization based on visibility\n        let authorized = false;\n        // For personal prompts, only creator can edit\n        if (existingPrompt.visibility !== 'team') {\n            authorized = sessionUserId === promptUserId;\n        } else if (existingPrompt.teamId) {\n            const team = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_4__.getTeamById)(existingPrompt.teamId);\n            if (team) {\n                // Check if user can edit this prompt based on their role\n                authorized = (0,_lib_permissions__WEBPACK_IMPORTED_MODULE_3__.canManagePrompt)(team, sessionUserId, existingPrompt, 'edit');\n            }\n        }\n        if (!authorized) {\n            console.error('API Authorization failed: User does not have permission to update this prompt');\n            return res.status(403).json({\n                message: 'Not authorized to update this prompt'\n            });\n        }\n        console.log('API Authorization successful.');\n        // --- End Authorization Check ---\n        // Validate the update data\n        const promptData = req.body;\n        const { isValid, errors } = (0,_models_prompt__WEBPACK_IMPORTED_MODULE_0__.validatePrompt)(promptData);\n        if (!isValid) {\n            return res.status(400).json({\n                message: 'Validation failed',\n                errors\n            });\n        }\n        // Update the prompt - ensure userId isn't overwritten if present in promptData\n        const dataToUpdate = {\n            ...promptData\n        };\n        delete dataToUpdate.userId; // Prevent accidental userId changes\n        const updatedPrompt = await _lib_repositories_promptRepository__WEBPACK_IMPORTED_MODULE_2__.updatePrompt(id, dataToUpdate);\n        if (!updatedPrompt) {\n            // This might happen if the update operation itself failed in the repo\n            return res.status(500).json({\n                message: 'Failed to update prompt in repository'\n            });\n        }\n        // Return the updated prompt, ensuring userId is a string\n        const updatedPromptWithStringId = {\n            ...updatedPrompt,\n            userId: String(updatedPrompt.userId)\n        };\n        return res.status(200).json(updatedPromptWithStringId);\n    } catch (error) {\n        console.error('Error updating prompt:', error);\n        return res.status(500).json({\n            message: 'Internal server error'\n        });\n    }\n}\nasync function deletePrompt(req, res, id) {\n    try {\n        await (0,_lib_mongoose__WEBPACK_IMPORTED_MODULE_6__[\"default\"])(); // Ensure DB connection\n        // Verify the prompt exists\n        const existingPrompt = await _lib_repositories_promptRepository__WEBPACK_IMPORTED_MODULE_2__.getPromptById(id);\n        if (!existingPrompt) {\n            return res.status(404).json({\n                message: 'Prompt not found'\n            });\n        }\n        // --- Authorization Check ---\n        const sessionUserId = String(req.session?.sub || '');\n        const promptOwnerUserId = String(existingPrompt.userId || ''); // Get owner ID from prompt\n        console.log('API - Delete - Session User ID:', sessionUserId);\n        console.log('API - Delete - Prompt Owner User ID:', promptOwnerUserId); // Log owner ID\n        // Check authorization based on visibility\n        let authorized = false;\n        // For personal prompts, only creator can delete\n        if (existingPrompt.visibility !== 'team') {\n            authorized = sessionUserId === promptOwnerUserId;\n        } else if (existingPrompt.teamId) {\n            const team = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_4__.getTeamById)(existingPrompt.teamId);\n            if (team) {\n                // Check if user can delete this prompt based on their role\n                authorized = (0,_lib_permissions__WEBPACK_IMPORTED_MODULE_3__.canManagePrompt)(team, sessionUserId, existingPrompt, 'delete');\n            }\n        }\n        if (!authorized) {\n            console.error('API Delete Authorization failed: User does not have permission to delete this prompt');\n            return res.status(403).json({\n                message: 'Not authorized to delete this prompt'\n            });\n        }\n        console.log('API Delete Authorization successful.');\n        // --- End Authorization Check ---\n        // Fetch prompt title before deleting for the audit log\n        let promptTitle = 'Unknown';\n        let promptTeamId = null;\n        if (existingPrompt.title) {\n            promptTitle = existingPrompt.title;\n        }\n        if (existingPrompt.teamId) {\n            promptTeamId = existingPrompt.teamId.toString();\n        }\n        // Delete the prompt\n        const success = await _lib_repositories_promptRepository__WEBPACK_IMPORTED_MODULE_2__.deletePrompt(id);\n        if (!success) {\n            return res.status(500).json({\n                message: 'Failed to delete prompt'\n            });\n        }\n        // --- Audit Log --- \n        await (0,_models_auditLog__WEBPACK_IMPORTED_MODULE_7__.logAuditEvent)({\n            userId: sessionUserId,\n            action: 'delete_prompt',\n            targetType: 'prompt',\n            targetId: id.toString(),\n            details: {\n                title: promptTitle,\n                creatorId: promptOwnerUserId,\n                teamId: promptTeamId\n            }\n        });\n        // --- End Audit Log ---\n        // --- Decrement User Prompt Count (after successful deletion) ---\n        if (promptOwnerUserId) {\n            try {\n                // Decrement count, ensuring it doesn't go below 0 (though schema has min:0)\n                await _models_user__WEBPACK_IMPORTED_MODULE_5__[\"default\"].updateOne({\n                    _id: promptOwnerUserId,\n                    promptCount: {\n                        $gt: 0\n                    }\n                }, {\n                    $inc: {\n                        promptCount: -1\n                    }\n                });\n                console.log(`Successfully decremented prompt count for user ${promptOwnerUserId}`);\n            } catch (decError) {\n                // Log error but don't fail the main delete operation\n                console.error(`Error decrementing prompt count for user ${promptOwnerUserId}:`, decError);\n            }\n        } else {\n            console.warn(`Could not decrement prompt count: Owner ID missing for prompt ${id}`);\n        }\n        // --- End Decrement ---\n        return res.status(200).json({\n            message: 'Prompt deleted successfully'\n        });\n    } catch (error) {\n        console.error('Error deleting prompt:', error);\n        return res.status(500).json({\n            message: 'Internal server error'\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9wcm9tcHRzL1tpZF0uanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXdEO0FBQ0Q7QUFDd0I7QUFDcEI7QUFDYjtBQUNOLENBQUMsb0JBQW9CO0FBQ2Y7QUFDVyxDQUFDLDBCQUEwQjtBQUVwRixlQUFlUSxRQUFRQyxHQUFHLEVBQUVDLEdBQUc7SUFDN0IsTUFBTSxFQUFFQyxFQUFFLEVBQUUsR0FBR0YsSUFBSUcsS0FBSztJQUV4QiwrQ0FBK0M7SUFDL0NGLElBQUlHLFNBQVMsQ0FBQyxpQkFBaUI7SUFDL0JILElBQUlHLFNBQVMsQ0FBQyxVQUFVO0lBQ3hCSCxJQUFJRyxTQUFTLENBQUMsV0FBVztJQUV6QixJQUFJLENBQUNGLElBQUk7UUFDUCxPQUFPRCxJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLFNBQVM7UUFBd0I7SUFDakU7SUFFQSxPQUFRUCxJQUFJUSxNQUFNO1FBQ2hCLEtBQUs7WUFDSCxPQUFPQyxVQUFVVCxLQUFLQyxLQUFLQztRQUM3QixLQUFLO1lBQ0gsT0FBT1EsYUFBYVYsS0FBS0MsS0FBS0M7UUFDaEMsS0FBSztZQUNILE9BQU9TLGFBQWFYLEtBQUtDLEtBQUtDO1FBQ2hDO1lBQ0UsT0FBT0QsSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsU0FBUztZQUFxQjtJQUNoRTtBQUNGO0FBRUEsaURBQWlEO0FBQ2pELCtFQUErRTtBQUMvRSxpRUFBZWYsNkRBQWtCQSxDQUFDTyxTQUFTO0lBQUM7SUFBTztDQUFTLENBQUMsRUFBQztBQUU5RCxlQUFlVSxVQUFVVCxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsRUFBRTtJQUNuQyxJQUFJO1FBQ0YsTUFBTVUsU0FBUyxNQUFNbkIsNkVBQThCLENBQUNTO1FBRXBELElBQUksQ0FBQ1UsUUFBUTtZQUNYLE9BQU9YLElBQUlJLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVDLFNBQVM7WUFBbUI7UUFDNUQ7UUFFQSwwREFBMEQ7UUFDMUQsSUFBSUssT0FBT0UsVUFBVSxLQUFLLFVBQVU7WUFDbEMsTUFBTUMsZ0JBQWdCQyxPQUFPaEIsSUFBSWlCLE9BQU8sRUFBRUMsT0FBTztZQUVqRCxpREFBaUQ7WUFDakQsSUFBSU4sT0FBT0UsVUFBVSxLQUFLLFdBQVc7Z0JBQ25DLElBQUlFLE9BQU9KLE9BQU9PLE1BQU0sTUFBTUosZUFBZTtvQkFDM0MsT0FBT2QsSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQzt3QkFBRUMsU0FBUztvQkFBcUM7Z0JBQzlFO1lBQ0YsT0FFSyxJQUFJSyxPQUFPRSxVQUFVLEtBQUssVUFBVUYsT0FBT1EsTUFBTSxFQUFFO2dCQUN0RCxzRUFBc0U7Z0JBQ3RFLElBQUlMLGVBQWU7b0JBQ2pCLE1BQU1NLE9BQU8sTUFBTTFCLG9EQUFXQSxDQUFDaUIsT0FBT1EsTUFBTTtvQkFFNUMsSUFBSSxDQUFDQyxNQUFNO3dCQUNULE9BQU9wQixJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDOzRCQUFFQyxTQUFTO3dCQUFpQjtvQkFDMUQ7b0JBRUEseUNBQXlDO29CQUN6QyxJQUFJLENBQUNiLGlFQUFlQSxDQUFDMkIsTUFBTU4sZUFBZUgsUUFBUSxTQUFTO3dCQUN6RCxPQUFPWCxJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDOzRCQUFFQyxTQUFTO3dCQUFxQztvQkFDOUU7Z0JBQ0Y7WUFDRjtRQUNGO1FBRUEsa0VBQWtFO1FBQ2xFLE1BQU1lLHFCQUFxQjtZQUN2QixHQUFHVixNQUFNO1lBQ1RPLFFBQVFILE9BQU9KLE9BQU9PLE1BQU07UUFDaEM7UUFFQSxPQUFPbEIsSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQ2dCO0lBQzlCLEVBQUUsT0FBT0MsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMseUJBQXlCQTtRQUN2QyxPQUFPdEIsSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxTQUFTO1FBQXdCO0lBQ2pFO0FBQ0Y7QUFFQSxlQUFlRyxhQUFhVixHQUFHLEVBQUVDLEdBQUcsRUFBRUMsRUFBRTtJQUN0QyxJQUFJO1FBQ0YsMkJBQTJCO1FBQzNCLE1BQU11QixpQkFBaUIsTUFBTWhDLDZFQUE4QixDQUFDUztRQUU1RCxJQUFJLENBQUN1QixnQkFBZ0I7WUFDbkIsT0FBT3hCLElBQUlJLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVDLFNBQVM7WUFBbUI7UUFDNUQ7UUFFQSw4QkFBOEI7UUFDOUIsNkRBQTZEO1FBQzdELE1BQU1RLGdCQUFnQkMsT0FBT2hCLElBQUlpQixPQUFPLEVBQUVDLE9BQU87UUFDakQsTUFBTVEsZUFBZVYsT0FBT1MsZUFBZU4sTUFBTSxJQUFJO1FBRXJESyxRQUFRRyxHQUFHLENBQUMsbUNBQW1DWjtRQUMvQ1MsUUFBUUcsR0FBRyxDQUFDLGtDQUFrQ0Q7UUFFOUMsMENBQTBDO1FBQzFDLElBQUlFLGFBQWE7UUFFakIsOENBQThDO1FBQzlDLElBQUlILGVBQWVYLFVBQVUsS0FBSyxRQUFRO1lBQ3hDYyxhQUFhYixrQkFBa0JXO1FBQ2pDLE9BRUssSUFBSUQsZUFBZUwsTUFBTSxFQUFFO1lBQzlCLE1BQU1DLE9BQU8sTUFBTTFCLG9EQUFXQSxDQUFDOEIsZUFBZUwsTUFBTTtZQUVwRCxJQUFJQyxNQUFNO2dCQUNSLHlEQUF5RDtnQkFDekRPLGFBQWFsQyxpRUFBZUEsQ0FBQzJCLE1BQU1OLGVBQWVVLGdCQUFnQjtZQUNwRTtRQUNGO1FBRUEsSUFBSSxDQUFDRyxZQUFZO1lBQ2ZKLFFBQVFELEtBQUssQ0FBQztZQUNkLE9BQU90QixJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFQyxTQUFTO1lBQXVDO1FBQ2hGO1FBRUFpQixRQUFRRyxHQUFHLENBQUM7UUFDWixrQ0FBa0M7UUFFbEMsMkJBQTJCO1FBQzNCLE1BQU1FLGFBQWE3QixJQUFJOEIsSUFBSTtRQUMzQixNQUFNLEVBQUVDLE9BQU8sRUFBRUMsTUFBTSxFQUFFLEdBQUd6Qyw4REFBY0EsQ0FBQ3NDO1FBRTNDLElBQUksQ0FBQ0UsU0FBUztZQUNaLE9BQU85QixJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFQyxTQUFTO2dCQUFxQnlCO1lBQU87UUFDckU7UUFFQSwrRUFBK0U7UUFDL0UsTUFBTUMsZUFBZTtZQUFFLEdBQUdKLFVBQVU7UUFBQztRQUNyQyxPQUFPSSxhQUFhZCxNQUFNLEVBQUUsb0NBQW9DO1FBRWhFLE1BQU1lLGdCQUFnQixNQUFNekMsNEVBQTZCLENBQUNTLElBQUkrQjtRQUU5RCxJQUFJLENBQUNDLGVBQWU7WUFDbEIsc0VBQXNFO1lBQ3RFLE9BQU9qQyxJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFQyxTQUFTO1lBQXdDO1FBQ2pGO1FBRUEseURBQXlEO1FBQ3pELE1BQU00Qiw0QkFBNEI7WUFDOUIsR0FBR0QsYUFBYTtZQUNoQmYsUUFBUUgsT0FBT2tCLGNBQWNmLE1BQU07UUFDdkM7UUFFQSxPQUFPbEIsSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQzZCO0lBQzlCLEVBQUUsT0FBT1osT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsMEJBQTBCQTtRQUN4QyxPQUFPdEIsSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxTQUFTO1FBQXdCO0lBQ2pFO0FBQ0Y7QUFFQSxlQUFlSSxhQUFhWCxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsRUFBRTtJQUN0QyxJQUFJO1FBQ0YsTUFBTUwseURBQVNBLElBQUksdUJBQXVCO1FBQzFDLDJCQUEyQjtRQUMzQixNQUFNNEIsaUJBQWlCLE1BQU1oQyw2RUFBOEIsQ0FBQ1M7UUFFNUQsSUFBSSxDQUFDdUIsZ0JBQWdCO1lBQ25CLE9BQU94QixJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFQyxTQUFTO1lBQW1CO1FBQzVEO1FBRUEsOEJBQThCO1FBQzlCLE1BQU1RLGdCQUFnQkMsT0FBT2hCLElBQUlpQixPQUFPLEVBQUVDLE9BQU87UUFDakQsTUFBTWtCLG9CQUFvQnBCLE9BQU9TLGVBQWVOLE1BQU0sSUFBSSxLQUFLLDJCQUEyQjtRQUUxRkssUUFBUUcsR0FBRyxDQUFDLG1DQUFtQ1o7UUFDL0NTLFFBQVFHLEdBQUcsQ0FBQyx3Q0FBd0NTLG9CQUFvQixlQUFlO1FBRXZGLDBDQUEwQztRQUMxQyxJQUFJUixhQUFhO1FBRWpCLGdEQUFnRDtRQUNoRCxJQUFJSCxlQUFlWCxVQUFVLEtBQUssUUFBUTtZQUN4Q2MsYUFBYWIsa0JBQWtCcUI7UUFDakMsT0FFSyxJQUFJWCxlQUFlTCxNQUFNLEVBQUU7WUFDOUIsTUFBTUMsT0FBTyxNQUFNMUIsb0RBQVdBLENBQUM4QixlQUFlTCxNQUFNO1lBRXBELElBQUlDLE1BQU07Z0JBQ1IsMkRBQTJEO2dCQUMzRE8sYUFBYWxDLGlFQUFlQSxDQUFDMkIsTUFBTU4sZUFBZVUsZ0JBQWdCO1lBQ3BFO1FBQ0Y7UUFFQSxJQUFJLENBQUNHLFlBQVk7WUFDZkosUUFBUUQsS0FBSyxDQUFDO1lBQ2QsT0FBT3RCLElBQUlJLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVDLFNBQVM7WUFBdUM7UUFDaEY7UUFFQWlCLFFBQVFHLEdBQUcsQ0FBQztRQUNaLGtDQUFrQztRQUVsQyx1REFBdUQ7UUFDdkQsSUFBSVUsY0FBYztRQUNsQixJQUFJQyxlQUFlO1FBQ25CLElBQUliLGVBQWVjLEtBQUssRUFBRTtZQUN4QkYsY0FBY1osZUFBZWMsS0FBSztRQUNwQztRQUNBLElBQUlkLGVBQWVMLE1BQU0sRUFBRTtZQUN6QmtCLGVBQWViLGVBQWVMLE1BQU0sQ0FBQ29CLFFBQVE7UUFDL0M7UUFFQSxvQkFBb0I7UUFDcEIsTUFBTUMsVUFBVSxNQUFNaEQsNEVBQTZCLENBQUNTO1FBRXBELElBQUksQ0FBQ3VDLFNBQVM7WUFDWixPQUFPeEMsSUFBSUksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsU0FBUztZQUEwQjtRQUNuRTtRQUVBLHFCQUFxQjtRQUNyQixNQUFNVCwrREFBYUEsQ0FBQztZQUNsQnFCLFFBQVFKO1lBQ1IyQixRQUFRO1lBQ1JDLFlBQVk7WUFDWkMsVUFBVTFDLEdBQUdzQyxRQUFRO1lBQ3JCSyxTQUFTO2dCQUFFTixPQUFPRjtnQkFBYVMsV0FBV1Y7Z0JBQW1CaEIsUUFBUWtCO1lBQWE7UUFDcEY7UUFDQSx3QkFBd0I7UUFFeEIsa0VBQWtFO1FBQ2xFLElBQUlGLG1CQUFtQjtZQUNuQixJQUFJO2dCQUNBLDRFQUE0RTtnQkFDNUUsTUFBTXhDLDhEQUFjLENBQ2hCO29CQUFFb0QsS0FBS1o7b0JBQW1CYSxhQUFhO3dCQUFFQyxLQUFLO29CQUFFO2dCQUFFLEdBQ2xEO29CQUFFQyxNQUFNO3dCQUFFRixhQUFhLENBQUM7b0JBQUU7Z0JBQUU7Z0JBRWhDekIsUUFBUUcsR0FBRyxDQUFDLENBQUMsK0NBQStDLEVBQUVTLG1CQUFtQjtZQUNyRixFQUFFLE9BQU9nQixVQUFVO2dCQUNmLHFEQUFxRDtnQkFDckQ1QixRQUFRRCxLQUFLLENBQUMsQ0FBQyx5Q0FBeUMsRUFBRWEsa0JBQWtCLENBQUMsQ0FBQyxFQUFFZ0I7WUFDcEY7UUFDSixPQUFPO1lBQ0g1QixRQUFRNkIsSUFBSSxDQUFDLENBQUMsOERBQThELEVBQUVuRCxJQUFJO1FBQ3RGO1FBQ0Esd0JBQXdCO1FBRXhCLE9BQU9ELElBQUlJLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsU0FBUztRQUE4QjtJQUN2RSxFQUFFLE9BQU9nQixPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQywwQkFBMEJBO1FBQ3hDLE9BQU90QixJQUFJSSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLFNBQVM7UUFBd0I7SUFDakU7QUFDRiIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxiYXVkaVxcT25lRHJpdmVcXERlc2t0b3BcXFByb21wdFByb1xcUHJvbXB0UHJvXFxwYWdlc1xcYXBpXFxwcm9tcHRzXFxbaWRdLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHZhbGlkYXRlUHJvbXB0IH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL3Byb21wdCc7XHJcbmltcG9ydCB7IHdpdGhBdXRoRm9yTWV0aG9kcyB9IGZyb20gJy4uLy4uLy4uL2xpYi9hdXRoJztcclxuaW1wb3J0ICogYXMgcHJvbXB0UmVwb3NpdG9yeSBmcm9tICcuLi8uLi8uLi9saWIvcmVwb3NpdG9yaWVzL3Byb21wdFJlcG9zaXRvcnknO1xyXG5pbXBvcnQgeyBjYW5NYW5hZ2VQcm9tcHQgfSBmcm9tICcuLi8uLi8uLi9saWIvcGVybWlzc2lvbnMnO1xyXG5pbXBvcnQgeyBnZXRUZWFtQnlJZCB9IGZyb20gJy4uLy4uLy4uL2xpYi9kYic7XHJcbmltcG9ydCBVc2VyIGZyb20gJy4uLy4uLy4uL21vZGVscy91c2VyJzsgLy8gSW1wb3J0IFVzZXIgbW9kZWxcclxuaW1wb3J0IGNvbm5lY3REQiBmcm9tICcuLi8uLi8uLi9saWIvbW9uZ29vc2UnO1xyXG5pbXBvcnQgeyBsb2dBdWRpdEV2ZW50IH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL2F1ZGl0TG9nJzsgLy8gSW1wb3J0IGF1ZGl0IGxvZyBoZWxwZXJcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMpIHtcclxuICBjb25zdCB7IGlkIH0gPSByZXEucXVlcnk7XHJcbiAgXHJcbiAgLy8gU2V0IGNhY2hlIGNvbnRyb2wgaGVhZGVycyB0byBwcmV2ZW50IGNhY2hpbmdcclxuICByZXMuc2V0SGVhZGVyKCdDYWNoZS1Db250cm9sJywgJ25vLXN0b3JlLCBuby1jYWNoZSwgbXVzdC1yZXZhbGlkYXRlLCBwcm94eS1yZXZhbGlkYXRlJyk7XHJcbiAgcmVzLnNldEhlYWRlcignUHJhZ21hJywgJ25vLWNhY2hlJyk7XHJcbiAgcmVzLnNldEhlYWRlcignRXhwaXJlcycsICcwJyk7XHJcbiAgXHJcbiAgaWYgKCFpZCkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ1Byb21wdCBJRCBpcyByZXF1aXJlZCcgfSk7XHJcbiAgfVxyXG4gIFxyXG4gIHN3aXRjaCAocmVxLm1ldGhvZCkge1xyXG4gICAgY2FzZSAnR0VUJzpcclxuICAgICAgcmV0dXJuIGdldFByb21wdChyZXEsIHJlcywgaWQpO1xyXG4gICAgY2FzZSAnUFVUJzpcclxuICAgICAgcmV0dXJuIHVwZGF0ZVByb21wdChyZXEsIHJlcywgaWQpO1xyXG4gICAgY2FzZSAnREVMRVRFJzpcclxuICAgICAgcmV0dXJuIGRlbGV0ZVByb21wdChyZXEsIHJlcywgaWQpO1xyXG4gICAgZGVmYXVsdDpcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgbWVzc2FnZTogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBBcHBseSBhdXRoZW50aWNhdGlvbiB0byBQVVQgYW5kIERFTEVURSBtZXRob2RzXHJcbi8vIEdFVCBpcyBwdWJsaWMgb3IgYmFzZWQgb24gcHJvbXB0IHZpc2liaWxpdHkgKGhhbmRsZWQgaW4gZ2V0UHJvbXB0IGlmIG5lZWRlZClcclxuZXhwb3J0IGRlZmF1bHQgd2l0aEF1dGhGb3JNZXRob2RzKGhhbmRsZXIsIFsnUFVUJywgJ0RFTEVURSddKTtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldFByb21wdChyZXEsIHJlcywgaWQpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgcHJvbXB0ID0gYXdhaXQgcHJvbXB0UmVwb3NpdG9yeS5nZXRQcm9tcHRCeUlkKGlkKTtcclxuICAgIFxyXG4gICAgaWYgKCFwcm9tcHQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ1Byb21wdCBub3QgZm91bmQnIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDaGVjayB2aXNpYmlsaXR5IGFuZCBwZXJtaXNzaW9ucyBmb3Igbm9uLXB1YmxpYyBwcm9tcHRzXHJcbiAgICBpZiAocHJvbXB0LnZpc2liaWxpdHkgIT09ICdwdWJsaWMnKSB7XHJcbiAgICAgIGNvbnN0IHNlc3Npb25Vc2VySWQgPSBTdHJpbmcocmVxLnNlc3Npb24/LnN1YiB8fCAnJyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBGb3IgcHJpdmF0ZSBwcm9tcHRzLCBvbmx5IHRoZSBjcmVhdG9yIGNhbiB2aWV3XHJcbiAgICAgIGlmIChwcm9tcHQudmlzaWJpbGl0eSA9PT0gJ3ByaXZhdGUnKSB7XHJcbiAgICAgICAgaWYgKFN0cmluZyhwcm9tcHQudXNlcklkKSAhPT0gc2Vzc2lvblVzZXJJZCkge1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgbWVzc2FnZTogJ05vdCBhdXRob3JpemVkIHRvIHZpZXcgdGhpcyBwcm9tcHQnIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBcclxuICAgICAgLy8gRm9yIHRlYW0gcHJvbXB0cywgY2hlY2sgdGVhbSBtZW1iZXJzaGlwXHJcbiAgICAgIGVsc2UgaWYgKHByb21wdC52aXNpYmlsaXR5ID09PSAndGVhbScgJiYgcHJvbXB0LnRlYW1JZCkge1xyXG4gICAgICAgIC8vIFNraXAgY2hlY2sgaWYgbm8gdXNlciBpcyBsb2dnZWQgaW4gKHdpbGwgYmUgaGFuZGxlZCBieSBjbGllbnQtc2lkZSlcclxuICAgICAgICBpZiAoc2Vzc2lvblVzZXJJZCkge1xyXG4gICAgICAgICAgY29uc3QgdGVhbSA9IGF3YWl0IGdldFRlYW1CeUlkKHByb21wdC50ZWFtSWQpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAoIXRlYW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ1RlYW0gbm90IGZvdW5kJyB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8gQ2hlY2sgaWYgdXNlciBjYW4gdmlldyB0aGUgdGVhbSBwcm9tcHRcclxuICAgICAgICAgIGlmICghY2FuTWFuYWdlUHJvbXB0KHRlYW0sIHNlc3Npb25Vc2VySWQsIHByb21wdCwgJ3ZpZXcnKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnTm90IGF1dGhvcml6ZWQgdG8gdmlldyB0aGlzIHByb21wdCcgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEVuc3VyZSB1c2VySWQgaXMgcmV0dXJuZWQgYXMgYSBzdHJpbmcgZm9yIGNvbnNpc3RlbnQgY29tcGFyaXNvblxyXG4gICAgY29uc3QgcHJvbXB0V2l0aFN0cmluZ0lkID0ge1xyXG4gICAgICAgIC4uLnByb21wdCxcclxuICAgICAgICB1c2VySWQ6IFN0cmluZyhwcm9tcHQudXNlcklkKVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHByb21wdFdpdGhTdHJpbmdJZCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgcHJvbXB0OicsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xyXG4gIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlUHJvbXB0KHJlcSwgcmVzLCBpZCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBWZXJpZnkgdGhlIHByb21wdCBleGlzdHNcclxuICAgIGNvbnN0IGV4aXN0aW5nUHJvbXB0ID0gYXdhaXQgcHJvbXB0UmVwb3NpdG9yeS5nZXRQcm9tcHRCeUlkKGlkKTtcclxuICAgIFxyXG4gICAgaWYgKCFleGlzdGluZ1Byb21wdCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnUHJvbXB0IG5vdCBmb3VuZCcgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIC0tLSBBdXRob3JpemF0aW9uIENoZWNrIC0tLVxyXG4gICAgLy8gR2V0IHVzZXIgSUQgZnJvbSBzZXNzaW9uIChwb3B1bGF0ZWQgYnkgd2l0aEF1dGhGb3JNZXRob2RzKVxyXG4gICAgY29uc3Qgc2Vzc2lvblVzZXJJZCA9IFN0cmluZyhyZXEuc2Vzc2lvbj8uc3ViIHx8ICcnKTtcclxuICAgIGNvbnN0IHByb21wdFVzZXJJZCA9IFN0cmluZyhleGlzdGluZ1Byb21wdC51c2VySWQgfHwgJycpO1xyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygnQVBJIC0gVXBkYXRlIC0gU2Vzc2lvbiBVc2VyIElEOicsIHNlc3Npb25Vc2VySWQpO1xyXG4gICAgY29uc29sZS5sb2coJ0FQSSAtIFVwZGF0ZSAtIFByb21wdCBVc2VyIElEOicsIHByb21wdFVzZXJJZCk7XHJcbiAgICBcclxuICAgIC8vIENoZWNrIGF1dGhvcml6YXRpb24gYmFzZWQgb24gdmlzaWJpbGl0eVxyXG4gICAgbGV0IGF1dGhvcml6ZWQgPSBmYWxzZTtcclxuICAgIFxyXG4gICAgLy8gRm9yIHBlcnNvbmFsIHByb21wdHMsIG9ubHkgY3JlYXRvciBjYW4gZWRpdFxyXG4gICAgaWYgKGV4aXN0aW5nUHJvbXB0LnZpc2liaWxpdHkgIT09ICd0ZWFtJykge1xyXG4gICAgICBhdXRob3JpemVkID0gc2Vzc2lvblVzZXJJZCA9PT0gcHJvbXB0VXNlcklkO1xyXG4gICAgfSBcclxuICAgIC8vIEZvciB0ZWFtIHByb21wdHMsIHVzZSByb2xlLWJhc2VkIHBlcm1pc3Npb25zXHJcbiAgICBlbHNlIGlmIChleGlzdGluZ1Byb21wdC50ZWFtSWQpIHtcclxuICAgICAgY29uc3QgdGVhbSA9IGF3YWl0IGdldFRlYW1CeUlkKGV4aXN0aW5nUHJvbXB0LnRlYW1JZCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAodGVhbSkge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIHVzZXIgY2FuIGVkaXQgdGhpcyBwcm9tcHQgYmFzZWQgb24gdGhlaXIgcm9sZVxyXG4gICAgICAgIGF1dGhvcml6ZWQgPSBjYW5NYW5hZ2VQcm9tcHQodGVhbSwgc2Vzc2lvblVzZXJJZCwgZXhpc3RpbmdQcm9tcHQsICdlZGl0Jyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKCFhdXRob3JpemVkKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0FQSSBBdXRob3JpemF0aW9uIGZhaWxlZDogVXNlciBkb2VzIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gdXBkYXRlIHRoaXMgcHJvbXB0Jyk7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byB1cGRhdGUgdGhpcyBwcm9tcHQnIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygnQVBJIEF1dGhvcml6YXRpb24gc3VjY2Vzc2Z1bC4nKTtcclxuICAgIC8vIC0tLSBFbmQgQXV0aG9yaXphdGlvbiBDaGVjayAtLS1cclxuICAgIFxyXG4gICAgLy8gVmFsaWRhdGUgdGhlIHVwZGF0ZSBkYXRhXHJcbiAgICBjb25zdCBwcm9tcHREYXRhID0gcmVxLmJvZHk7XHJcbiAgICBjb25zdCB7IGlzVmFsaWQsIGVycm9ycyB9ID0gdmFsaWRhdGVQcm9tcHQocHJvbXB0RGF0YSk7XHJcbiAgICBcclxuICAgIGlmICghaXNWYWxpZCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnVmFsaWRhdGlvbiBmYWlsZWQnLCBlcnJvcnMgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFVwZGF0ZSB0aGUgcHJvbXB0IC0gZW5zdXJlIHVzZXJJZCBpc24ndCBvdmVyd3JpdHRlbiBpZiBwcmVzZW50IGluIHByb21wdERhdGFcclxuICAgIGNvbnN0IGRhdGFUb1VwZGF0ZSA9IHsgLi4ucHJvbXB0RGF0YSB9O1xyXG4gICAgZGVsZXRlIGRhdGFUb1VwZGF0ZS51c2VySWQ7IC8vIFByZXZlbnQgYWNjaWRlbnRhbCB1c2VySWQgY2hhbmdlc1xyXG4gICAgXHJcbiAgICBjb25zdCB1cGRhdGVkUHJvbXB0ID0gYXdhaXQgcHJvbXB0UmVwb3NpdG9yeS51cGRhdGVQcm9tcHQoaWQsIGRhdGFUb1VwZGF0ZSk7XHJcbiAgICBcclxuICAgIGlmICghdXBkYXRlZFByb21wdCkge1xyXG4gICAgICAvLyBUaGlzIG1pZ2h0IGhhcHBlbiBpZiB0aGUgdXBkYXRlIG9wZXJhdGlvbiBpdHNlbGYgZmFpbGVkIGluIHRoZSByZXBvXHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gdXBkYXRlIHByb21wdCBpbiByZXBvc2l0b3J5JyB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gUmV0dXJuIHRoZSB1cGRhdGVkIHByb21wdCwgZW5zdXJpbmcgdXNlcklkIGlzIGEgc3RyaW5nXHJcbiAgICBjb25zdCB1cGRhdGVkUHJvbXB0V2l0aFN0cmluZ0lkID0ge1xyXG4gICAgICAgIC4uLnVwZGF0ZWRQcm9tcHQsXHJcbiAgICAgICAgdXNlcklkOiBTdHJpbmcodXBkYXRlZFByb21wdC51c2VySWQpXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24odXBkYXRlZFByb21wdFdpdGhTdHJpbmdJZCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHByb21wdDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9KTtcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVByb21wdChyZXEsIHJlcywgaWQpIHtcclxuICB0cnkge1xyXG4gICAgYXdhaXQgY29ubmVjdERCKCk7IC8vIEVuc3VyZSBEQiBjb25uZWN0aW9uXHJcbiAgICAvLyBWZXJpZnkgdGhlIHByb21wdCBleGlzdHNcclxuICAgIGNvbnN0IGV4aXN0aW5nUHJvbXB0ID0gYXdhaXQgcHJvbXB0UmVwb3NpdG9yeS5nZXRQcm9tcHRCeUlkKGlkKTtcclxuICAgIFxyXG4gICAgaWYgKCFleGlzdGluZ1Byb21wdCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnUHJvbXB0IG5vdCBmb3VuZCcgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIC0tLSBBdXRob3JpemF0aW9uIENoZWNrIC0tLVxyXG4gICAgY29uc3Qgc2Vzc2lvblVzZXJJZCA9IFN0cmluZyhyZXEuc2Vzc2lvbj8uc3ViIHx8ICcnKTtcclxuICAgIGNvbnN0IHByb21wdE93bmVyVXNlcklkID0gU3RyaW5nKGV4aXN0aW5nUHJvbXB0LnVzZXJJZCB8fCAnJyk7IC8vIEdldCBvd25lciBJRCBmcm9tIHByb21wdFxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygnQVBJIC0gRGVsZXRlIC0gU2Vzc2lvbiBVc2VyIElEOicsIHNlc3Npb25Vc2VySWQpO1xyXG4gICAgY29uc29sZS5sb2coJ0FQSSAtIERlbGV0ZSAtIFByb21wdCBPd25lciBVc2VyIElEOicsIHByb21wdE93bmVyVXNlcklkKTsgLy8gTG9nIG93bmVyIElEXHJcbiAgICBcclxuICAgIC8vIENoZWNrIGF1dGhvcml6YXRpb24gYmFzZWQgb24gdmlzaWJpbGl0eVxyXG4gICAgbGV0IGF1dGhvcml6ZWQgPSBmYWxzZTtcclxuICAgIFxyXG4gICAgLy8gRm9yIHBlcnNvbmFsIHByb21wdHMsIG9ubHkgY3JlYXRvciBjYW4gZGVsZXRlXHJcbiAgICBpZiAoZXhpc3RpbmdQcm9tcHQudmlzaWJpbGl0eSAhPT0gJ3RlYW0nKSB7XHJcbiAgICAgIGF1dGhvcml6ZWQgPSBzZXNzaW9uVXNlcklkID09PSBwcm9tcHRPd25lclVzZXJJZDtcclxuICAgIH0gXHJcbiAgICAvLyBGb3IgdGVhbSBwcm9tcHRzLCB1c2Ugcm9sZS1iYXNlZCBwZXJtaXNzaW9uc1xyXG4gICAgZWxzZSBpZiAoZXhpc3RpbmdQcm9tcHQudGVhbUlkKSB7XHJcbiAgICAgIGNvbnN0IHRlYW0gPSBhd2FpdCBnZXRUZWFtQnlJZChleGlzdGluZ1Byb21wdC50ZWFtSWQpO1xyXG4gICAgICBcclxuICAgICAgaWYgKHRlYW0pIHtcclxuICAgICAgICAvLyBDaGVjayBpZiB1c2VyIGNhbiBkZWxldGUgdGhpcyBwcm9tcHQgYmFzZWQgb24gdGhlaXIgcm9sZVxyXG4gICAgICAgIGF1dGhvcml6ZWQgPSBjYW5NYW5hZ2VQcm9tcHQodGVhbSwgc2Vzc2lvblVzZXJJZCwgZXhpc3RpbmdQcm9tcHQsICdkZWxldGUnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoIWF1dGhvcml6ZWQpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignQVBJIERlbGV0ZSBBdXRob3JpemF0aW9uIGZhaWxlZDogVXNlciBkb2VzIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gZGVsZXRlIHRoaXMgcHJvbXB0Jyk7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byBkZWxldGUgdGhpcyBwcm9tcHQnIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygnQVBJIERlbGV0ZSBBdXRob3JpemF0aW9uIHN1Y2Nlc3NmdWwuJyk7XHJcbiAgICAvLyAtLS0gRW5kIEF1dGhvcml6YXRpb24gQ2hlY2sgLS0tXHJcbiAgICBcclxuICAgIC8vIEZldGNoIHByb21wdCB0aXRsZSBiZWZvcmUgZGVsZXRpbmcgZm9yIHRoZSBhdWRpdCBsb2dcclxuICAgIGxldCBwcm9tcHRUaXRsZSA9ICdVbmtub3duJztcclxuICAgIGxldCBwcm9tcHRUZWFtSWQgPSBudWxsO1xyXG4gICAgaWYgKGV4aXN0aW5nUHJvbXB0LnRpdGxlKSB7XHJcbiAgICAgIHByb21wdFRpdGxlID0gZXhpc3RpbmdQcm9tcHQudGl0bGU7XHJcbiAgICB9XHJcbiAgICBpZiAoZXhpc3RpbmdQcm9tcHQudGVhbUlkKSB7XHJcbiAgICAgIHByb21wdFRlYW1JZCA9IGV4aXN0aW5nUHJvbXB0LnRlYW1JZC50b1N0cmluZygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERlbGV0ZSB0aGUgcHJvbXB0XHJcbiAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgcHJvbXB0UmVwb3NpdG9yeS5kZWxldGVQcm9tcHQoaWQpO1xyXG4gICAgXHJcbiAgICBpZiAoIXN1Y2Nlc3MpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBkZWxldGUgcHJvbXB0JyB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyAtLS0gQXVkaXQgTG9nIC0tLSBcclxuICAgIGF3YWl0IGxvZ0F1ZGl0RXZlbnQoe1xyXG4gICAgICB1c2VySWQ6IHNlc3Npb25Vc2VySWQsIC8vIFVzZXIgcGVyZm9ybWluZyB0aGUgZGVsZXRlXHJcbiAgICAgIGFjdGlvbjogJ2RlbGV0ZV9wcm9tcHQnLFxyXG4gICAgICB0YXJnZXRUeXBlOiAncHJvbXB0JyxcclxuICAgICAgdGFyZ2V0SWQ6IGlkLnRvU3RyaW5nKCksXHJcbiAgICAgIGRldGFpbHM6IHsgdGl0bGU6IHByb21wdFRpdGxlLCBjcmVhdG9ySWQ6IHByb21wdE93bmVyVXNlcklkLCB0ZWFtSWQ6IHByb21wdFRlYW1JZCB9XHJcbiAgICB9KTtcclxuICAgIC8vIC0tLSBFbmQgQXVkaXQgTG9nIC0tLVxyXG5cclxuICAgIC8vIC0tLSBEZWNyZW1lbnQgVXNlciBQcm9tcHQgQ291bnQgKGFmdGVyIHN1Y2Nlc3NmdWwgZGVsZXRpb24pIC0tLVxyXG4gICAgaWYgKHByb21wdE93bmVyVXNlcklkKSB7IC8vIEVuc3VyZSB3ZSBoYXZlIGFuIG93bmVyIElEXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gRGVjcmVtZW50IGNvdW50LCBlbnN1cmluZyBpdCBkb2Vzbid0IGdvIGJlbG93IDAgKHRob3VnaCBzY2hlbWEgaGFzIG1pbjowKVxyXG4gICAgICAgICAgICBhd2FpdCBVc2VyLnVwZGF0ZU9uZShcclxuICAgICAgICAgICAgICAgIHsgX2lkOiBwcm9tcHRPd25lclVzZXJJZCwgcHJvbXB0Q291bnQ6IHsgJGd0OiAwIH0gfSwgLy8gT25seSBkZWNyZW1lbnQgaWYgY291bnQgPiAwXHJcbiAgICAgICAgICAgICAgICB7ICRpbmM6IHsgcHJvbXB0Q291bnQ6IC0xIH0gfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgU3VjY2Vzc2Z1bGx5IGRlY3JlbWVudGVkIHByb21wdCBjb3VudCBmb3IgdXNlciAke3Byb21wdE93bmVyVXNlcklkfWApO1xyXG4gICAgICAgIH0gY2F0Y2ggKGRlY0Vycm9yKSB7XHJcbiAgICAgICAgICAgIC8vIExvZyBlcnJvciBidXQgZG9uJ3QgZmFpbCB0aGUgbWFpbiBkZWxldGUgb3BlcmF0aW9uXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGRlY3JlbWVudGluZyBwcm9tcHQgY291bnQgZm9yIHVzZXIgJHtwcm9tcHRPd25lclVzZXJJZH06YCwgZGVjRXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKGBDb3VsZCBub3QgZGVjcmVtZW50IHByb21wdCBjb3VudDogT3duZXIgSUQgbWlzc2luZyBmb3IgcHJvbXB0ICR7aWR9YCk7XHJcbiAgICB9XHJcbiAgICAvLyAtLS0gRW5kIERlY3JlbWVudCAtLS1cclxuICAgIFxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgbWVzc2FnZTogJ1Byb21wdCBkZWxldGVkIHN1Y2Nlc3NmdWxseScgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRlbGV0aW5nIHByb21wdDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9KTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbInZhbGlkYXRlUHJvbXB0Iiwid2l0aEF1dGhGb3JNZXRob2RzIiwicHJvbXB0UmVwb3NpdG9yeSIsImNhbk1hbmFnZVByb21wdCIsImdldFRlYW1CeUlkIiwiVXNlciIsImNvbm5lY3REQiIsImxvZ0F1ZGl0RXZlbnQiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwiaWQiLCJxdWVyeSIsInNldEhlYWRlciIsInN0YXR1cyIsImpzb24iLCJtZXNzYWdlIiwibWV0aG9kIiwiZ2V0UHJvbXB0IiwidXBkYXRlUHJvbXB0IiwiZGVsZXRlUHJvbXB0IiwicHJvbXB0IiwiZ2V0UHJvbXB0QnlJZCIsInZpc2liaWxpdHkiLCJzZXNzaW9uVXNlcklkIiwiU3RyaW5nIiwic2Vzc2lvbiIsInN1YiIsInVzZXJJZCIsInRlYW1JZCIsInRlYW0iLCJwcm9tcHRXaXRoU3RyaW5nSWQiLCJlcnJvciIsImNvbnNvbGUiLCJleGlzdGluZ1Byb21wdCIsInByb21wdFVzZXJJZCIsImxvZyIsImF1dGhvcml6ZWQiLCJwcm9tcHREYXRhIiwiYm9keSIsImlzVmFsaWQiLCJlcnJvcnMiLCJkYXRhVG9VcGRhdGUiLCJ1cGRhdGVkUHJvbXB0IiwidXBkYXRlZFByb21wdFdpdGhTdHJpbmdJZCIsInByb21wdE93bmVyVXNlcklkIiwicHJvbXB0VGl0bGUiLCJwcm9tcHRUZWFtSWQiLCJ0aXRsZSIsInRvU3RyaW5nIiwic3VjY2VzcyIsImFjdGlvbiIsInRhcmdldFR5cGUiLCJ0YXJnZXRJZCIsImRldGFpbHMiLCJjcmVhdG9ySWQiLCJ1cGRhdGVPbmUiLCJfaWQiLCJwcm9tcHRDb3VudCIsIiRndCIsIiRpbmMiLCJkZWNFcnJvciIsIndhcm4iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/prompts/[id].js\n");

/***/ }),

/***/ "bcryptjs":
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/***/ ((module) => {

module.exports = import("bcryptjs");;

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "mongoose":
/*!***************************!*\
  !*** external "mongoose" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("mongoose");

/***/ }),

/***/ "next-auth/jwt":
/*!********************************!*\
  !*** external "next-auth/jwt" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("next-auth/jwt");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fprompts%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cprompts%5C%5Bid%5D.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();